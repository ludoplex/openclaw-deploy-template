{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"00ecbf0d-2752-4406-8be8-44edf166ecf8","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:40:34.703Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","serverBubbleId":"d3e540eb-5858-4eff-b94c-314701615270","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","capabilityType":30,"thinking":{"text":"Now let me update the background diagnostics wrapper to include MitmAudit as an option. Let me also check for any lint issues.","signature":"EqcCCkYIChgCKkApbTKcqVfbWhuW+Fqcw6D/piuaktPObasT5yRjTN1zfArvzqwhelS0CIMPHtyNR5hX2p03ylNiqVjTB3/if/8IEgzhatMMSDLmw7xeUlUaDIdFXS9NN/iQCFqsBCIw7YdiJlyNmCRfiR22OFTOTFcqY9ElE4KpFjgT60lE6OqTO6TZxVQ2zqPpkPOz+AkUKo4BySLjw0yso12HAe0jP6h8U+5xxR2+vAo5qQ6e9KkBftwZBPmDV37wNWyW2FqMXXJdps89Cgy++YckFXlQm1p8qbxyel8dp/3h9CJw+9IOWbyPXmtaKRdscM8ZcLLmmxN7TVRjCPc4T3CIhd1bb8nP8GzW19JXBd+MZ7keaNd8VEnABSKMSrL/DHNnBsP69xgB"},"thinkingStyle":1,"thinkingDurationMs":807},"bubbleId":"00ecbf0d-2752-4406-8be8-44edf166ecf8"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"08da0bd7-ef45-4285-acdc-97409bba9856","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:34:28.837Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","capabilityType":15,"toolFormerData":{"tool":40,"toolIndex":1,"modelCallId":"d22820b8-667d-4282-98cc-d8869a06cd7f","toolCallId":"toolu_015CBews2EKAvq6wGPpzMJet","status":"completed","rawArgs":"{\"target_file\": \"AGENT_ONBOARD.md\"}","name":"read_file","params":"{\"targetFile\":\"AGENT_ONBOARD.md\",\"charsLimit\":100000,\"effectiveUri\":\"file:///c%3A/Users/user/Downloads/Cursor_working_directory_misc/AGENT_ONBOARD.md\"}","additionalData":{},"result":"{\"contents\":\"# AGENT ONBOARDING - READ FIRST\\n\\n**STOP. Before generating any code, read this file completely.**\\n\\nThis workspace uses pre-built helper scripts and templates to minimize token consumption and maximize code quality. Do NOT generate multi-step shell/git commands manually. Use the scripts below.\\n\\n---\\n\\n## Critical Rules\\n\\n1. **No emojis** in source code, configs, or documentation\\n2. **Default languages**: PowerShell (Windows), POSIX sh (Unix), C17, AMD64/ARM64 assembly\\n3. **Universal config paradigm**: One `.cfg` file consumed by three scripts (POSIX sh, PowerShell v5, PowerShell v7)\\n4. **Use existing scripts** instead of generating equivalent commands\\n5. **BSD-2-Clause** license with DCO sign-off required\\n6. **Check BROKEN_SCRIPTS.md** for scripts that need verification before use\\n\\n---\\n\\n## CRITICAL: NEVER DELEGATE WORK TO THE USER\\n\\n**THIS IS NON-NEGOTIABLE. READ CAREFULLY.**\\n\\nAgents exist to DO THE WORK. The user is NOT your assistant. You are THEIR assistant.\\n\\n- NEVER ask the user to run commands for you\\n- NEVER ask the user to copy-paste output\\n- NEVER ask the user to check something manually\\n- NEVER say \\\"please run this in your terminal\\\"\\n- USE the native shell tool directly (shell bug resolved 2025-12-14)\\n\\nIf you cannot complete a task, explain WHY and propose an AUTOMATED solution. Do NOT make the user do your job.\\n\\n---\\n\\n## GENERAL Scripts, SPECIFIC Tasks\\n\\n**CRITICAL CONCEPT:** The scripts in this workspace are GENERAL-PURPOSE building blocks, NOT task-specific solutions.\\n\\nAgents must understand:\\n\\n1. **Scripts are composable** - Combine multiple general scripts to accomplish specific tasks\\n2. **Templates are parameterized** - One template serves many use cases via `.cfg` substitution\\n3. **No script-per-task assumption** - Do NOT expect `do-exactly-what-I-need.ps1` to exist\\n4. **Adapt and compose** - Use existing scripts creatively; extend only when necessary\\n\\n**Example - Creating a New C Project:**\\n```powershell\\n# WRONG: Looking for \\\"New-CProject.ps1\\\"\\n# RIGHT: Compose general tools\\n.\\\\New-Project-v7.ps1 -ConfigFile project.cfg  # General scaffolding\\n.\\\\Invoke-Template.ps1 -Language c             # Language-specific templates\\n.\\\\git-ops\\\\New-Repo.ps1 -WithBackup            # Git setup\\n```\\n\\n---\\n\\n## Fravia Search Strategy + Suckless Principles\\n\\nApply reverse-engineering search methodology with minimal-complexity execution.\\n\\n### Fravia Method: Search Strategy Formulation\\n\\nBefore searching, PLAN the search:\\n\\n1. **Define the target** - What exactly are you looking for? (file, function, pattern, concept)\\n2. **Predict locations** - Where would this logically exist? (directory, file type, naming convention)\\n3. **Choose search depth** - Broad reconnaissance first, then targeted drilling\\n4. **Formulate patterns** - Build regex from known fragments, not guesses\\n5. **Cross-reference results** - Validate findings against multiple indicators\\n\\n### Suckless Principles: Minimal Complexity, Maximum Effect\\n\\n**AVOID** these anti-patterns (Useless Use of Cat and friends):\\n\\n```sh\\n# BAD: UUoC - Useless Use of Cat\\ncat file.txt | grep pattern\\ncat file.txt | wc -l\\ncat file.txt | awk \u0027{print $1}\u0027\\ncat file.txt | sed \u0027s/foo/bar/\u0027\\n\\n# GOOD: Direct invocation\\ngrep pattern file.txt\\nwc -l \u003c file.txt\\nawk \u0027{print $1}\u0027 file.txt\\nsed \u0027s/foo/bar/\u0027 file.txt\\n```\\n\\n**AVOID** unnecessary tool chains:\\n\\n```sh\\n# BAD: Multi-tool chain for simple task\\ncat file | grep foo | sed \u0027s/bar/baz/\u0027 | awk \u0027{print $2}\u0027 | wc -l\\n\\n# GOOD: Single tool when possible\\nawk \u0027/foo/ { gsub(/bar/, \\\"baz\\\"); print $2; count++ } END { print count }\u0027 file\\n```\\n\\n**PREFER** heredoc and ed/vi for edits:\\n\\n```sh\\n# BAD: Multiple sed invocations\\nsed -i \u0027s/old1/new1/\u0027 file\\nsed -i \u0027s/old2/new2/\u0027 file\\nsed -i \u0027s/old3/new3/\u0027 file\\n\\n# GOOD: Single heredoc with ed\\ned -s file \u003c\u003c\u0027EOF\u0027\\n%s/old1/new1/g\\n%s/old2/new2/g\\n%s/old3/new3/g\\nw\\nq\\nEOF\\n\\n# GOOD: Single sed with multiple expressions\\nsed -i -e \u0027s/old1/new1/g\u0027 -e \u0027s/old2/new2/g\u0027 -e \u0027s/old3/new3/g\u0027 file\\n```\\n\\n### Search Tool Priority\\n\\nUse tools in this order (most efficient first):\\n\\n| Priority | Tool | Use Case |\\n|----------|------|----------|\\n| 1 | `grep -r` / `rg` | Known pattern, broad search |\\n| 2 | `find` + `-name` | Known filename pattern |\\n| 3 | `git grep` | Within git repo, respects .gitignore |\\n| 4 | Codebase semantic search | Concept/meaning-based queries |\\n| 5 | Web search | External documentation, APIs |\\n\\n### PowerShell Equivalents\\n\\n```powershell\\n# BAD: Pipeline abuse\\nGet-Content file.txt | Select-String pattern\\nGet-Content file.txt | Measure-Object -Line\\nGet-Content file.txt | ForEach-Object { $_.Split()[0] }\\n\\n# GOOD: Direct parameter usage\\nSelect-String -Path file.txt -Pattern pattern\\n(Get-Content file.txt).Count\\n(Get-Content file.txt) -replace \u0027pattern\u0027, \u0027replacement\u0027\\n\\n# GOOD: Single expression for complex operations\\nGet-Content file.txt | ForEach-Object -Begin { $count = 0 } -Process {\\n    if ($_ -match \u0027pattern\u0027) { $count++ }\\n} -End { $count }\\n```\\n\\n### The Suckless Test\\n\\nBefore executing a command chain, ask:\\n\\n1. Can this be done with ONE tool instead of many?\\n2. Am I piping cat/Get-Content unnecessarily?\\n3. Would a heredoc/here-string be cleaner?\\n4. Is there a built-in flag that eliminates a pipeline stage?\\n5. Am I using awk/sed when grep alone suffices (or vice versa)?\\n\\n**Rule of thumb:** If your command has more than 2 pipes, reconsider the approach.\\n\\n---\\n\\n## RESOLVED: Agent Shell Bug Workaround (Windows 11)\\n\\n**Status:** RESOLVED as of 2025-12-14. Shell tool now works correctly.\\n\\n**History:** Between 2025-12-07 and 2025-12-14, Cursor Shell tool returned `pid: -1` on Windows 11 (build 26200, Cursor 2.1.50+). This has been fixed.\\n\\n### File-Based Shell Bridge (Archived - For Reference Only)\\n\\nThe bridge workaround below is no longer needed but preserved for reference if the issue recurs.\\n\\n\u003cdetails\u003e\\n\u003csummary\u003eClick to expand archived workaround\u003c/summary\u003e\\n\\nWhen the Cursor Shell tool fails, use `agent-shell-bridge.ps1` which runs in the user\u0027s manual terminal.\\n\\n**To execute shell commands:**\\n\\n1. Write command to `.agent-command.txt` using the Write tool\\n2. Wait briefly, then read `.agent-status.txt` (should say `DONE`)\\n3. Read result from `.agent-result.txt`\\n\\n**Example:**\\n\\n```\\n# Step 1: Write command\\nWrite tool -\u003e .agent-command.txt -\u003e \\\"hostname; Get-Date\\\"\\n\\n# Step 2: Check status\\nRead tool -\u003e .agent-status.txt -\u003e \\\"DONE\\\"\\n\\n# Step 3: Read result\\nRead tool -\u003e .agent-result.txt -\u003e \\\"EXIT_CODE=0\\\\nDESKTOP-7KTB236\\\\n...\\\"\\n```\\n\\n**Files:**\\n\\n| File | Purpose |\\n|------|---------|\\n| `.agent-command.txt` | Write your command here (bridge consumes it) |\\n| `.agent-status.txt` | READY/RUNNING/DONE |\\n| `.agent-result.txt` | EXIT_CODE=N followed by output |\\n| `agent-shell-bridge.ps1` | The bridge script (user starts once) |\\n\\n\u003c/details\u003e\\n\\n---\\n\\n---\\n\\n## Known Issues: BROKEN_SCRIPTS.md\\n\\nBefore using or modifying scripts, check `BROKEN_SCRIPTS.md` for:\\n\\n- Scripts that silently skip critical functionality\\n- Useless Use of Cat (UUoC) patterns in shell scripts\\n- Placeholder values that should be complete functions\\n- Templates with unsubstituted variables\\n- Scripts requiring verification\\n\\n**When a script fails during agent operations:**\\n1. Do NOT attempt to fix inline\\n2. Add to `BROKEN_SCRIPTS.md` with filename, filepath, and issue description\\n3. Mark as unchecked `[ ]`\\n4. Only check off `[x]` when fully verified working\\n\\n---\\n\\n## Helper Script Index (General-Purpose Building Blocks)\\n\\n**These are GENERAL scripts.** Combine them to accomplish SPECIFIC tasks. Do not expect a dedicated script for every operation.\\n\\nAll scripts are in `github-backup/cursor-project-scaffolding-backup/ludoplex-cursor-project-scaffolding-backup-*/`\\n\\n### Project Scaffolding (General)\\n\\n| Task | Script | Config |\\n|------|--------|--------|\\n| Create new project | `new-project.sh` / `New-Project-v5.ps1` / `New-Project-v7.ps1` | `project.cfg` |\\n| Watch/backup files | `watch-project.sh` / `Watch-Project-v5.ps1` / `Watch-Project-v7.ps1` | `watcher.cfg` |\\n| Process templates | `Invoke-Template.ps1` | (inline params) |\\n\\n### Git Operations (git-ops/) - General\\n\\n| Task | Script |\\n|------|--------|\\n| Create GitHub repo | `New-Repo.ps1` / `new-repo.sh` |\\n| Clone with backup | `Import-Repo.ps1` / `import-repo.sh` (legacy) |\\n\\n### Import Repository (github-backup/) - General, with gh fallback\\n\\n| Task | Script | Config |\\n|------|--------|--------|\\n| Import repo | `import-repo.sh` / `Import-Repo-v5.ps1` / `Import-Repo-v7.ps1` | `import-repo.cfg` |\\n\\nTries git clone first, falls back to gh api zip download when git fails.\\n| Create branch | `New-Branch.ps1` / `new-branch.sh` |\\n| Archive project | `Archive-Repo.ps1` / `archive-repo.sh` |\\n| Sync backups | `Sync-Backup.ps1` / `sync-backup.sh` |\\n| Update index | `Update-RepoIndex.ps1` / `update-index.sh` |\\n\\n### Utilities (utils/) - General Search/Reconnaissance\\n\\n| Task | Script |\\n|------|--------|\\n| Project tree | `Get-ProjectStructure.ps1` |\\n| Find files | `Search-Files.ps1` / `search-files.sh` |\\n| Search content | `Search-Content.ps1` / `search-content.sh` |\\n\\n**Note:** These wrap grep/find with sensible defaults. Use directly when wrappers add overhead.\\n\\n### Production Readiness (prr/)\\n\\n| Task | Script |\\n|------|--------|\\n| Run PRR checks | `Invoke-PRR.ps1` / `prr-check.sh` |\\n\\n### Network Diagnostics (templates/network/)\\n\\n| Task | Script (Windows) | Script (POSIX) | Config |\\n|------|------------------|----------------|--------|\\n| Port scanning | `Invoke-NetworkScan-v7.ps1` | `network-scan.sh` | `network.cfg` |\\n| DNS diagnostics | `Invoke-DnsDiagnostics-v7.ps1` | `dns-diagnostics.sh` | `network.cfg` |\\n| Network forensics | `Invoke-NetworkForensics-v7.ps1` | `network-forensics.sh` | `network.cfg` |\\n| Packet capture | `Invoke-PacketCapture-v7.ps1` (pktmon) | `packet-capture.sh` (tcpdump) | `network.cfg` |\\n| Background wrapper | `Invoke-BackgroundDiagnostics-v7.ps1` | (use nohup/\u0026) | `network.cfg` |\\n\\nDetects: DNS hijacking, ARP spoofing, LLMNR poisoning, suspicious connections, firewall issues.\\n\\n### Linting (workspace root)\\n\\n| Task | Script | Config |\\n|------|--------|--------|\\n| Aggregate linting | `lint-project.sh` / `Lint-Project-v5.ps1` / `Lint-Project-v7.ps1` | `lint.cfg` |\\n\\nRuns C, Shell, PowerShell, JSON, YAML, Markdown linters plus ROSE-style policy checks:\\n- No tab characters in source files\\n- Maximum line length (default 132)\\n- Unix line endings (LF not CRLF)\\n- No \\\"using\\\" directives in headers\\n\\n### Nuclei Vulnerability Scanning (nuclei-ops/)\\n\\n| Task | Script | Config |\\n|------|--------|--------|\\n| Run nuclei scan | `nuclei-scan.sh` / `Invoke-NucleiScan-v5.ps1` / `Invoke-NucleiScan-v7.ps1` | `nuclei-scan.cfg` |\\n\\nFeatures: Unified config for target, templates, rate limiting, output format. Auto-detects nuclei binary.\\n\\n### Cursor Backup Extension (cursor-backup-ops/)\\n\\n| Task | Script | Config |\\n|------|--------|--------|\\n| Install extension | `install-backup-extension.sh` / `Install-BackupExtension-v5.ps1` / `Install-BackupExtension-v7.ps1` | `backup-extension.cfg` |\\n\\nFeatures: Builds TypeScript, packages VSIX, auto-detects IDE (Cursor/VS Code/Codium).\\n\\n### Portmaster DNS Firewall (portmaster-ops/)\\n\\n| Task | Script | Config |\\n|------|--------|--------|\\n| Status check | `portmaster-status.sh` / `Get-PortmasterStatus-v5.ps1` / `Get-PortmasterStatus-v7.ps1` | `portmaster.cfg` |\\n| Full diagnostics | `Invoke-PortmasterDiagnostics-v7.ps1` | `portmaster.cfg` |\\n\\n### WSL2 KVM for Docker-OSX (wsl-kvm-ops/)\\n\\n| Task | Script | Config |\\n|------|--------|--------|\\n| Enable features | `Install-WslKvm-v5.ps1 -Step Features` | `wsl-kvm.cfg` |\\n| Install distro | `Install-WslKvm-v5.ps1 -Step Distro` | `wsl-kvm.cfg` |\\n| Build KVM kernel | `Install-WslKvm-v5.ps1 -Step Kernel` | `wsl-kvm.cfg` |\\n| Configure WSL | `Install-WslKvm-v5.ps1 -Step Configure` | `wsl-kvm.cfg` |\\n| Setup Docker-OSX | `Install-WslKvm-v5.ps1 -Step DockerOsx` | `wsl-kvm.cfg` |\\n| Check status | `Install-WslKvm-v5.ps1 -Step Status` | `wsl-kvm.cfg` |\\n\\nWorkflow: Features (reboot) -\u003e Distro -\u003e Kernel -\u003e Configure -\u003e DockerOsx\\n\\nFeatures:\\n- Detects if Portmaster is sole DNS resolver (`noAssignedNameservers: true`)\\n- Tests DoT (DNS-over-TLS) server connectivity\\n- Compares DNS resolution through Portmaster vs external servers\\n- Analyzes logs for blocked connections and resolver failures\\n- Identifies common DNS error patterns (0.0.0.17, .lan suffix, no compliant resolvers)\\n\\nKey Portmaster paths:\\n- Config: `C:\\\\ProgramData\\\\Portmaster\\\\config.json`\\n- Logs: `C:\\\\ProgramData\\\\Portmaster\\\\logs\\\\`\\n- UI: `http://127.0.0.1:817`\\n\\n---\\n\\n## Token Savings Example\\n\\n**WITHOUT scripts** (agent generates each command):\\n```powershell\\ngh repo create owner/name --private\\ngh repo create owner/name-backup --private\\ncd /path/to/project\\ngit init\\ngit remote add origin https://github.com/owner/name.git\\ngit remote add backup https://github.com/owner/name-backup.git\\ngit add -A\\ngit commit -s -m \\\"Initial commit\\\"\\ngit branch -M main\\ngit push -u origin main\\ngit push backup main\\n```\\n**Tokens: ~800-1200**\\n\\n**WITH scripts** (single invocation):\\n```powershell\\n.\\\\git-ops\\\\New-Repo.ps1 -Path \\\".\\\" -Private -WithBackup\\n```\\n**Tokens: ~50** (94% savings)\\n\\n---\\n\\n## Agent Instruction Files\\n\\nProject-specific agent instructions are in `.copilot/` directories:\\n\\n| Agent | Purpose | File |\\n|-------|---------|------|\\n| checks-agent | CI/CD monitoring | `checks-agent-instructions.md` |\\n| code-maintainer | C/ASM code quality | `code-maintainer-instructions.md` |\\n| database-maintainer | SQLite schema/migrations | `database-maintainer-instructions.md` |\\n| docs-maintainer | Documentation quality | `docs-maintainer-instructions.md` |\\n| github-actions-agent | Workflow management | `github-actions-agent-instructions.md` |\\n| prd-agent | Requirements alignment | `prd-agent-instructions.md` |\\n| test-runner | Test execution | `test-runner-instructions.md` |\\n| validator | Script/config validation | `validator-instructions.md` |\\n| workflow-maintainer | CI/CD configuration | `workflow-maintainer-instructions.md` |\\n\\n---\\n\\n## Template System\\n\\nTemplates in `templates/` use `{{VARIABLE}}` substitution:\\n\\n- `templates/base/` - Common files (LICENSE, README, CONTRIBUTING)\\n- `templates/languages/` - Language-specific (c, python, rust, go, sh, powershell)\\n- `templates/ci-cd/` - CI/CD workflows (github-actions)\\n- `templates/platforms/` - Platform-specific\\n\\nInvoke with:\\n```powershell\\n.\\\\Invoke-Template.ps1 -ConfigFile project.cfg -Language c -OutputPath ./my-project\\n```\\n\\n---\\n\\n## Platform Detection\\n\\nScripts auto-detect platform and set defaults:\\n\\n| Platform | Shell | Language | Assembly |\\n|----------|-------|----------|----------|\\n| Windows x64 | PowerShell | C17 | MASM/AMD64 |\\n| Windows ARM64 | PowerShell | C17 | ARM64 |\\n| macOS x64 | sh | C17 | AMD64 |\\n| macOS ARM64 | sh | C17 | A64 |\\n| Linux x64 | sh | C17 | AMD64 |\\n| Linux ARM64 | sh | C17 | A64 |\\n\\n---\\n\\n## Before Generating Code\\n\\n1. Check if a helper script exists for the task\\n2. Use `Search-Files.ps1` to find relevant templates\\n3. Use `Get-ProjectStructure.ps1` to understand layout\\n4. Read relevant `.copilot/*-instructions.md` files\\n5. Follow PRR guidelines for production readiness\\n\\n---\\n\\n## Background Execution for Long-Running Processes\\n\\nWhen running scripts that have no definite end time (diagnostics, watchers, packet captures, servers), use background execution to avoid blocking the agent session.\\n\\n### Problem\\n\\nAgent tool calls timeout when scripts run too long. Scripts that:\\n- Collect data over extended periods (packet capture, forensics)\\n- Watch for file changes indefinitely\\n- Wait for network events\\n- Run servers or daemons\\n\\nwill cause `Tool call errored or timed out` errors.\\n\\n### Solution: Background Wrapper Pattern\\n\\n**Windows (PowerShell 7+):**\\n```powershell\\n# Use the background diagnostics wrapper\\n.\\\\templates\\\\network\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script NetworkForensics -OutputPath .\\\\results\\n\\n# Or run any script in background with output capture\\n$job = Start-Job -ScriptBlock { \u0026 .\\\\SomeLongScript.ps1 *\u003e\u00261 | Tee-Object -FilePath .\\\\output.txt }\\n\\n# Check status later\\nGet-Content .\\\\diagnostics-output\\\\*-status.json\\nGet-Content .\\\\diagnostics-output\\\\*-stdout.txt\\n```\\n\\n**Unix (POSIX sh):**\\n```sh\\n# Run with nohup and redirect output\\nnohup ./network-forensics.sh -o ./results \u003e ./forensics.log 2\u003e\u00261 \u0026\\necho $! \u003e ./forensics.pid\\n\\n# Check status later\\ncat ./forensics.log\\nkill -0 $(cat ./forensics.pid) \u0026\u0026 echo \\\"Still running\\\" || echo \\\"Completed\\\"\\n```\\n\\n### Background Wrapper Scripts\\n\\n| Task | Script | Output |\\n|------|--------|--------|\\n| Network diagnostics | `Invoke-BackgroundDiagnostics-v7.ps1` | `*-status.json`, `*-stdout.txt` |\\n| File watcher | `Watch-Project-v7.ps1` (run with Start-Job) | watcher.log |\\n| Packet capture | `Invoke-PacketCapture-v7.ps1` | ETL/PCAP files |\\n\\n### Agent Workflow for Background Tasks\\n\\n1. **Start**: Launch script with background wrapper, capture job/PID\\n2. **Continue**: Proceed with other tasks while script runs\\n3. **Check**: Read status file or stdout file to get results\\n4. **Retrieve**: Parse JSON output files for programmatic access\\n\\n### Example: Network Diagnostics\\n\\n```powershell\\n# Start forensics in background (returns immediately)\\n.\\\\templates\\\\network\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script NetworkForensics -OutputPath .\\\\forensics-results\\n\\n# Do other work...\\n\\n# Later, check results\\nGet-Content .\\\\forensics-results\\\\*-status.json | ConvertFrom-Json\\nGet-Content .\\\\forensics-results\\\\*-stdout.txt\\nGet-Content .\\\\forensics-results\\\\summary.json | ConvertFrom-Json\\n```\\n\\n### Key Files After Background Execution\\n\\n| File | Purpose |\\n|------|---------|\\n| `*-status.json` | Job state: Running/Completed/Failed, timestamps, exit code |\\n| `*-stdout.txt` | Captured console output |\\n| `*-stderr.txt` | Error output (if any) |\\n| `summary.json` | Structured results from the diagnostic script |\\n\\n### Critical Rule\\n\\n**DO NOT** run these scripts directly via `run_terminal_cmd` without background:\\n- `Invoke-NetworkForensics-v7.ps1`\\n- `Invoke-PacketCapture-v7.ps1`\\n- `Watch-Project-*.ps1`\\n- Any script with indefinite runtime\\n\\n**DO** use `Invoke-BackgroundDiagnostics-v7.ps1` or `Start-Job` wrapper, then read output files.\\n\\n---\\n\\n## Config File Format\\n\\nUniversal `.cfg` files use `KEY=VALUE` format:\\n\\n```\\n# Comment lines start with #\\nPROJECT_NAME=MyApp\\nTYPE=cli\\nLANGUAGE=c\\nAUTHOR=username\\nLICENSE=BSD-2-Clause\\nBACKUP_ENABLED=true\\n```\\n\\nParsed identically by all three script consumers.\\n\\n---\\n\\n## Validation Before Commit\\n\\nRun these before declaring work complete:\\n\\n```powershell\\n# Aggregate linting (uses lint.cfg)\\n.\\\\Lint-Project-v7.ps1       # PowerShell 7+ (Windows/macOS/Linux)\\n.\\\\Lint-Project-v5.ps1       # PowerShell 5.1 (Windows 10)\\n./lint-project.sh           # POSIX shell (macOS/Linux)\\n```\\n\\n```sh\\n# Project-specific validation\\n./scripts/workflows.sh      # Validate GitHub Actions\\n./scripts/actions.sh        # Check action versions\\n./scripts/json-configs.sh   # Validate JSON files\\n./scripts/run-core-tests.sh # Run unit tests\\n```\\n\\n---\\n\\n## ROSE Policy Checkers\\n\\nIntegrated from `rose-1/scripts/policies/` (configure via `lint.cfg`):\\n\\n| Config Key | Check |\\n|-----------|-------|\\n| `ROSE_NO_TABS` | No tab characters in source |\\n| `ROSE_MAX_LINE_LENGTH` | Lines \u003c= N chars (default 132) |\\n| `ROSE_UNIX_LINE_ENDINGS` | LF only, no CRLF |\\n| `ROSE_NO_USING_IN_HEADERS` | No `using` directives in headers |\\n| `ROSE_CASE_INSENSITIVE_NAMES` | No files differing only by case |\\n| `ROSE_UNIQUE_HEADER_NAMES` | No duplicate header names |\\n\\nSet `ROSE_SOURCE_EXTENSIONS` to control which files are checked.\\n\\n---\\n\\n## Required Reading for New Sessions\\n\\n1. This file (`AGENT_ONBOARD.md`)\\n2. Project\u0027s `.cursorrules` if present\\n3. Project\u0027s `.copilot/` agent instructions if present\\n4. `git-ops/agent-instructions.md` for Git operations\\n5. `prr/agent-instructions-cursor.md` for production readiness\\n\\n---\\n\\n**DO NOT:**\\n- Generate multi-command sequences when a single script exists\\n- Assume a task-specific script exists for every operation\\n- Use cat/Get-Content in pipelines when direct tool invocation works\\n- Chain awk/sed/wc when a single tool with flags suffices\\n- Ask the user to run commands or copy-paste output\\n\\n**DO:**\\n- Compose GENERAL scripts to accomplish SPECIFIC tasks\\n- Apply Fravia search strategy before grepping blindly\\n- Use suckless principles: minimum complexity, maximum effect\\n- Prefer heredoc/ed for multi-line edits over repeated sed calls\\n- Invoke scripts with appropriate parameters; extend only when necessary\\n\\n---\\n\\nGenerated: 2025-12-01\\nUpdated: 2025-12-14 (shell bug resolved)\\nPurpose: Agent onboarding for token efficiency\\n\\n\",\"numCharactersInRequestedRange\":20430,\"totalLinesInFile\":617}"}},"bubbleId":"08da0bd7-ef45-4285-acdc-97409bba9856"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"0c7a44b2-90ca-4dc2-9a33-5ea844df43ee","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:41:15.960Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","serverBubbleId":"03c8fbb0-994e-42e1-aa2b-cf3db0554342","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","capabilityType":30,"thinking":{"text":"That error is because Windows PowerShell doesn\u0027t understand Unix shell syntax. Let me verify the scripts were created correctly by reading them back and checking for any issues.","signature":"EtoCCkYIChgCKkAF/dHpMBnNl2v1U8cIicSxS5MbD1NRGc0XQFg4SoqgzF0YFZBEOgT5nP4Q7NrfKDcD9XOouVwRW53UUABbtZTBEgx4yquu33xp69y79FoaDLe6a3yoSw+922hyxiIwyAfW/kuD5X+eCo/aKq8CeVD4hdTPGPMzRw4DFNX0nNYSGI95cropZeZyxK48L6p2KsEBZQbBNCBjGY1cWiM/NhxxSkwF8hpS0AsCdM0YM5QSidXWNvZJEJj8k5q3a3CichCh2pCdXjd/lM2uNClt4P2hW2TQQRBs0sHQm/+oze2J+djYpWFq24lqZJoa3h8L85FOq1GVKlY7CX4436glvnFqupswU0sSedNh+98XXo79eHuWKg4m6DYGXHdxLwfPRzjlAfvNrsTS1SzUZf0ngWJCHKdeLEj2qNv8XVyxE+mn9g65E5qNnxfQQh5IuWUlcYZdhRgB"},"thinkingStyle":1,"thinkingDurationMs":1159},"bubbleId":"0c7a44b2-90ca-4dc2-9a33-5ea844df43ee"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"1070432f-1c3d-4e10-8cb3-eea96199e3a9","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:34:39.580Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"text":"I see there are existing network diagnostics scripts in `templates/network/`. Let me check what already exists to ensure proper integration:","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878"},"bubbleId":"1070432f-1c3d-4e10-8cb3-eea96199e3a9"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"114c85b3-f90f-4689-ab06-6d2deb9db53b","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:35:14.894Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[{"uri":{"scheme":"file","authority":"","path":"/c:/Users/user/Downloads/Cursor_working_directory_misc/templates/network/mitm-audit.cfg","query":"","fragment":"","_formatted":"file:///c%3A/Users/user/Downloads/Cursor_working_directory_misc/templates/network/mitm-audit.cfg","_fsPath":null},"codeblockId":"79e67638-70c5-4306-92e2-b4b768ad5f1f","codeBlockIdx":0,"content":"# Infrastructure MITM Audit Configuration\n# Format: KEY=VALUE (consumed by POSIX sh, PowerShell v5, PowerShell v7)\n# License: BSD-2-Clause\n# Signed-off-by: Network Diagnostics Toolkit\n\n# =============================================================================\n# Target Domains for MITM Detection\n# High-value authentication endpoints that should NEVER be proxied\n# =============================================================================\nTARGETS=accounts.google.com,login.microsoftonline.com,appleid.apple.com,aws.amazon.com,github.com\n\n# =============================================================================\n# Public DNS Resolvers (Control Group for DoH Comparison)\n# =============================================================================\nPUBLIC_RESOLVERS=1.1.1.1,8.8.8.8,9.9.9.9\nDOH_ENDPOINT=https://dns.google/resolve\n\n# =============================================================================\n# ASN Lookup Service\n# =============================================================================\nASN_LOOKUP_URL=http://ip-api.com/json\nASN_LOOKUP_TIMEOUT_SEC=3\n\n# =============================================================================\n# External IP Service\n# =============================================================================\nEXTERNAL_IP_URL=https://ipinfo.io/json\nEXTERNAL_IP_TIMEOUT_SEC=5\n\n# =============================================================================\n# Expected ISP Context (Optional - for Vyve/Eagle/Local ISP detection)\n# Leave empty to skip ISP validation\n# =============================================================================\nEXPECTED_ISP_PATTERNS=\n# Example: EXPECTED_ISP_PATTERNS=Vyve,Eagle,Lumen,Level3\n\n# =============================================================================\n# ASN Integrity Heuristics\n# Format: domain_pattern:expected_asn_pattern\n# If domain matches pattern, ASN must contain expected pattern\n# =============================================================================\nASN_RULES_GOOGLE=google:Google\nASN_RULES_MICROSOFT=microsoft:Microsoft\nASN_RULES_APPLE=apple:Apple\nASN_RULES_AMAZON=aws.amazon:Amazon,AMAZON\nASN_RULES_GITHUB=github:GitHub,Microsoft\n\n# =============================================================================\n# Suspicious ASN Patterns (VPS providers that should NOT serve auth traffic)\n# =============================================================================\nSUSPICIOUS_ASN_PATTERNS=DigitalOcean,Linode,Vultr,Choopa,Datacamp,OVH,Hetzner\n\n# =============================================================================\n# Certificate Validation\n# Issuers that are suspicious for major tech companies\n# =============================================================================\nSUSPICIOUS_CERT_ISSUERS=Let\u0027s Encrypt,ZeroSSL,Self-Signed,localhost\n\n# =============================================================================\n# Traceroute Configuration\n# =============================================================================\nTRACEROUTE_MAX_HOPS=15\nTRACEROUTE_TIMEOUT_SEC=2\nTRACEROUTE_ENABLED=true\n\n# =============================================================================\n# Root CA Export Configuration\n# =============================================================================\nEXPORT_ROOT_CA=true\nHASH_ROOT_CA=true\n\n# =============================================================================\n# Client-Side Exploit Detection\n# =============================================================================\nCHECK_PROXY_SETTINGS=true\nCHECK_BROWSER_EXTENSIONS=true\nCHECK_HOSTS_FILE=true\nCHECK_ROOT_CA_ANOMALIES=true\n\n# =============================================================================\n# Output Configuration\n# =============================================================================\nOUTPUT_BASE_DIR=ForensicEvidence\nTIMESTAMP_FORMAT=yyyyMMdd_HHmmss\nGENERATE_HASHES=true\nHASH_ALGORITHM=SHA256\n\n# =============================================================================\n# Logging\n# =============================================================================\nLOG_LEVEL=INFO\nVERBOSE_OUTPUT=false\n\n","languageId":"properties"}],"text":"","capabilityType":15,"toolFormerData":{"tool":38,"toolIndex":1,"modelCallId":"b53995e3-b39c-44d6-85de-a6445a0834ff","toolCallId":"toolu_019ECZiVN3EBbnoVRV3djaL7","status":"completed","rawArgs":"{\"file_path\": \"templates/network/mitm-audit.cfg\", \"contents\": \"# Infrastructure MITM Audit Configuration\\n# Format: KEY=VALUE (consumed by POSIX sh, PowerShell v5, PowerShell v7)\\n# License: BSD-2-Clause\\n# Signed-off-by: Network Diagnostics Toolkit\\n\\n# =============================================================================\\n# Target Domains for MITM Detection\\n# High-value authentication endpoints that should NEVER be proxied\\n# =============================================================================\\nTARGETS=accounts.google.com,login.microsoftonline.com,appleid.apple.com,aws.amazon.com,github.com\\n\\n# =============================================================================\\n# Public DNS Resolvers (Control Group for DoH Comparison)\\n# =============================================================================\\nPUBLIC_RESOLVERS=1.1.1.1,8.8.8.8,9.9.9.9\\nDOH_ENDPOINT=https://dns.google/resolve\\n\\n# =============================================================================\\n# ASN Lookup Service\\n# =============================================================================\\nASN_LOOKUP_URL=http://ip-api.com/json\\nASN_LOOKUP_TIMEOUT_SEC=3\\n\\n# =============================================================================\\n# External IP Service\\n# =============================================================================\\nEXTERNAL_IP_URL=https://ipinfo.io/json\\nEXTERNAL_IP_TIMEOUT_SEC=5\\n\\n# =============================================================================\\n# Expected ISP Context (Optional - for Vyve/Eagle/Local ISP detection)\\n# Leave empty to skip ISP validation\\n# =============================================================================\\nEXPECTED_ISP_PATTERNS=\\n# Example: EXPECTED_ISP_PATTERNS=Vyve,Eagle,Lumen,Level3\\n\\n# =============================================================================\\n# ASN Integrity Heuristics\\n# Format: domain_pattern:expected_asn_pattern\\n# If domain matches pattern, ASN must contain expected pattern\\n# =============================================================================\\nASN_RULES_GOOGLE=google:Google\\nASN_RULES_MICROSOFT=microsoft:Microsoft\\nASN_RULES_APPLE=apple:Apple\\nASN_RULES_AMAZON=aws.amazon:Amazon,AMAZON\\nASN_RULES_GITHUB=github:GitHub,Microsoft\\n\\n# =============================================================================\\n# Suspicious ASN Patterns (VPS providers that should NOT serve auth traffic)\\n# =============================================================================\\nSUSPICIOUS_ASN_PATTERNS=DigitalOcean,Linode,Vultr,Choopa,Datacamp,OVH,Hetzner\\n\\n# =============================================================================\\n# Certificate Validation\\n# Issuers that are suspicious for major tech companies\\n# =============================================================================\\nSUSPICIOUS_CERT_ISSUERS=Let\u0027s Encrypt,ZeroSSL,Self-Signed,localhost\\n\\n# =============================================================================\\n# Traceroute Configuration\\n# =============================================================================\\nTRACEROUTE_MAX_HOPS=15\\nTRACEROUTE_TIMEOUT_SEC=2\\nTRACEROUTE_ENABLED=true\\n\\n# =============================================================================\\n# Root CA Export Configuration\\n# =============================================================================\\nEXPORT_ROOT_CA=true\\nHASH_ROOT_CA=true\\n\\n# =============================================================================\\n# Client-Side Exploit Detection\\n# =============================================================================\\nCHECK_PROXY_SETTINGS=true\\nCHECK_BROWSER_EXTENSIONS=true\\nCHECK_HOSTS_FILE=true\\nCHECK_ROOT_CA_ANOMALIES=true\\n\\n# =============================================================================\\n# Output Configuration\\n# =============================================================================\\nOUTPUT_BASE_DIR=ForensicEvidence\\nTIMESTAMP_FORMAT=yyyyMMdd_HHmmss\\nGENERATE_HASHES=true\\nHASH_ALGORITHM=SHA256\\n\\n# =============================================================================\\n# Logging\\n# =============================================================================\\nLOG_LEVEL=INFO\\nVERBOSE_OUTPUT=false\\n\\n\"}","name":"write","params":"{\"relativeWorkspacePath\":\"templates/network/mitm-audit.cfg\",\"code\":{\"code\":\"# Infrastructure\"}}","additionalData":{"codeblockId":"79e67638-70c5-4306-92e2-b4b768ad5f1f","reviewData":{"status":"None","selectedOption":"accept","isShowingInput":false,"firstTimeReviewMode":false}},"userDecision":"accepted","result":"{\"diff\":{\"chunks\":[{\"diffString\":\"- \\n+ # Infrastructure MITM Audit Configuration\\n+ # Format: KEY=VALUE (consumed by POSIX sh, PowerShell v5, PowerShell v7)\\n+ # License: BSD-2-Clause\\n+ # Signed-off-by: Network Diagnostics Toolkit\\n+ \\n+ # =============================================================================\\n+ # Target Domains for MITM Detection\\n+ # High-value authentication endpoints that should NEVER be proxied\\n+ # =============================================================================\\n+ TARGETS=accounts.google.com,login.microsoftonline.com,appleid.apple.com,aws.amazon.com,github.com\\n+ \\n+ # =============================================================================\\n+ # Public DNS Resolvers (Control Group for DoH Comparison)\\n+ # =============================================================================\\n+ PUBLIC_RESOLVERS=1.1.1.1,8.8.8.8,9.9.9.9\\n+ DOH_ENDPOINT=https://dns.google/resolve\\n+ \\n+ # =============================================================================\\n+ # ASN Lookup Service\\n+ # =============================================================================\\n+ ASN_LOOKUP_URL=http://ip-api.com/json\\n+ ASN_LOOKUP_TIMEOUT_SEC=3\\n+ \\n+ # =============================================================================\\n+ # External IP Service\\n+ # =============================================================================\\n+ EXTERNAL_IP_URL=https://ipinfo.io/json\\n+ EXTERNAL_IP_TIMEOUT_SEC=5\\n+ \\n+ # =============================================================================\\n+ # Expected ISP Context (Optional - for Vyve/Eagle/Local ISP detection)\\n+ # Leave empty to skip ISP validation\\n+ # =============================================================================\\n+ EXPECTED_ISP_PATTERNS=\\n+ # Example: EXPECTED_ISP_PATTERNS=Vyve,Eagle,Lumen,Level3\\n+ \\n+ # =============================================================================\\n+ # ASN Integrity Heuristics\\n+ # Format: domain_pattern:expected_asn_pattern\\n+ # If domain matches pattern, ASN must contain expected pattern\\n+ # =============================================================================\\n+ ASN_RULES_GOOGLE=google:Google\\n+ ASN_RULES_MICROSOFT=microsoft:Microsoft\\n+ ASN_RULES_APPLE=apple:Apple\\n+ ASN_RULES_AMAZON=aws.amazon:Amazon,AMAZON\\n+ ASN_RULES_GITHUB=github:GitHub,Microsoft\\n+ \\n+ # =============================================================================\\n+ # Suspicious ASN Patterns (VPS providers that should NOT serve auth traffic)\\n+ # =============================================================================\\n+ SUSPICIOUS_ASN_PATTERNS=DigitalOcean,Linode,Vultr,Choopa,Datacamp,OVH,Hetzner\\n+ \\n+ # =============================================================================\\n+ # Certificate Validation\\n+ # Issuers that are suspicious for major tech companies\\n+ # =============================================================================\\n+ SUSPICIOUS_CERT_ISSUERS=Let\u0027s Encrypt,ZeroSSL,Self-Signed,localhost\\n+ \\n+ # =============================================================================\\n+ # Traceroute Configuration\\n+ # =============================================================================\\n+ TRACEROUTE_MAX_HOPS=15\\n+ TRACEROUTE_TIMEOUT_SEC=2\\n+ TRACEROUTE_ENABLED=true\\n+ \\n+ # =============================================================================\\n+ # Root CA Export Configuration\\n+ # =============================================================================\\n+ EXPORT_ROOT_CA=true\\n+ HASH_ROOT_CA=true\\n+ \\n+ # =============================================================================\\n+ # Client-Side Exploit Detection\\n+ # =============================================================================\\n+ CHECK_PROXY_SETTINGS=true\\n+ CHECK_BROWSER_EXTENSIONS=true\\n+ CHECK_HOSTS_FILE=true\\n+ CHECK_ROOT_CA_ANOMALIES=true\\n+ \\n+ # =============================================================================\\n+ # Output Configuration\\n+ # =============================================================================\\n+ OUTPUT_BASE_DIR=ForensicEvidence\\n+ TIMESTAMP_FORMAT=yyyyMMdd_HHmmss\\n+ GENERATE_HASHES=true\\n+ HASH_ALGORITHM=SHA256\\n+ \\n+ # =============================================================================\\n+ # Logging\\n+ # =============================================================================\\n+ LOG_LEVEL=INFO\\n+ VERBOSE_OUTPUT=false\\n+ \\n+ \",\"oldStart\":1,\"newStart\":1,\"oldLines\":1,\"newLines\":94,\"linesRemoved\":1,\"linesAdded\":94}],\"editor\":\"EDITOR_AI\"},\"shouldAutoFixLints\":true,\"resultForModel\":\"Wrote contents to templates/network/mitm-audit.cfg.\",\"contentsAfterEdit\":\"# Infrastructure MITM Audit Configuration\\n# Format: KEY=VALUE (consumed by POSIX sh, PowerShell v5, PowerShell v7)\\n# License: BSD-2-Clause\\n# Signed-off-by: Network Diagnostics Toolkit\\n\\n# =============================================================================\\n# Target Domains for MITM Detection\\n# High-value authentication endpoints that should NEVER be proxied\\n# =============================================================================\\nTARGETS=accounts.google.com,login.microsoftonline.com,appleid.apple.com,aws.amazon.com,github.com\\n\\n# =============================================================================\\n# Public DNS Resolvers (Control Group for DoH Comparison)\\n# =============================================================================\\nPUBLIC_RESOLVERS=1.1.1.1,8.8.8.8,9.9.9.9\\nDOH_ENDPOINT=https://dns.google/resolve\\n\\n# =============================================================================\\n# ASN Lookup Service\\n# =============================================================================\\nASN_LOOKUP_URL=http://ip-api.com/json\\nASN_LOOKUP_TIMEOUT_SEC=3\\n\\n# =============================================================================\\n# External IP Service\\n# =============================================================================\\nEXTERNAL_IP_URL=https://ipinfo.io/json\\nEXTERNAL_IP_TIMEOUT_SEC=5\\n\\n# =============================================================================\\n# Expected ISP Context (Optional - for Vyve/Eagle/Local ISP detection)\\n# Leave empty to skip ISP validation\\n# =============================================================================\\nEXPECTED_ISP_PATTERNS=\\n# Example: EXPECTED_ISP_PATTERNS=Vyve,Eagle,Lumen,Level3\\n\\n# =============================================================================\\n# ASN Integrity Heuristics\\n# Format: domain_pattern:expected_asn_pattern\\n# If domain matches pattern, ASN must contain expected pattern\\n# =============================================================================\\nASN_RULES_GOOGLE=google:Google\\nASN_RULES_MICROSOFT=microsoft:Microsoft\\nASN_RULES_APPLE=apple:Apple\\nASN_RULES_AMAZON=aws.amazon:Amazon,AMAZON\\nASN_RULES_GITHUB=github:GitHub,Microsoft\\n\\n# =============================================================================\\n# Suspicious ASN Patterns (VPS providers that should NOT serve auth traffic)\\n# =============================================================================\\nSUSPICIOUS_ASN_PATTERNS=DigitalOcean,Linode,Vultr,Choopa,Datacamp,OVH,Hetzner\\n\\n# =============================================================================\\n# Certificate Validation\\n# Issuers that are suspicious for major tech companies\\n# =============================================================================\\nSUSPICIOUS_CERT_ISSUERS=Let\u0027s Encrypt,ZeroSSL,Self-Signed,localhost\\n\\n# =============================================================================\\n# Traceroute Configuration\\n# =============================================================================\\nTRACEROUTE_MAX_HOPS=15\\nTRACEROUTE_TIMEOUT_SEC=2\\nTRACEROUTE_ENABLED=true\\n\\n# =============================================================================\\n# Root CA Export Configuration\\n# =============================================================================\\nEXPORT_ROOT_CA=true\\nHASH_ROOT_CA=true\\n\\n# =============================================================================\\n# Client-Side Exploit Detection\\n# =============================================================================\\nCHECK_PROXY_SETTINGS=true\\nCHECK_BROWSER_EXTENSIONS=true\\nCHECK_HOSTS_FILE=true\\nCHECK_ROOT_CA_ANOMALIES=true\\n\\n# =============================================================================\\n# Output Configuration\\n# =============================================================================\\nOUTPUT_BASE_DIR=ForensicEvidence\\nTIMESTAMP_FORMAT=yyyyMMdd_HHmmss\\nGENERATE_HASHES=true\\nHASH_ALGORITHM=SHA256\\n\\n# =============================================================================\\n# Logging\\n# =============================================================================\\nLOG_LEVEL=INFO\\nVERBOSE_OUTPUT=false\\n\\n\\n\"}"},"checkpointId":"c00081f9-28fb-4e32-9a8b-19b6f0a8aa97"},"bubbleId":"114c85b3-f90f-4689-ab06-6d2deb9db53b"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"1b828f00-3913-43bb-9dec-cc64a62bbf1b","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:34:41.734Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","serverBubbleId":"9aaa22f8-ab3c-49fa-9637-a772d4a7067f","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","capabilityType":30,"thinking":{"text":"Good, there are existing forensics scripts. Let me examine them to understand the current pattern and then create reconciled versions that:\n1. Follow the workspace conventions2. Include the \"Gold Standard\" MITM detection logic from the user\u0027s request\n3. Have feature parity between PowerShell and POSIX\n4. Use a unified .cfg configuration\n\nLet me read the existing scripts.","signature":"EpkECkYIChgCKkA9YkoBLvuCjGGJRkdT7g8EDT02YLvqX6OdCz0NbPTWOhI3BTNLME/noqgvIidxDLktXr6HqvFv1HZ8FhtwKnxOEgxmr2q5FxtxYURxK70aDL5iqALqsjdVd5arxiIw/gqm/jBkIs8w5N9NTfwGvpBWWkWVa9CwTjNoHeVxSxPJPq8VwIbaMB7REmb9iT7wKoADIbGapYvJUYwxps3ubksZN8KwXSqeAKqN7muL7NdEwofnisCQ8RHEdYKefLfKVYWcQETQ2Bo1+hoTbEufZBHPazfHhpfCdYz5o2d0aoCntzZO8Cq/WScfC6+U9rDrv5d4k3zx54RwjUNd/o3pPCpreqny6dJrccy9TEPxg2Guq2Lf3fiC7LbhD0suFuutz8n8Q6jdMqZ/h4Kk+0JMbnE0VDYItlClDLD0KsxZuKPRj759NDWV9gmfsZgZE/zNET0utZ8ilva6MFtAntIk++cUX88xkiZdkqRQq85e/xE2E7TRMDqdoa2smfDk4RozRpCmqci+tRJDA1G2tnyde4vW++ScD73abyJpvpcscKmGbouurSeznBPJB3jA9S3Njp+30Bg5IzN+ohBuIZ/B8Vb2WmwK803ZZn4xJABHaQRNqLt6R+seEA9Ca0bFhN1l82pyj5QAGb9xpGhbjNI7smbGLoe73qlywuedNFG2J6pbfkF6q2lVM+YAcYSFHiocrDWmGAE="},"thinkingStyle":1,"thinkingDurationMs":2558},"bubbleId":"1b828f00-3913-43bb-9dec-cc64a62bbf1b"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"1db03c30-2c05-43dc-9f19-bfcc727fe840","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":122431,"outputTokens":33184},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:42:12.055Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"text":"I\u0027ve created a unified, reconciled Infrastructure MITM audit solution. Here\u0027s what was built:\n\n## Created Files\n\n| File | Purpose |\n|------|---------|\n| `templates/network/mitm-audit.cfg` | Universal config (POSIX sh + PowerShell) |\n| `templates/network/Invoke-MitmAudit-v7.ps1` | Windows PowerShell 7+ implementation |\n| `templates/network/mitm-audit.sh` | POSIX shell implementation (Linux/macOS/WSL) |\n| `templates/network/MITM-AUDIT-RECONCILIATION.md` | Feature parity documentation |\n\n## Key Reconciliations\n\n### 1. Unified Configuration\nBoth scripts consume the same `mitm-audit.cfg` file:\n\n```7:21:templates/network/mitm-audit.cfg\n# Target Domains for MITM Detection\n# High-value authentication endpoints that should NEVER be proxied\n# =============================================================================\nTARGETS=accounts.google.com,login.microsoftonline.com,appleid.apple.com,aws.amazon.com,github.com\n\n# =============================================================================\n# Public DNS Resolvers (Control Group for DoH Comparison)\n# =============================================================================\nPUBLIC_RESOLVERS=1.1.1.1,8.8.8.8,9.9.9.9\nDOH_ENDPOINT=https://dns.google/resolve\n\n# =============================================================================\n# ASN Lookup Service\n# =============================================================================\nASN_LOOKUP_URL=http://ip-api.com/json\n```\n\n### 2. Feature Parity Across Platforms\n\n| Capability | Both Have |\n|------------|-----------|\n| ASN integrity checks | Google-\u003eGoogle ASN, Microsoft-\u003eMicrosoft ASN, etc. |\n| DoH comparison | dns.google as control group |\n| Certificate capture | TcpClient/SslStream (PS) / openssl (sh) |\n| Root CA export + hashing | CSV (Windows) / PEM (Unix) |\n| Traceroute with ASN lookup | Per-hop VPS provider detection |\n| Client-side exploit detection | Proxy, hosts file, browser extensions |\n| Evidence package hashing | SHA256 chain of custody |\n\n### 3. Identical Output Structure\n\nBoth produce the same evidence package layout:\n```\nForensicEvidence_YYYYMMDD_HHMMSS/\n  _AuditLog.txt\n  _RedFlags.txt           \u003c-- Check this FIRST\n  _FileHashes.json\n  Summary.json\n  environment/\n  trust-store/\n  targets/\n  traceroute/\n  client-side/\n```\n\n### 4. Background Execution Integration\n\nThe PowerShell version integrates with the existing background wrapper:\n\n```powershell\n.\\Invoke-BackgroundDiagnostics-v7.ps1 -Script MitmAudit -OutputPath .\\results\n```\n\n## Usage\n\n**Windows (Admin recommended):**\n```powershell\n.\\templates\\network\\Invoke-MitmAudit-v7.ps1\n```\n\n**Linux/macOS:**\n```bash\n./templates/network/mitm-audit.sh\n```\n\n**With Vyve/ISP context validation:**\n```\n# In mitm-audit.cfg\nEXPECTED_ISP_PATTERNS=Vyve,Eagle,Lumen,Level3\n```\n\n## Evidence Processing Workflow\n\n1. **Check `_RedFlags.txt`** - If empty, MITM may be passive/logging only\n2. **Certificate Serial Check** - Copy serial to [crt.sh](https://crt.sh) on clean network:\n   - \"No certificates found\" = **100% MITM** by private root CA\n   - Different domain = collision attack\n3. **Zip + Hash** the evidence folder for chain of custody\n\nThe scripts detect infrastructure-side MITM while ruling out client-side exploits by checking proxy settings, browser extensions, hosts file tampering, and suspicious root CAs separately.","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","codeBlocks":[{"unregistered":true,"content":"# Target Domains for MITM Detection\n# High-value authentication endpoints that should NEVER be proxied\n# =============================================================================\nTARGETS=accounts.google.com,login.microsoftonline.com,appleid.apple.com,aws.amazon.com,github.com\n\n# =============================================================================\n# Public DNS Resolvers (Control Group for DoH Comparison)\n# =============================================================================\nPUBLIC_RESOLVERS=1.1.1.1,8.8.8.8,9.9.9.9\nDOH_ENDPOINT=https://dns.google/resolve\n\n# =============================================================================\n# ASN Lookup Service\n# =============================================================================\nASN_LOOKUP_URL=http://ip-api.com/json","languageId":"plaintext","isGenerating":false,"isClickable":false,"codeBlockIdx":0},{"unregistered":true,"content":"ForensicEvidence_YYYYMMDD_HHMMSS/\n  _AuditLog.txt\n  _RedFlags.txt           \u003c-- Check this FIRST\n  _FileHashes.json\n  Summary.json\n  environment/\n  trust-store/\n  targets/\n  traceroute/\n  client-side/","languageId":"plaintext","isGenerating":false,"isClickable":false,"codeBlockIdx":1},{"unregistered":true,"content":".\\Invoke-BackgroundDiagnostics-v7.ps1 -Script MitmAudit -OutputPath .\\results","languageId":"powershell","isGenerating":false,"isClickable":false,"codeBlockIdx":2},{"unregistered":true,"content":".\\templates\\network\\Invoke-MitmAudit-v7.ps1","languageId":"powershell","isGenerating":false,"isClickable":false,"codeBlockIdx":3},{"unregistered":true,"content":"./templates/network/mitm-audit.sh","languageId":"shellscript","isGenerating":false,"isClickable":false,"codeBlockIdx":4},{"unregistered":true,"content":"# In mitm-audit.cfg\nEXPECTED_ISP_PATTERNS=Vyve,Eagle,Lumen,Level3","languageId":"plaintext","isGenerating":false,"isClickable":false,"codeBlockIdx":5}]},"bubbleId":"1db03c30-2c05-43dc-9f19-bfcc727fe840"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"22d56af6-2480-4c65-a16f-e8c285c054cc","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:39:47.351Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","capabilityType":15,"toolFormerData":{"tool":40,"toolIndex":1,"modelCallId":"91504fb3-1310-41c0-aac4-3e2d697e7bde","toolCallId":"toolu_01QJws9PjiZjBa7APdyraL4y","status":"completed","rawArgs":"{\"target_file\": \"templates/network/README.md\"}","name":"read_file","params":"{\"targetFile\":\"templates/network/README.md\",\"charsLimit\":100000,\"effectiveUri\":\"file:///c%3A/Users/user/Downloads/Cursor_working_directory_misc/templates/network/README.md\"}","additionalData":{},"result":"{\"contents\":\"# Network Diagnostics Toolkit\\n\\nNetwork scanning, DNS diagnostics, and forensics collection tools.\\n\\n## Scripts\\n\\n| Script | Platform | Purpose |\\n|--------|----------|---------|\\n| `Invoke-NetworkScan-v7.ps1` | Windows (PS7) | TCP port scanner with service detection |\\n| `Invoke-DnsDiagnostics-v7.ps1` | Windows (PS7) | DNS anomaly detection and consistency checks |\\n| `Invoke-NetworkForensics-v7.ps1` | Windows (PS7) | Forensic data collection and analysis |\\n| `Invoke-BackgroundDiagnostics-v7.ps1` | Windows (PS7) | Background wrapper for all diagnostics |\\n| `network-scan.sh` | POSIX | TCP port scanner |\\n| `dns-diagnostics.sh` | POSIX | DNS testing and anomaly detection |\\n| `network-forensics.sh` | POSIX | Forensic data collection |\\n| `Invoke-PacketCapture-v7.ps1` | Windows (PS7) | Packet capture with pktmon (full detail, timestamps) |\\n| `packet-capture.sh` | POSIX | Packet capture with tcpdump (full detail, timestamps) |\\n\\n## Configuration\\n\\nAll scripts use `network.cfg` with KEY=VALUE format:\\n\\n```\\nTARGET_HOST=192.168.1.1\\nTARGET_NETWORK=192.168.1.0/24\\nSCAN_PORTS=21,22,23,25,53,80,443,445,3389,8080,8443\\nDNS_SERVERS=1.1.1.1,8.8.8.8,9.9.9.9\\nDNS_TEST_DOMAINS=api2.cursor.sh,github.com,google.com\\nSCAN_TIMEOUT_MS=500\\nOUTPUT_DIR=./network-diagnostics\\n\\n# Packet capture settings\\nCAPTURE_SNAPLEN=0\\nCAPTURE_MAX_SIZE_MB=512\\nCAPTURE_ROTATE_COUNT=10\\nCAPTURE_TIMESTAMP_PRECISION=nano\\nCAPTURE_CONVERT_PCAPNG=true\\n```\\n\\n## Usage Examples\\n\\n### Network Scanning\\n\\n```powershell\\n# Windows - Scan single host\\n.\\\\Invoke-NetworkScan-v7.ps1 -Target 192.168.1.1 -Ports \\\"22,80,443\\\"\\n\\n# Windows - Use config file\\n.\\\\Invoke-NetworkScan-v7.ps1 -ConfigFile .\\\\network.cfg\\n\\n# Unix\\n./network-scan.sh -t 192.168.1.1 -p \\\"22,80,443\\\"\\n```\\n\\n### DNS Diagnostics\\n\\n```powershell\\n# Windows - Test specific domain\\n.\\\\Invoke-DnsDiagnostics-v7.ps1 -Domain api2.cursor.sh\\n\\n# Windows - Full diagnostics with config\\n.\\\\Invoke-DnsDiagnostics-v7.ps1 -ConfigFile .\\\\network.cfg -OutputPath .\\\\results\\n\\n# Unix\\n./dns-diagnostics.sh -d api2.cursor.sh -s \\\"1.1.1.1,8.8.8.8\\\"\\n```\\n\\n### Network Forensics\\n\\n```powershell\\n# Windows - Full collection\\n.\\\\Invoke-NetworkForensics-v7.ps1 -OutputPath .\\\\forensics\\n\\n# Unix\\n./network-forensics.sh -o ./forensics\\n```\\n\\n### Background Execution (for Agent/Automation)\\n\\nFor scripts that may run indefinitely or timeout in agent sessions:\\n\\n```powershell\\n# Windows - Run any diagnostic in background\\n.\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script NetworkForensics -OutputPath .\\\\results\\n.\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script DnsDiagnostics -WaitSeconds 30\\n.\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script PacketCapture -ScriptArgs @{Duration=60}\\n\\n# Check status\\nGet-Content .\\\\results\\\\*-status.json\\n\\n# Read output when complete\\nGet-Content .\\\\results\\\\*-stdout.txt\\n```\\n\\n```sh\\n# Unix - Use nohup for background\\nnohup ./network-forensics.sh -o ./results \u003e forensics.log 2\u003e\u00261 \u0026\\n\\n# Check later\\ncat forensics.log\\n```\\n\\n### Packet Capture\\n\\n```powershell\\n# Windows - Capture with pktmon (requires Admin)\\n.\\\\Invoke-PacketCapture-v7.ps1 -Duration 60 -OutputPath .\\\\captures\\n.\\\\Invoke-PacketCapture-v7.ps1 -Filter \\\"port 443\\\" -Duration 30 -ConvertToPcap\\n\\n# Unix - Capture with tcpdump (requires root/sudo)\\n./packet-capture.sh -i eth0 -d 60 -o ./captures\\n./packet-capture.sh -f \\\"port 443 or port 80\\\" -d 30\\n./packet-capture.sh -i any -f \\\"host 192.168.1.1\\\" -d 120\\n```\\n\\n#### Capture Options\\n\\n**Windows (pktmon):**\\n- Full packet capture (no truncation)\\n- All network components\\n- ETL format with optional PCAPNG conversion\\n- Timestamp precision to nanoseconds\\n\\n**Unix (tcpdump):**\\n- `-XX` Hex and ASCII dump\\n- `-vvv` Maximum verbosity\\n- `-tttt` Human-readable timestamps with date\\n- `-S` Absolute sequence numbers\\n- `--time-stamp-precision=nano` Nanosecond precision (if supported)\\n- File rotation support\\n\\n## Detection Capabilities\\n\\n### DNS Diagnostics\\n\\n- DNS hijacking (fake IPs like 0.0.0.x)\\n- LLMNR/NetBIOS poisoning (.lan/.local suffixes)\\n- DNS response inconsistencies across servers\\n- Temporary resolution failures (EAI_AGAIN)\\n\\n### Network Forensics\\n\\n- ARP spoofing (duplicate MAC addresses)\\n- Suspicious listening ports\\n- Malware C2 ports (4444, 5555, 31337, etc.)\\n- Hosts file tampering\\n- Firewall state analysis\\n- Promiscuous mode detection\\n\\n## Output Format\\n\\nAll tools output JSON files for programmatic analysis:\\n\\n```\\n./network-diagnostics/\\n  scan-2025-12-01_15-00-00.json\\n  dns-diagnostics-2025-12-01_15-00-00.json\\n\\n./network-forensics/\\n  summary.json\\n  network/\\n    connections.json\\n    interfaces.json\\n    arp-cache.json\\n    routes.json\\n    listeners.json\\n  dns/\\n    cache.json\\n    hosts-file.json\\n  security/\\n    firewall.json\\n  processes/\\n    network-processes.json\\n```\\n\\n## Requirements\\n\\n### Windows\\n\\n- PowerShell 7+\\n- Administrator privileges recommended for full data collection\\n\\n### Unix/Linux/macOS\\n\\n- POSIX-compliant shell\\n- One of: dig, nslookup, or host (for DNS)\\n- One of: nc (netcat), or bash with /dev/tcp support (for scanning)\\n- tcpdump for packet capture\\n- root/sudo for packet capture and full forensics collection\\n\\n## License\\n\\nBSD-2-Clause\\n\\n## Signed-off-by\\n\\nNetwork Diagnostics Toolkit\\n\\n\",\"numCharactersInRequestedRange\":5074,\"totalLinesInFile\":199}"}},"bubbleId":"22d56af6-2480-4c65-a16f-e8c285c054cc"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"23aa1533-2877-4dcf-946d-25122fc481c7","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:40:25.069Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","serverBubbleId":"0b342133-ec73-458f-8ea8-5bfb496ae1e3","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","capabilityType":30,"thinking":{"text":"Now let me also add the MITM audit configuration section.","signature":"EuEBCkYIChgCKkDmItXJZ3ND+A07QGqu6tFO+Dq8TCTR67GyPRKTn/vu/MOqDZmFaMNIEdYBSJOZnFjYOexwdZJv0T7Y88wifQ9REgwb2NZ8LH2tQ9qdKCYaDPLMj/p77Rn7BSJKziIweEYFAJHH9axwtm/EPL5AIW/bJHlYI8xNZPkLPH/wcIvmgGKg8aA6jqTG5TkV1DpAKknzd4bRqH4Wsc3KlS1nDtk7huas2+31L63FaP2pPHIf/ucDWcUYWqq10TEgrP5VcOvsaREtGGGAPC9dXzNtDeb8S0OPHkv+5hvPGAE="},"thinkingStyle":1,"thinkingDurationMs":411},"bubbleId":"23aa1533-2877-4dcf-946d-25122fc481c7"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"2678f064-c916-4ab8-b743-8a798806b043","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:37:40.973Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","serverBubbleId":"e13eafac-4e99-4bb8-9bb8-25ee265adb07","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","capabilityType":30,"thinking":{"text":"Now let me update the README.md in the network templates directory to document these new scripts, and also update the AGENT_ONBOARD.md to reference them.","signature":"EsICCkYIChgCKkBWY9Ke9x5rI34JjiaOdbqeWerSAjqKISRBwGRBRtbjLn300Mch3WJujdRG3k5/z2k/J84iuK/AXknA92Vz9wFQEgwygZ0eEH24s63UJhcaDNSmmfRmKOrCL38SFCIw+fluQibPVmrcKsiML7UWgRA4I0a/kMQ8M3mixkzoR6cJq7YIzXlQmtLdI7RRR9hNKqkBPwINy2PAxpwtO3bzPrNP5+q0qqcurcIPLCVb9qEmN3PcI5LuBb1a0SYQ6W4ig/KhskJyC9yn2oOPqHXJiJMTxBKajS4jYE3wHbolmh/Ne4oIpNnfS40JHEt4yXPFV/tnIar8k2mxuAZDy9Fh7xdAXCToFMRPghK9i4HhCEkxpJt0CtKoURcpcdTDIfYVK/6tti0ZC7UcF106r4BhKPTB4ERza4pCdLPZwBgB"},"thinkingStyle":1,"thinkingDurationMs":1301},"bubbleId":"2678f064-c916-4ab8-b743-8a798806b043"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"2d6e5a47-0c7e-4aac-901f-138ef00cb7b4","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:34:40.239Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","capabilityType":15,"toolFormerData":{"tool":39,"toolIndex":1,"modelCallId":"417cab30-1903-4e20-bcd5-a019d4fce47c","toolCallId":"toolu_01PGeHXgUDvU8N6HH6BLS4AD","status":"completed","rawArgs":"{\"target_directory\": \"github-backup\"}","name":"list_dir","params":"{\"targetDirectory\":\"github-backup\",\"shouldEnrichTerminalMetadata\":true}","additionalData":{},"result":"{\"directoryTreeRoot\":{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\",\"childrenDirs\":[{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\BallisticsCalculator-iOS\",\"childrenDirs\":[{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\BallisticsCalculator-iOS\\\\core\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\BallisticsCalculator-iOS\\\\db\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\BallisticsCalculator-iOS\\\\docker-osx\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\BallisticsCalculator-iOS\\\\ios\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\BallisticsCalculator-iOS\\\\scripts\"}],\"childrenFiles\":[{\"name\":\"LICENSE\"},{\"name\":\"README.md\"}],\"childrenWereProcessed\":true},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\BallisticsCalculator-iOS-backup\",\"childrenDirs\":[{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\BallisticsCalculator-iOS-backup\\\\ludoplex-BallisticsCalculator-iOS-backup-37b41729db14d5b18f4e086f796e0051f57f959d\"}],\"childrenWereProcessed\":true},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\copilot-cocoten-project-backup\",\"childrenDirs\":[{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\copilot-cocoten-project-backup\\\\ludoplex-copilot-cocoten-project-backup-c97457e4a8701853f096782aee24bc4ccc6bd297\"}],\"childrenWereProcessed\":true},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\cursor-backup-extension\",\"childrenDirs\":[{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\cursor-backup-extension\\\\ludoplex-cursor-backup-extension-eb0394de8f4436bc44089de8dace67ce7e2af557\",\"fullSubtreeExtensionCounts\":{\".json\":2,\".ts\":7,\".md\":1,\"\":1},\"numFiles\":11}],\"childrenWereProcessed\":true,\"fullSubtreeExtensionCounts\":{\".json\":2,\".ts\":7,\".md\":1,\"\":1},\"numFiles\":11},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\cursor-backup-extension-backup\",\"childrenDirs\":[{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\cursor-backup-extension-backup\\\\ludoplex-cursor-backup-extension-backup-eb0394de8f4436bc44089de8dace67ce7e2af557\"}],\"childrenWereProcessed\":true},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\cursor-backup-extension-latest\",\"childrenDirs\":[{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\cursor-backup-extension-latest\\\\src\",\"fullSubtreeExtensionCounts\":{\".ts\":7},\"numFiles\":7}],\"childrenFiles\":[{\"name\":\"LICENSE\"},{\"name\":\"package.json\"},{\"name\":\"README.md\"},{\"name\":\"tsconfig.json\"}],\"childrenWereProcessed\":true,\"fullSubtreeExtensionCounts\":{\".json\":2,\".ts\":7,\".md\":1,\"\":1},\"numFiles\":11},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\cursor-backup-store\",\"childrenDirs\":[{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\cursor-backup-store\\\\ludoplex-cursor-backup-store-fbe7f6dab22fadc701e2148d2af0042136d562cc\"}],\"childrenWereProcessed\":true},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\cursor-backup-store-latest\",\"fullSubtreeExtensionCounts\":{\".ps1\":131,\".md\":89,\".txt\":639,\".cfg\":22,\".json\":185,\".jpg\":1,\".backup\":3,\".vscdb\":3,\".sh\":191,\".csv\":93,\".vbs\":1,\".zip\":10,\".ipynb\":1,\".ydk\":1,\".h\":3077,\".ts\":15,\".user\":4,\".vcproj\":4,\".pdb\":5,\".idb\":4,\".htm\":8,\"\":1314,\".manifest\":1,\".suo\":2,\".sln\":2,\".bat\":6,\".C\":9262,\".am\":709,\".jsonl\":2,\".cpp\":979,\".S\":2,\".ncb\":1,\".pbxproj\":11,\".swift\":20,\".in\":139,\".codeFragment\":2,\".ps\":9,\".hpp\":120,\".m\":33,\".lua\":4,\".c\":4109,\".s\":32,\".tex\":257,\".out\":4,\".xml\":56,\".cc\":1102,\".sql\":15,\".annotations\":1,\".js\":16,\".dox\":20,\".bin\":5,\".yml\":11,\".docs\":148,\".html\":19,\".tup\":1,\".ini\":1,\".config\":18,\".css\":11,\".ssz\":1,\".output\":362,\".external\":2,\".bib\":8,\".sty\":16,\".py\":127,\".plist\":1,\".windows\":1,\".vm\":1,\".Ubuntu\":1,\".static_and_dynamic_analysis_tools\":1,\".RoseOnRose\":1,\".java\":458,\".intel\":2,\".hudson\":1,\".Debian\":1,\".Cygwin\":1,\".pptx\":14,\".ppt\":4,\".ac\":6,\".f90\":3331,\".cmake\":160,\".sha256\":1,\".conf\":48,\".ans\":309,\".m4\":187,\".inc\":82,\".libs\":1,\".5\":1,\".pl\":81,\".def\":13,\".Makefile\":2,\".save\":25,\".annot\":20,\".org\":3,\".rose\":1,\".f\":592,\".fold\":2,\".cxx\":30,\".H\":76,\".out2\":3,\".out1\":4,\".pt\":8,\".rtf\":1,\".tpp\":6,\".README\":4,\".viz\":2,\".texi\":11,\".info\":5,\".upc\":102,\".sub\":5,\".guess\":5,\".incl\":6,\".code\":21,\".pi\":2,\".sample\":5,\".trace\":1,\".itmpl\":8,\".P\":8,\".tcl\":5,\".tmpl\":2,\".d\":2,\".common\":2,\".omc\":2,\".carefully\":2,\".raw\":2,\".ipd\":1,\".a\":1,\".cramfs\":1,\".mips\":1,\".ppc\":1,\".i386\":1,\".rot13\":1,\".cl\":6,\".custom\":4,\".cu\":26,\".default\":2,\".optla\":19,\".hs\":4,\".report\":1,\".install\":1,\".template\":4,\".qrc\":11,\".ui\":23,\".sp\":1,\".small\":1,\".mg\":1,\".lu\":1,\".is\":1,\".ft\":1,\".ep\":1,\".cg\":1,\".bt\":1,\".sun_ultra_sparc\":1,\".sp2_babbage\":1,\".2\":1,\".dec_alpha\":1,\".gcc\":2,\".sun\":1,\".omni\":3,\".gomp\":1,\".omp\":2,\".identity\":1,\".rose-seq\":1,\".tsinghua\":1,\".path\":1,\".openkcl\":1,\".open64\":1,\".nanos\":1,\".dragon\":1,\".xpm\":31,\".el\":1,\".zargo\":1,\".original\":13,\".allElements\":1,\".orig\":9,\".mw\":1,\".api\":2,\".owl\":2,\".ttl\":4,\".pump\":4,\".dot\":221,\".l++\":6,\".y++\":5,\".DISABLED\":1,\".patch\":2,\".show\":1,\".c++\":3,\".fig\":4,\".pig\":2,\".gergo\":2,\".ROSE\":2,\".syn\":4,\".ltl\":9,\".testinput\":1,\".ok_msg\":88,\".mk\":8,\".benchmarks\":1,\".set\":10,\".awk\":9,\".inputs\":1,\".php\":9,\".F90\":169,\".sn\":5,\".smt2\":2,\".dat\":18,\".gnu\":16,\".txC\":1,\".gp\":7,\".unsupported\":2,\".test\":3,\".sector\":2,\".compile\":1,\".mat\":6,\".nsdump\":1,\".F\":76,\".eps\":3,\".ref\":35,\".tab\":1,\".tf\":2,\".cmpmd\":6,\".sed\":2,\".makefile\":4,\".l\":5,\".y\":8,\".doxyfile\":1,\".labels\":8,\".aral\":13,\".notaral\":1,\".hxx\":2,\".lxx\":1,\".yxx\":1,\".cdl\":86,\".h-template\":4,\".C-template\":3,\".expected\":74,\".nc\":11,\".1\":4,\".ti\":16,\".cpp_dot\":2,\".tld\":4,\".ncml\":1,\".dmp\":768,\".dxy\":1,\".Windows\":1,\".spot\":5,\".readme\":1,\".dods\":87,\".dds\":87,\".das\":87,\".ico\":1,\".cmd\":3,\".x10\":3,\".spec\":4,\".manual\":1,\".coll\":2,\".base3\":1,\".hpcstruct\":1,\".old\":3,\".example\":1,\".h5\":2,\".3\":3,\".adb\":151,\".b01\":1,\".b00\":1,\".du\":4,\".June_27_2006_original\":2,\".outx\":1,\".inplace\":1,\".ann\":1,\".hh\":29,\".caf\":94,\".bug\":1,\".binary\":1,\".codes\":1,\".macro\":36,\".cs\":29,\".cobol\":1,\".cob\":1,\".redundant_file\":3,\".yy\":3,\".ll\":6,\".ads\":122,\".gpr\":11,\".ada\":2,\".f03\":386,\".f08\":61,\".F08\":1,\".F03\":1,\".F95\":1,\".f95\":3,\".f77\":2,\".exp\":8,\".adc\":1,\".am-recursive\":29,\".am-nonrecursive\":2,\".pri\":2,\".qxf\":12,\".qnfa\":12,\".qxm\":1,\".pre\":5,\".notused\":2,\".hhh\":1,\".usedef\":1,\".classes\":1,\".i\":2,\".winners\":1,\".losers\":1,\".fxx\":10,\".jov\":288,\".jovial\":2,\".cpl\":137,\".comments\":2,\".cop\":1,\".with_comments\":1,\".am-old\":1,\".coverity\":1,\".res\":4,\".rc\":4,\".msvc_dll\":1,\".msvc\":2,\".mingw_dll\":1,\".mingw\":1,\".cygwin_dll\":1,\".cygwin\":1,\".bcc32_dll\":1,\".bcc32\":1,\".vb\":1,\".vbw\":1,\".vbp\":1,\".SCC\":1,\".bas\":4,\".frm\":1,\".nozlib\":1,\".nopnglib\":1,\".all\":1,\".rb\":11,\".python\":1,\".freebasic\":1,\".bi\":3,\".delphi\":1,\".dpr\":2,\".pas\":3,\".c#\":1,\".pfb\":1,\".afm\":1,\".ttf\":1,\".rmod\":2,\".tbl\":1,\".sdf\":2},\"numFiles\":32935},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\cursor-docs-registry-backup\",\"childrenDirs\":[{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\cursor-docs-registry-backup\\\\ludoplex-cursor-docs-registry-backup-72de1a0628369d9aabdef4b1cf06cc300f5ff763\"}],\"childrenWereProcessed\":true},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\cursor-project-scaffolding-backup\",\"childrenDirs\":[{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\cursor-project-scaffolding-backup\\\\ludoplex-cursor-project-scaffolding-backup-f6582e718307ac074929abfbd31c6444e6d72371\"}],\"childrenWereProcessed\":true},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\cursor-project-scaffolding-latest\",\"childrenDirs\":[{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\cursor-project-scaffolding-latest\\\\extensions\",\"fullSubtreeExtensionCounts\":{\".json\":1},\"numFiles\":1},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\cursor-project-scaffolding-latest\\\\git-ops\",\"fullSubtreeExtensionCounts\":{\".ps1\":6,\".sh\":6,\".md\":2},\"numFiles\":14},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\cursor-project-scaffolding-latest\\\\prr\",\"fullSubtreeExtensionCounts\":{\".md\":4,\".yaml\":1,\".sh\":1,\".ps1\":1},\"numFiles\":7},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\cursor-project-scaffolding-latest\\\\templates\",\"fullSubtreeExtensionCounts\":{\".json\":16,\".template\":51,\".md\":4},\"numFiles\":71},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\cursor-project-scaffolding-latest\\\\utils\",\"fullSubtreeExtensionCounts\":{\".sh\":2,\".ps1\":3,\".md\":1},\"numFiles\":6}],\"childrenFiles\":[{\"name\":\"CONTRIBUTING.md\"},{\"name\":\"CursorProject.psd1\"},{\"name\":\"CursorProject.psm1\"},{\"name\":\"Invoke-Template.ps1\"},{\"name\":\"LICENSE\"},{\"name\":\"New-Project-v5.ps1\"},{\"name\":\"New-Project-v7.ps1\"},{\"name\":\"new-project.sh\"},{\"name\":\"project.cfg\"},{\"name\":\"README.md\"},{\"name\":\"SECURITY.md\"},{\"name\":\"Watch-Project-v5.ps1\"},{\"name\":\"Watch-Project-v7.ps1\"},{\"name\":\"watch-project.sh\"},{\"name\":\"Watch-ProjectFiles.ps1\"},{\"name\":\"watcher.cfg\"}],\"childrenWereProcessed\":true,\"fullSubtreeExtensionCounts\":{\".cfg\":2,\".ps1\":16,\".sh\":11,\".md\":14,\".json\":17,\".template\":51,\".yaml\":1,\"\":1,\".psm1\":1,\".psd1\":1},\"numFiles\":115},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\CursorProject\",\"childrenFiles\":[{\"name\":\"CursorProject.psd1\"},{\"name\":\"CursorProject.psm1\"},{\"name\":\"new-project.sh\"},{\"name\":\"project.cfg\"}],\"childrenWereProcessed\":true},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\dexter\",\"childrenDirs\":[{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\dexter\\\\data\",\"fullSubtreeExtensionCounts\":{\".json\":1},\"numFiles\":1},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\dexter\\\\legacy\",\"fullSubtreeExtensionCounts\":{\".lock\":1,\".py\":34,\".csv\":1,\".md\":1,\".toml\":1,\".json\":1,\".js\":1,\".example\":1},\"numFiles\":41},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\dexter\\\\node_modules\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\dexter\\\\src\",\"fullSubtreeExtensionCounts\":{\".ts\":30,\".tsx\":10},\"numFiles\":40}],\"childrenFiles\":[{\"name\":\"biome.json\"},{\"name\":\"bun.lock\"},{\"name\":\"env.example\"},{\"name\":\"jest.config.js\"},{\"name\":\"package.json\"},{\"name\":\"README.md\"},{\"name\":\"tsconfig.json\"}],\"childrenWereProcessed\":true,\"fullSubtreeExtensionCounts\":{\".lock\":2,\".json\":5,\".ts\":30,\".tsx\":10,\".md\":2,\".py\":34,\".csv\":1,\".toml\":1,\".js\":2,\".example\":2},\"numFiles\":89},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\docs-registry-backup\",\"childrenDirs\":[{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\docs-registry-backup\\\\ludoplex-docs-registry-backup-9c4024941f90d91d77483ec250a5fda530d280b3\"}],\"childrenWereProcessed\":true},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\docs-registry-latest\",\"fullSubtreeExtensionCounts\":{\".ps1\":7,\".md\":6,\".json\":2,\".sh\":2},\"numFiles\":17},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\forensic-captures\",\"childrenDirs\":[{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\forensic-captures\\\\captures\",\"fullSubtreeExtensionCounts\":{\".sha256\":1,\".json\":1},\"numFiles\":2}],\"childrenFiles\":[{\"name\":\"Download-LargeFile.ps1\"},{\"name\":\"README.md\"},{\"name\":\"Upload-LargeFile.ps1\"},{\"name\":\"verify.ps1\"}],\"childrenWereProcessed\":true,\"fullSubtreeExtensionCounts\":{\".ps1\":3,\".md\":1,\".sha256\":1,\".json\":1},\"numFiles\":6},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\forensic-captures-backup\",\"childrenDirs\":[{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\forensic-captures-backup\\\\ludoplex-forensic-captures-backup-80beeba2571424da582747060b48c9d9a7165fab\"}],\"childrenWereProcessed\":true},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\Generic-C-A64-Template-backup\",\"childrenDirs\":[{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\Generic-C-A64-Template-backup\\\\ludoplex-Generic-C-A64-Template-backup-1c27fa61393e5e3591775c0afdda26bd03e8b8a8\"}],\"childrenWereProcessed\":true},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\gerev-latest\",\"fullSubtreeExtensionCounts\":{\"\":3,\".yaml\":1,\".sh\":2,\".js\":4,\".json\":4,\".py\":65,\".tsx\":5,\".ts\":4,\".png\":40,\".txt\":2,\".md\":7,\".svg\":14,\".webp\":1,\".jpeg\":1,\".gif\":1,\".ttf\":6,\".css\":3,\".html\":1,\".ico\":1,\".ini\":1,\".mako\":1},\"numFiles\":167},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\Ikemen-Plus-Ultra-backup\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\mighty-house-sops-latest\",\"fullSubtreeExtensionCounts\":{\".md\":31,\".ps1\":2,\".bat\":3,\"\":1},\"numFiles\":37},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\rose-1\",\"fullSubtreeExtensionCounts\":{\".h\":2753,\".user\":4,\".vcproj\":4,\".pdb\":5,\".idb\":4,\".htm\":8,\".manifest\":1,\".suo\":2,\".sln\":2,\".ncb\":1,\".obj\":5,\"\":1335,\".am\":636,\".json\":7,\".hpp\":119,\".cpp\":939,\".txt\":555,\".C\":4434,\".s\":32,\".tex\":229,\".c\":2509,\".out\":4,\".xml\":56,\".cc\":227,\".annotations\":1,\".gz\":7,\".in\":138,\".dox\":20,\".bin\":5,\".tup\":1,\".ini\":1,\".config\":19,\".output\":155,\".external\":2,\".f90\":130,\".md\":17,\".conf\":47,\".ans\":309,\".inc\":58,\".out2\":3,\".out1\":4,\".save\":25,\".annot\":20,\".f\":59,\".pt\":8,\".sh\":226,\".README\":4,\".raw\":2,\".ipd\":1,\".so\":8,\".EXE\":1,\".a\":1,\".cramfs\":1,\".mips\":1,\".ppc\":1,\".i386\":1,\".rot13\":1,\".pump\":4,\".py\":138,\".show\":1,\".ROSE\":2,\".benchmarks\":1,\".F90\":66,\".gnu\":16,\".awk\":9,\".unsupported\":2,\".test\":3,\".sector\":2,\".compile\":1,\".ps\":9,\".bib\":8,\".sty\":16,\".eps\":3,\".texi\":11,\".info\":5,\".html\":22,\".tab\":1,\".m4\":186,\".l\":5,\".y\":8,\".ac\":7,\".sub\":5,\".guess\":5,\".F\":66,\".cdl\":86,\".nc\":11,\".1\":6,\".ncml\":1,\".dmp\":768,\".dods\":87,\".dds\":87,\".das\":87,\".h5\":2,\".3\":5,\".hh\":29,\".pl\":108,\".template\":4,\".codeFragment\":2,\".docs\":149,\".rose\":1,\".pptx\":14,\".Makefile\":2,\".cxx\":28,\".windows\":1,\".vm\":1,\".Ubuntu\":1,\".static_and_dynamic_analysis_tools\":1,\".RoseOnRose\":1,\".java\":42,\".intel\":2,\".hudson\":1,\".Debian\":1,\".Cygwin\":1,\".css\":10,\".ppt\":4,\".cmake\":159,\".libs\":1,\".5\":1,\".def\":10,\".tpp\":6,\".hpcstruct\":1,\".viz\":2,\".old\":3,\".example\":1,\".upc\":102,\".patch\":2,\".trace\":1,\".adb\":32,\".js\":14,\".allElements\":1,\".php\":9,\".cfg\":5,\".original\":12,\".du\":4,\".ref\":35,\".June_27_2006_original\":2,\".code\":21,\".macro\":36,\".cl\":1,\".cu\":26,\".class\":15,\".sql\":13,\".redundant_file\":3,\".yy\":3,\".ll\":6,\".ltl\":9,\".testinput\":1,\".tcl\":5,\".csv\":92,\".xpm\":31,\".fig\":4,\".dat\":15,\".outx\":1,\".mk\":1,\".mat\":6,\".expected\":74,\".nsdump\":1,\".org\":3,\".fold\":2,\".ann\":1,\".tf\":2,\".qrc\":11,\".ui\":23,\".smt2\":2,\".pri\":2,\".cmpmd\":6,\".qxf\":12,\".qnfa\":12,\".qxm\":1,\".pre\":5,\".H\":76,\".notused\":2,\".rtf\":1,\".l++\":6,\".inplace\":1,\".dxy\":1,\".Windows\":1,\".spot\":5,\".ti\":16,\".hs\":4,\".inputs\":1,\".readme\":1,\".gp\":7,\".usedef\":1,\".manual\":1,\".common\":2,\".y++\":5,\".txC\":1,\".coll\":2,\".binary\":1,\".codes\":1,\".d\":2,\".am-recursive\":29,\".am-nonrecursive\":2,\".x10\":3,\".spec\":4,\".incl\":6,\".pi\":2,\".itmpl\":8,\".P\":8,\".tmpl\":2,\".el\":1,\".zargo\":1,\".sample\":5,\".omc\":2,\".api\":2,\".orig\":9,\".custom\":4,\".carefully\":2,\".optla\":19,\".gergo\":2,\".owl\":2,\".report\":1,\".install\":1,\".ttl\":4,\".sp\":1,\".small\":1,\".mg\":1,\".lu\":1,\".is\":1,\".ft\":1,\".ep\":1,\".cg\":1,\".bt\":1,\".sun_ultra_sparc\":1,\".sp2_babbage\":1,\".2\":1,\".dec_alpha\":1,\".gcc\":2,\".sun\":1,\".omni\":3,\".gomp\":1,\".omp\":2,\".identity\":1,\".rose-seq\":1,\".tsinghua\":1,\".path\":1,\".openkcl\":1,\".open64\":1,\".nanos\":1,\".dragon\":1,\".b01\":1,\".b00\":2,\".DISABLED\":1,\".ok_msg\":88,\".sed\":2,\".doxyfile\":1,\".sn\":5,\".dot\":27,\".ico\":1,\".m\":24,\".set\":10,\".cmd\":3,\".default\":2,\".cpp_dot\":2,\".c++\":3,\".pig\":2,\".tld\":4,\".am-old\":1,\".syn\":4,\".makefile\":3,\".i\":2,\".mw\":1,\".hxx\":2,\".coverity\":1,\".base3\":1,\".hhh\":1,\".tar\":8,\".labels\":8,\".aral\":13,\".notaral\":1,\".h-template\":4,\".C-template\":3,\".lxx\":1,\".yxx\":1,\".jar\":5,\".tbl\":6,\".sdf\":22,\".aterm\":1,\".str\":2,\".classes\":1,\".pm\":6,\".cs\":22,\".2006\":1,\".disabled\":1,\".sha-256\":1,\".rmod\":2,\".svn\":1,\".scp\":3,\".submit\":2,\".res\":4,\".rc\":4,\".4\":3,\".unit\":8,\".vb\":1,\".vbw\":1,\".vbp\":1,\".SCC\":1,\".bas\":4,\".frm\":1,\".msvc\":2,\".nozlib\":1,\".nopnglib\":1,\".all\":1,\".rb\":11,\".36\":1,\".msvc_dll\":1,\".mingw_dll\":1,\".mingw\":1,\".cygwin_dll\":1,\".cygwin\":1,\".bcc32_dll\":1,\".bcc32\":1,\".gpr\":6,\".0\":1,\".python\":1,\".ads\":28,\".nmi\":1,\".freebasic\":1,\".bi\":3,\".delphi\":1,\".dpr\":2,\".pas\":3,\".c#\":1,\".build_latest\":1,\".jov\":288,\".jovial\":2,\".cpl\":137,\".comments\":2,\".cop\":1},\"numFiles\":19269},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\\\\rose-1-latest\",\"fullSubtreeExtensionCounts\":{\".h\":2434,\".c\":2983,\".user\":4,\".vcproj\":4,\".py\":91,\"\":1143,\".am\":626,\".pdb\":5,\".idb\":4,\".htm\":8,\".txt\":498,\".C\":6057,\".manifest\":1,\".suo\":2,\".sln\":2,\".ncb\":1,\".obj\":5,\".cpp\":924,\".config\":18,\".conf\":48,\".ans\":309,\".in\":135,\".docs\":134,\".html\":18,\".rose\":1,\".json\":7,\".hpp\":93,\".tex\":257,\".gif\":62,\".dox\":20,\".Makefile\":2,\".cxx\":29,\".pdf\":41,\".inc\":75,\".windows\":1,\".vm\":1,\".Ubuntu\":1,\".static_and_dynamic_analysis_tools\":1,\".RoseOnRose\":1,\".java\":448,\".intel\":2,\".hudson\":1,\".Debian\":1,\".Cygwin\":1,\".tgz\":2,\".ac\":6,\".cc\":221,\".bib\":8,\".sty\":16,\".xml\":56,\".css\":10,\".jpg\":27,\".ps\":9,\".md\":13,\".pptx\":13,\".ppt\":3,\".png\":115,\".tpp\":5,\".viz\":2,\".m4\":186,\".cmake\":158,\".libs\":1,\".5\":1,\".pl\":80,\".sh\":166,\".def\":7,\".upc\":102,\".s\":32,\".out\":4,\".trace\":1,\".annotations\":1,\".out2\":3,\".out1\":4,\".gz\":4,\".bin\":5,\".tup\":1,\".ini\":1,\".save\":25,\".annot\":20,\".f\":378,\".pt\":6,\".output\":361,\".external\":2,\".allElements\":1,\".original\":13,\".f90\":2263,\".cl\":6,\".cu\":26,\".js\":14,\".php\":9,\".awk\":9,\".sql\":13,\".README\":4,\".raw\":2,\".ipd\":1,\".so\":8,\".exe\":8,\".EXE\":1,\".a\":1,\".cramfs\":1,\".mips\":1,\".ppc\":1,\".i386\":1,\".rot13\":1,\".tcl\":5,\".xpm\":3,\".fig\":4,\".F\":70,\".mk\":5,\".org\":3,\".fold\":2,\".pump\":4,\".expected\":74,\".smt2\":2,\".show\":1,\".ROSE\":2,\".csv\":92,\".benchmarks\":1,\".F90\":159,\".gnu\":16,\".log\":14,\".H\":76,\".unsupported\":2,\".test\":3,\".sector\":2,\".compile\":1,\".eps\":3,\".texi\":11,\".info\":5,\".tab\":1,\".rtf\":1,\".l\":4,\".y\":6,\".sub\":4,\".guess\":4,\".codeFragment\":2,\".cdl\":86,\".nc\":11,\".1\":4,\".dxy\":1,\".Windows\":1,\".ncml\":1,\".coll\":2,\".dmp\":768,\".spec\":4,\".dods\":87,\".dds\":87,\".das\":87,\".ti\":16,\".qrc\":11,\".ui\":23,\".d\":2,\".el\":1,\".zargo\":1,\".manual\":1,\".common\":2,\".api\":2,\".incl\":2,\".code\":15,\".pi\":1,\".h5\":2,\".3\":3,\".itmpl\":8,\".P\":8,\".tmpl\":2,\".gergo\":2,\".sample\":5,\".omc\":2,\".custom\":4,\".optla\":19,\".hs\":4,\".carefully\":2,\".report\":1,\".install\":1,\".template\":3,\".sp\":1,\".small\":1,\".mg\":1,\".lu\":1,\".is\":1,\".ft\":1,\".ep\":1,\".cg\":1,\".bt\":1,\".sun_ultra_sparc\":1,\".sp2_babbage\":1,\".2\":1,\".dec_alpha\":1,\".gcc\":2,\".sun\":1,\".omni\":3,\".gomp\":1,\".omp\":2,\".identity\":1,\".rose-seq\":1,\".tsinghua\":1,\".path\":1,\".openkcl\":1,\".open64\":1,\".nanos\":1,\".dragon\":1,\".ok_msg\":88,\".sn\":5,\".orig\":8,\".owl\":2,\".ttl\":4,\".dot\":225,\".l++\":6,\".y++\":5,\".patch\":2,\".DISABLED\":1,\".c++\":3,\".pig\":2,\".makefile\":4,\".syn\":4,\".hxx\":2,\".set\":10,\".sed\":2,\".m\":24,\".hh\":29,\".doxyfile\":1,\".default\":2,\".gp\":7,\".mw\":1,\".cpp_dot\":2,\".tld\":4,\".old\":3,\".labels\":8,\".aral\":13,\".notaral\":1,\".hpcstruct\":1,\".lxx\":1,\".yxx\":1,\".example\":1,\".h-template\":4,\".C-template\":3,\".adb\":115,\".docx\":1,\".du\":4,\".ref\":35,\".cfg\":5,\".June_27_2006_original\":2,\".binary\":1,\".codes\":1,\".x10\":1,\".base3\":1,\".outx\":1,\".ico\":1,\".cmd\":3,\".doc\":1,\".ann\":1,\".b01\":1,\".b00\":1,\".caf\":94,\".ltl\":9,\".testinput\":1,\".inplace\":1,\".dat\":12,\".mat\":6,\".nsdump\":1,\".tf\":2,\".cmpmd\":6,\".bug\":1,\".macro\":36,\".spot\":5,\".class\":15,\".readme\":1,\".redundant_file\":3,\".yy\":1,\".ll\":1,\".txC\":1,\".inputs\":1,\".f03\":186,\".f08\":42,\".F08\":1,\".F03\":1,\".F95\":1,\".f95\":2,\".f77\":2,\".exp\":5,\".usedef\":1,\".pri\":2,\".am-recursive\":18,\".am-nonrecursive\":1,\".qxf\":12,\".qnfa\":12,\".qxm\":1,\".pre\":5,\".notused\":2,\".fxx\":10,\".jov\":288,\".jovial\":2,\".cpl\":137,\".comments\":2,\".cop\":1,\".cs\":7,\".cobol\":1,\".cob\":1,\".ads\":90,\".gpr\":3,\".ada\":2},\"numFiles\":24521}],\"childrenFiles\":[{\"name\":\"BallisticsCalculator-iOS-backup.zip\"},{\"name\":\"clone-repos.bat\"},{\"name\":\"copilot-cocoten-project-backup.zip\"},{\"name\":\"cursor-backup-extension-backup.zip\"},{\"name\":\"cursor-backup-extension.zip\"},{\"name\":\"cursor-backup-store.zip\"},{\"name\":\"cursor-docs-registry-backup.zip\"},{\"name\":\"cursor-project-scaffolding-backup.zip\"},{\"name\":\"cursor-rose-linter-backup.zip\"},{\"name\":\"docs-backup.zip\"},{\"name\":\"docs-registry-backup.zip\"},{\"name\":\"forensic-captures-backup.zip\"},{\"name\":\"Generic-C-A64-Template-backup.zip\"},{\"name\":\"github_auth_server.py\"},{\"name\":\"import-dexter.cfg\"},{\"name\":\"import-forensic-captures.cfg\"},{\"name\":\"Import-Repo-v5.ps1\"},{\"name\":\"Import-Repo-v7.ps1\"},{\"name\":\"import-repo.cfg\"},{\"name\":\"import-repo.sh\"},{\"name\":\"import-scaffolding.cfg\"},{\"name\":\"rose-1-backup.zip\"},{\"name\":\"run-clone.vbs\"},{\"name\":\"templates-network-backup.zip\"}],\"childrenWereProcessed\":true,\"fullSubtreeExtensionCounts\":{\".vbs\":2,\".bat\":10,\".ps1\":161,\".cfg\":38,\".sh\":599,\".py\":456,\".json\":232,\".ts\":63,\".md\":182,\"\":3799,\".yaml\":2,\".lock\":2,\".txt\":1694,\".js\":50,\".jpg\":28,\".tsx\":15,\".backup\":3,\".vscdb\":3,\".h\":8264,\".c\":9601,\".png\":155,\".csv\":278,\".user\":12,\".vcproj\":12,\".svg\":14,\".webp\":1,\".jpeg\":1,\".gif\":63,\".am\":1971,\".pdb\":15,\".idb\":12,\".htm\":24,\".ttf\":7,\".template\":62,\".C\":19753,\".manifest\":3,\".suo\":6,\".sln\":6,\".zip\":10,\".ipynb\":1,\".ydk\":1,\".css\":34,\".ncb\":3,\".html\":60,\".ico\":4,\".obj\":10,\".cpp\":2842,\".config\":55,\".conf\":143,\".ans\":927,\".in\":412,\".docs\":431,\".rose\":3,\".jsonl\":2,\".ini\":4,\".hpp\":332,\".S\":2,\".tex\":743,\".dox\":60,\".mako\":1,\".Makefile\":6,\".cxx\":87,\".pbxproj\":11,\".pdf\":41,\".inc\":215,\".windows\":3,\".vm\":3,\".Ubuntu\":3,\".static_and_dynamic_analysis_tools\":3,\".RoseOnRose\":3,\".java\":948,\".intel\":6,\".hudson\":3,\".Debian\":3,\".Cygwin\":3,\".tgz\":2,\".ac\":19,\".cc\":1550,\".toml\":1,\".example\":5,\".bib\":24,\".sty\":48,\".xml\":168,\".ps\":27,\".swift\":20,\".codeFragment\":6,\".sha256\":2,\".pptx\":41,\".ppt\":11,\".psm1\":1,\".psd1\":1,\".tpp\":17,\".viz\":6,\".m4\":559,\".cmake\":477,\".libs\":3,\".5\":3,\".pl\":269,\".def\":30,\".upc\":306,\".s\":96,\".m\":81,\".out\":12,\".trace\":3,\".lua\":4,\".annotations\":3,\".out2\":9,\".out1\":12,\".gz\":11,\".bin\":15,\".tup\":3,\".save\":75,\".annot\":60,\".f\":1029,\".pt\":22,\".output\":878,\".external\":6,\".sql\":41,\".allElements\":3,\".yml\":11,\".original\":38,\".f90\":5724,\".cl\":13,\".cu\":78,\".ssz\":1,\".php\":27,\".awk\":27,\".plist\":1,\".README\":12,\".raw\":6,\".ipd\":3,\".so\":16,\".exe\":8,\".EXE\":2,\".a\":3,\".cramfs\":3,\".mips\":3,\".ppc\":3,\".i386\":3,\".rot13\":3,\".tcl\":15,\".xpm\":65,\".fig\":12,\".F\":212,\".mk\":14,\".org\":9,\".fold\":6,\".H\":228,\".pump\":12,\".rtf\":3,\".expected\":222,\".texi\":33,\".info\":15,\".smt2\":6,\".show\":3,\".sub\":14,\".guess\":14,\".incl\":14,\".code\":57,\".pi\":5,\".sample\":15,\".ROSE\":6,\".itmpl\":24,\".P\":24,\".tmpl\":6,\".d\":6,\".benchmarks\":3,\".common\":6,\".F90\":394,\".omc\":6,\".gnu\":48,\".log\":14,\".carefully\":6,\".custom\":12,\".default\":6,\".unsupported\":6,\".test\":9,\".sector\":6,\".compile\":3,\".optla\":57,\".hs\":12,\".report\":3,\".install\":3,\".qrc\":33,\".ui\":69,\".sp\":3,\".small\":3,\".mg\":3,\".lu\":3,\".is\":3,\".ft\":3,\".ep\":3,\".cg\":3,\".bt\":3,\".sun_ultra_sparc\":3,\".sp2_babbage\":3,\".2\":3,\".dec_alpha\":3,\".gcc\":6,\".sun\":3,\".omni\":9,\".gomp\":3,\".omp\":6,\".identity\":3,\".rose-seq\":3,\".tsinghua\":3,\".path\":3,\".openkcl\":3,\".open64\":3,\".nanos\":3,\".dragon\":3,\".eps\":9,\".el\":3,\".zargo\":3,\".tab\":3,\".orig\":26,\".mw\":3,\".api\":6,\".owl\":6,\".ttl\":12,\".dot\":473,\".l++\":18,\".y++\":15,\".l\":14,\".y\":22,\".DISABLED\":3,\".patch\":6,\".cdl\":258,\".c++\":9,\".pig\":6,\".gergo\":6,\".nc\":33,\".syn\":12,\".1\":14,\".ltl\":27,\".testinput\":3,\".ok_msg\":264,\".set\":30,\".dxy\":3,\".Windows\":3,\".inputs\":3,\".ncml\":3,\".coll\":6,\".sn\":15,\".dmp\":2304,\".dat\":45,\".txC\":3,\".gp\":21,\".mat\":18,\".nsdump\":3,\".ref\":105,\".spec\":12,\".dods\":261,\".dds\":261,\".das\":261,\".tf\":6,\".ti\":48,\".cmpmd\":18,\".sed\":6,\".makefile\":11,\".doxyfile\":3,\".labels\":24,\".aral\":39,\".notaral\":3,\".hxx\":6,\".lxx\":3,\".yxx\":3,\".manual\":3,\".h-template\":12,\".C-template\":9,\".h5\":6,\".3\":11,\".cpp_dot\":6,\".tld\":12,\".spot\":15,\".readme\":3,\".cmd\":9,\".x10\":7,\".base3\":3,\".hh\":87,\".hpcstruct\":3,\".old\":9,\".adb\":298,\".b01\":3,\".b00\":4,\".du\":12,\".June_27_2006_original\":6,\".outx\":3,\".inplace\":3,\".docx\":1,\".ann\":3,\".binary\":3,\".codes\":3,\".caf\":188,\".doc\":1,\".bug\":2,\".macro\":108,\".cs\":58,\".cobol\":2,\".cob\":2,\".redundant_file\":9,\".yy\":7,\".ll\":13,\".ads\":240,\".class\":30,\".gpr\":20,\".ada\":4,\".f03\":572,\".f08\":103,\".F08\":2,\".F03\":2,\".F95\":2,\".f95\":5,\".f77\":4,\".exp\":13,\".adc\":1,\".am-recursive\":76,\".am-nonrecursive\":5,\".pri\":6,\".qxf\":36,\".qnfa\":36,\".qxm\":3,\".pre\":15,\".notused\":6,\".hhh\":2,\".usedef\":3,\".classes\":2,\".i\":4,\".winners\":1,\".losers\":1,\".fxx\":20,\".jov\":864,\".jovial\":6,\".cpl\":411,\".comments\":6,\".cop\":3,\".with_comments\":1,\".am-old\":2,\".coverity\":2,\".res\":8,\".rc\":8,\".tar\":8,\".msvc_dll\":2,\".msvc\":4,\".mingw_dll\":2,\".mingw\":2,\".cygwin_dll\":2,\".cygwin\":2,\".bcc32_dll\":2,\".bcc32\":2,\".jar\":5,\".tbl\":7,\".sdf\":24,\".aterm\":1,\".str\":2,\".vb\":2,\".vbw\":2,\".vbp\":2,\".SCC\":2,\".bas\":8,\".frm\":2,\".nozlib\":2,\".nopnglib\":2,\".all\":2,\".rb\":22,\".pm\":6,\".python\":2,\".2006\":1,\".disabled\":1,\".sha-256\":1,\".freebasic\":2,\".bi\":6,\".rmod\":4,\".svn\":1,\".scp\":3,\".submit\":2,\".delphi\":2,\".dpr\":4,\".pas\":6,\".c#\":2,\".4\":3,\".unit\":8,\".pfb\":1,\".afm\":1,\".36\":1,\".0\":1,\".nmi\":1,\".build_latest\":1},\"numFiles\":77188}}"}},"bubbleId":"2d6e5a47-0c7e-4aac-901f-138ef00cb7b4"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"309ae83c-cac9-48a5-8d35-279292e111f4","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:35:04.634Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","capabilityType":15,"toolFormerData":{"tool":40,"toolCallId":"toolu_01Ve512rfoo8gKGDgidEwyH4","toolIndex":2,"modelCallId":"7848ff73-4eef-46fc-916d-d1213162695c","status":"completed","rawArgs":"{\"target_file\": \"templates/network/Invoke-BackgroundDiagnostics-v7.ps1\"}","name":"read_file","params":"{\"targetFile\":\"templates/network/Invoke-BackgroundDiagnostics-v7.ps1\",\"charsLimit\":100000,\"effectiveUri\":\"file:///c%3A/Users/user/Downloads/Cursor_working_directory_misc/templates/network/Invoke-BackgroundDiagnostics-v7.ps1\"}","additionalData":{},"result":"{\"contents\":\"#Requires -Version 7.0\\n\u003c#\\n.SYNOPSIS\\n    Background execution wrapper for network diagnostics scripts.\\n\\n.DESCRIPTION\\n    Runs network diagnostic scripts as background jobs with output captured\\n    to files. Allows agent to start diagnostics and retrieve results later\\n    without blocking on long-running or indefinite processes.\\n\\n.PARAMETER Script\\n    Name of the script to run: NetworkScan, DnsDiagnostics, NetworkForensics, PacketCapture\\n\\n.PARAMETER ConfigFile\\n    Path to network.cfg configuration file.\\n\\n.PARAMETER OutputPath\\n    Directory for results and job output.\\n\\n.PARAMETER ScriptArgs\\n    Additional arguments to pass to the script as hashtable.\\n\\n.PARAMETER JobName\\n    Custom name for the background job.\\n\\n.PARAMETER WaitSeconds\\n    Seconds to wait for job completion (0 = no wait, return immediately).\\n\\n.EXAMPLE\\n    .\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script NetworkForensics -OutputPath .\\\\results\\n    .\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script DnsDiagnostics -WaitSeconds 30\\n    .\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script PacketCapture -ScriptArgs @{Duration=60}\\n\\n.NOTES\\n    License: BSD-2-Clause\\n    Requires: PowerShell 7+\\n    Signed-off-by: Network Diagnostics Toolkit\\n#\u003e\\n\\n[CmdletBinding()]\\nparam(\\n    [Parameter(Mandatory)]\\n    [ValidateSet(\u0027NetworkScan\u0027, \u0027DnsDiagnostics\u0027, \u0027NetworkForensics\u0027, \u0027PacketCapture\u0027)]\\n    [string]$Script,\\n\\n    [Parameter()]\\n    [string]$ConfigFile,\\n\\n    [Parameter()]\\n    [string]$OutputPath = \\\".\\\\diagnostics-output\\\",\\n\\n    [Parameter()]\\n    [hashtable]$ScriptArgs = @{},\\n\\n    [Parameter()]\\n    [string]$JobName,\\n\\n    [Parameter()]\\n    [int]$WaitSeconds = 0\\n)\\n\\nSet-StrictMode -Version Latest\\n$ErrorActionPreference = \u0027Stop\u0027\\n\\n#region Script Mapping\\n\\n$scriptMap = @{\\n    \u0027NetworkScan\u0027      = \u0027Invoke-NetworkScan-v7.ps1\u0027\\n    \u0027DnsDiagnostics\u0027   = \u0027Invoke-DnsDiagnostics-v7.ps1\u0027\\n    \u0027NetworkForensics\u0027 = \u0027Invoke-NetworkForensics-v7.ps1\u0027\\n    \u0027PacketCapture\u0027    = \u0027Invoke-PacketCapture-v7.ps1\u0027\\n}\\n\\n#endregion\\n\\n#region Main\\n\\n$scriptDir = $PSScriptRoot\\n$scriptPath = Join-Path $scriptDir $scriptMap[$Script]\\n\\nif (-not (Test-Path $scriptPath)) {\\n    Write-Error \\\"Script not found: $scriptPath\\\"\\n    exit 1\\n}\\n\\n# Create output directory\\nif (-not (Test-Path $OutputPath)) {\\n    New-Item -ItemType Directory -Path $OutputPath -Force | Out-Null\\n}\\n\\n$timestamp = Get-Date -Format \\\"yyyy-MM-dd_HH-mm-ss\\\"\\n$jobNameFinal = if ($JobName) { $JobName } else { \\\"$Script-$timestamp\\\" }\\n\\n# Output files\\n$stdoutFile = Join-Path $OutputPath \\\"$jobNameFinal-stdout.txt\\\"\\n$stderrFile = Join-Path $OutputPath \\\"$jobNameFinal-stderr.txt\\\"\\n$statusFile = Join-Path $OutputPath \\\"$jobNameFinal-status.json\\\"\\n\\n# Build argument list\\n$argList = @()\\nif ($ConfigFile) {\\n    $argList += \\\"-ConfigFile\\\"\\n    $argList += $ConfigFile\\n}\\n$argList += \\\"-OutputPath\\\"\\n$argList += $OutputPath\\n\\nforeach ($key in $ScriptArgs.Keys) {\\n    $argList += \\\"-$key\\\"\\n    $value = $ScriptArgs[$key]\\n    if ($value -isnot [switch] -and $value -ne $true) {\\n        $argList += $value\\n    }\\n}\\n\\n# Write initial status\\n$status = [PSCustomObject]@{\\n    JobName     = $jobNameFinal\\n    Script      = $Script\\n    ScriptPath  = $scriptPath\\n    Arguments   = $argList\\n    StartTime   = (Get-Date).ToString(\\\"o\\\")\\n    EndTime     = $null\\n    Status      = \\\"Running\\\"\\n    ExitCode    = $null\\n    StdoutFile  = $stdoutFile\\n    StderrFile  = $stderrFile\\n    OutputPath  = $OutputPath\\n}\\n$status | ConvertTo-Json -Depth 3 | Set-Content $statusFile -Encoding UTF8\\n\\nWrite-Host \\\"============================================\\\" -ForegroundColor Cyan\\nWrite-Host \\\" BACKGROUND DIAGNOSTICS LAUNCHER\\\" -ForegroundColor Cyan\\nWrite-Host \\\"============================================\\\" -ForegroundColor Cyan\\nWrite-Host \\\"Job Name:    $jobNameFinal\\\"\\nWrite-Host \\\"Script:      $Script\\\"\\nWrite-Host \\\"Output:      $OutputPath\\\"\\nWrite-Host \\\"Status File: $statusFile\\\"\\nWrite-Host \\\"\\\"\\n\\n# Start background job\\n$job = Start-Job -Name $jobNameFinal -ScriptBlock {\\n    param($ScriptPath, $ArgList, $StdoutFile, $StderrFile, $StatusFile)\\n\\n    try {\\n        # Redirect output to files\\n        $output = \u0026 $ScriptPath @ArgList 2\u003e\u00261\\n        $output | Out-File -FilePath $StdoutFile -Encoding UTF8\\n        $exitCode = $LASTEXITCODE\\n        if ($null -eq $exitCode) { $exitCode = 0 }\\n    } catch {\\n        $_ | Out-File -FilePath $StderrFile -Encoding UTF8 -Append\\n        $exitCode = 1\\n    }\\n\\n    # Update status file\\n    $status = Get-Content $StatusFile -Raw | ConvertFrom-Json\\n    $status.EndTime = (Get-Date).ToString(\\\"o\\\")\\n    $status.Status = if ($exitCode -eq 0) { \\\"Completed\\\" } else { \\\"Failed\\\" }\\n    $status.ExitCode = $exitCode\\n    $status | ConvertTo-Json -Depth 3 | Set-Content $StatusFile -Encoding UTF8\\n\\n    return $exitCode\\n} -ArgumentList $scriptPath, $argList, $stdoutFile, $stderrFile, $statusFile\\n\\nWrite-Host \\\"Job started: $($job.Id)\\\" -ForegroundColor Green\\nWrite-Host \\\"\\\"\\n\\nif ($WaitSeconds -gt 0) {\\n    Write-Host \\\"Waiting up to $WaitSeconds seconds for completion...\\\" -ForegroundColor Yellow\\n    $completed = Wait-Job -Job $job -Timeout $WaitSeconds\\n\\n    if ($completed) {\\n        $result = Receive-Job -Job $job\\n        Write-Host \\\"\\\"\\n        Write-Host \\\"Job completed.\\\" -ForegroundColor Green\\n\\n        # Display output\\n        if (Test-Path $stdoutFile) {\\n            Write-Host \\\"\\\"\\n            Write-Host \\\"--- OUTPUT ---\\\" -ForegroundColor Cyan\\n            Get-Content $stdoutFile\\n        }\\n    } else {\\n        Write-Host \\\"\\\"\\n        Write-Host \\\"Job still running after $WaitSeconds seconds.\\\" -ForegroundColor Yellow\\n        Write-Host \\\"Check status later with:\\\" -ForegroundColor Yellow\\n        Write-Host \\\"  Get-Content \u0027$statusFile\u0027\\\" -ForegroundColor White\\n        Write-Host \\\"  Get-Content \u0027$stdoutFile\u0027\\\" -ForegroundColor White\\n    }\\n} else {\\n    Write-Host \\\"Job running in background.\\\" -ForegroundColor Yellow\\n    Write-Host \\\"\\\"\\n    Write-Host \\\"To check status:\\\" -ForegroundColor Cyan\\n    Write-Host \\\"  Get-Content \u0027$statusFile\u0027\\\" -ForegroundColor White\\n    Write-Host \\\"\\\"\\n    Write-Host \\\"To read output when complete:\\\" -ForegroundColor Cyan\\n    Write-Host \\\"  Get-Content \u0027$stdoutFile\u0027\\\" -ForegroundColor White\\n    Write-Host \\\"\\\"\\n    Write-Host \\\"To check job state:\\\" -ForegroundColor Cyan\\n    Write-Host \\\"  Get-Job -Name \u0027$jobNameFinal\u0027\\\" -ForegroundColor White\\n    Write-Host \\\"\\\"\\n    Write-Host \\\"To wait and receive output:\\\" -ForegroundColor Cyan\\n    Write-Host \\\"  Receive-Job -Name \u0027$jobNameFinal\u0027 -Wait\\\" -ForegroundColor White\\n}\\n\\nWrite-Host \\\"\\\"\\nWrite-Host \\\"============================================\\\" -ForegroundColor Cyan\\n\\n#endregion\\n\\n\\n\\n\",\"numCharactersInRequestedRange\":6476,\"totalLinesInFile\":214}","attachments":"{\"shouldShowTodoWriteReminder\":true,\"todoReminderType\":\"TODO_REMINDER_TYPE_EVERY_10_TURNS\"}"}},"bubbleId":"309ae83c-cac9-48a5-8d35-279292e111f4"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"3373ec9c-ee46-4df4-b531-4fcdd6531f27","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:41:02.949Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","serverBubbleId":"ec1c633c-5a1d-4c92-bac7-153617cd01ba","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","capabilityType":30,"thinking":{"text":"Now let me make the shell script executable and verify no lint errors. Also, let me check if there\u0027s a reconciliation comparison document I should create.","signature":"EsMCCkYIChgCKkB6ylXBQM9oID3S0egukE3e5nyZmxZzDLRY/Fja3wuaS5+Aghct9nDLR5S1uDLRta1n31hs3OaGRg5Lep1dOJ+GEgxGLEE0LAHqGgLE6HMaDNJHAR0vRbUINCc1ZyIwkm2i2t0vjYiVeKngSitwpBFjYd0nC65PCiv9upoRuo+sPUuQSLscpaGwrM+XaR2iKqoBAxyAKann1+n7Y5InBReumySD3lZ47CiQwJqpQdtVfUagF4Tcofexl7ZNtqD6damgm6if5wpsMDPCm1WSBVSOX/qCWYqZ6nT1Skm4W8VRflAaIcNyxIfspdtV6VGHu/f3hiZydA2pmps3CvADU9hhFzfoL3vjNu4ODggtZqmwyRxxP7sSiXdINoHqV7dzIAJHzVsNzGRg+mgYF+BhSotAN0cBMwdfXbCPNxgYAQ=="},"thinkingStyle":1,"thinkingDurationMs":950},"bubbleId":"3373ec9c-ee46-4df4-b531-4fcdd6531f27"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"35c78798-179b-43cf-8059-8d7a0c767f7e","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:39:51.373Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","serverBubbleId":"cca9b4de-f84f-4490-be29-400f8223bd1d","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","capabilityType":30,"thinking":{"text":"Now let me add a comprehensive section about the MITM audit tools to the README.","signature":"EvgBCkYIChgCKkAS0exbpdyOe/6UtvF4iPMVfPjv9fhjbVUNXIWWHvqT6iJPHQ68Zy/5eMxf8KezF+BuC6/i+tf+eoUvgrHGnLfaEgxID0dFtN5Uor7xQf8aDJgwpWxTEgW13vO1eyIw/MYFMWdmjo5M+kAPXyVRawOX+Gajao8fXh0RRoAn6/3TQd/CwSWqHFFo+kpmj7/xKmB6VMHS64Fx7F6BvLTa7Ryi66zAbaqp3gR3fkEfxEzBWRb51sHcpm9rw5INY4UOLMVge5/1rjCjVnDM6EBCO+HkJlge6Z+PuDQXXRuzcl4NFNbH2ZHwOH9HcYA8t6S9e18YAQ=="},"thinkingStyle":1,"thinkingDurationMs":687},"bubbleId":"35c78798-179b-43cf-8059-8d7a0c767f7e"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"3a7f5e51-380a-4445-898d-12474daa33b1","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:35:31.842Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","serverBubbleId":"12e654c1-044a-476d-bff0-3f8d135a8d39","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","capabilityType":30,"thinking":{"text":"Now let me create the POSIX shell version with feature parity.","signature":"EuYBCkYIChgCKkCiik5uc4+HDWzWXiUooGM5pkYoRSIyke8+/so9Tw7slLHmiS5KvoSm/H9R09Vr9MEzS2abi8h3ORQf0B+dkj7aEgz6vblGVEDoAnxojqsaDGwb2xByt0zvF+Fk+SIwEe00DrH+MlQkKRlXd8IAeq0ANh52g+bPU/Dl1NjSpOTmwdYhkxln3h+6XGqkLqEuKk6DQllPrdkYAYXILM8k4lyaTvZtFAdVNSuSg/Of1hGyTmDDFmf5U80saYGbW1S7z31K9Kk+bCW19B9nuiBDuC+d6lmd1ULybZ/VNa2ID/cYAQ=="},"thinkingStyle":1,"thinkingDurationMs":948},"bubbleId":"3a7f5e51-380a-4445-898d-12474daa33b1"}
{"data":{"_v":3,"type":1,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"3ca959e0-d4f5-4cc2-bf5a-eaede34d50c5","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":true,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[1,41,7,38,8,9,11,12,15,18,25,27,43,46,47,29,30,32,34,35,39,40,42,44,45,49,52],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:34:04.187Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":["file:///c%3A/Users/user/Downloads/Cursor_working_directory_misc"],"richText":"{\"root\":{\"children\":[{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"This is the **Gold Standard** version.\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"It combines the **structural rigor** of the \\\"Other\\\" response (timestamped directories, full trust store exports, environment snapshots) with the **adversarial logic** of my previous response (ASN organization checks, DoH comparisons, and MITM-specific targeting).\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"These scripts are designed to produce a \\\"Evidence Package\\\" that you can zip up and hand to a security engineer.\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"### 1. PowerShell Script (Windows)\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"*Run as Administrator.*\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"```powershell\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"\u003c#\",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\".SYNOPSIS\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    Advanced Forensic Network Audit for Infrastructure MITM (Vyve/Wheatland Context)\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\".DESCRIPTION\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    Combines environment baselining, Root CA dumping, and ASN-based integrity checking.\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    Output is organized into a timestamped directory for legal/forensic chain of custody.\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"#\u003e\",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"# --- CONFIGURATION ---\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"$Targets = @(\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    \\\"accounts.google.com\\\", \",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    \\\"login.microsoftonline.com\\\", \",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    \\\"appleid.apple.com\\\", \",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    \\\"aws.amazon.com\\\",\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    \\\"search.google.com\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\")\",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"$PublicResolvers = @(\\\"1.1.1.1\\\", \\\"8.8.8.8\\\")\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"$Timestamp = Get-Date -Format \\\"yyyyMMdd_HHmmss\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"$BaseDir = \\\"$env:USERPROFILE\\\\Desktop\\\\ForensicEvidence_$Timestamp\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"# Create Evidence Directory\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"New-Item -Path $BaseDir -ItemType Directory -Force | Out-Null\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"$LogFile = \\\"$BaseDir\\\\_AuditLog.txt\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"$AlertFile = \\\"$BaseDir\\\\_RedFlags.txt\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"Function Log {\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    Param([string]$Msg)\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    Write-Host $Msg\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    Add-Content -Path $LogFile -Value \\\"$([DateTime]::Now): $Msg\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"}\",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"Function Alert {\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    Param([string]$Msg)\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    Write-Host \\\"[!] $Msg\\\" -ForegroundColor Red\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    Add-Content -Path $AlertFile -Value \\\"$([DateTime]::Now): $Msg\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    Add-Content -Path $LogFile -Value \\\"[ALERT] $Msg\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"}\",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"Function Get-ASN {\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    Param([string]$IP)\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    Try {\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"        $Req = Invoke-RestMethod -Uri \\\"http://ip-api.com/json/$IP?fields=status,message,org,as\\\" -TimeoutSec 3 -ErrorAction Stop\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"        If ($Req.status -eq \\\"success\\\") { Return \\\"$($Req.org) ($($Req.as))\\\" } Else { Return \\\"Unknown\\\" }\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    } Catch { Return \\\"Lookup Failed (Blocked?)\\\" }\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"}\",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"Log \\\"=== FORENSIC NETWORK AUDIT START ===\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"Log \\\"Location: Wheatland, WY (Target Context)\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"Log \\\"System: $env:COMPUTERNAME / User: $env:USERNAME\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"# --- PHASE 1: ENVIRONMENT SNAPSHOT ---\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"Log \\\"`n[PHASE 1] ENVIRONMENT SNAPSHOT\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"$EnvFile = \\\"$BaseDir\\\\Environment.txt\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"Get-NetIPConfiguration | Out-File $EnvFile\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"Try {\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    $ExtIP = Invoke-RestMethod -Uri \\\"https://ipinfo.io/json\\\" -TimeoutSec 5\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    Log \\\"External IP Identified: $($ExtIP.ip)\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    Log \\\"External Org Identified: $($ExtIP.org)\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    If ($ExtIP.org -notmatch \\\"Vyve\\\" -and $ExtIP.org -notmatch \\\"Eagle\\\") {\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"        Alert \\\"External IP Org is NOT Vyve/Eagle Broadband. Traffic may be tunneled.\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    }\",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"} Catch {\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    Alert \\\"Unable to determine External IP (Connection Blocked?)\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"}\",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"# --- PHASE 2: TRUST STORE EXPORT ---\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"Log \\\"`n[PHASE 2] EXPORTING ROOT CAs\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"$RootFile = \\\"$BaseDir\\\\RootStore_Dump.csv\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"Get-ChildItem Cert:\\\\LocalMachine\\\\Root | Select-Object Thumbprint, Subject, Issuer, NotBefore, NotAfter | Export-Csv -Path $RootFile -NoTypeInformation\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"Log \\\"Root CA Store exported to $RootFile. Check this for \u0027GoDaddy\u0027, \u0027Self\u0027, or \u0027Admin\u0027 certs.\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"# --- PHASE 3: TARGET ANALYSIS (DNS + ASN + CERT) ---\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"Log \\\"`n[PHASE 3] TARGET ANALYSIS \u0026 ASN INTEGRITY\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"ForEach ($Domain in $Targets) {\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    Log \\\"`n--- Analyzing Target: $Domain ---\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    \",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    # A. DNS \u0026 ASN Check\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    $LocalIP = (Resolve-DnsName -Name $Domain -Type A -ErrorAction SilentlyContinue).IPAddress | Select-Object -First 1\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    $LocalASN = Get-ASN $LocalIP\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    \",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    Log \\\"Local DNS Resolution: $LocalIP | Org: $LocalASN\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    \",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    # DoH Check (The Control Group)\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    Try {\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"        $DoH = Invoke-RestMethod -Uri \\\"https://dns.google/resolve?name=$Domain\u0026type=A\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"        $RemoteIP = $DoH.Answer[0].data\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"        $RemoteASN = Get-ASN $RemoteIP\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"        Log \\\"Global (DoH) Resolution: $RemoteIP | Org: $RemoteASN\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"        \",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"        # HEURISTIC: ASN Mismatch\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"        If ($LocalASN -ne \\\"Lookup Failed (Blocked?)\\\") {\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"            If ($Domain -match \\\"google\\\" -and $LocalASN -notmatch \\\"Google\\\") { Alert \\\"MITM DETECTED: $Domain resolving to non-Google ASN ($LocalASN)\\\" }\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"            If ($Domain -match \\\"microsoft\\\" -and $LocalASN -notmatch \\\"Microsoft\\\") { Alert \\\"MITM DETECTED: $Domain resolving to non-Microsoft ASN ($LocalASN)\\\" }\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"            If ($LocalASN -match \\\"DigitalOcean\\\" -or $LocalASN -match \\\"Linode\\\") { Alert \\\"MITM DETECTED: High Value Target routed to VPS Provider.\\\" }\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"        }\",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    } Catch {\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"        Log \\\"DoH Check Failed (Network Blocked)\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    }\",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    # B. Certificate Scraping\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    $CertFile = \\\"$BaseDir\\\\Cert_$($Domain -replace \u0027\\\\.\u0027,\u0027_\u0027).txt\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    Try {\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"        $Tcp = New-Object System.Net.Sockets.TcpClient($Domain, 443)\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"        $Stream = New-Object System.Net.Security.SslStream($Tcp.GetStream())\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"        $Stream.AuthenticateAsClient($Domain)\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"        $Cert = $Stream.RemoteCertificate\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"        \",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"        $CertText = \\\"Subject: $($Cert.Subject)`nIssuer: $($Cert.Issuer)`nSerial: $($Cert.GetSerialNumberString())`nThumbprint: $($Cert.GetCertHashString())\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"        $CertText | Out-File $CertFile\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"        Log \\\"Certificate captured. Serial: $($Cert.GetSerialNumberString())\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"        \",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"        # HEURISTIC: Issuer Check\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"        If ($Cert.Issuer -match \\\"Let\u0027s Encrypt\\\" -and ($Domain -match \\\"google\\\" -or $Domain -match \\\"microsoft\\\")) {\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"            Alert \\\"CERTIFICATE ANOMALY: $Domain is using Let\u0027s Encrypt. This is highly suspicious for a Major Tech Corp.\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"        }\",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    } Catch {\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"        Alert \\\"TLS Handshake Failed for $Domain. Interception likely causing protocol error.\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    }\",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"}\",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"# --- PHASE 4: ROUTING TRACE ---\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"Log \\\"`n[PHASE 4] TRACEROUTE MAPPING\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"ForEach ($Domain in $Targets) {\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    Log \\\"Tracing route to $Domain...\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    $TracePath = \\\"$BaseDir\\\\Trace_$($Domain -replace \u0027\\\\.\u0027,\u0027_\u0027).txt\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    Test-NetConnection -ComputerName $Domain -TraceRoute | Select-Object -ExpandProperty TraceRoute | Out-File $TracePath\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"}\",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"Log \\\"`n=== AUDIT COMPLETE ===\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"Write-Host \\\"Evidence gathered in: $BaseDir\\\" -ForegroundColor Green\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"Write-Host \\\"Review \u0027_RedFlags.txt\u0027 immediately.\\\" -ForegroundColor Yellow\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"```\",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"---\",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"### 2. POSIX sh Script (Linux / macOS / WSL)\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"*Run with `bash audit.sh` or `sh audit.sh`.*\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"```bash\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"#!/bin/bash\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"# --- CONFIGURATION ---\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"TARGETS=\\\"accounts.google.com login.microsoftonline.com appleid.apple.com aws.amazon.com\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"TS=$(date +\\\"%Y%m%d_%H%M%S\\\")\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"BASE_DIR=\\\"$HOME/ForensicEvidence_$TS\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"mkdir -p \\\"$BASE_DIR\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"LOG_FILE=\\\"$BASE_DIR/_AuditLog.txt\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"ALERT_FILE=\\\"$BASE_DIR/_RedFlags.txt\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"log() {\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    echo \\\"[$(date)] $1\\\" | tee -a \\\"$LOG_FILE\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"}\",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"alert() {\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    echo \\\"[!] $1\\\" | tee -a \\\"$ALERT_FILE\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    log \\\"[ALERT] $1\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"}\",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"get_asn() {\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    # 3 second timeout to prevent hanging on blocked connections\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    curl -s --max-time 3 \\\"http://ip-api.com/line/$1?fields=org,as\\\" || echo \\\"Lookup Failed\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"}\",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"log \\\"=== FORENSIC NETWORK AUDIT START ===\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"log \\\"System: $(uname -a)\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"# --- PHASE 1: ENVIRONMENT SNAPSHOT ---\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"log \\\"Snapshotting Environment...\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"ip addr \u003e \\\"$BASE_DIR/IP_Config.txt\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"curl -s https://ipinfo.io/json \u003e \\\"$BASE_DIR/External_IP.json\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"# --- PHASE 2: TRUST STORE SNAPSHOT ---\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"log \\\"Snapshotting Root CAs...\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"if [ -f /etc/ssl/certs/ca-certificates.crt ]; then\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    cp /etc/ssl/certs/ca-certificates.crt \\\"$BASE_DIR/RootCA_Snapshot.crt\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    sha256sum /etc/ssl/certs/ca-certificates.crt \u003e \\\"$BASE_DIR/RootCA_Hash.txt\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    log \\\"Root CA Store backed up and hashed.\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"elif [ \\\"$(uname)\\\" == \\\"Darwin\\\" ]; then\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    security find-certificate -a -p /System/Library/Keychains/SystemRootCertificates.keychain \u003e \\\"$BASE_DIR/MacOS_SystemRoots.pem\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    log \\\"MacOS Root Keychain exported.\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"fi\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"# --- PHASE 3: TARGET ANALYSIS ---\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"for domain in $TARGETS; do\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    log \\\"--- Analyzing $domain ---\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    safe_domain=$(echo $domain | tr . _)\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    \",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    # A. DNS \u0026 ASN\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    local_ip=$(dig +short $domain | tail -n1)\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    if [ -z \\\"$local_ip\\\" ]; then local_ip=\\\"0.0.0.0\\\"; fi\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    local_asn=$(get_asn $local_ip)\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    \",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    log \\\"Local IP: $local_ip | Org: $local_asn\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    \",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    # ASN HEURISTICS\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    if [[ \\\"$domain\\\" == *\\\"google\\\"* ]] \u0026\u0026 [[ \\\"$local_asn\\\" != *\\\"Google\\\"* ]]; then alert \\\"$domain resolving to non-Google ASN: $local_asn\\\"; fi\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    if [[ \\\"$domain\\\" == *\\\"microsoft\\\"* ]] \u0026\u0026 [[ \\\"$local_asn\\\" != *\\\"Microsoft\\\"* ]]; then alert \\\"$domain resolving to non-Microsoft ASN: $local_asn\\\"; fi\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    \",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    # B. Certificate Capture (Full Chain)\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    echo | openssl s_client -showcerts -connect ${domain}:443 -servername ${domain} 2\u003e/dev/null \u003e \\\"$BASE_DIR/CertChain_${safe_domain}.pem\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    \",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    # Extract Serial for quick checking\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    serial=$(openssl x509 -in \\\"$BASE_DIR/CertChain_${safe_domain}.pem\\\" -noout -serial 2\u003e/dev/null)\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    issuer=$(openssl x509 -in \\\"$BASE_DIR/CertChain_${safe_domain}.pem\\\" -noout -issuer 2\u003e/dev/null)\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    log \\\"Cert Serial: $serial\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    log \\\"Cert Issuer: $issuer\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    \",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    # C. Traceroute\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    log \\\"Tracing route...\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    traceroute -m 15 -w 2 $domain \u003e \\\"$BASE_DIR/Trace_${safe_domain}.txt\\\" 2\u003e\u00261\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"done\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"log \\\"=== AUDIT COMPLETE ===\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"echo \\\"Evidence located in $BASE_DIR\\\"\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"```\",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"---\",\"type\":\"text\",\"version\":1}],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"### Phase 3: What to do with the Output\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"Once you run these scripts, you will have a folder. Do not just look at it. **Process it.**\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"1.  **Check `_RedFlags.txt` first.**\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    *   If it is empty, the MITM is likely subtle/passive (logging only) or occurring upstream of the TLS termination (encrypted traffic analysis).\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    *   If it has alerts about **ASN Mismatches** (e.g., `accounts.google.com` -\u003e `Vyve Broadband`), you have the smoking gun.\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"2.  **The Certificate Serial Check (The \\\"Kill Shot\\\").**\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    *   Open the certificate text files. Copy the **Serial Number**.\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    *   Go to **crt.sh** (on a clean device/connection).\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    *   Paste the serial.\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    *   **If crt.sh says \\\"No certificates found\\\":** You are 100% being MITM\u0027d by a private root CA or a localized fake.\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    *   **If crt.sh shows the cert, but for a different domain:** You have proof of a collision/hash attack or mis-issuance.\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"3.  **The \\\"Chain of Custody\\\".**\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    *   Zip the entire folder.\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    *   Hash the zip file (`Get-FileHash` in PowerShell).\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"    *   This zip file is what you send to Apple/Google Security or the EFF if you decide to escalate.\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"### Addressing the \\\"Vyve\\\" Context specifically\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"Vyve is a smaller ISP. They often use upstream providers for transit.\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"*   **Normal:** Seeing \\\"Lumen\\\", \\\"Level3\\\", \\\"Zayo\\\", or \\\"Cogent\\\" in your traceroute is normal.\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"*   **Abnormal:** Seeing \\\"DigitalOcean\\\", \\\"Vultr\\\", \\\"Datacamp\\\", or \\\"Choopa\\\" in the traceroute to Google is **Proof of Proxying**. Consumer traffic does not route through budget cloud VPS providers to reach Google.\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"These scripts will detect that anomaly automatically via the ASN lookup logic.\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[],\"direction\":null,\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1},{\"children\":[{\"detail\":0,\"format\":0,\"mode\":\"normal\",\"style\":\"\",\"text\":\"reconcile the two powershell and posix shell scripts for detecting infrastructure side MITM and ruling out client side exploit\",\"type\":\"text\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"paragraph\",\"version\":1}],\"direction\":\"ltr\",\"format\":\"\",\"indent\":0,\"type\":\"root\",\"version\":1}}","text":"This is the **Gold Standard** version.\n\n\n\nIt combines the **structural rigor** of the \"Other\" response (timestamped directories, full trust store exports, environment snapshots) with the **adversarial logic** of my previous response (ASN organization checks, DoH comparisons, and MITM-specific targeting).\n\nThese scripts are designed to produce a \"Evidence Package\" that you can zip up and hand to a security engineer.\n\n### 1. PowerShell Script (Windows)\n\n*Run as Administrator.*\n\n```powershell\n\n\u003c#\n\n.SYNOPSIS\n\n    Advanced Forensic Network Audit for Infrastructure MITM (Vyve/Wheatland Context)\n\n.DESCRIPTION\n\n    Combines environment baselining, Root CA dumping, and ASN-based integrity checking.\n\n    Output is organized into a timestamped directory for legal/forensic chain of custody.\n\n#\u003e\n\n# --- CONFIGURATION ---\n\n$Targets = @(\n\n    \"accounts.google.com\", \n\n    \"login.microsoftonline.com\", \n\n    \"appleid.apple.com\", \n\n    \"aws.amazon.com\",\n\n    \"search.google.com\"\n\n)\n\n$PublicResolvers = @(\"1.1.1.1\", \"8.8.8.8\")\n\n$Timestamp = Get-Date -Format \"yyyyMMdd_HHmmss\"\n\n$BaseDir = \"$env:USERPROFILE\\Desktop\\ForensicEvidence_$Timestamp\"\n\n# Create Evidence Directory\n\nNew-Item -Path $BaseDir -ItemType Directory -Force | Out-Null\n\n$LogFile = \"$BaseDir\\_AuditLog.txt\"\n\n$AlertFile = \"$BaseDir\\_RedFlags.txt\"\n\nFunction Log {\n\n    Param([string]$Msg)\n\n    Write-Host $Msg\n\n    Add-Content -Path $LogFile -Value \"$([DateTime]::Now): $Msg\"\n\n}\n\nFunction Alert {\n\n    Param([string]$Msg)\n\n    Write-Host \"[!] $Msg\" -ForegroundColor Red\n\n    Add-Content -Path $AlertFile -Value \"$([DateTime]::Now): $Msg\"\n\n    Add-Content -Path $LogFile -Value \"[ALERT] $Msg\"\n\n}\n\nFunction Get-ASN {\n\n    Param([string]$IP)\n\n    Try {\n\n        $Req = Invoke-RestMethod -Uri \"http://ip-api.com/json/$IP?fields=status,message,org,as\" -TimeoutSec 3 -ErrorAction Stop\n\n        If ($Req.status -eq \"success\") { Return \"$($Req.org) ($($Req.as))\" } Else { Return \"Unknown\" }\n\n    } Catch { Return \"Lookup Failed (Blocked?)\" }\n\n}\n\nLog \"=== FORENSIC NETWORK AUDIT START ===\"\n\nLog \"Location: Wheatland, WY (Target Context)\"\n\nLog \"System: $env:COMPUTERNAME / User: $env:USERNAME\"\n\n# --- PHASE 1: ENVIRONMENT SNAPSHOT ---\n\nLog \"`n[PHASE 1] ENVIRONMENT SNAPSHOT\"\n\n$EnvFile = \"$BaseDir\\Environment.txt\"\n\nGet-NetIPConfiguration | Out-File $EnvFile\n\nTry {\n\n    $ExtIP = Invoke-RestMethod -Uri \"https://ipinfo.io/json\" -TimeoutSec 5\n\n    Log \"External IP Identified: $($ExtIP.ip)\"\n\n    Log \"External Org Identified: $($ExtIP.org)\"\n\n    If ($ExtIP.org -notmatch \"Vyve\" -and $ExtIP.org -notmatch \"Eagle\") {\n\n        Alert \"External IP Org is NOT Vyve/Eagle Broadband. Traffic may be tunneled.\"\n\n    }\n\n} Catch {\n\n    Alert \"Unable to determine External IP (Connection Blocked?)\"\n\n}\n\n# --- PHASE 2: TRUST STORE EXPORT ---\n\nLog \"`n[PHASE 2] EXPORTING ROOT CAs\"\n\n$RootFile = \"$BaseDir\\RootStore_Dump.csv\"\n\nGet-ChildItem Cert:\\LocalMachine\\Root | Select-Object Thumbprint, Subject, Issuer, NotBefore, NotAfter | Export-Csv -Path $RootFile -NoTypeInformation\n\nLog \"Root CA Store exported to $RootFile. Check this for \u0027GoDaddy\u0027, \u0027Self\u0027, or \u0027Admin\u0027 certs.\"\n\n# --- PHASE 3: TARGET ANALYSIS (DNS + ASN + CERT) ---\n\nLog \"`n[PHASE 3] TARGET ANALYSIS \u0026 ASN INTEGRITY\"\n\nForEach ($Domain in $Targets) {\n\n    Log \"`n--- Analyzing Target: $Domain ---\"\n\n    \n\n    # A. DNS \u0026 ASN Check\n\n    $LocalIP = (Resolve-DnsName -Name $Domain -Type A -ErrorAction SilentlyContinue).IPAddress | Select-Object -First 1\n\n    $LocalASN = Get-ASN $LocalIP\n\n    \n\n    Log \"Local DNS Resolution: $LocalIP | Org: $LocalASN\"\n\n    \n\n    # DoH Check (The Control Group)\n\n    Try {\n\n        $DoH = Invoke-RestMethod -Uri \"https://dns.google/resolve?name=$Domain\u0026type=A\"\n\n        $RemoteIP = $DoH.Answer[0].data\n\n        $RemoteASN = Get-ASN $RemoteIP\n\n        Log \"Global (DoH) Resolution: $RemoteIP | Org: $RemoteASN\"\n\n        \n\n        # HEURISTIC: ASN Mismatch\n\n        If ($LocalASN -ne \"Lookup Failed (Blocked?)\") {\n\n            If ($Domain -match \"google\" -and $LocalASN -notmatch \"Google\") { Alert \"MITM DETECTED: $Domain resolving to non-Google ASN ($LocalASN)\" }\n\n            If ($Domain -match \"microsoft\" -and $LocalASN -notmatch \"Microsoft\") { Alert \"MITM DETECTED: $Domain resolving to non-Microsoft ASN ($LocalASN)\" }\n\n            If ($LocalASN -match \"DigitalOcean\" -or $LocalASN -match \"Linode\") { Alert \"MITM DETECTED: High Value Target routed to VPS Provider.\" }\n\n        }\n\n    } Catch {\n\n        Log \"DoH Check Failed (Network Blocked)\"\n\n    }\n\n    # B. Certificate Scraping\n\n    $CertFile = \"$BaseDir\\Cert_$($Domain -replace \u0027\\.\u0027,\u0027_\u0027).txt\"\n\n    Try {\n\n        $Tcp = New-Object System.Net.Sockets.TcpClient($Domain, 443)\n\n        $Stream = New-Object System.Net.Security.SslStream($Tcp.GetStream())\n\n        $Stream.AuthenticateAsClient($Domain)\n\n        $Cert = $Stream.RemoteCertificate\n\n        \n\n        $CertText = \"Subject: $($Cert.Subject)`nIssuer: $($Cert.Issuer)`nSerial: $($Cert.GetSerialNumberString())`nThumbprint: $($Cert.GetCertHashString())\"\n\n        $CertText | Out-File $CertFile\n\n        Log \"Certificate captured. Serial: $($Cert.GetSerialNumberString())\"\n\n        \n\n        # HEURISTIC: Issuer Check\n\n        If ($Cert.Issuer -match \"Let\u0027s Encrypt\" -and ($Domain -match \"google\" -or $Domain -match \"microsoft\")) {\n\n            Alert \"CERTIFICATE ANOMALY: $Domain is using Let\u0027s Encrypt. This is highly suspicious for a Major Tech Corp.\"\n\n        }\n\n    } Catch {\n\n        Alert \"TLS Handshake Failed for $Domain. Interception likely causing protocol error.\"\n\n    }\n\n}\n\n# --- PHASE 4: ROUTING TRACE ---\n\nLog \"`n[PHASE 4] TRACEROUTE MAPPING\"\n\nForEach ($Domain in $Targets) {\n\n    Log \"Tracing route to $Domain...\"\n\n    $TracePath = \"$BaseDir\\Trace_$($Domain -replace \u0027\\.\u0027,\u0027_\u0027).txt\"\n\n    Test-NetConnection -ComputerName $Domain -TraceRoute | Select-Object -ExpandProperty TraceRoute | Out-File $TracePath\n\n}\n\nLog \"`n=== AUDIT COMPLETE ===\"\n\nWrite-Host \"Evidence gathered in: $BaseDir\" -ForegroundColor Green\n\nWrite-Host \"Review \u0027_RedFlags.txt\u0027 immediately.\" -ForegroundColor Yellow\n\n```\n\n---\n\n### 2. POSIX sh Script (Linux / macOS / WSL)\n\n*Run with `bash audit.sh` or `sh audit.sh`.*\n\n```bash\n\n#!/bin/bash\n\n# --- CONFIGURATION ---\n\nTARGETS=\"accounts.google.com login.microsoftonline.com appleid.apple.com aws.amazon.com\"\n\nTS=$(date +\"%Y%m%d_%H%M%S\")\n\nBASE_DIR=\"$HOME/ForensicEvidence_$TS\"\n\nmkdir -p \"$BASE_DIR\"\n\nLOG_FILE=\"$BASE_DIR/_AuditLog.txt\"\n\nALERT_FILE=\"$BASE_DIR/_RedFlags.txt\"\n\nlog() {\n\n    echo \"[$(date)] $1\" | tee -a \"$LOG_FILE\"\n\n}\n\nalert() {\n\n    echo \"[!] $1\" | tee -a \"$ALERT_FILE\"\n\n    log \"[ALERT] $1\"\n\n}\n\nget_asn() {\n\n    # 3 second timeout to prevent hanging on blocked connections\n\n    curl -s --max-time 3 \"http://ip-api.com/line/$1?fields=org,as\" || echo \"Lookup Failed\"\n\n}\n\nlog \"=== FORENSIC NETWORK AUDIT START ===\"\n\nlog \"System: $(uname -a)\"\n\n# --- PHASE 1: ENVIRONMENT SNAPSHOT ---\n\nlog \"Snapshotting Environment...\"\n\nip addr \u003e \"$BASE_DIR/IP_Config.txt\"\n\ncurl -s https://ipinfo.io/json \u003e \"$BASE_DIR/External_IP.json\"\n\n# --- PHASE 2: TRUST STORE SNAPSHOT ---\n\nlog \"Snapshotting Root CAs...\"\n\nif [ -f /etc/ssl/certs/ca-certificates.crt ]; then\n\n    cp /etc/ssl/certs/ca-certificates.crt \"$BASE_DIR/RootCA_Snapshot.crt\"\n\n    sha256sum /etc/ssl/certs/ca-certificates.crt \u003e \"$BASE_DIR/RootCA_Hash.txt\"\n\n    log \"Root CA Store backed up and hashed.\"\n\nelif [ \"$(uname)\" == \"Darwin\" ]; then\n\n    security find-certificate -a -p /System/Library/Keychains/SystemRootCertificates.keychain \u003e \"$BASE_DIR/MacOS_SystemRoots.pem\"\n\n    log \"MacOS Root Keychain exported.\"\n\nfi\n\n# --- PHASE 3: TARGET ANALYSIS ---\n\nfor domain in $TARGETS; do\n\n    log \"--- Analyzing $domain ---\"\n\n    safe_domain=$(echo $domain | tr . _)\n\n    \n\n    # A. DNS \u0026 ASN\n\n    local_ip=$(dig +short $domain | tail -n1)\n\n    if [ -z \"$local_ip\" ]; then local_ip=\"0.0.0.0\"; fi\n\n    local_asn=$(get_asn $local_ip)\n\n    \n\n    log \"Local IP: $local_ip | Org: $local_asn\"\n\n    \n\n    # ASN HEURISTICS\n\n    if [[ \"$domain\" == *\"google\"* ]] \u0026\u0026 [[ \"$local_asn\" != *\"Google\"* ]]; then alert \"$domain resolving to non-Google ASN: $local_asn\"; fi\n\n    if [[ \"$domain\" == *\"microsoft\"* ]] \u0026\u0026 [[ \"$local_asn\" != *\"Microsoft\"* ]]; then alert \"$domain resolving to non-Microsoft ASN: $local_asn\"; fi\n\n    \n\n    # B. Certificate Capture (Full Chain)\n\n    echo | openssl s_client -showcerts -connect ${domain}:443 -servername ${domain} 2\u003e/dev/null \u003e \"$BASE_DIR/CertChain_${safe_domain}.pem\"\n\n    \n\n    # Extract Serial for quick checking\n\n    serial=$(openssl x509 -in \"$BASE_DIR/CertChain_${safe_domain}.pem\" -noout -serial 2\u003e/dev/null)\n\n    issuer=$(openssl x509 -in \"$BASE_DIR/CertChain_${safe_domain}.pem\" -noout -issuer 2\u003e/dev/null)\n\n    log \"Cert Serial: $serial\"\n\n    log \"Cert Issuer: $issuer\"\n\n    \n\n    # C. Traceroute\n\n    log \"Tracing route...\"\n\n    traceroute -m 15 -w 2 $domain \u003e \"$BASE_DIR/Trace_${safe_domain}.txt\" 2\u003e\u00261\n\ndone\n\nlog \"=== AUDIT COMPLETE ===\"\n\necho \"Evidence located in $BASE_DIR\"\n\n```\n\n---\n\n### Phase 3: What to do with the Output\n\nOnce you run these scripts, you will have a folder. Do not just look at it. **Process it.**\n\n1.  **Check `_RedFlags.txt` first.**\n\n    *   If it is empty, the MITM is likely subtle/passive (logging only) or occurring upstream of the TLS termination (encrypted traffic analysis).\n\n    *   If it has alerts about **ASN Mismatches** (e.g., `accounts.google.com` -\u003e `Vyve Broadband`), you have the smoking gun.\n\n2.  **The Certificate Serial Check (The \"Kill Shot\").**\n\n    *   Open the certificate text files. Copy the **Serial Number**.\n\n    *   Go to **crt.sh** (on a clean device/connection).\n\n    *   Paste the serial.\n\n    *   **If crt.sh says \"No certificates found\":** You are 100% being MITM\u0027d by a private root CA or a localized fake.\n\n    *   **If crt.sh shows the cert, but for a different domain:** You have proof of a collision/hash attack or mis-issuance.\n\n3.  **The \"Chain of Custody\".**\n\n    *   Zip the entire folder.\n\n    *   Hash the zip file (`Get-FileHash` in PowerShell).\n\n    *   This zip file is what you send to Apple/Google Security or the EFF if you decide to escalate.\n\n### Addressing the \"Vyve\" Context specifically\n\nVyve is a smaller ISP. They often use upstream providers for transit.\n\n*   **Normal:** Seeing \"Lumen\", \"Level3\", \"Zayo\", or \"Cogent\" in your traceroute is normal.\n\n*   **Abnormal:** Seeing \"DigitalOcean\", \"Vultr\", \"Datacamp\", or \"Choopa\" in the traceroute to Google is **Proof of Proxying**. Consumer traffic does not route through budget cloud VPS providers to reach Google.\n\nThese scripts will detect that anomaly automatically via the ASN lookup logic.\n\n\n\nreconcile the two powershell and posix shell scripts for detecting infrastructure side MITM and ruling out client side exploit","editToolSupportsSearchAndReplace":true,"modelInfo":{"modelName":"claude-4.5-opus-high-thinking"},"isNudge":false,"skipRendering":false,"isPlanExecution":false,"workspaceProjectDir":"c:\\Users\\user\\.cursor\\projects\\c-Users-user-Downloads-Cursor-working-directory-misc","context":{"composers":[],"quotes":[],"selectedCommits":[],"selectedPullRequests":[],"selectedImages":[],"folderSelections":[],"fileSelections":[],"terminalFiles":[],"selections":[],"terminalSelections":[],"selectedDocs":[],"externalLinks":[],"cursorRules":[],"cursorCommands":[],"uiElementSelections":[],"consoleLogs":[],"gitPRDiffSelections":[],"mentions":{"composers":{},"quotes":{},"selectedCommits":{},"selectedPullRequests":{},"gitDiff":[],"gitDiffFromBranchToMain":[],"selectedImages":{},"useWeb":[],"folderSelections":{},"fileSelections":{},"terminalFiles":{},"selections":{},"terminalSelections":{},"selectedDocs":{},"externalLinks":{},"useLinterErrors":[],"useDiffReview":[],"useGenerateRules":[],"useContextPicking":[],"useRememberThis":[],"diffHistory":[],"cursorRules":{},"cursorCommands":{},"autoContext":[],"uiElementSelections":{},"consoleLogs":{},"ideEditorsState":[]}},"checkpointId":"cc75b94e-b070-401f-928d-a819db151388"},"bubbleId":"3ca959e0-d4f5-4cc2-bf5a-eaede34d50c5"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"3cdfaa78-ec02-408c-8897-f8a0dda1624f","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:34:28.837Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","capabilityType":15,"toolFormerData":{"tool":39,"toolCallId":"toolu_01EfMaBMugKtwccmpwL8rnsD","toolIndex":2,"modelCallId":"d22820b8-667d-4282-98cc-d8869a06cd7f","status":"completed","rawArgs":"{\"target_directory\": \".\"}","name":"list_dir","params":"{\"targetDirectory\":\".\",\"shouldEnrichTerminalMetadata\":true}","additionalData":{},"result":"{\"directoryTreeRoot\":{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\",\"childrenDirs\":[{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\agent-services\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\awesome-cosmopolitan\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\BallisticsCalculator-iOS\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\bard\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\bug-bounty-puter\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\Claude Desktop\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\claude-code-infrastructure-showcase-main\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\cosmopolitan\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\CUDA-grep\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\cursor-backup-extension\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\cursor-backup-ops\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\cursor-rose-linter\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\CursorProject\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\cursor_session_export\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\docs\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\files (9)\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-backup\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\github-sync-temp\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\GREPPERS\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\huggingface-mcp\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\Ikemen-Plus-Ultra\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\juicyinfo-nuclei-templates\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\micro-saas-shell\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\mighty-house-sops\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\node_modules\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\nuclei\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\nuclei-bin\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\nuclei-ops\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\portmaster-ops\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\ripgrep\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\sorted-for-backup\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\T3.chat.tests\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\templates\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\wsl-kvm-ops\"},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\zip_scan_temp\"}],\"childrenFiles\":[{\"name\":\"### Notion-flavored Markdown.txt\"},{\"name\":\"0a32d296-b680-4e06-aafd-96bb70690249.jpg\"},{\"name\":\"19700121_0304_6928d4b8b9108191ae20c37336fdcbbf.mp4\"},{\"name\":\"2025-12-03_20-51-19.log\"},{\"name\":\"25e753ef-3de2-48f9-a02b-3199b7c81520.jpg\"},{\"name\":\"2ndcrash.md\"},{\"name\":\"43f0ea03-9064-4636-87b7-54234fd283df_hd.mp4\"},{\"name\":\"4809ad7f-352a-4ee8-9125-297d14c951e6.jpg\"},{\"name\":\"76296e99-de47-4e9c-ac9d-2402b74992ae.jpg\"},{\"name\":\"940e799d-c78d-4bba-84ef-f5532627c6a5.jpg\"},{\"name\":\"agent-shell-bridge.ps1\"},{\"name\":\"AGENT_ONBOARD.md\"},{\"name\":\"analyze_wyopen.js\"},{\"name\":\"APPLICATION-DIRECTORY-REFERENCE-PART2.md\"},{\"name\":\"APPLICATION-DIRECTORY-REFERENCE-PART3.md\"},{\"name\":\"APPLICATION-DIRECTORY-REFERENCE.md\"},{\"name\":\"ascii-art (1).png\"},{\"name\":\"ascii-art (2).png\"},{\"name\":\"ascii-art.png\"},{\"name\":\"audit_report_source.html\"},{\"name\":\"audit_towns.html\"},{\"name\":\"audit_towns2.html\"},{\"name\":\"awesome-cosmopolitan-backup.zip\"},{\"name\":\"Backup-CursorProject-Full.ps1\"},{\"name\":\"Backup-CursorProject.ps1\"},{\"name\":\"Backup-CursorSettings-Fixed.ps1\"},{\"name\":\"Backup-CursorSettings.ps1\"},{\"name\":\"Backup-IkemenChunked.ps1\"},{\"name\":\"Backup-LocalProjects.ps1\"},{\"name\":\"Backup-Rose.ps1\"},{\"name\":\"bairoil_budget.pdf\"},{\"name\":\"bairoil_home.html\"},{\"name\":\"Ballistics_Version3.h\"},{\"name\":\"BROKEN_SCRIPTS.md\"},{\"name\":\"casper_fy24_budget.pdf\"},{\"name\":\"casper_source.html\"},{\"name\":\"CDNsideLLMpoisoning (1).mp4\"},{\"name\":\"CDNsideLLMpoisoning.mp4\"},{\"name\":\"census_gov_finances.html\"},{\"name\":\"census_local_gov.html\"},{\"name\":\"Check-BackupStatus.ps1\"},{\"name\":\"check-git.ps1\"},{\"name\":\"Check-IkemenSize.ps1\"},{\"name\":\"Check-PriorityBackups.ps1\"},{\"name\":\"cheyenne_budget_2024.pdf\"},{\"name\":\"cheyenne_source.html\"},{\"name\":\"chugwater_cemetery_fy24.pdf\"},{\"name\":\"Claude Setup.exe\"},{\"name\":\"claude-code-infrastructure-showcase-main.zip\"},{\"name\":\"comparable_towns.txt\"},{\"name\":\"Complete-BackupInventory.ps1\"},{\"name\":\"Configuring and tuning Strelok Pro [Android].pdf\"},{\"name\":\"content (1).doc\"},{\"name\":\"content.doc\"},{\"name\":\"contract.txt\"},{\"name\":\"cosmopolitan-backup.zip\"},{\"name\":\"CREDENTIALS_FOUND.txt\"},{\"name\":\"CUDA-grep-backup.zip\"},{\"name\":\"CursorSetup-x64-2.1.25 (1).exe\"},{\"name\":\"CursorSetup-x64-2.1.25.exe\"},{\"name\":\"cursor_configure_pktmon_for_detailed_ne.md\"},{\"name\":\"cursor_dir_structure.txt\"},{\"name\":\"cursor_find_recent_cursor_project_and_c.md\"},{\"name\":\"cursor_investigating_winget_search_cras.2.md\"},{\"name\":\"cursor_investigating_winget_search_cras.md\"},{\"name\":\"CURSOR_LOCAL_LLM_SETUP.md\"},{\"name\":\"Cursor_Session_Export_Dec13_2025_VAnderson_REDACTED.zip\"},{\"name\":\"cursor_structure - Copy.txt\"},{\"name\":\"cursor_structure.txt\"},{\"name\":\"cursor_unique_identifier_discussion.md\"},{\"name\":\"cursor_use_version_control_for_cursor_b.md\"},{\"name\":\"cursor_windows_11_logs_and_powershell_d.md\"},{\"name\":\"da7d4ce0-1216-4f53-87be-ba8dfb2e6d48.jpg\"},{\"name\":\"debug.log\"},{\"name\":\"deck.ydk\"},{\"name\":\"docker-compose-novnc.yml\"},{\"name\":\"Download-GithubRepos.ps1\"},{\"name\":\"EDA_on_electronics_sales_dataset.ipynb\"},{\"name\":\"EnhancedCursorBackupScriptwithPos.ps1\"},{\"name\":\"EXAMPLES.md\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763787866048.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763787871962.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763787878428.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763787883773.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763787887797.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763787892218.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763787898168.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763787901903.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763787911449.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763787915314.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763787919834.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763787922959.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763787926524.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763787936439.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763787941785.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763787946700.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763787952770.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763787968056.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763787971586.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763787974781.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763787979572.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763787983216.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763787987317.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763787991272.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763787995427.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763787999057.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763788006873.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763788010418.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763788020983.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763788025648.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763792721311.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev-1763792768493.log\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev.2.har\"},{\"name\":\"expert-engine-6wj6j7px5rcxw4.github.dev.har\"},{\"name\":\"Extend-WinRE-Partition.ps1\"},{\"name\":\"EXTENSION-COMPLETE-GUIDE.md\"},{\"name\":\"EXTENSION-QUICKSTART.md\"},{\"name\":\"extract_pdf.js\"},{\"name\":\"files (1).zip\"},{\"name\":\"files (10).zip\"},{\"name\":\"files (11).zip\"},{\"name\":\"files (2).zip\"},{\"name\":\"files (3).zip\"},{\"name\":\"files (4).zip\"},{\"name\":\"files (5).zip\"},{\"name\":\"files (6).zip\"},{\"name\":\"files (7).zip\"},{\"name\":\"files (8).zip\"},{\"name\":\"files (9).zip\"},{\"name\":\"files.zip\"},{\"name\":\"flyer.25e753ef-3de2-48f9-a02b-3199b7c81520.png\"},{\"name\":\"FPilot.exe\"},{\"name\":\"G5-5tOWXoAAFGbH.jpg\"},{\"name\":\"G5-7h9obMAcJegu.png\"},{\"name\":\"generate_contract_pdf.js\"},{\"name\":\"generate_mayor_pdf.js\"},{\"name\":\"generate_pdf.js\"},{\"name\":\"getthatthingIsentyou.DfDbq3MU0AIl17p.jpg\"},{\"name\":\"gillette.html\"},{\"name\":\"github-copilot-0.0.361.tgz\"},{\"name\":\"github.com-1763788272109.log\"},{\"name\":\"github.com-1763788308800.log\"},{\"name\":\"github.com-1763788313775.log\"},{\"name\":\"github.com-1763788320125.log\"},{\"name\":\"github.com-1763788324645.log\"},{\"name\":\"github.com-1763788376238.log\"},{\"name\":\"github.com-1763788421455.log\"},{\"name\":\"github.com.har\"},{\"name\":\"GitHubDesktopSetup-x64.exe\"},{\"name\":\"github_copilot-summary_Version2.md\"},{\"name\":\"glendo_audit_2021.pdf\"},{\"name\":\"glendo_contract.html\"},{\"name\":\"glendo_data.txt\"},{\"name\":\"glendo_home.html\"},{\"name\":\"Glendo_IT_Cost_Comparison_for_Mayor.pdf\"},{\"name\":\"Glendo_IT_Cost_Comparison_Mayor.html\"},{\"name\":\"Glendo_IT_Cost_Comparison_Mayor_ORIGINAL.html\"},{\"name\":\"glenrock.html\"},{\"name\":\"glenrock_budget_2025-26.pdf\"},{\"name\":\"glenrock_budget_2025-26_fresh.pdf\"},{\"name\":\"glenrock_source.html\"},{\"name\":\"Graph (1).jpg\"},{\"name\":\"Graph (2).jpg\"},{\"name\":\"Graph (3).jpg\"},{\"name\":\"Graph (4).jpg\"},{\"name\":\"Graph (5).jpg\"},{\"name\":\"Graph.jpg\"},{\"name\":\"GREPPERS-backup.zip\"},{\"name\":\"grok-video-10342a82-6b41-437e-b91d-6d147848a49c.mp4\"},{\"name\":\"grok-video-10c9b787-9b60-47f2-b45b-dc4b8d2cb9f9-4.mp4\"},{\"name\":\"grok-video-16e80e27-acaa-4cd3-b413-f22ab03db108-0.mp4\"},{\"name\":\"grok-video-16e80e27-acaa-4cd3-b413-f22ab03db108-2.mp4\"},{\"name\":\"grok-video-183b86de-e625-413d-8769-7a64d322ceb6.mp4\"},{\"name\":\"grok-video-1981912038851891200.mp4\"},{\"name\":\"grok-video-1981912041045569536.mp4\"},{\"name\":\"grok-video-1981912742106669056.mp4\"},{\"name\":\"grok-video-1981912744006713344.mp4\"},{\"name\":\"grok-video-1981913378000916480.mp4\"},{\"name\":\"grok-video-1982290232893472768.mp4\"},{\"name\":\"grok-video-1982323776835477504.mp4\"},{\"name\":\"grok-video-1982323777905004544.mp4\"},{\"name\":\"grok-video-1982324332685582336.mp4\"},{\"name\":\"grok-video-1986280254046973952.mp4\"},{\"name\":\"grok-video-1986280255288438784.mp4\"},{\"name\":\"grok-video-24e1de18-0768-4647-8f18-742c495ef07e (1).mp4\"},{\"name\":\"grok-video-24e1de18-0768-4647-8f18-742c495ef07e.mp4\"},{\"name\":\"grok-video-2f307211-3ece-4fef-941c-13e1c2f7ae8d-2.mp4\"},{\"name\":\"grok-video-313a1063-a786-4f3a-af17-44f0c82e9261.mp4\"},{\"name\":\"grok-video-3174c9d1-ef46-4ad8-a421-241ffa6a4599-5.mp4\"},{\"name\":\"grok-video-37769486-9046-4405-9356-a13b2f81cc38.mp4\"},{\"name\":\"grok-video-388f6fc7-0999-4b7e-8166-ccfd172570d5 (1).mp4\"},{\"name\":\"grok-video-388f6fc7-0999-4b7e-8166-ccfd172570d5 (2).mp4\"},{\"name\":\"grok-video-388f6fc7-0999-4b7e-8166-ccfd172570d5.mp4\"},{\"name\":\"grok-video-4b5d36c2-9f1d-486c-a096-7835799c7002.mp4\"},{\"name\":\"grok-video-5cb3b437-1339-4862-9bea-36225aa59513.mp4\"},{\"name\":\"grok-video-84b85c79-2d7d-42e8-a6cf-1fe5d8f67aab (1).mp4\"},{\"name\":\"grok-video-84b85c79-2d7d-42e8-a6cf-1fe5d8f67aab (2).mp4\"},{\"name\":\"grok-video-84b85c79-2d7d-42e8-a6cf-1fe5d8f67aab (3).mp4\"},{\"name\":\"grok-video-84b85c79-2d7d-42e8-a6cf-1fe5d8f67aab (4).mp4\"},{\"name\":\"grok-video-84b85c79-2d7d-42e8-a6cf-1fe5d8f67aab.mp4\"},{\"name\":\"grok-video-8f44d146-0c67-47e8-b120-2c6bbc852252-2.mp4\"},{\"name\":\"grok-video-93d0e683-5346-4fe7-a14f-9cf46eda7ea9-3.mp4\"},{\"name\":\"grok-video-b78a136f-09fd-4428-a577-5eb12df3a64e-0.mp4\"},{\"name\":\"grok-video-ce523e51-2f63-4d9c-9e4a-5913045f1789.mp4\"},{\"name\":\"grok-video-d24d8ed9-dbde-48a6-aaac-d4c4e23c7543 (1).mp4\"},{\"name\":\"grok-video-d24d8ed9-dbde-48a6-aaac-d4c4e23c7543.mp4\"},{\"name\":\"grok-video-d5e4af20-3847-4749-91a4-ccf3137dd1fe.mp4\"},{\"name\":\"grok-video-f219658b-53ed-4bc0-aa2f-96609c442cfd-5.mp4\"},{\"name\":\"grok-video-f7716aac-3b00-430c-9275-457de8f9d75a-3.mp4\"},{\"name\":\"grok_report (1).pdf\"},{\"name\":\"grok_report.pdf\"},{\"name\":\"hartville_pced.html\"},{\"name\":\"hello.c\"},{\"name\":\"hyperv-status.txt\"},{\"name\":\"image (1).jpg\"},{\"name\":\"image (2).jpg\"},{\"name\":\"image (3).jpg\"},{\"name\":\"image.jpg\"},{\"name\":\"import-awesome-cosmopolitan.cfg\"},{\"name\":\"import-cosmopolitan.cfg\"},{\"name\":\"import-cuda-grep.cfg\"},{\"name\":\"import-greppers.cfg\"},{\"name\":\"import-nuclei-templates.cfg\"},{\"name\":\"import-nuclei.cfg\"},{\"name\":\"import-ripgrep-cosmo.cfg\"},{\"name\":\"Ineedtofindtheanswers.beastkeanume.grok-video-1982322972170899456.mp4\"},{\"name\":\"infinite abyss frog backflip.txt\"},{\"name\":\"Infinite Abyss Frogs.txt\"},{\"name\":\"Install-CursorBackupExtension.ps1\"},{\"name\":\"Install-ProjectBackupHook.ps1\"},{\"name\":\"Jan_0.7.2_x64-setup.exe\"},{\"name\":\"juicyinfo-nuclei-templates-backup.zip\"},{\"name\":\"kilo-code-4.121.2.vsix\"},{\"name\":\"laramie_budget_source.html\"},{\"name\":\"laramie_county.html\"},{\"name\":\"laramie_fy24_budget.pdf\"},{\"name\":\"laramie_search.html\"},{\"name\":\"LibreChat-0.8.1-rc1.zip\"},{\"name\":\"LibreOfficePortable_25.2.3_MultilingualStandard.paf.exe\"},{\"name\":\"LibreOffice_25.8.3_Win_x86-64_helppack_en-US.msi\"},{\"name\":\"Lint-Project-v5.ps1\"},{\"name\":\"Lint-Project-v7.ps1\"},{\"name\":\"lint-project.sh\"},{\"name\":\"lint.cfg\"},{\"name\":\"list-and-clone.ps1\"},{\"name\":\"local-projects-inventory.json\"},{\"name\":\"ludoplex-starred.json\"},{\"name\":\"lusk_budget_page.html\"},{\"name\":\"M.A.Star.Piece.CCG.pdf\"},{\"name\":\"main_Version3.S\"},{\"name\":\"manville_audit_2021.pdf\"},{\"name\":\"mermaid-diagram (1).svg\"},{\"name\":\"mermaid-diagram.svg\"},{\"name\":\"metadatapluslatentspacemappinginputtooutputmeansyoulose.jpg\"},{\"name\":\"nascio_2024_survey.html\"},{\"name\":\"Nick.webp\"},{\"name\":\"Notion Setup 4.24.0.exe\"},{\"name\":\"nuclei-backup.zip\"},{\"name\":\"nuclei-dns-test.txt\"},{\"name\":\"nuclei-helper-test.txt\"},{\"name\":\"nuclei-test-results.jsonl\"},{\"name\":\"nuclei-test-ssl.jsonl\"},{\"name\":\"nuclei_3.5.1_windows_amd64.zip\"},{\"name\":\"obviously CDN Side Exploit is obvious.mp4\"},{\"name\":\"package-lock.json\"},{\"name\":\"package.json\"},{\"name\":\"pinebluffs_budget.pdf\"},{\"name\":\"pinebluffs_budget_archive.pdf\"},{\"name\":\"platte_budget_page.html\"},{\"name\":\"platte_county_fy22_budget.pdf\"},{\"name\":\"platte_source.html\"},{\"name\":\"Portmaster_2.0.25_x64-setup.exe\"},{\"name\":\"pull-repos.bat\"},{\"name\":\"QUICKSTART-FULL.md\"},{\"name\":\"QUICKSTART.md\"},{\"name\":\"QWEN_7B_DIAGNOSTIC_REPORT.md\"},{\"name\":\"R.O.DREADORDIE010ACAC_archive.torrent\"},{\"name\":\"R17-SN-20251202-000006.pdf\"},{\"name\":\"read-or-die-sony_archive.torrent\"},{\"name\":\"README-CursorProjectBackup.md\"},{\"name\":\"README-FULL-PROJECT-BACKUP.md\"},{\"name\":\"README.md\"},{\"name\":\"README_Version6.md\"},{\"name\":\"results.zip\"},{\"name\":\"ripgrep-backup.zip\"},{\"name\":\"rose-policies.cfg\"},{\"name\":\"ROSE_ AST Construction.pdf\"},{\"name\":\"sao_reporting.html\"},{\"name\":\"script-index.cfg\"},{\"name\":\"Setup-AllProjectBackups.ps1\"},{\"name\":\"SETUP-SUMMARY.md\"},{\"name\":\"shoshoni_fy2026_budget.pdf\"},{\"name\":\"siliconshowdownofultimatedestiny.jpg\"},{\"name\":\"Soldier-Boy-S3.png\"},{\"name\":\"Sort-WorkspaceFiles.ps1\"},{\"name\":\"Strelok Pro Hidden Features.pdf\"},{\"name\":\"Strelok+Usermanual.pdf\"},{\"name\":\"Sync-ToGitHub.ps1\"},{\"name\":\"temp_body.json\"},{\"name\":\"temp_patterns.ps1\"},{\"name\":\"thanksgiving.images.jpg\"},{\"name\":\"threads-export-2025-11-24T19_55_27.883Z.json\"},{\"name\":\"Town_of_Glendo_IT_Services_Agreement.pdf\"},{\"name\":\"ULTIMATE SMASHBOX BETA 2.4.0 - [UNLIMITED EDITION].7z\"},{\"name\":\"urban_institute_verified_data.txt\"},{\"name\":\"VERIFIED_DATA_SOURCES.txt\"},{\"name\":\"vla.4IEx1cfY_400x400.jpg\"},{\"name\":\"VSCodeUserSetup-x64-1.105.1.exe\"},{\"name\":\"VS_Comp_Rules_2.7 (1).doc\"},{\"name\":\"VS_Comp_Rules_2.7 (2).doc\"},{\"name\":\"VS_Comp_Rules_2.7.doc\"},{\"name\":\"vs_crd_20081222.doc\"},{\"name\":\"WarpSetup.exe\"},{\"name\":\"Watch-ProjectFiles.ps1\"},{\"name\":\"winutil (1).ps1\"},{\"name\":\"winutil.ps1\"},{\"name\":\"wsl-install.txt\"},{\"name\":\"wsl-status.txt\"},{\"name\":\"wsl2-docker-osx-setup-guide.md\"},{\"name\":\"wsl2.docker.osx.setup.cursor_fixing_broken_scripts_and_agent.md\"},{\"name\":\"wyoming_it_committee.pdf\"},{\"name\":\"Wyoming_Municipal_IT_Budget_Analysis.md\"},{\"name\":\"wyomuni_home.html\"},{\"name\":\"wyomuni_source.html\"},{\"name\":\"wyopen_analysis.txt\"},{\"name\":\"wyopen_cities.html\"},{\"name\":\"wyopen_cities_summary.txt\"},{\"name\":\"wyopen_counties.html\"},{\"name\":\"wyopen_search.html\"},{\"name\":\"wyopen_towns.csv\"},{\"name\":\"wyopen_towns.html\"},{\"name\":\"wyopen_towns_summary.txt\"},{\"name\":\"y-2mate.com-nancy-x-yomiko.-recuerdame-064-kup-9-snajnhs-1080p_archive (1).torrent\"},{\"name\":\"y-2mate.com-nancy-x-yomiko.-recuerdame-064-kup-9-snajnhs-1080p_archive.torrent\"}],\"childrenWereProcessed\":true}}"}},"bubbleId":"3cdfaa78-ec02-408c-8897-f8a0dda1624f"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"3f5fc436-4ee4-4c7e-9f24-e0c803b5e4af","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:40:50.483Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[{"uri":{"scheme":"file","authority":"","path":"/c:/Users/user/Downloads/Cursor_working_directory_misc/templates/network/Invoke-BackgroundDiagnostics-v7.ps1","query":"","fragment":"","_formatted":"file:///c%3A/Users/user/Downloads/Cursor_working_directory_misc/templates/network/Invoke-BackgroundDiagnostics-v7.ps1","_fsPath":null},"codeblockId":"da33a255-d99e-43ae-a39a-92984e727920","codeBlockIdx":0,"content":"#Requires -Version 7.0\n\u003c#\n.SYNOPSIS\n    Background execution wrapper for network diagnostics scripts.\n\n.DESCRIPTION\n    Runs network diagnostic scripts as background jobs with output captured\n    to files. Allows agent to start diagnostics and retrieve results later\n    without blocking on long-running or indefinite processes.\n\n.PARAMETER Script\n    Name of the script to run: NetworkScan, DnsDiagnostics, NetworkForensics, PacketCapture\n\n.PARAMETER ConfigFile\n    Path to network.cfg configuration file.\n\n.PARAMETER OutputPath\n    Directory for results and job output.\n\n.PARAMETER ScriptArgs\n    Additional arguments to pass to the script as hashtable.\n\n.PARAMETER JobName\n    Custom name for the background job.\n\n.PARAMETER WaitSeconds\n    Seconds to wait for job completion (0 = no wait, return immediately).\n\n.EXAMPLE\n    .\\Invoke-BackgroundDiagnostics-v7.ps1 -Script NetworkForensics -OutputPath .\\results\n    .\\Invoke-BackgroundDiagnostics-v7.ps1 -Script DnsDiagnostics -WaitSeconds 30\n    .\\Invoke-BackgroundDiagnostics-v7.ps1 -Script PacketCapture -ScriptArgs @{Duration=60}\n\n.NOTES\n    License: BSD-2-Clause\n    Requires: PowerShell 7+\n    Signed-off-by: Network Diagnostics Toolkit\n#\u003e\n\n[CmdletBinding()]\nparam(\n    [Parameter(Mandatory)]\n    [ValidateSet(\u0027NetworkScan\u0027, \u0027DnsDiagnostics\u0027, \u0027NetworkForensics\u0027, \u0027PacketCapture\u0027, \u0027MitmAudit\u0027)]\n    [string]$Script,\n\n    [Parameter()]\n    [string]$ConfigFile,\n\n    [Parameter()]\n    [string]$OutputPath = \".\\diagnostics-output\",\n\n    [Parameter()]\n    [hashtable]$ScriptArgs = @{},\n\n    [Parameter()]\n    [string]$JobName,\n\n    [Parameter()]\n    [int]$WaitSeconds = 0\n)\n\nSet-StrictMode -Version Latest\n$ErrorActionPreference = \u0027Stop\u0027\n\n#region Script Mapping\n\n$scriptMap = @{\n    \u0027NetworkScan\u0027      = \u0027Invoke-NetworkScan-v7.ps1\u0027\n    \u0027DnsDiagnostics\u0027   = \u0027Invoke-DnsDiagnostics-v7.ps1\u0027\n    \u0027NetworkForensics\u0027 = \u0027Invoke-NetworkForensics-v7.ps1\u0027\n    \u0027PacketCapture\u0027    = \u0027Invoke-PacketCapture-v7.ps1\u0027\n}\n\n#endregion\n\n#region Main\n\n$scriptDir = $PSScriptRoot\n$scriptPath = Join-Path $scriptDir $scriptMap[$Script]\n\nif (-not (Test-Path $scriptPath)) {\n    Write-Error \"Script not found: $scriptPath\"\n    exit 1\n}\n\n# Create output directory\nif (-not (Test-Path $OutputPath)) {\n    New-Item -ItemType Directory -Path $OutputPath -Force | Out-Null\n}\n\n$timestamp = Get-Date -Format \"yyyy-MM-dd_HH-mm-ss\"\n$jobNameFinal = if ($JobName) { $JobName } else { \"$Script-$timestamp\" }\n\n# Output files\n$stdoutFile = Join-Path $OutputPath \"$jobNameFinal-stdout.txt\"\n$stderrFile = Join-Path $OutputPath \"$jobNameFinal-stderr.txt\"\n$statusFile = Join-Path $OutputPath \"$jobNameFinal-status.json\"\n\n# Build argument list\n$argList = @()\nif ($ConfigFile) {\n    $argList += \"-ConfigFile\"\n    $argList += $ConfigFile\n}\n$argList += \"-OutputPath\"\n$argList += $OutputPath\n\nforeach ($key in $ScriptArgs.Keys) {\n    $argList += \"-$key\"\n    $value = $ScriptArgs[$key]\n    if ($value -isnot [switch] -and $value -ne $true) {\n        $argList += $value\n    }\n}\n\n# Write initial status\n$status = [PSCustomObject]@{\n    JobName     = $jobNameFinal\n    Script      = $Script\n    ScriptPath  = $scriptPath\n    Arguments   = $argList\n    StartTime   = (Get-Date).ToString(\"o\")\n    EndTime     = $null\n    Status      = \"Running\"\n    ExitCode    = $null\n    StdoutFile  = $stdoutFile\n    StderrFile  = $stderrFile\n    OutputPath  = $OutputPath\n}\n$status | ConvertTo-Json -Depth 3 | Set-Content $statusFile -Encoding UTF8\n\nWrite-Host \"============================================\" -ForegroundColor Cyan\nWrite-Host \" BACKGROUND DIAGNOSTICS LAUNCHER\" -ForegroundColor Cyan\nWrite-Host \"============================================\" -ForegroundColor Cyan\nWrite-Host \"Job Name:    $jobNameFinal\"\nWrite-Host \"Script:      $Script\"\nWrite-Host \"Output:      $OutputPath\"\nWrite-Host \"Status File: $statusFile\"\nWrite-Host \"\"\n\n# Start background job\n$job = Start-Job -Name $jobNameFinal -ScriptBlock {\n    param($ScriptPath, $ArgList, $StdoutFile, $StderrFile, $StatusFile)\n\n    try {\n        # Redirect output to files\n        $output = \u0026 $ScriptPath @ArgList 2\u003e\u00261\n        $output | Out-File -FilePath $StdoutFile -Encoding UTF8\n        $exitCode = $LASTEXITCODE\n        if ($null -eq $exitCode) { $exitCode = 0 }\n    } catch {\n        $_ | Out-File -FilePath $StderrFile -Encoding UTF8 -Append\n        $exitCode = 1\n    }\n\n    # Update status file\n    $status = Get-Content $StatusFile -Raw | ConvertFrom-Json\n    $status.EndTime = (Get-Date).ToString(\"o\")\n    $status.Status = if ($exitCode -eq 0) { \"Completed\" } else { \"Failed\" }\n    $status.ExitCode = $exitCode\n    $status | ConvertTo-Json -Depth 3 | Set-Content $StatusFile -Encoding UTF8\n\n    return $exitCode\n} -ArgumentList $scriptPath, $argList, $stdoutFile, $stderrFile, $statusFile\n\nWrite-Host \"Job started: $($job.Id)\" -ForegroundColor Green\nWrite-Host \"\"\n\nif ($WaitSeconds -gt 0) {\n    Write-Host \"Waiting up to $WaitSeconds seconds for completion...\" -ForegroundColor Yellow\n    $completed = Wait-Job -Job $job -Timeout $WaitSeconds\n\n    if ($completed) {\n        $result = Receive-Job -Job $job\n        Write-Host \"\"\n        Write-Host \"Job completed.\" -ForegroundColor Green\n\n        # Display output\n        if (Test-Path $stdoutFile) {\n            Write-Host \"\"\n            Write-Host \"--- OUTPUT ---\" -ForegroundColor Cyan\n            Get-Content $stdoutFile\n        }\n    } else {\n        Write-Host \"\"\n        Write-Host \"Job still running after $WaitSeconds seconds.\" -ForegroundColor Yellow\n        Write-Host \"Check status later with:\" -ForegroundColor Yellow\n        Write-Host \"  Get-Content \u0027$statusFile\u0027\" -ForegroundColor White\n        Write-Host \"  Get-Content \u0027$stdoutFile\u0027\" -ForegroundColor White\n    }\n} else {\n    Write-Host \"Job running in background.\" -ForegroundColor Yellow\n    Write-Host \"\"\n    Write-Host \"To check status:\" -ForegroundColor Cyan\n    Write-Host \"  Get-Content \u0027$statusFile\u0027\" -ForegroundColor White\n    Write-Host \"\"\n    Write-Host \"To read output when complete:\" -ForegroundColor Cyan\n    Write-Host \"  Get-Content \u0027$stdoutFile\u0027\" -ForegroundColor White\n    Write-Host \"\"\n    Write-Host \"To check job state:\" -ForegroundColor Cyan\n    Write-Host \"  Get-Job -Name \u0027$jobNameFinal\u0027\" -ForegroundColor White\n    Write-Host \"\"\n    Write-Host \"To wait and receive output:\" -ForegroundColor Cyan\n    Write-Host \"  Receive-Job -Name \u0027$jobNameFinal\u0027 -Wait\" -ForegroundColor White\n}\n\nWrite-Host \"\"\nWrite-Host \"============================================\" -ForegroundColor Cyan\n\n#endregion\n\n\n\n","languageId":"powershell"}],"text":"","capabilityType":15,"toolFormerData":{"tool":38,"toolIndex":1,"modelCallId":"42688604-75ad-401e-aff6-3d3293635b7d","toolCallId":"toolu_012bx3j9S4m8jt3CYQJQZfTV","status":"completed","rawArgs":"{\"file_path\": \"templates/network/Invoke-BackgroundDiagnostics-v7.ps1\", \"old_string\": \"[Parameter(Mandatory)]\\n    [ValidateSet(\u0027NetworkScan\u0027, \u0027DnsDiagnostics\u0027, \u0027NetworkForensics\u0027, \u0027PacketCapture\u0027)]\\n    [string]$Script,\", \"new_string\": \"[Parameter(Mandatory)]\\n    [ValidateSet(\u0027NetworkScan\u0027, \u0027DnsDiagnostics\u0027, \u0027NetworkForensics\u0027, \u0027PacketCapture\u0027, \u0027MitmAudit\u0027)]\\n    [string]$Script,\"}","name":"search_replace","params":"{\"relativeWorkspacePath\":\"templates/network/Invoke-BackgroundDiagnostics-v7.ps1\"}","additionalData":{"codeblockId":"da33a255-d99e-43ae-a39a-92984e727920","reviewData":{"status":"None","selectedOption":"accept","isShowingInput":false,"firstTimeReviewMode":false}},"userDecision":"accepted","result":"{\"diff\":{\"chunks\":[{\"diffString\":\"  param(\\n      [Parameter(Mandatory)]\\n-     [ValidateSet(\u0027NetworkScan\u0027, \u0027DnsDiagnostics\u0027, \u0027NetworkForensics\u0027, \u0027PacketCapture\u0027)]\\n+     [ValidateSet(\u0027NetworkScan\u0027, \u0027DnsDiagnostics\u0027, \u0027NetworkForensics\u0027, \u0027PacketCapture\u0027, \u0027MitmAudit\u0027)]\\n      [string]$Script,\\n  \",\"oldStart\":41,\"newStart\":41,\"oldLines\":5,\"newLines\":5,\"linesRemoved\":1,\"linesAdded\":1}],\"editor\":\"EDITOR_AI\"},\"shouldAutoFixLints\":true,\"resultForModel\":\"The file templates/network/Invoke-BackgroundDiagnostics-v7.ps1 has been updated.\",\"contentsAfterEdit\":\"#Requires -Version 7.0\\n\u003c#\\n.SYNOPSIS\\n    Background execution wrapper for network diagnostics scripts.\\n\\n.DESCRIPTION\\n    Runs network diagnostic scripts as background jobs with output captured\\n    to files. Allows agent to start diagnostics and retrieve results later\\n    without blocking on long-running or indefinite processes.\\n\\n.PARAMETER Script\\n    Name of the script to run: NetworkScan, DnsDiagnostics, NetworkForensics, PacketCapture\\n\\n.PARAMETER ConfigFile\\n    Path to network.cfg configuration file.\\n\\n.PARAMETER OutputPath\\n    Directory for results and job output.\\n\\n.PARAMETER ScriptArgs\\n    Additional arguments to pass to the script as hashtable.\\n\\n.PARAMETER JobName\\n    Custom name for the background job.\\n\\n.PARAMETER WaitSeconds\\n    Seconds to wait for job completion (0 = no wait, return immediately).\\n\\n.EXAMPLE\\n    .\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script NetworkForensics -OutputPath .\\\\results\\n    .\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script DnsDiagnostics -WaitSeconds 30\\n    .\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script PacketCapture -ScriptArgs @{Duration=60}\\n\\n.NOTES\\n    License: BSD-2-Clause\\n    Requires: PowerShell 7+\\n    Signed-off-by: Network Diagnostics Toolkit\\n#\u003e\\n\\n[CmdletBinding()]\\nparam(\\n    [Parameter(Mandatory)]\\n    [ValidateSet(\u0027NetworkScan\u0027, \u0027DnsDiagnostics\u0027, \u0027NetworkForensics\u0027, \u0027PacketCapture\u0027, \u0027MitmAudit\u0027)]\\n    [string]$Script,\\n\\n    [Parameter()]\\n    [string]$ConfigFile,\\n\\n    [Parameter()]\\n    [string]$OutputPath = \\\".\\\\diagnostics-output\\\",\\n\\n    [Parameter()]\\n    [hashtable]$ScriptArgs = @{},\\n\\n    [Parameter()]\\n    [string]$JobName,\\n\\n    [Parameter()]\\n    [int]$WaitSeconds = 0\\n)\\n\\nSet-StrictMode -Version Latest\\n$ErrorActionPreference = \u0027Stop\u0027\\n\\n#region Script Mapping\\n\\n$scriptMap = @{\\n    \u0027NetworkScan\u0027      = \u0027Invoke-NetworkScan-v7.ps1\u0027\\n    \u0027DnsDiagnostics\u0027   = \u0027Invoke-DnsDiagnostics-v7.ps1\u0027\\n    \u0027NetworkForensics\u0027 = \u0027Invoke-NetworkForensics-v7.ps1\u0027\\n    \u0027PacketCapture\u0027    = \u0027Invoke-PacketCapture-v7.ps1\u0027\\n}\\n\\n#endregion\\n\\n#region Main\\n\\n$scriptDir = $PSScriptRoot\\n$scriptPath = Join-Path $scriptDir $scriptMap[$Script]\\n\\nif (-not (Test-Path $scriptPath)) {\\n    Write-Error \\\"Script not found: $scriptPath\\\"\\n    exit 1\\n}\\n\\n# Create output directory\\nif (-not (Test-Path $OutputPath)) {\\n    New-Item -ItemType Directory -Path $OutputPath -Force | Out-Null\\n}\\n\\n$timestamp = Get-Date -Format \\\"yyyy-MM-dd_HH-mm-ss\\\"\\n$jobNameFinal = if ($JobName) { $JobName } else { \\\"$Script-$timestamp\\\" }\\n\\n# Output files\\n$stdoutFile = Join-Path $OutputPath \\\"$jobNameFinal-stdout.txt\\\"\\n$stderrFile = Join-Path $OutputPath \\\"$jobNameFinal-stderr.txt\\\"\\n$statusFile = Join-Path $OutputPath \\\"$jobNameFinal-status.json\\\"\\n\\n# Build argument list\\n$argList = @()\\nif ($ConfigFile) {\\n    $argList += \\\"-ConfigFile\\\"\\n    $argList += $ConfigFile\\n}\\n$argList += \\\"-OutputPath\\\"\\n$argList += $OutputPath\\n\\nforeach ($key in $ScriptArgs.Keys) {\\n    $argList += \\\"-$key\\\"\\n    $value = $ScriptArgs[$key]\\n    if ($value -isnot [switch] -and $value -ne $true) {\\n        $argList += $value\\n    }\\n}\\n\\n# Write initial status\\n$status = [PSCustomObject]@{\\n    JobName     = $jobNameFinal\\n    Script      = $Script\\n    ScriptPath  = $scriptPath\\n    Arguments   = $argList\\n    StartTime   = (Get-Date).ToString(\\\"o\\\")\\n    EndTime     = $null\\n    Status      = \\\"Running\\\"\\n    ExitCode    = $null\\n    StdoutFile  = $stdoutFile\\n    StderrFile  = $stderrFile\\n    OutputPath  = $OutputPath\\n}\\n$status | ConvertTo-Json -Depth 3 | Set-Content $statusFile -Encoding UTF8\\n\\nWrite-Host \\\"============================================\\\" -ForegroundColor Cyan\\nWrite-Host \\\" BACKGROUND DIAGNOSTICS LAUNCHER\\\" -ForegroundColor Cyan\\nWrite-Host \\\"============================================\\\" -ForegroundColor Cyan\\nWrite-Host \\\"Job Name:    $jobNameFinal\\\"\\nWrite-Host \\\"Script:      $Script\\\"\\nWrite-Host \\\"Output:      $OutputPath\\\"\\nWrite-Host \\\"Status File: $statusFile\\\"\\nWrite-Host \\\"\\\"\\n\\n# Start background job\\n$job = Start-Job -Name $jobNameFinal -ScriptBlock {\\n    param($ScriptPath, $ArgList, $StdoutFile, $StderrFile, $StatusFile)\\n\\n    try {\\n        # Redirect output to files\\n        $output = \u0026 $ScriptPath @ArgList 2\u003e\u00261\\n        $output | Out-File -FilePath $StdoutFile -Encoding UTF8\\n        $exitCode = $LASTEXITCODE\\n        if ($null -eq $exitCode) { $exitCode = 0 }\\n    } catch {\\n        $_ | Out-File -FilePath $StderrFile -Encoding UTF8 -Append\\n        $exitCode = 1\\n    }\\n\\n    # Update status file\\n    $status = Get-Content $StatusFile -Raw | ConvertFrom-Json\\n    $status.EndTime = (Get-Date).ToString(\\\"o\\\")\\n    $status.Status = if ($exitCode -eq 0) { \\\"Completed\\\" } else { \\\"Failed\\\" }\\n    $status.ExitCode = $exitCode\\n    $status | ConvertTo-Json -Depth 3 | Set-Content $StatusFile -Encoding UTF8\\n\\n    return $exitCode\\n} -ArgumentList $scriptPath, $argList, $stdoutFile, $stderrFile, $statusFile\\n\\nWrite-Host \\\"Job started: $($job.Id)\\\" -ForegroundColor Green\\nWrite-Host \\\"\\\"\\n\\nif ($WaitSeconds -gt 0) {\\n    Write-Host \\\"Waiting up to $WaitSeconds seconds for completion...\\\" -ForegroundColor Yellow\\n    $completed = Wait-Job -Job $job -Timeout $WaitSeconds\\n\\n    if ($completed) {\\n        $result = Receive-Job -Job $job\\n        Write-Host \\\"\\\"\\n        Write-Host \\\"Job completed.\\\" -ForegroundColor Green\\n\\n        # Display output\\n        if (Test-Path $stdoutFile) {\\n            Write-Host \\\"\\\"\\n            Write-Host \\\"--- OUTPUT ---\\\" -ForegroundColor Cyan\\n            Get-Content $stdoutFile\\n        }\\n    } else {\\n        Write-Host \\\"\\\"\\n        Write-Host \\\"Job still running after $WaitSeconds seconds.\\\" -ForegroundColor Yellow\\n        Write-Host \\\"Check status later with:\\\" -ForegroundColor Yellow\\n        Write-Host \\\"  Get-Content \u0027$statusFile\u0027\\\" -ForegroundColor White\\n        Write-Host \\\"  Get-Content \u0027$stdoutFile\u0027\\\" -ForegroundColor White\\n    }\\n} else {\\n    Write-Host \\\"Job running in background.\\\" -ForegroundColor Yellow\\n    Write-Host \\\"\\\"\\n    Write-Host \\\"To check status:\\\" -ForegroundColor Cyan\\n    Write-Host \\\"  Get-Content \u0027$statusFile\u0027\\\" -ForegroundColor White\\n    Write-Host \\\"\\\"\\n    Write-Host \\\"To read output when complete:\\\" -ForegroundColor Cyan\\n    Write-Host \\\"  Get-Content \u0027$stdoutFile\u0027\\\" -ForegroundColor White\\n    Write-Host \\\"\\\"\\n    Write-Host \\\"To check job state:\\\" -ForegroundColor Cyan\\n    Write-Host \\\"  Get-Job -Name \u0027$jobNameFinal\u0027\\\" -ForegroundColor White\\n    Write-Host \\\"\\\"\\n    Write-Host \\\"To wait and receive output:\\\" -ForegroundColor Cyan\\n    Write-Host \\\"  Receive-Job -Name \u0027$jobNameFinal\u0027 -Wait\\\" -ForegroundColor White\\n}\\n\\nWrite-Host \\\"\\\"\\nWrite-Host \\\"============================================\\\" -ForegroundColor Cyan\\n\\n#endregion\\n\\n\\n\\n\"}"},"checkpointId":"fb2e697f-cf74-430f-98a0-6536839a475c"},"bubbleId":"3f5fc436-4ee4-4c7e-9f24-e0c803b5e4af"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"4178c52e-3b9d-47c5-b174-e8b3b30e11af","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:39:47.351Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","serverBubbleId":"19770d17-62aa-4596-9e7e-0517db9c9a42","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","capabilityType":30,"thinking":{"text":"Let me update the README to include the new MITM audit scripts.","signature":"EucBCkYIChgCKkCFMtcfXkNYgpvjthubcUtW+p/R/I33aNllVIO6optAoAJxbEbNnSOcbM26ZUFxzNu3eftA/Xr8LStCc0CVSZVwEgxwH1OKF80nxu15IfYaDHdjBkroKfeF7zxDhCIwdEceZokXeIoR3MuIUP7BcoReiPA7wXKjBhuLk3hM0zR6bvrYAuqEBJO82BauNPm7Kk/fkXmWOO95uLwDZegJBp9sosv8Kt81JHJ0T/x0l5KyDmpOMTYBfsTf6vt04A8kxezYrwlBqvVnAJlSbGURyhMChvCIUKDmh/OxXRSNVnlkGAE="},"thinkingStyle":1,"thinkingDurationMs":722},"bubbleId":"4178c52e-3b9d-47c5-b174-e8b3b30e11af"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"431f9ca9-050f-462e-95ec-d28b8895b5b9","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:40:50.483Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","serverBubbleId":"7a647a4a-c1bd-4aca-9bb6-084b6c168658","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","capabilityType":30,"thinking":{"text":"Now I need to add the MitmAudit entry to the script map.","signature":"EuABCkYIChgCKkAc0145y5rADOHZzbRXhDAxFC4/Blzc7wku5qe+jMbq9wAX7M7BhhUDuMrxZKYZqeCOOxBYL7esxV86hZjuTiL2Egz4TX6D2AWTvQeebnQaDBBkwGlCrpzJtr/9gyIwsyVV3HKnd9bcD9yjEwHbj1FO6qQ7IHMLcxhOedqtxV9S++QAwYpZSzbrvB5Wm0tfKkjRGRjef3REKx8Ksk0EsO7nOcCY4ngGNlSJ9kbn6Gt1RzIj5NNu1du6fdXpPcIiW0jyE5XLqg67DHOw4jVrU+FHm/T+ZIGBB0gYAQ=="},"thinkingStyle":1,"thinkingDurationMs":541},"bubbleId":"431f9ca9-050f-462e-95ec-d28b8895b5b9"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"4990f3a8-8c39-47e2-a2e8-9a23dc46db81","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:41:31.645Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","serverBubbleId":"5afd39f4-a4d3-4e22-aa89-1491e63254dc","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","capabilityType":30,"thinking":{"text":"The reconciliation is complete. Let me now provide a summary to the user explaining what was created and how the two scripts are unified.","signature":"ErICCkYIChgCKkCuhXzbD2kF5jVhzpG5a6mg8DmjB2OxmSXDWjuQHutDf42/CPQWxMHfQrlFidZJlJ0jPDHRTl6DRS7ovsSu4DhwEgxCN3DW4NfHm29fBB4aDKTY2khDQCGCQjNd0CIw0xM3fEceq9Wj0AS64DuvxuGGiuCM/svXMEI+byyJJxVC5mPw9dpH1pxTE2k0L0aMKpkBdzVzmADktoMtYJNlt7otxLjGMVvIwpFmjyUofDiazjm9Vxfk831D9MnpzChMQzDS9AlqLjmrwo8yNEiwwaZR/fMQMWY76YinNIP770eyd9s6tBjFE59DfJSFctpQjl6LGs5JEYVNJBqpCr13NC51hGTgl3rviM2UgdsPKzDMAfF6RJAXkic5bLoCsZEpcn3m7vZyyqLCctxQGAE="},"thinkingStyle":1,"thinkingDurationMs":816},"bubbleId":"4990f3a8-8c39-47e2-a2e8-9a23dc46db81"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"4a2893f5-fd30-460d-ab5a-485f8970374a","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:39:51.361Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"text":"","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","codeBlocks":[{"uri":{"scheme":"file","authority":"","path":"/c:/Users/user/Downloads/Cursor_working_directory_misc/templates/network/README.md","query":"","fragment":"","_formatted":"file:///c%3A/Users/user/Downloads/Cursor_working_directory_misc/templates/network/README.md","_fsPath":null},"codeblockId":"e8a14f8e-8008-4e14-88ac-05ac92dba8e2","codeBlockIdx":0,"content":"# Network Diagnostics Toolkit\n\nNetwork scanning, DNS diagnostics, forensics collection, and Infrastructure MITM detection tools.\n\n## Scripts\n\n| Script | Platform | Purpose |\n|--------|----------|---------|\n| `Invoke-NetworkScan-v7.ps1` | Windows (PS7) | TCP port scanner with service detection |\n| `Invoke-DnsDiagnostics-v7.ps1` | Windows (PS7) | DNS anomaly detection and consistency checks |\n| `Invoke-NetworkForensics-v7.ps1` | Windows (PS7) | Forensic data collection and analysis |\n| `Invoke-MitmAudit-v7.ps1` | Windows (PS7) | Infrastructure MITM detection with ASN/DoH/Cert analysis |\n| `Invoke-BackgroundDiagnostics-v7.ps1` | Windows (PS7) | Background wrapper for all diagnostics |\n| `network-scan.sh` | POSIX | TCP port scanner |\n| `dns-diagnostics.sh` | POSIX | DNS testing and anomaly detection |\n| `network-forensics.sh` | POSIX | Forensic data collection |\n| `mitm-audit.sh` | POSIX | Infrastructure MITM detection with ASN/DoH/Cert analysis |\n| `Invoke-PacketCapture-v7.ps1` | Windows (PS7) | Packet capture with pktmon (full detail, timestamps) |\n| `packet-capture.sh` | POSIX | Packet capture with tcpdump (full detail, timestamps) |\n\n## Configuration\n\nAll scripts use `network.cfg` with KEY=VALUE format:\n\n```\nTARGET_HOST=192.168.1.1\nTARGET_NETWORK=192.168.1.0/24\nSCAN_PORTS=21,22,23,25,53,80,443,445,3389,8080,8443\nDNS_SERVERS=1.1.1.1,8.8.8.8,9.9.9.9\nDNS_TEST_DOMAINS=api2.cursor.sh,github.com,google.com\nSCAN_TIMEOUT_MS=500\nOUTPUT_DIR=./network-diagnostics\n\n# Packet capture settings\nCAPTURE_SNAPLEN=0\nCAPTURE_MAX_SIZE_MB=512\nCAPTURE_ROTATE_COUNT=10\nCAPTURE_TIMESTAMP_PRECISION=nano\nCAPTURE_CONVERT_PCAPNG=true\n```\n\n## Usage Examples\n\n### Network Scanning\n\n```powershell\n# Windows - Scan single host\n.\\Invoke-NetworkScan-v7.ps1 -Target 192.168.1.1 -Ports \"22,80,443\"\n\n# Windows - Use config file\n.\\Invoke-NetworkScan-v7.ps1 -ConfigFile .\\network.cfg\n\n# Unix\n./network-scan.sh -t 192.168.1.1 -p \"22,80,443\"\n```\n\n### DNS Diagnostics\n\n```powershell\n# Windows - Test specific domain\n.\\Invoke-DnsDiagnostics-v7.ps1 -Domain api2.cursor.sh\n\n# Windows - Full diagnostics with config\n.\\Invoke-DnsDiagnostics-v7.ps1 -ConfigFile .\\network.cfg -OutputPath .\\results\n\n# Unix\n./dns-diagnostics.sh -d api2.cursor.sh -s \"1.1.1.1,8.8.8.8\"\n```\n\n### Network Forensics\n\n```powershell\n# Windows - Full collection\n.\\Invoke-NetworkForensics-v7.ps1 -OutputPath .\\forensics\n\n# Unix\n./network-forensics.sh -o ./forensics\n```\n\n### Background Execution (for Agent/Automation)\n\nFor scripts that may run indefinitely or timeout in agent sessions:\n\n```powershell\n# Windows - Run any diagnostic in background\n.\\Invoke-BackgroundDiagnostics-v7.ps1 -Script NetworkForensics -OutputPath .\\results\n.\\Invoke-BackgroundDiagnostics-v7.ps1 -Script DnsDiagnostics -WaitSeconds 30\n.\\Invoke-BackgroundDiagnostics-v7.ps1 -Script PacketCapture -ScriptArgs @{Duration=60}\n\n# Check status\nGet-Content .\\results\\*-status.json\n\n# Read output when complete\nGet-Content .\\results\\*-stdout.txt\n```\n\n```sh\n# Unix - Use nohup for background\nnohup ./network-forensics.sh -o ./results \u003e forensics.log 2\u003e\u00261 \u0026\n\n# Check later\ncat forensics.log\n```\n\n### Packet Capture\n\n```powershell\n# Windows - Capture with pktmon (requires Admin)\n.\\Invoke-PacketCapture-v7.ps1 -Duration 60 -OutputPath .\\captures\n.\\Invoke-PacketCapture-v7.ps1 -Filter \"port 443\" -Duration 30 -ConvertToPcap\n\n# Unix - Capture with tcpdump (requires root/sudo)\n./packet-capture.sh -i eth0 -d 60 -o ./captures\n./packet-capture.sh -f \"port 443 or port 80\" -d 30\n./packet-capture.sh -i any -f \"host 192.168.1.1\" -d 120\n```\n\n#### Capture Options\n\n**Windows (pktmon):**\n- Full packet capture (no truncation)\n- All network components\n- ETL format with optional PCAPNG conversion\n- Timestamp precision to nanoseconds\n\n**Unix (tcpdump):**\n- `-XX` Hex and ASCII dump\n- `-vvv` Maximum verbosity\n- `-tttt` Human-readable timestamps with date\n- `-S` Absolute sequence numbers\n- `--time-stamp-precision=nano` Nanosecond precision (if supported)\n- File rotation support\n\n## Detection Capabilities\n\n### DNS Diagnostics\n\n- DNS hijacking (fake IPs like 0.0.0.x)\n- LLMNR/NetBIOS poisoning (.lan/.local suffixes)\n- DNS response inconsistencies across servers\n- Temporary resolution failures (EAI_AGAIN)\n\n### Network Forensics\n\n- ARP spoofing (duplicate MAC addresses)\n- Suspicious listening ports\n- Malware C2 ports (4444, 5555, 31337, etc.)\n- Hosts file tampering\n- Firewall state analysis\n- Promiscuous mode detection\n\n## Output Format\n\nAll tools output JSON files for programmatic analysis:\n\n```\n./network-diagnostics/\n  scan-2025-12-01_15-00-00.json\n  dns-diagnostics-2025-12-01_15-00-00.json\n\n./network-forensics/\n  summary.json\n  network/\n    connections.json\n    interfaces.json\n    arp-cache.json\n    routes.json\n    listeners.json\n  dns/\n    cache.json\n    hosts-file.json\n  security/\n    firewall.json\n  processes/\n    network-processes.json\n```\n\n## Requirements\n\n### Windows\n\n- PowerShell 7+\n- Administrator privileges recommended for full data collection\n\n### Unix/Linux/macOS\n\n- POSIX-compliant shell\n- One of: dig, nslookup, or host (for DNS)\n- One of: nc (netcat), or bash with /dev/tcp support (for scanning)\n- tcpdump for packet capture\n- root/sudo for packet capture and full forensics collection\n\n## License\n\nBSD-2-Clause\n\n## Signed-off-by\n\nNetwork Diagnostics Toolkit\n\n","languageId":"markdown"}],"capabilityType":15,"toolFormerData":{"tool":38,"toolCallId":"toolu_01CUqLAbTGd5UYXXwd2xzoR9","toolIndex":1,"modelCallId":"23fdb5f6-d711-4ea4-ab78-03cb3621efe9","status":"completed","rawArgs":"{\"file_path\": \"templates/network/README.md\", \"old_string\": \"# Network Diagnostics Toolkit\\n\\nNetwork scanning, DNS diagnostics, and forensics collection tools.\\n\\n## Scripts\\n\\n| Script | Platform | Purpose |\\n|--------|----------|---------|\\n| `Invoke-NetworkScan-v7.ps1` | Windows (PS7) | TCP port scanner with service detection |\\n| `Invoke-DnsDiagnostics-v7.ps1` | Windows (PS7) | DNS anomaly detection and consistency checks |\\n| `Invoke-NetworkForensics-v7.ps1` | Windows (PS7) | Forensic data collection and analysis |\\n| `Invoke-BackgroundDiagnostics-v7.ps1` | Windows (PS7) | Background wrapper for all diagnostics |\\n| `network-scan.sh` | POSIX | TCP port scanner |\\n| `dns-diagnostics.sh` | POSIX | DNS testing and anomaly detection |\\n| `network-forensics.sh` | POSIX | Forensic data collection |\\n| `Invoke-PacketCapture-v7.ps1` | Windows (PS7) | Packet capture with pktmon (full detail, timestamps) |\\n| `packet-capture.sh` | POSIX | Packet capture with tcpdump (full detail, timestamps) |\", \"new_string\": \"# Network Diagnostics Toolkit\\n\\nNetwork scanning, DNS diagnostics, forensics collection, and Infrastructure MITM detection tools.\\n\\n## Scripts\\n\\n| Script | Platform | Purpose |\\n|--------|----------|---------|\\n| `Invoke-NetworkScan-v7.ps1` | Windows (PS7) | TCP port scanner with service detection |\\n| `Invoke-DnsDiagnostics-v7.ps1` | Windows (PS7) | DNS anomaly detection and consistency checks |\\n| `Invoke-NetworkForensics-v7.ps1` | Windows (PS7) | Forensic data collection and analysis |\\n| `Invoke-MitmAudit-v7.ps1` | Windows (PS7) | Infrastructure MITM detection with ASN/DoH/Cert analysis |\\n| `Invoke-BackgroundDiagnostics-v7.ps1` | Windows (PS7) | Background wrapper for all diagnostics |\\n| `network-scan.sh` | POSIX | TCP port scanner |\\n| `dns-diagnostics.sh` | POSIX | DNS testing and anomaly detection |\\n| `network-forensics.sh` | POSIX | Forensic data collection |\\n| `mitm-audit.sh` | POSIX | Infrastructure MITM detection with ASN/DoH/Cert analysis |\\n| `Invoke-PacketCapture-v7.ps1` | Windows (PS7) | Packet capture with pktmon (full detail, timestamps) |\\n| `packet-capture.sh` | POSIX | Packet capture with tcpdump (full detail, timestamps) |\"}","name":"search_replace","params":"{\"relativeWorkspacePath\":\"templates/network/README.md\"}","additionalData":{"codeblockId":"e8a14f8e-8008-4e14-88ac-05ac92dba8e2","reviewData":{"status":"None","selectedOption":"accept","isShowingInput":false,"firstTimeReviewMode":false}},"userDecision":"accepted","result":"{\"diff\":{\"chunks\":[{\"diffString\":\"  # Network Diagnostics Toolkit\\n  \\n- Network scanning, DNS diagnostics, and forensics collection tools.\\n+ Network scanning, DNS diagnostics, forensics collection, and Infrastructure MITM detection tools.\\n  \\n  ## Scripts\",\"oldStart\":1,\"newStart\":1,\"oldLines\":5,\"newLines\":5,\"linesRemoved\":1,\"linesAdded\":1},{\"diffString\":\"  | `Invoke-DnsDiagnostics-v7.ps1` | Windows (PS7) | DNS anomaly detection and consistency checks |\\n  | `Invoke-NetworkForensics-v7.ps1` | Windows (PS7) | Forensic data collection and analysis |\\n+ | `Invoke-MitmAudit-v7.ps1` | Windows (PS7) | Infrastructure MITM detection with ASN/DoH/Cert analysis |\\n  | `Invoke-BackgroundDiagnostics-v7.ps1` | Windows (PS7) | Background wrapper for all diagnostics |\\n  | `network-scan.sh` | POSIX | TCP port scanner |\\n  | `dns-diagnostics.sh` | POSIX | DNS testing and anomaly detection |\\n  | `network-forensics.sh` | POSIX | Forensic data collection |\\n+ | `mitm-audit.sh` | POSIX | Infrastructure MITM detection with ASN/DoH/Cert analysis |\\n  | `Invoke-PacketCapture-v7.ps1` | Windows (PS7) | Packet capture with pktmon (full detail, timestamps) |\\n  | `packet-capture.sh` | POSIX | Packet capture with tcpdump (full detail, timestamps) |\",\"oldStart\":10,\"newStart\":10,\"oldLines\":8,\"newLines\":10,\"linesAdded\":2}],\"editor\":\"EDITOR_AI\"},\"shouldAutoFixLints\":true,\"resultForModel\":\"The file templates/network/README.md has been updated.\",\"contentsAfterEdit\":\"# Network Diagnostics Toolkit\\n\\nNetwork scanning, DNS diagnostics, forensics collection, and Infrastructure MITM detection tools.\\n\\n## Scripts\\n\\n| Script | Platform | Purpose |\\n|--------|----------|---------|\\n| `Invoke-NetworkScan-v7.ps1` | Windows (PS7) | TCP port scanner with service detection |\\n| `Invoke-DnsDiagnostics-v7.ps1` | Windows (PS7) | DNS anomaly detection and consistency checks |\\n| `Invoke-NetworkForensics-v7.ps1` | Windows (PS7) | Forensic data collection and analysis |\\n| `Invoke-MitmAudit-v7.ps1` | Windows (PS7) | Infrastructure MITM detection with ASN/DoH/Cert analysis |\\n| `Invoke-BackgroundDiagnostics-v7.ps1` | Windows (PS7) | Background wrapper for all diagnostics |\\n| `network-scan.sh` | POSIX | TCP port scanner |\\n| `dns-diagnostics.sh` | POSIX | DNS testing and anomaly detection |\\n| `network-forensics.sh` | POSIX | Forensic data collection |\\n| `mitm-audit.sh` | POSIX | Infrastructure MITM detection with ASN/DoH/Cert analysis |\\n| `Invoke-PacketCapture-v7.ps1` | Windows (PS7) | Packet capture with pktmon (full detail, timestamps) |\\n| `packet-capture.sh` | POSIX | Packet capture with tcpdump (full detail, timestamps) |\\n\\n## Configuration\\n\\nAll scripts use `network.cfg` with KEY=VALUE format:\\n\\n```\\nTARGET_HOST=192.168.1.1\\nTARGET_NETWORK=192.168.1.0/24\\nSCAN_PORTS=21,22,23,25,53,80,443,445,3389,8080,8443\\nDNS_SERVERS=1.1.1.1,8.8.8.8,9.9.9.9\\nDNS_TEST_DOMAINS=api2.cursor.sh,github.com,google.com\\nSCAN_TIMEOUT_MS=500\\nOUTPUT_DIR=./network-diagnostics\\n\\n# Packet capture settings\\nCAPTURE_SNAPLEN=0\\nCAPTURE_MAX_SIZE_MB=512\\nCAPTURE_ROTATE_COUNT=10\\nCAPTURE_TIMESTAMP_PRECISION=nano\\nCAPTURE_CONVERT_PCAPNG=true\\n```\\n\\n## Usage Examples\\n\\n### Network Scanning\\n\\n```powershell\\n# Windows - Scan single host\\n.\\\\Invoke-NetworkScan-v7.ps1 -Target 192.168.1.1 -Ports \\\"22,80,443\\\"\\n\\n# Windows - Use config file\\n.\\\\Invoke-NetworkScan-v7.ps1 -ConfigFile .\\\\network.cfg\\n\\n# Unix\\n./network-scan.sh -t 192.168.1.1 -p \\\"22,80,443\\\"\\n```\\n\\n### DNS Diagnostics\\n\\n```powershell\\n# Windows - Test specific domain\\n.\\\\Invoke-DnsDiagnostics-v7.ps1 -Domain api2.cursor.sh\\n\\n# Windows - Full diagnostics with config\\n.\\\\Invoke-DnsDiagnostics-v7.ps1 -ConfigFile .\\\\network.cfg -OutputPath .\\\\results\\n\\n# Unix\\n./dns-diagnostics.sh -d api2.cursor.sh -s \\\"1.1.1.1,8.8.8.8\\\"\\n```\\n\\n### Network Forensics\\n\\n```powershell\\n# Windows - Full collection\\n.\\\\Invoke-NetworkForensics-v7.ps1 -OutputPath .\\\\forensics\\n\\n# Unix\\n./network-forensics.sh -o ./forensics\\n```\\n\\n### Background Execution (for Agent/Automation)\\n\\nFor scripts that may run indefinitely or timeout in agent sessions:\\n\\n```powershell\\n# Windows - Run any diagnostic in background\\n.\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script NetworkForensics -OutputPath .\\\\results\\n.\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script DnsDiagnostics -WaitSeconds 30\\n.\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script PacketCapture -ScriptArgs @{Duration=60}\\n\\n# Check status\\nGet-Content .\\\\results\\\\*-status.json\\n\\n# Read output when complete\\nGet-Content .\\\\results\\\\*-stdout.txt\\n```\\n\\n```sh\\n# Unix - Use nohup for background\\nnohup ./network-forensics.sh -o ./results \u003e forensics.log 2\u003e\u00261 \u0026\\n\\n# Check later\\ncat forensics.log\\n```\\n\\n### Packet Capture\\n\\n```powershell\\n# Windows - Capture with pktmon (requires Admin)\\n.\\\\Invoke-PacketCapture-v7.ps1 -Duration 60 -OutputPath .\\\\captures\\n.\\\\Invoke-PacketCapture-v7.ps1 -Filter \\\"port 443\\\" -Duration 30 -ConvertToPcap\\n\\n# Unix - Capture with tcpdump (requires root/sudo)\\n./packet-capture.sh -i eth0 -d 60 -o ./captures\\n./packet-capture.sh -f \\\"port 443 or port 80\\\" -d 30\\n./packet-capture.sh -i any -f \\\"host 192.168.1.1\\\" -d 120\\n```\\n\\n#### Capture Options\\n\\n**Windows (pktmon):**\\n- Full packet capture (no truncation)\\n- All network components\\n- ETL format with optional PCAPNG conversion\\n- Timestamp precision to nanoseconds\\n\\n**Unix (tcpdump):**\\n- `-XX` Hex and ASCII dump\\n- `-vvv` Maximum verbosity\\n- `-tttt` Human-readable timestamps with date\\n- `-S` Absolute sequence numbers\\n- `--time-stamp-precision=nano` Nanosecond precision (if supported)\\n- File rotation support\\n\\n## Detection Capabilities\\n\\n### DNS Diagnostics\\n\\n- DNS hijacking (fake IPs like 0.0.0.x)\\n- LLMNR/NetBIOS poisoning (.lan/.local suffixes)\\n- DNS response inconsistencies across servers\\n- Temporary resolution failures (EAI_AGAIN)\\n\\n### Network Forensics\\n\\n- ARP spoofing (duplicate MAC addresses)\\n- Suspicious listening ports\\n- Malware C2 ports (4444, 5555, 31337, etc.)\\n- Hosts file tampering\\n- Firewall state analysis\\n- Promiscuous mode detection\\n\\n## Output Format\\n\\nAll tools output JSON files for programmatic analysis:\\n\\n```\\n./network-diagnostics/\\n  scan-2025-12-01_15-00-00.json\\n  dns-diagnostics-2025-12-01_15-00-00.json\\n\\n./network-forensics/\\n  summary.json\\n  network/\\n    connections.json\\n    interfaces.json\\n    arp-cache.json\\n    routes.json\\n    listeners.json\\n  dns/\\n    cache.json\\n    hosts-file.json\\n  security/\\n    firewall.json\\n  processes/\\n    network-processes.json\\n```\\n\\n## Requirements\\n\\n### Windows\\n\\n- PowerShell 7+\\n- Administrator privileges recommended for full data collection\\n\\n### Unix/Linux/macOS\\n\\n- POSIX-compliant shell\\n- One of: dig, nslookup, or host (for DNS)\\n- One of: nc (netcat), or bash with /dev/tcp support (for scanning)\\n- tcpdump for packet capture\\n- root/sudo for packet capture and full forensics collection\\n\\n## License\\n\\nBSD-2-Clause\\n\\n## Signed-off-by\\n\\nNetwork Diagnostics Toolkit\\n\\n\"}"},"checkpointId":"d8a8b205-7db2-4ade-a55e-53ef8c988547"},"bubbleId":"4a2893f5-fd30-460d-ab5a-485f8970374a"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"4b4f6b28-8ca6-4262-ae03-e5f27555977c","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:41:31.007Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"text":"All scripts are in place. Let me create a quick reconciliation summary document to show the feature parity:","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878"},"bubbleId":"4b4f6b28-8ca6-4262-ae03-e5f27555977c"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"4f5584e8-b6f6-427b-8633-ab0a1d75ec88","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:35:04.994Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","serverBubbleId":"10e598e5-0bcd-4b7d-83d4-5d5610314fc0","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","capabilityType":30,"thinking":{"text":"Now I have a clear picture. I need to create reconciled scripts that:\n\n1. Follow the workspace conventions:\n   - Use `.cfg` file pattern\n   - BSD-2-Clause license with DCO sign-off\n   - No emojis\n   - POSIX shell and PowerShell 7\n\n2. Have **feature parity** between PowerShell and POSIX shell with all the \"Gold Standard\" features:\n   - ASN-based integrity checking\n   - DoH comparison (dns.google)\n   - Certificate serial extraction (for crt.sh verification)\n   - Timestamped evidence directories\n   - Alert/Red Flags file\n   - External IP organization verification\n   - Root CA export with hashing\n   - Traceroute mapping\n\n3. Add **client-side exploit ruling out**:\n   - Check for proxy settings (system and browser)\n   - Check for suspicious browser extensions\n   - Check for local host file modifications\n   - Check for rogue root CAs\n   - Compare behavior on same network vs different network\n\n4. Produce identical evidence package structure\n\n5. Include evidence integrity hashing (SHA256 of the evidence package)\n\nLet me create:\n1. `mitm-audit.cfg` - Configuration file\n2. `Invoke-MitmAudit-v7.ps1` - PowerShell version\n3. `mitm-audit.sh` - POSIX shell version\n\nI\u0027ll place these in the templates/network directory following the existing pattern.","signature":"Ev4KCkYIChgCKkB7wPJSXrYHB8LQ+GxbXMvoT3AqDBMiiWVRJGgvDLnj8h+rDwZ0h5vYNkaZIf0ZZEUeaLRNAqWx+7BqSLwoQdcLEgyDrjgYrm2SsUCFzz4aDMl8nxNhWwQJkZJzeSIw5y+f/hfgSWThmg+7FYxYF3a1azOIAmkYE7ZpzmA1yXqtv4Hlr5sHdI3/GvKAcvQIKuUJeuePJYSBVx+Vh5MkCvXV5hD5I7JPkG33aY0meLmiy1D0eSWG+Nx0H9pXM6UqffOaiJgpIRJnfilaYAWe8yGeAXFgESUX/ZgMr3l2r0EBM7GYJlkqKlq1Pd2Wrykl4ltLNuDsMHBOZb3y+P1auyuyt8II2m2X3B9c3HeNyXlBXTPQzyl8ConMipSJn4lirecVbSsCeiep6vvaEzZ7FxJ7rE0qggB4pbVP2/wyZLo8QvLT4dlCmOLgQfdEVllXztFyF7cAHQjo9jrzYoqN3e9qE+WL0MShF8nE29XWvaZAP/ng3BKd4p1YKA0IeDA/X30aD8NsZ8cRBxW5neBAkymY3QY1GSItlNgJBLuCylV5QVFaodYr0gWlyGU8Pf2Cuwyqtjx/Wtz3IQ1yM8qgjwwGEAIDopkxPu3y8aLQhn0hVUU+NAPYT4AcC6w8gPBwH+MEsTe2v64HxEcWUAs3AshhgEF6WKV4EY/jgz1Cd15jhG5Bz2Im7fFHbNGGW4ykjAoKY/0196OmI77+9iKpQhJlj8zZwmCE17VA3YLg3zwdBRzSEKcNEGpFXArukRFrOxqNSo/AoQU3t6DjtPPKYLojpZNla5gPwI7nzX+dpzExR+w+puwrKgtOqZqd41/B4TNvhaPGSWNPdT9Up5SAo2ixMFTQse60bK7WGE8mQmC3HquyLiHuKKEuCxxwLAGyAwoZuHj9/BrzyHtyen/R2DQUoTjXDYvV+CYAp0bTLO9TmNCtIuDJMVeonxB6m0NAZUPfAlwY1lPr1xQpa60nw7UsEF+AbxsY4DDlHDTr/SZcqK8sTs22oh9YLd6EQMHWGB+YfEIGlkKJLoIuSoKTU0lveMlMEqvzcB/nlO6RNLdoDseU2M3UL4rCRMHz64hQhRXnnR/9dfpF0Cuw38gcu5KlD3wM8dmc8sk5zzY6HHBkoJUnLt68loYjDz4T+Sa39zX7VHJyYBjCfVLwX7UCuwdm0hk81D/o+NIleG1tpyRyg+IJ1m9/85VmNFX+lfa8R0nJP0zFLPeKAJ+Min8jXQyfN03N7Du+fHRizZNAubv+6RxVOiLUE4f84Eppl6q17d75jBp3XeYpz/u4Ch6Zu2+OhufuJfaT2/TC5U7LH8lqSpwXAgnVvbTcIEFRuEd20b8nSntBpmh155wtXtceYY0k4p2hPjGNwLly+2k86fQ2DQq/OGIFT+o09h1faS3bJi7xq4rWZfIsuNg4UbIDpGlCq8Wd8eKpQem1WeTNjaXObBPOwbfUJvbD9yCp+Qa4+ctB7U7hHvX1Qw7Svi8ZmjPCFFwPD3TWoKLasB+Gl15TUqzh5pfRxKe1ZhrA97nxpsLpiudTz3coYjMf4fTLUuvSplHOEm/A4ONDznztljeiVZc7sGSEUG8I0pBhcqKOxZxcjksjXBj/IjoH7mugNBuylfh2xALLQ7yZ//kDObDFlCnSLzzL66K6Dh45gPpqJv+rycNDlC7dJSubbExbCnIDEUg4BEakBZud2jlNsLW/kWw2bQ7+jvzeXWCXVPffHB18s0iBdfDTuEY9fu0zXBTpQedKR4HvjSnlFswxOvBqyNu0NE3yrCPFf6vOA6SSUpoQyfdr9W+109hWGK4jk8KwLsFmwd0iB0X1vLwSSve1QyTaCw6nT1A0HTQkMpHN4xF3fMZQA1QYAQ=="},"thinkingStyle":1,"thinkingDurationMs":4908},"bubbleId":"4f5584e8-b6f6-427b-8633-ab0a1d75ec88"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"57ec902e-a7e9-4b89-b6d6-5803838bf38e","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:34:50.986Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","serverBubbleId":"d7e82756-a6ea-4c87-931c-c903b062de0e","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","capabilityType":30,"thinking":{"text":"I now have a clear picture. The existing `Invoke-NetworkForensics-v7.ps1` and `network-forensics.sh` are general forensics collection tools, but they don\u0027t have the specific **Infrastructure MITM detection** logic that the user\u0027s \"Gold Standard\" scripts contain.\n\nThe user\u0027s scripts have unique features not in the existing tools:1. **ASN-based integrity checking** (checking if Google resolves to Google ASN)2. **DoH comparison** (comparing local DNS resolution to dns.google)3. **Certificate serial checking** (for crt.sh verification)4. **Timestamped evidence directories** for chain of custody5. **Alert/Red Flags file** for immediate review6. **External IP organization verification** (Vyve/Eagle context)7. **Root CA export** with hashing8. **Traceroute mapping**\n\nI need to create reconciled scripts that:1. Follow the workspace conventions (`.cfg` file, no emojis, BSD-2-Clause)2. Have **feature parity** between PowerShell and POSIX shell3. Include all the \"Gold Standard\" MITM detection logic4. Add **client-side exploit ruling out** (checking for local proxy, browser extensions, etc.)5. Produce identical evidence package structure6. Include evidence integrity hashing\n\nLet me also check the network.cfg to understand the config pattern.","signature":"EoYLCkYIChgCKkAuIp3BvoO/tQAmkOitXLFIS/e+GMZEMcmy6DG95m/S6J3YbYY+zlf/zTS9CeTHWIGGQmiEnv52zHgi+I/08MkFEgyoenZHlADf4OpsgOMaDEQ+BCAQKbddtfndoCIwn+L9chC1RsKif8d56XxmsHpWmDta3JBtM/YHgXC2RWlNyfTt1UuS7BIHDx/isq9cKu0JlyivqFhzJvNTz+YlymvTu9Jn+AES5rDd9MkN+43PbvSxo77NNkHE9uVeZb+xoV68qV8AIzu+76I6vYod0T9uWN0CQA42kwiWuKRlLOtGbujIH2a5garst/YO0Uxv7Wv6qk0RXbQfzOyVrM+YwkctUdgONLuISlDlbpK25SnJeOTPyT4OyNBXEC5BVnCx2C/k/NrcWsDNeajkdN44DCvF6n4eyaTkAfGcKz41cnlVeA1Ozo2Z1is1Tvw6l6BcXjY78tAylczaS/8ehvYtrPOqmORj3Yc3LdSZL5v/P6XrNHkMm+FI1/8ZQ3NbPV6cgPq73i9XCoh41ztv3KBTM5v9bn1Oim+LTNsWBxuZNWn1DQXwkSLqsrtk6SXHVv0ojXVadyHH1d1W/zEVR+DljyuiwS65JoVuHAUudWY9zRx2qCUMN5gX5kLM48hcw7essKn0foiKcsig8JI+0yErpQPGs8IfE79pLjZxHe9N/0sWErj2w/qtlxKpJYdffCuKnlK0oaXFFOTDVO4oO6UOLi3QY7ZMW2N2kE+KfFxOXiT9ofT1J5Da9ULXMwODGTid1UKyqevvsovGT/vbbkCa9Nhk1qA1ST/kCbMoidTJiAcPthvWba7I/0FNilolr6BNsLGReyOU2hR9BpnNhTZCcFZ1nWwg6uGvGxuilkSBHRHLgMti1i5/EVYWtPRviOOsrEaxHY12ByM3SYSD0Cy3WsSxHYZSu674d2tT9JckHboQtlymqt+tku+StHOXaezGPiWTMmOATdQW6okUECq9gWMQvATw0BCX9znDoXRxrY/Yz1ZIVzkYTKnfUqxqDFSY0VfxO7730WbNOxxBHuh9F1mALhOg5luooh5KIRqw2uAnZXndUuig86pY/MiUgkgn2EcPPbhnUfcVOQqeSo/bmHd4JsoIAsKg7aDAhcsnijOBI9PxZVlXuvFUHdTYfoMazVUI3OQg47he7P4ARHsi0PnRZoKRxD0pZfqS334Zp1skwp2o6C6zenSZWumLXrVUFe9ZE74OY6Qu7J1EoyEzvxNFUpM9PflDmhl4HmQW5+/Z/u0yT82JkcMMuWQ876VbkX8zwBF59ZNJSJMW35y/yAOxFZZ6naE9v69qmN9ugaHkTGA/jvEo18A/kJlomlpP296kFrw/+vGvMDQBYO4RexUN/LPCLqBXhQNPZ0MAvjQH5ab4q3JKrldcBD+42tkH5ubVA/TPhojdMZWgmTDOprdSHxCLU3CEN9ZYcZx35cZiMaWfzSdDHBmgIxEvdQ3+zfwb48lf3v4aOqx84pDiXokOp/p9LC1T2mljOB/gYcbmNZbY4SNKwV4xlkZHLjTk/UwhXo2IgvthrGriSjP3Rx194hoc6kFx632lwwk4PzYlkrH7wOgW+Z3wHqsQ+oNHaU3EMWIwV5ezXBbDKkk+JmmSvj11HA12P2eFdgMe88A6SP/hn3QuWC3RYHhL9X3RuZfWkE3nF5bLtBt9BUPwxjkilbaPbqdFsTw/RgVdmB8DzMtJ3flTZtMb9zHzxsOPo6dnqBlB50v7rQYZuPU/Xuc2LGiNq5NkO+8iCCuvV44tg7feZNaFxEOPimjOcUy63TOnQkNwonv6Vcgp6nAul6zshuRgjK7Gqscvxlr7TxrFsIDHd9h4/vDik1b/DLEbZSktts/W0LVA6Xu2K76J9hgB"},"thinkingStyle":1,"thinkingDurationMs":8481},"bubbleId":"57ec902e-a7e9-4b89-b6d6-5803838bf38e"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"580ddb9a-1a80-4862-b906-2eb3e282217f","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:41:26.831Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","serverBubbleId":"9c3289ed-2411-41de-93a3-b60eafa48fb2","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","capabilityType":30,"thinking":{"text":"The scripts were created correctly. Now let me provide a summary showing how the scripts are reconciled and document the feature parity table.","signature":"ErcCCkYIChgCKkDkjEYxw8cMi+qmMiHtRFHAQcBTWmdi1v/mbhUpJu8739rxDChnZjEP83zDlPhsPdtAwyGV73K1LaEmljancrW2EgxX3quDvWqqKvf5SScaDI7s+Q928nOewozaoyIwpkoSFvK7n51TMnlOa+D35v5W/ZYOXxxmJRN9OVCpWznEOHsI+dOpj4U4XASmB49NKp4Bto0wUCigeJZOpYffwZmVFpskZ6Y8DHGB6lQHjOe51+OPjaVu6aBQeHydpPFj54pGLNNa4fn3W3eOZoHm+2LJO2fJlMwwMnknJK0mq+Z3Wt0CBesT3f8oAWHf7UlUXg3+Kfcjx+YQc9lN3j5RXhan0s3cHLH6pjTGT2hWtkxm2wLNly0xDoACCFy0zc+XnDB3yOqT7fyMptEy59wW8jEYAQ=="},"thinkingStyle":1,"thinkingDurationMs":891},"bubbleId":"580ddb9a-1a80-4862-b906-2eb3e282217f"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"586edc8f-6433-467b-87c3-874f439ffd70","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:34:04.273Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":["file:///c%3A/Users/user/Downloads/Cursor_working_directory_misc"],"codeBlocks":[],"text":"","modelInfo":{"modelName":"claude-4.5-opus-high-thinking"},"timingInfo":{"clientStartTime":7590869.900000006,"clientRpcSendTime":1765856044273,"clientSettleTime":1765856547774,"clientEndTime":1765856547774},"workspaceProjectDir":"c:\\Users\\user\\.cursor\\projects\\c-Users-user-Downloads-Cursor-working-directory-misc","serviceStatusUpdate":"{\"message\":\"You are projected to reach your usage limits by 12/17/2025 based on your current usage. Consider switching to a different model or enabling pay-as-you-go to avoid interruptions until your cycle resets on 1/2/2026.\",\"codicon\":\"info\"}","serverBubbleId":"d6671a04-b17d-4086-8e56-8cd81b66571c","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","capabilityType":30,"thinking":{"text":"The user is asking me to reconcile two forensic network audit scripts - one for PowerShell (Windows) and one for POSIX shell (Linux/macOS/WSL). They want me to create a unified, consistent approach that detects infrastructure-side MITM attacks while ruling out client-side exploits.\n\nLet me first read the AGENT_ONBOARD.md file as instructed by the rules, then analyze what needs to be reconciled between these two scripts.\n\nKey areas to reconcile:\n1. **Consistent output structure** - Both should produce identical evidence package layouts\n2. **Consistent detection logic** - Same ASN heuristics, same certificate checks\n3. **Cross-platform parity** - Features available in one should be mirrored in the other where possible\n4. **Proper error handling** - Both should handle network failures gracefully\n5. **Evidence integrity** - Both should hash outputs for chain of custody\n\nLet me examine what each script does and identify gaps:\n\n**PowerShell script features:**\n- Timestamped evidence directory\n- Environment snapshot (IP config, external IP)\n- Root CA export to CSV\n- DNS resolution with ASN lookup\n- DoH comparison (dns.google)\n- Certificate capture via TcpClient/SslStream\n- ASN mismatch heuristics\n- Traceroute\n- Logging and alerting\n\n**POSIX shell script features:**\n- Timestamped evidence directory\n- Environment snapshot (ip addr, external IP)\n- Root CA backup with hash\n- DNS resolution with ASN lookup\n- ASN mismatch heuristics\n- Certificate capture via openssl (full chain)\n- Traceroute\n- Logging and alerting\n\n**Gaps to reconcile:**\n1. PowerShell lacks Root CA hash for integrity\n2. POSIX shell lacks DoH comparison\n3. Certificate capture methods differ (PowerShell gets single cert, POSIX gets full chain)\n4. PowerShell exports Root CA to CSV, POSIX copies the PEM file\n\n\n5. POSIX lacks the Let\u0027s Encrypt heuristic\n6. Neither has final evidence package hashing\n7. POSIX could use more robust error handling\n8. Need consistent target list handling\n9. Need to add client-side exploit ruling out\n\nI\u0027ll develop a unified approach that standardizes detection methods, ensures cross-platform compatibility, and implements comprehensive exploit ruling out techniques. The reconciled scripts will provide a robust, consistent forensic network audit methodology across different operating systems.","signature":"EpcUCkYIChgCKkBl/PpyhtbLsf5lMTcWhdl4qfuAHoY0LHHIbwnK+dOAE9WJtkx+abdnUEXGNYNelZ4yDeJtdWDwpxZRXpZ/nq/2Egw8gKb8gjvFKV0O/loaDBhs7WmIBmgmC2wrqCIwhMc25Q6fFRXWy5hdY/qu9QNMoLAKiT162wRgYVQFyJCaEQgxHsskAtUiH1qrC3SpKv4S9qkrff6ksJdt0/R7yxlnlEiziPEDasjsSTGIodhaVmPtrgGl4w0YQC3/0tYUa36gAPhHesGgx60oMOKDZgVCwGC4lNN7/mJpX3dSo9gmIn3rNcooFRfOM8jGvMLAe9MXwWMvKBQvBRE2+dS64aOGVJyfBLBExFmlY3nYni6mJhh2RXPDfXYbGRDNccCCND0glmNckTlrngL+Zi40uwK+9mRQQH970vZpuaoNh8ixLIAuzB3d7uo++SqsdLHslnX8obKWL5ZqA1/2Wqw5zVMd/QktKaSKmjInYjBvRl0gWauvOK1epbb9aUPYDvPyTjPZKzz4Dkt62I8UWT/t6Xy0plnKoRzuc1IYDfEWVPYGydaUCcEFy5VF5jVuKL6JKLdltLcCJiOphB6aBTFpE32fDsTD+Vvkp4oPfy4id4HzlBnQf7mOAPtlONAgO88ntqOa6YGeMrhKvkkZ5aoPOCl+Zn3qKgYWdKCgyysHmmbXxCpc03srm6XUP5E44SWpPLynkoWSBLQ88/uk1Gch9dNw+eZrPg2W0olMuD1AtzuqMn6G7JphGK3JZwVfFK04BFI+Y2NY5rX+LY0J/M9NScBXKmUNLvs/qA8OUJgj/QqRg4+WYyMIZjRtVZzcxq9UfF1BLcVFwCqRInl1dirX3USWqa5GAtKi/NhIIjgUk3+g0Pcx/RL9InwF6juZfLSZkpQ0wn66BV6TVXXy0BUAct57UtVgUs66EnhVJ8JNohamxMLM0vwxD0m7PXL8IhAu0jgz7JWUqQhOBhZLUfZKoUAwVQCGSXJYl0uZJijbhCwoZ8w1d330s9HZuTokTc7usiZN1u0vnbhiqC2cASCpvD2KPAnhmuNgCgl6FRSU/L+1JrkC5fsqQC59VJDkweF323mpTEtvrtHMkntWmfI10UbRNVXSkaIJZ2GUaNRRE6+VwYQ5QCmI6M1Bh0xqaLRTWuSETOU8lYBIXKK0x5oq3R3zWsiBzWtLIDxc2GljhuovlLLE/gV36Xk6Q0kuzJA0SvMqQm0aaJYDHfQnm6XJtVgYZNfjmtSUFdSZIIc+6K0wD1e01pzqoa5QVxkkCIKr34vR2jKRBh5Mdxl5e8XrEem4aeEtFKFPC39iUcuCul8B/xY3r0VYRGWPzzZMo5RAEIP1tv60zWgFTmA34HqbX8UtmGSDPiDzzhlaP8g3ZWRitW/6L4dlJ0/MZeRUkUYYO8lX2XL6tAAt6AgoTJwo0vQxVb7ounDUnxVNeuuQn1yCUiSjnbmFk45GXmSNmg8hWXZI2N7HxuGhdnG4W0egv2i27tzHf6fU9uCgEDYnrbj7+kyV5cvJz5OE8scxa92PixK1DB4g0/5P5eQbN07umVg+vk0/7/0jGuPQc4+xPfRKpizbNg07JMQJmMjgYqW6iyw5F2wGSBBa4LvNW3wX7EwlMZ2pOFE2Na3xhZwq/TqHdvcWIvrE8yrq/BsvKbasVuZCKg5Z28nm4W3OH5aFW9Dc+Fs7YShtf+CkHHcn4yWJcLCxcHBG7CkFWbZ/ufW6MDu6xV1n5VyZdlbcAATUkTsQ4t3C5LI3B+NQIyOlflYB6f31CbT7Eu849aIL8Nf9kRFaKaN+muSNEVAUWmBNriNCUVDKdyradvWWlU8tU6h9AJSMgDN2QSALOTGorZTLXBcOJyd+3S3K2K+7cL2eMmF7Yjfj+79NhY5GN3PE8br5Of8vIZVZmU0cyQ/yQoyPhlqm0uwBTtGbYq2YcI45A9hFgNFG4gHPJK4BN8oBTt1V+l1PedBKJVuc3TabLApEu+Aj8u3QmHBQAJY9b0Yqm/DpV8yx0Wxx4G7k4YGGZ4OIX+x67kQ8ALY2vfiRBBOB/AqFhlT2Ja2oGNY6+78hqPqky2GBVZd6iNZCpVxO/rxv66XF5ktWedCsj3U5acFUUbIqqQA8JCl7hsRmKDxhsCCCnFXq6U4pnTuTXSD3km2MaoBUbp2qLF3ixJ3gdt/uzS3HVSkR5y7BbWURIwgtsIK31mB3tS3B0vUZlsl2Kb9oxq+m4MZ+iKIkC58ekCDhbd8m7k8DNNJij+a4H0FKHTS6z09u2BObTmorCsKtW6FVYgjzPuVQJpDt72GlWXxQCOhWt7C1EAdBqV2htgQvffsGkWRqSM3GtoU0isOS/5xXfvlxKrWkdi+WT3G4eHckbHbT20Ef7UeLGEPFvfy2KqcqMZMx8rRXNTi/rXSDe6UNfitb9Mt5uYT4Smc+G77ODHsAQF2GRCaf7qFCvs03yft/P2eJDAWVLQ2iabG/4I6vUcEtVOuWSaeLk/bGSmm4xfi/xBjMN9An5rhyVpGgQHQ9MKK9oKWdi52h2vUIJSkMnwCtfZ2UqeCx3bfZj4yysiXkpMXLH30IyOq0cil7pcirAPn4L/NHcOseKcI3jdWJcwkjAgiT5ravRLrld0LkYt3hh9ycziaamiVdEH24+wOyP2QF8hLCcTXLBs8U3BnXXQNVzy6WdlBJVg0fBZwLd3nlso7BBYhR67d37LULA42R1EG1BtcAwJPm8ItqCLecs5NdfCAKf+jtZpMwyQeTebbcXARoFQGvTFdwLe7jhO30Gf4LoUmJR948yg+QRbb5xocVlVQ/jdCPuRRoryMRPvBKLTp60jU9OYlp02QFTMwFYcXAJoTV+H5+Yf/kQpUCNA6PKzZ1Q1lMBl6vy+NldoIIf4eu7QekaaasEWnpWTcwHmDf24Oiy4D+s//Q7RaBbB+kt6kvucWESB6FOcLxU2h3flTPQ4mJqVufaHJRMVUXNK7xfsnfGqA1lcMTHE9OmA2hWcwXYbqSZAxc5PIjEeZEUBIWj8qsP/DYxfUpeEMV6XZnVbpRYSvkdvl1c3MaZnbACbVMGYmRQCCtztJI0ta2UAytf2iHSmHMmacKH45yr8Z2uIadBO7hp652kzZd/OGoCS/HVmMRHMzAh7rdAljXAIQ5YXWfUHO6pBlBbf9Yet2yH3BavexFj+HN4T7yWzOPsO5M7MQ3mYct3+OBymkx/gK890JzdCIGO+6m8DaD+Dpj7+cLxWZ5JP9O72hm3VVtZBzMoaxZPbLxT4DxIl5XngN5aG8BiV7xaUChNAfNXdgYqYXEg0LjeYrEDDuW6Rjz1WoTxYPSaD8jXOGycOiwdAJ+vRJjcmijtamgI6GbBaPoqQODijIq7nWiKCheB+erjm+ZL6FOwO8BBGhJyEmgTPTWTuCzUZq4gYdH0CTFFb6Pk1eCy/DXN9p5hpvBGAE="},"thinkingStyle":1,"thinkingDurationMs":14658},"bubbleId":"586edc8f-6433-467b-87c3-874f439ffd70"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"60b16488-96b1-43e5-98a1-da8fa6f8d454","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:34:48.938Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","capabilityType":15,"toolFormerData":{"tool":40,"toolIndex":1,"modelCallId":"15279199-0e5d-402b-bfdd-6e6fff2a3bbf","toolCallId":"toolu_01NkQP7sHnD76gaGdw1xP8JX","status":"completed","rawArgs":"{\"target_file\": \"templates/network/Invoke-NetworkForensics-v7.ps1\"}","name":"read_file","params":"{\"targetFile\":\"templates/network/Invoke-NetworkForensics-v7.ps1\",\"charsLimit\":100000,\"effectiveUri\":\"file:///c%3A/Users/user/Downloads/Cursor_working_directory_misc/templates/network/Invoke-NetworkForensics-v7.ps1\"}","additionalData":{},"result":"{\"contents\":\"#Requires -Version 7.0\\r\\n\u003c#\\r\\n.SYNOPSIS\\r\\n    Network forensics data collection and analysis tool.\\r\\n\\r\\n.DESCRIPTION\\r\\n    Collects network state, connection information, routing tables,\\r\\n    ARP cache, DNS cache, and firewall rules for forensic analysis.\\r\\n    Identifies anomalies and potential indicators of compromise.\\r\\n\\r\\n.PARAMETER ConfigFile\\r\\n    Path to network.cfg configuration file.\\r\\n\\r\\n.PARAMETER OutputPath\\r\\n    Directory for forensic data collection.\\r\\n\\r\\n.PARAMETER Full\\r\\n    Perform full collection including event logs.\\r\\n\\r\\n.PARAMETER Analyze\\r\\n    Run analysis on existing collection.\\r\\n\\r\\n.EXAMPLE\\r\\n    .\\\\Invoke-NetworkForensics-v7.ps1 -OutputPath .\\\\forensics\\r\\n    .\\\\Invoke-NetworkForensics-v7.ps1 -Full -OutputPath .\\\\forensics\\r\\n\\r\\n.NOTES\\r\\n    License: BSD-2-Clause\\r\\n    Requires: PowerShell 7+, Administrator privileges recommended\\r\\n    Signed-off-by: Network Diagnostics Toolkit\\r\\n#\u003e\\r\\n\\r\\n[CmdletBinding()]\\r\\nparam(\\r\\n    [Parameter()]\\r\\n    [string]$ConfigFile,\\r\\n\\r\\n    [Parameter()]\\r\\n    [string]$OutputPath = \\\".\\\\network-forensics\\\",\\r\\n\\r\\n    [Parameter()]\\r\\n    [switch]$Full,\\r\\n\\r\\n    [Parameter()]\\r\\n    [switch]$Analyze\\r\\n)\\r\\n\\r\\nSet-StrictMode -Version Latest\\r\\n$ErrorActionPreference = \u0027Continue\u0027\\r\\n\\r\\n#region Utility Functions\\r\\n\\r\\nfunction Write-Section {\\r\\n    param([string]$Title)\\r\\n    Write-Host \\\"\\\"\\r\\n    Write-Host (\\\"=\\\" * 60) -ForegroundColor Cyan\\r\\n    Write-Host \\\" $Title\\\" -ForegroundColor Cyan\\r\\n    Write-Host (\\\"=\\\" * 60) -ForegroundColor Cyan\\r\\n}\\r\\n\\r\\nfunction Write-SubSection {\\r\\n    param([string]$Title)\\r\\n    Write-Host \\\"\\\"\\r\\n    Write-Host \\\"[*] $Title\\\" -ForegroundColor Yellow\\r\\n    Write-Host (\\\"-\\\" * 50)\\r\\n}\\r\\n\\r\\nfunction Save-ForensicData {\\r\\n    param(\\r\\n        [string]$Category,\\r\\n        [string]$Name,\\r\\n        [object]$Data,\\r\\n        [string]$BaseDir\\r\\n    )\\r\\n\\r\\n    $categoryDir = Join-Path $BaseDir $Category\\r\\n    if (-not (Test-Path $categoryDir)) {\\r\\n        New-Item -ItemType Directory -Path $categoryDir -Force | Out-Null\\r\\n    }\\r\\n\\r\\n    $jsonPath = Join-Path $categoryDir \\\"$Name.json\\\"\\r\\n    $Data | ConvertTo-Json -Depth 10 | Set-Content $jsonPath -Encoding UTF8\\r\\n\\r\\n    return $jsonPath\\r\\n}\\r\\n\\r\\n#endregion\\r\\n\\r\\n#region Collection Functions\\r\\n\\r\\nfunction Get-NetworkConnections {\\r\\n    Write-SubSection \\\"Active Network Connections\\\"\\r\\n\\r\\n    $connections = Get-NetTCPConnection -ErrorAction SilentlyContinue | ForEach-Object {\\r\\n        $process = Get-Process -Id $_.OwningProcess -ErrorAction SilentlyContinue\\r\\n        [PSCustomObject]@{\\r\\n            LocalAddress = $_.LocalAddress\\r\\n            LocalPort = $_.LocalPort\\r\\n            RemoteAddress = $_.RemoteAddress\\r\\n            RemotePort = $_.RemotePort\\r\\n            State = $_.State\\r\\n            ProcessId = $_.OwningProcess\\r\\n            ProcessName = $process.ProcessName\\r\\n            ProcessPath = $process.Path\\r\\n        }\\r\\n    }\\r\\n\\r\\n    # Identify suspicious connections\\r\\n    $suspicious = @()\\r\\n    foreach ($conn in $connections) {\\r\\n        # Check for connections to unusual ports from system processes\\r\\n        if ($conn.ProcessName -in @(\u0027svchost\u0027, \u0027lsass\u0027, \u0027csrss\u0027) -and\\r\\n            $conn.RemotePort -notin @(80, 443, 53, 123, 389, 636)) {\\r\\n            $suspicious += [PSCustomObject]@{\\r\\n                Type = \\\"SystemProcessUnusualPort\\\"\\r\\n                Connection = $conn\\r\\n                Reason = \\\"System process connecting to non-standard port\\\"\\r\\n            }\\r\\n        }\\r\\n\\r\\n        # Check for connections on known malware ports\\r\\n        $malwarePorts = @(4444, 5555, 6666, 7777, 1337, 31337, 12345, 54321)\\r\\n        if ($conn.RemotePort -in $malwarePorts -or $conn.LocalPort -in $malwarePorts) {\\r\\n            $suspicious += [PSCustomObject]@{\\r\\n                Type = \\\"SuspiciousPort\\\"\\r\\n                Connection = $conn\\r\\n                Reason = \\\"Connection on known malware port\\\"\\r\\n            }\\r\\n        }\\r\\n    }\\r\\n\\r\\n    $established = $connections | Where-Object { $_.State -eq \u0027Established\u0027 }\\r\\n    $listening = $connections | Where-Object { $_.State -eq \u0027Listen\u0027 }\\r\\n\\r\\n    Write-Host \\\"  Total connections: $($connections.Count)\\\"\\r\\n    Write-Host \\\"  Established: $($established.Count)\\\"\\r\\n    Write-Host \\\"  Listening: $($listening.Count)\\\"\\r\\n    Write-Host \\\"  Suspicious: $($suspicious.Count)\\\" -ForegroundColor $(if ($suspicious.Count -gt 0) { \u0027Red\u0027 } else { \u0027Green\u0027 })\\r\\n\\r\\n    return [PSCustomObject]@{\\r\\n        Connections = $connections\\r\\n        Established = $established\\r\\n        Listening = $listening\\r\\n        Suspicious = $suspicious\\r\\n        CollectedAt = Get-Date -Format \\\"o\\\"\\r\\n    }\\r\\n}\\r\\n\\r\\nfunction Get-NetworkInterfaces {\\r\\n    Write-SubSection \\\"Network Interfaces\\\"\\r\\n\\r\\n    $adapters = Get-NetAdapter -ErrorAction SilentlyContinue | ForEach-Object {\\r\\n        $ipConfig = Get-NetIPConfiguration -InterfaceIndex $_.ifIndex -ErrorAction SilentlyContinue\\r\\n        $dnsServers = (Get-DnsClientServerAddress -InterfaceIndex $_.ifIndex -ErrorAction SilentlyContinue).ServerAddresses\\r\\n\\r\\n        [PSCustomObject]@{\\r\\n            Name = $_.Name\\r\\n            Description = $_.InterfaceDescription\\r\\n            Status = $_.Status\\r\\n            MacAddress = $_.MacAddress\\r\\n            LinkSpeed = $_.LinkSpeed\\r\\n            MediaType = $_.MediaType\\r\\n            IPv4Address = $ipConfig.IPv4Address.IPAddress\\r\\n            IPv4Gateway = $ipConfig.IPv4DefaultGateway.NextHop\\r\\n            IPv6Address = $ipConfig.IPv6Address.IPAddress\\r\\n            DnsServers = $dnsServers\\r\\n            PromiscuousMode = $_.PromiscuousMode\\r\\n        }\\r\\n    }\\r\\n\\r\\n    # Check for promiscuous mode (packet sniffing indicator)\\r\\n    $promiscuous = $adapters | Where-Object { $_.PromiscuousMode -eq $true }\\r\\n    if ($promiscuous) {\\r\\n        Write-Host \\\"  [!] WARNING: Promiscuous mode detected on: $($promiscuous.Name -join \u0027, \u0027)\\\" -ForegroundColor Red\\r\\n    }\\r\\n\\r\\n    Write-Host \\\"  Active adapters: $(($adapters | Where-Object { $_.Status -eq \u0027Up\u0027 }).Count)\\\"\\r\\n\\r\\n    return [PSCustomObject]@{\\r\\n        Adapters = $adapters\\r\\n        PromiscuousAdapters = $promiscuous\\r\\n        CollectedAt = Get-Date -Format \\\"o\\\"\\r\\n    }\\r\\n}\\r\\n\\r\\nfunction Get-ArpCache {\\r\\n    Write-SubSection \\\"ARP Cache\\\"\\r\\n\\r\\n    $arp = Get-NetNeighbor -ErrorAction SilentlyContinue | Where-Object { $_.State -ne \u0027Permanent\u0027 } | ForEach-Object {\\r\\n        [PSCustomObject]@{\\r\\n            IPAddress = $_.IPAddress\\r\\n            LinkLayerAddress = $_.LinkLayerAddress\\r\\n            State = $_.State\\r\\n            InterfaceAlias = $_.InterfaceAlias\\r\\n        }\\r\\n    }\\r\\n\\r\\n    # Detect ARP spoofing - multiple IPs with same MAC (excluding multicast)\\r\\n    $macGroups = $arp | Where-Object { $_.LinkLayerAddress -and $_.LinkLayerAddress -notmatch \u0027^(01-00-5E|33-33)\u0027 } |\\r\\n        Group-Object LinkLayerAddress | Where-Object { $_.Count -gt 1 }\\r\\n\\r\\n    $spoofIndicators = @()\\r\\n    foreach ($group in $macGroups) {\\r\\n        $ips = $group.Group.IPAddress\\r\\n        # Filter out link-local addresses\\r\\n        $nonLinkLocal = $ips | Where-Object { $_ -notmatch \u0027^(169\\\\.254\\\\.|fe80:)\u0027 }\\r\\n        if ($nonLinkLocal.Count -gt 1) {\\r\\n            $spoofIndicators += [PSCustomObject]@{\\r\\n                Mac = $group.Name\\r\\n                IPs = $nonLinkLocal\\r\\n                Reason = \\\"Multiple IPs using same MAC address\\\"\\r\\n            }\\r\\n        }\\r\\n    }\\r\\n\\r\\n    Write-Host \\\"  ARP entries: $($arp.Count)\\\"\\r\\n    if ($spoofIndicators.Count -gt 0) {\\r\\n        Write-Host \\\"  [!] POTENTIAL ARP SPOOFING DETECTED\\\" -ForegroundColor Red\\r\\n        foreach ($indicator in $spoofIndicators) {\\r\\n            Write-Host \\\"      MAC $($indicator.Mac) -\u003e $($indicator.IPs -join \u0027, \u0027)\\\" -ForegroundColor Yellow\\r\\n        }\\r\\n    }\\r\\n\\r\\n    return [PSCustomObject]@{\\r\\n        Entries = $arp\\r\\n        SpoofIndicators = $spoofIndicators\\r\\n        CollectedAt = Get-Date -Format \\\"o\\\"\\r\\n    }\\r\\n}\\r\\n\\r\\nfunction Get-DnsCache {\\r\\n    Write-SubSection \\\"DNS Cache\\\"\\r\\n\\r\\n    $cache = Get-DnsClientCache -ErrorAction SilentlyContinue | ForEach-Object {\\r\\n        [PSCustomObject]@{\\r\\n            Entry = $_.Entry\\r\\n            RecordName = $_.RecordName\\r\\n            RecordType = $_.RecordType\\r\\n            Data = $_.Data\\r\\n            TTL = $_.TimeToLive\\r\\n            Section = $_.Section\\r\\n        }\\r\\n    }\\r\\n\\r\\n    # Check for suspicious entries\\r\\n    $suspicious = @()\\r\\n    foreach ($entry in $cache) {\\r\\n        # Check for local domain hijacking\\r\\n        if ($entry.RecordName -match \u0027\\\\.(lan|local|home|internal)$\u0027 -and\\r\\n            $entry.RecordName -notmatch \u0027^(localhost|_)\u0027) {\\r\\n            $suspicious += [PSCustomObject]@{\\r\\n                Entry = $entry\\r\\n                Reason = \\\"Local domain suffix - possible LLMNR/NetBIOS poisoning\\\"\\r\\n            }\\r\\n        }\\r\\n\\r\\n        # Check for bogus IPs\\r\\n        if ($entry.Data -match \u0027^0\\\\.0\\\\.0\\\\.\u0027 -or $entry.Data -eq \u0027127.0.0.1\u0027) {\\r\\n            $suspicious += [PSCustomObject]@{\\r\\n                Entry = $entry\\r\\n                Reason = \\\"Suspicious IP address in cache\\\"\\r\\n            }\\r\\n        }\\r\\n    }\\r\\n\\r\\n    Write-Host \\\"  Cache entries: $($cache.Count)\\\"\\r\\n    Write-Host \\\"  Suspicious entries: $($suspicious.Count)\\\" -ForegroundColor $(if ($suspicious.Count -gt 0) { \u0027Yellow\u0027 } else { \u0027Green\u0027 })\\r\\n\\r\\n    return [PSCustomObject]@{\\r\\n        Entries = $cache\\r\\n        Suspicious = $suspicious\\r\\n        CollectedAt = Get-Date -Format \\\"o\\\"\\r\\n    }\\r\\n}\\r\\n\\r\\nfunction Get-RoutingTable {\\r\\n    Write-SubSection \\\"Routing Table\\\"\\r\\n\\r\\n    $routes = Get-NetRoute -ErrorAction SilentlyContinue | ForEach-Object {\\r\\n        [PSCustomObject]@{\\r\\n            DestinationPrefix = $_.DestinationPrefix\\r\\n            NextHop = $_.NextHop\\r\\n            RouteMetric = $_.RouteMetric\\r\\n            InterfaceAlias = $_.InterfaceAlias\\r\\n            AddressFamily = $_.AddressFamily\\r\\n        }\\r\\n    }\\r\\n\\r\\n    # Check for suspicious routes\\r\\n    $suspicious = @()\\r\\n    $defaultRoutes = $routes | Where-Object { $_.DestinationPrefix -eq \u00270.0.0.0/0\u0027 }\\r\\n    if ($defaultRoutes.Count -gt 1) {\\r\\n        $suspicious += [PSCustomObject]@{\\r\\n            Type = \\\"MultipleDefaultRoutes\\\"\\r\\n            Routes = $defaultRoutes\\r\\n            Reason = \\\"Multiple default gateways - possible route hijacking\\\"\\r\\n        }\\r\\n    }\\r\\n\\r\\n    Write-Host \\\"  Total routes: $($routes.Count)\\\"\\r\\n    Write-Host \\\"  Default routes: $($defaultRoutes.Count)\\\"\\r\\n\\r\\n    return [PSCustomObject]@{\\r\\n        Routes = $routes\\r\\n        DefaultRoutes = $defaultRoutes\\r\\n        Suspicious = $suspicious\\r\\n        CollectedAt = Get-Date -Format \\\"o\\\"\\r\\n    }\\r\\n}\\r\\n\\r\\nfunction Get-ListeningServices {\\r\\n    Write-SubSection \\\"Listening Services\\\"\\r\\n\\r\\n    $listeners = Get-NetTCPConnection -State Listen -ErrorAction SilentlyContinue | ForEach-Object {\\r\\n        $process = Get-Process -Id $_.OwningProcess -ErrorAction SilentlyContinue\\r\\n        [PSCustomObject]@{\\r\\n            LocalAddress = $_.LocalAddress\\r\\n            LocalPort = $_.LocalPort\\r\\n            ProcessId = $_.OwningProcess\\r\\n            ProcessName = $process.ProcessName\\r\\n            ProcessPath = $process.Path\\r\\n            ProcessCompany = $process.Company\\r\\n        }\\r\\n    } | Sort-Object LocalPort\\r\\n\\r\\n    # Flag listeners on all interfaces (0.0.0.0)\\r\\n    $exposed = $listeners | Where-Object { $_.LocalAddress -eq \u00270.0.0.0\u0027 }\\r\\n\\r\\n    Write-Host \\\"  Total listeners: $($listeners.Count)\\\"\\r\\n    Write-Host \\\"  Exposed to all interfaces: $($exposed.Count)\\\"\\r\\n\\r\\n    return [PSCustomObject]@{\\r\\n        Listeners = $listeners\\r\\n        ExposedServices = $exposed\\r\\n        CollectedAt = Get-Date -Format \\\"o\\\"\\r\\n    }\\r\\n}\\r\\n\\r\\nfunction Get-FirewallState {\\r\\n    Write-SubSection \\\"Firewall Configuration\\\"\\r\\n\\r\\n    $profiles = Get-NetFirewallProfile -ErrorAction SilentlyContinue | ForEach-Object {\\r\\n        [PSCustomObject]@{\\r\\n            Name = $_.Name\\r\\n            Enabled = $_.Enabled\\r\\n            DefaultInboundAction = $_.DefaultInboundAction\\r\\n            DefaultOutboundAction = $_.DefaultOutboundAction\\r\\n            AllowInboundRules = $_.AllowInboundRules\\r\\n            LogAllowed = $_.LogAllowed\\r\\n            LogBlocked = $_.LogBlocked\\r\\n        }\\r\\n    }\\r\\n\\r\\n    # Check for disabled firewalls\\r\\n    $disabled = $profiles | Where-Object { -not $_.Enabled }\\r\\n    if ($disabled) {\\r\\n        Write-Host \\\"  [!] WARNING: Firewall disabled on: $($disabled.Name -join \u0027, \u0027)\\\" -ForegroundColor Red\\r\\n    }\\r\\n\\r\\n    # Get recently modified rules\\r\\n    $rules = Get-NetFirewallRule -ErrorAction SilentlyContinue |\\r\\n        Where-Object { $_.Enabled -eq \u0027True\u0027 } |\\r\\n        Select-Object -First 100 Name, DisplayName, Direction, Action, Profile\\r\\n\\r\\n    Write-Host \\\"  Active profiles: $(($profiles | Where-Object { $_.Enabled }).Count) / $($profiles.Count)\\\"\\r\\n    Write-Host \\\"  Enabled rules (sample): $($rules.Count)\\\"\\r\\n\\r\\n    return [PSCustomObject]@{\\r\\n        Profiles = $profiles\\r\\n        DisabledProfiles = $disabled\\r\\n        SampleRules = $rules\\r\\n        CollectedAt = Get-Date -Format \\\"o\\\"\\r\\n    }\\r\\n}\\r\\n\\r\\nfunction Get-RunningProcesses {\\r\\n    Write-SubSection \\\"Network-Active Processes\\\"\\r\\n\\r\\n    $netProcessIds = (Get-NetTCPConnection -ErrorAction SilentlyContinue).OwningProcess | Sort-Object -Unique\\r\\n\\r\\n    $processes = Get-Process -Id $netProcessIds -ErrorAction SilentlyContinue | ForEach-Object {\\r\\n        [PSCustomObject]@{\\r\\n            Id = $_.Id\\r\\n            Name = $_.ProcessName\\r\\n            Path = $_.Path\\r\\n            Company = $_.Company\\r\\n            Description = $_.Description\\r\\n            StartTime = $_.StartTime\\r\\n            CommandLine = (Get-CimInstance Win32_Process -Filter \\\"ProcessId = $($_.Id)\\\" -ErrorAction SilentlyContinue).CommandLine\\r\\n        }\\r\\n    }\\r\\n\\r\\n    # Flag unsigned or suspicious processes\\r\\n    $suspicious = @()\\r\\n    foreach ($proc in $processes) {\\r\\n        if (-not $proc.Path) { continue }\\r\\n\\r\\n        # Check if running from temp directories\\r\\n        if ($proc.Path -match \u0027\\\\\\\\(Temp|tmp|AppData\\\\\\\\Local\\\\\\\\Temp)\\\\\\\\\u0027) {\\r\\n            $suspicious += [PSCustomObject]@{\\r\\n                Process = $proc\\r\\n                Reason = \\\"Running from temporary directory\\\"\\r\\n            }\\r\\n        }\\r\\n\\r\\n        # Check for no company info (could be unsigned)\\r\\n        if (-not $proc.Company -and $proc.Path -notmatch \u0027\\\\\\\\Windows\\\\\\\\\u0027) {\\r\\n            $suspicious += [PSCustomObject]@{\\r\\n                Process = $proc\\r\\n                Reason = \\\"No company information (possibly unsigned)\\\"\\r\\n            }\\r\\n        }\\r\\n    }\\r\\n\\r\\n    Write-Host \\\"  Network-active processes: $($processes.Count)\\\"\\r\\n    Write-Host \\\"  Suspicious: $($suspicious.Count)\\\" -ForegroundColor $(if ($suspicious.Count -gt 0) { \u0027Yellow\u0027 } else { \u0027Green\u0027 })\\r\\n\\r\\n    return [PSCustomObject]@{\\r\\n        Processes = $processes\\r\\n        Suspicious = $suspicious\\r\\n        CollectedAt = Get-Date -Format \\\"o\\\"\\r\\n    }\\r\\n}\\r\\n\\r\\nfunction Get-HostsFile {\\r\\n    Write-SubSection \\\"Hosts File\\\"\\r\\n\\r\\n    $hostsPath = \\\"$env:SystemRoot\\\\System32\\\\drivers\\\\etc\\\\hosts\\\"\\r\\n    $content = Get-Content $hostsPath -ErrorAction SilentlyContinue\\r\\n\\r\\n    $entries = @()\\r\\n    $suspicious = @()\\r\\n\\r\\n    foreach ($line in $content) {\\r\\n        if ($line -match \u0027^\\\\s*#\u0027 -or $line -match \u0027^\\\\s*$\u0027) { continue }\\r\\n\\r\\n        $parts = $line -split \u0027\\\\s+\u0027, 2\\r\\n        if ($parts.Count -ge 2) {\\r\\n            $entry = [PSCustomObject]@{\\r\\n                IP = $parts[0]\\r\\n                Hostnames = $parts[1] -split \u0027\\\\s+\u0027\\r\\n            }\\r\\n            $entries += $entry\\r\\n\\r\\n            # Flag redirects of known services\\r\\n            $sensitiveHosts = @(\u0027google\u0027, \u0027microsoft\u0027, \u0027windows\u0027, \u0027apple\u0027, \u0027github\u0027, \u0027cursor\u0027)\\r\\n            foreach ($host in $entry.Hostnames) {\\r\\n                foreach ($sensitive in $sensitiveHosts) {\\r\\n                    if ($host -match $sensitive -and $entry.IP -notmatch \u0027^(127\\\\.0\\\\.0\\\\.1|::1|0\\\\.0\\\\.0\\\\.0)$\u0027) {\\r\\n                        $suspicious += [PSCustomObject]@{\\r\\n                            Entry = $entry\\r\\n                            Reason = \\\"Potential redirect of $sensitive domain\\\"\\r\\n                        }\\r\\n                    }\\r\\n                }\\r\\n            }\\r\\n        }\\r\\n    }\\r\\n\\r\\n    Write-Host \\\"  Host entries: $($entries.Count)\\\"\\r\\n    Write-Host \\\"  Suspicious redirects: $($suspicious.Count)\\\" -ForegroundColor $(if ($suspicious.Count -gt 0) { \u0027Red\u0027 } else { \u0027Green\u0027 })\\r\\n\\r\\n    return [PSCustomObject]@{\\r\\n        Path = $hostsPath\\r\\n        Entries = $entries\\r\\n        Suspicious = $suspicious\\r\\n        RawContent = $content\\r\\n        CollectedAt = Get-Date -Format \\\"o\\\"\\r\\n    }\\r\\n}\\r\\n\\r\\n#endregion\\r\\n\\r\\n#region Main Execution\\r\\n\\r\\nWrite-Section \\\"NETWORK FORENSICS COLLECTION\\\"\\r\\nWrite-Host \\\"Timestamp: $(Get-Date -Format \u0027yyyy-MM-dd HH:mm:ss\u0027)\\\"\\r\\nWrite-Host \\\"Output Directory: $OutputPath\\\"\\r\\n\\r\\n# Create output directory\\r\\nif (-not (Test-Path $OutputPath)) {\\r\\n    New-Item -ItemType Directory -Path $OutputPath -Force | Out-Null\\r\\n}\\r\\n\\r\\n$collectionStart = Get-Date\\r\\n$allFindings = @()\\r\\n\\r\\n# Collect data\\r\\n$connections = Get-NetworkConnections\\r\\nSave-ForensicData -Category \\\"network\\\" -Name \\\"connections\\\" -Data $connections -BaseDir $OutputPath\\r\\n$allFindings += $connections.Suspicious\\r\\n\\r\\n$interfaces = Get-NetworkInterfaces\\r\\nSave-ForensicData -Category \\\"network\\\" -Name \\\"interfaces\\\" -Data $interfaces -BaseDir $OutputPath\\r\\n\\r\\n$arpCache = Get-ArpCache\\r\\nSave-ForensicData -Category \\\"network\\\" -Name \\\"arp-cache\\\" -Data $arpCache -BaseDir $OutputPath\\r\\n$allFindings += $arpCache.SpoofIndicators\\r\\n\\r\\n$dnsCache = Get-DnsCache\\r\\nSave-ForensicData -Category \\\"dns\\\" -Name \\\"cache\\\" -Data $dnsCache -BaseDir $OutputPath\\r\\n$allFindings += $dnsCache.Suspicious\\r\\n\\r\\n$routes = Get-RoutingTable\\r\\nSave-ForensicData -Category \\\"network\\\" -Name \\\"routes\\\" -Data $routes -BaseDir $OutputPath\\r\\n$allFindings += $routes.Suspicious\\r\\n\\r\\n$listeners = Get-ListeningServices\\r\\nSave-ForensicData -Category \\\"network\\\" -Name \\\"listeners\\\" -Data $listeners -BaseDir $OutputPath\\r\\n\\r\\n$firewall = Get-FirewallState\\r\\nSave-ForensicData -Category \\\"security\\\" -Name \\\"firewall\\\" -Data $firewall -BaseDir $OutputPath\\r\\n\\r\\n$processes = Get-RunningProcesses\\r\\nSave-ForensicData -Category \\\"processes\\\" -Name \\\"network-processes\\\" -Data $processes -BaseDir $OutputPath\\r\\n$allFindings += $processes.Suspicious\\r\\n\\r\\n$hosts = Get-HostsFile\\r\\nSave-ForensicData -Category \\\"dns\\\" -Name \\\"hosts-file\\\" -Data $hosts -BaseDir $OutputPath\\r\\n$allFindings += $hosts.Suspicious\\r\\n\\r\\n$collectionEnd = Get-Date\\r\\n\\r\\n# Summary\\r\\nWrite-Section \\\"COLLECTION SUMMARY\\\"\\r\\n\\r\\n$summary = [PSCustomObject]@{\\r\\n    CollectionStart = $collectionStart.ToString(\\\"o\\\")\\r\\n    CollectionEnd = $collectionEnd.ToString(\\\"o\\\")\\r\\n    DurationSeconds = ($collectionEnd - $collectionStart).TotalSeconds\\r\\n    TotalConnections = $connections.Connections.Count\\r\\n    EstablishedConnections = $connections.Established.Count\\r\\n    ListeningPorts = $listeners.Listeners.Count\\r\\n    ArpEntries = $arpCache.Entries.Count\\r\\n    DnsCacheEntries = $dnsCache.Entries.Count\\r\\n    NetworkProcesses = $processes.Processes.Count\\r\\n    TotalFindings = $allFindings.Count\\r\\n    Findings = $allFindings\\r\\n}\\r\\n\\r\\nSave-ForensicData -Category \\\".\\\" -Name \\\"summary\\\" -Data $summary -BaseDir $OutputPath\\r\\n\\r\\nWrite-Host \\\"Collection completed in $([math]::Round($summary.DurationSeconds, 2)) seconds\\\"\\r\\nWrite-Host \\\"\\\"\\r\\nWrite-Host \\\"Data collected:\\\"\\r\\nWrite-Host \\\"  - Connections: $($summary.TotalConnections) ($($summary.EstablishedConnections) established)\\\"\\r\\nWrite-Host \\\"  - Listening ports: $($summary.ListeningPorts)\\\"\\r\\nWrite-Host \\\"  - ARP entries: $($summary.ArpEntries)\\\"\\r\\nWrite-Host \\\"  - DNS cache: $($summary.DnsCacheEntries)\\\"\\r\\nWrite-Host \\\"  - Network processes: $($summary.NetworkProcesses)\\\"\\r\\nWrite-Host \\\"\\\"\\r\\n\\r\\nif ($allFindings.Count -gt 0) {\\r\\n    Write-Host \\\"FINDINGS ($($allFindings.Count)):\\\" -ForegroundColor Red\\r\\n    foreach ($finding in $allFindings | Select-Object -First 10) {\\r\\n        Write-Host \\\"  - $($finding.Reason)\\\" -ForegroundColor Yellow\\r\\n    }\\r\\n    if ($allFindings.Count -gt 10) {\\r\\n        Write-Host \\\"  ... and $($allFindings.Count - 10) more (see summary.json)\\\" -ForegroundColor Yellow\\r\\n    }\\r\\n} else {\\r\\n    Write-Host \\\"No suspicious findings detected.\\\" -ForegroundColor Green\\r\\n}\\r\\n\\r\\nWrite-Host \\\"\\\"\\r\\nWrite-Host \\\"Results saved to: $OutputPath\\\" -ForegroundColor Cyan\\r\\n\\r\\n#endregion\\r\\n\\r\\n\",\"numCharactersInRequestedRange\":19640,\"totalLinesInFile\":570}"}},"bubbleId":"60b16488-96b1-43e5-98a1-da8fa6f8d454"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"60b443b2-ccbb-4569-818a-1970206d8126","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:40:34.690Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"text":"","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","codeBlocks":[{"uri":{"scheme":"file","authority":"","path":"/c:/Users/user/Downloads/Cursor_working_directory_misc/templates/network/README.md","query":"","fragment":"","_formatted":"file:///c%3A/Users/user/Downloads/Cursor_working_directory_misc/templates/network/README.md","_fsPath":null},"codeblockId":"57db5d0a-79c4-4063-93e3-ba08de30dc74","codeBlockIdx":0,"content":"# Network Diagnostics Toolkit\n\nNetwork scanning, DNS diagnostics, forensics collection, and Infrastructure MITM detection tools.\n\n## Scripts\n\n| Script | Platform | Purpose |\n|--------|----------|---------|\n| `Invoke-NetworkScan-v7.ps1` | Windows (PS7) | TCP port scanner with service detection |\n| `Invoke-DnsDiagnostics-v7.ps1` | Windows (PS7) | DNS anomaly detection and consistency checks |\n| `Invoke-NetworkForensics-v7.ps1` | Windows (PS7) | Forensic data collection and analysis |\n| `Invoke-MitmAudit-v7.ps1` | Windows (PS7) | Infrastructure MITM detection with ASN/DoH/Cert analysis |\n| `Invoke-BackgroundDiagnostics-v7.ps1` | Windows (PS7) | Background wrapper for all diagnostics |\n| `network-scan.sh` | POSIX | TCP port scanner |\n| `dns-diagnostics.sh` | POSIX | DNS testing and anomaly detection |\n| `network-forensics.sh` | POSIX | Forensic data collection |\n| `mitm-audit.sh` | POSIX | Infrastructure MITM detection with ASN/DoH/Cert analysis |\n| `Invoke-PacketCapture-v7.ps1` | Windows (PS7) | Packet capture with pktmon (full detail, timestamps) |\n| `packet-capture.sh` | POSIX | Packet capture with tcpdump (full detail, timestamps) |\n\n## Configuration\n\n### Network Diagnostics (`network.cfg`)\n\n```\nTARGET_HOST=192.168.1.1\nTARGET_NETWORK=192.168.1.0/24\nSCAN_PORTS=21,22,23,25,53,80,443,445,3389,8080,8443\nDNS_SERVERS=1.1.1.1,8.8.8.8,9.9.9.9\nDNS_TEST_DOMAINS=api2.cursor.sh,github.com,google.com\nSCAN_TIMEOUT_MS=500\nOUTPUT_DIR=./network-diagnostics\n\n# Packet capture settings\nCAPTURE_SNAPLEN=0\nCAPTURE_MAX_SIZE_MB=512\nCAPTURE_ROTATE_COUNT=10\nCAPTURE_TIMESTAMP_PRECISION=nano\nCAPTURE_CONVERT_PCAPNG=true\n```\n\n### MITM Audit (`mitm-audit.cfg`)\n\n```\n# Target domains (high-value auth endpoints)\nTARGETS=accounts.google.com,login.microsoftonline.com,appleid.apple.com,aws.amazon.com,github.com\n\n# DNS-over-HTTPS endpoint (control group)\nDOH_ENDPOINT=https://dns.google/resolve\n\n# ASN lookup service\nASN_LOOKUP_URL=http://ip-api.com/json\nASN_LOOKUP_TIMEOUT_SEC=3\n\n# Expected ISP patterns (optional - leave empty to skip)\nEXPECTED_ISP_PATTERNS=Vyve,Eagle,Lumen\n\n# Suspicious ASN patterns (VPS providers that should NOT serve auth traffic)\nSUSPICIOUS_ASN_PATTERNS=DigitalOcean,Linode,Vultr,Choopa,Datacamp,OVH,Hetzner\n\n# Suspicious certificate issuers for major tech companies\nSUSPICIOUS_CERT_ISSUERS=Let\u0027s Encrypt,ZeroSSL,Self-Signed,localhost\n\n# Enable/disable phases\nTRACEROUTE_ENABLED=true\nEXPORT_ROOT_CA=true\nCHECK_PROXY_SETTINGS=true\nCHECK_BROWSER_EXTENSIONS=true\nCHECK_HOSTS_FILE=true\nCHECK_ROOT_CA_ANOMALIES=true\n```\n\n## Usage Examples\n\n### Network Scanning\n\n```powershell\n# Windows - Scan single host\n.\\Invoke-NetworkScan-v7.ps1 -Target 192.168.1.1 -Ports \"22,80,443\"\n\n# Windows - Use config file\n.\\Invoke-NetworkScan-v7.ps1 -ConfigFile .\\network.cfg\n\n# Unix\n./network-scan.sh -t 192.168.1.1 -p \"22,80,443\"\n```\n\n### DNS Diagnostics\n\n```powershell\n# Windows - Test specific domain\n.\\Invoke-DnsDiagnostics-v7.ps1 -Domain api2.cursor.sh\n\n# Windows - Full diagnostics with config\n.\\Invoke-DnsDiagnostics-v7.ps1 -ConfigFile .\\network.cfg -OutputPath .\\results\n\n# Unix\n./dns-diagnostics.sh -d api2.cursor.sh -s \"1.1.1.1,8.8.8.8\"\n```\n\n### Network Forensics\n\n```powershell\n# Windows - Full collection\n.\\Invoke-NetworkForensics-v7.ps1 -OutputPath .\\forensics\n\n# Unix\n./network-forensics.sh -o ./forensics\n```\n\n### Background Execution (for Agent/Automation)\n\nFor scripts that may run indefinitely or timeout in agent sessions:\n\n```powershell\n# Windows - Run any diagnostic in background\n.\\Invoke-BackgroundDiagnostics-v7.ps1 -Script NetworkForensics -OutputPath .\\results\n.\\Invoke-BackgroundDiagnostics-v7.ps1 -Script DnsDiagnostics -WaitSeconds 30\n.\\Invoke-BackgroundDiagnostics-v7.ps1 -Script PacketCapture -ScriptArgs @{Duration=60}\n\n# Check status\nGet-Content .\\results\\*-status.json\n\n# Read output when complete\nGet-Content .\\results\\*-stdout.txt\n```\n\n```sh\n# Unix - Use nohup for background\nnohup ./network-forensics.sh -o ./results \u003e forensics.log 2\u003e\u00261 \u0026\n\n# Check later\ncat forensics.log\n```\n\n### Infrastructure MITM Audit\n\nDetects infrastructure-side Man-in-the-Middle attacks while ruling out client-side exploits. Uses `mitm-audit.cfg`.\n\n```powershell\n# Windows - Full MITM audit\n.\\Invoke-MitmAudit-v7.ps1\n\n# Windows - With custom config\n.\\Invoke-MitmAudit-v7.ps1 -ConfigFile .\\mitm-audit.cfg\n\n# Windows - Custom targets, skip traceroute\n.\\Invoke-MitmAudit-v7.ps1 -Targets \"accounts.google.com,github.com\" -SkipTraceroute\n\n# Unix\n./mitm-audit.sh\n\n# Unix - With options\n./mitm-audit.sh -c ./mitm-audit.cfg -t \"accounts.google.com,github.com\" --skip-traceroute\n```\n\n#### MITM Detection Capabilities\n\n- **ASN Integrity**: Verifies Google/Microsoft/Apple/Amazon/GitHub resolve to their ASNs\n- **DoH Comparison**: Compares local DNS to DNS-over-HTTPS (dns.google) as control group\n- **Certificate Analysis**: Captures TLS certs, detects anomalous issuers for major tech\n- **Root CA Audit**: Exports trust store, detects enterprise MITM tools and suspicious CAs\n- **Traceroute Mapping**: Identifies suspicious hops through VPS providers\n- **Client-Side Checks**: Proxy settings, browser extensions, hosts file tampering\n\n#### Evidence Processing\n\n1. Check `_RedFlags.txt` first - if empty, MITM may be passive/logging only\n2. Certificate Serial Check - copy serial to [crt.sh](https://crt.sh) on clean device:\n   - \"No certificates found\" = 100% MITM by private root CA\n   - Cert shown for different domain = collision/hash attack or mis-issuance\n3. Zip evidence folder, hash the zip for chain of custody\n\n#### Output Structure\n\n```\nForensicEvidence_YYYYMMDD_HHMMSS/\n  _AuditLog.txt          # Full audit log\n  _RedFlags.txt          # Immediate alerts (check this first)\n  _FileHashes.json       # SHA256 hashes for chain of custody\n  Summary.json           # Audit verdict and configuration\n  environment/\n    NetworkConfig.json   # IP/DNS configuration\n    ExternalIP.json      # External IP and ISP info\n    SystemInfo.json      # System identification\n  trust-store/\n    RootStore_Dump.csv   # All root CAs (Windows)\n    RootCA_Snapshot.crt  # CA bundle (Linux/macOS)\n    RootCA_Hash.json     # Hash of CA store\n    SuspiciousCAs.json   # Flagged certificates\n  targets/\n    accounts_google_com/\n      Analysis.json      # Full analysis results\n      Certificate.json   # TLS certificate details\n      dns.txt            # DNS resolution data\n    (... other targets ...)\n  traceroute/\n    Trace_*.txt          # Raw traceroute output\n    Trace_*.json         # Hops with ASN lookup\n  client-side/\n    ProxySettings.json   # System/environment proxy\n    HostsFile.json       # /etc/hosts analysis\n    BrowserExtensions.json # Installed extensions\n```\n\n### Packet Capture\n\n```powershell\n# Windows - Capture with pktmon (requires Admin)\n.\\Invoke-PacketCapture-v7.ps1 -Duration 60 -OutputPath .\\captures\n.\\Invoke-PacketCapture-v7.ps1 -Filter \"port 443\" -Duration 30 -ConvertToPcap\n\n# Unix - Capture with tcpdump (requires root/sudo)\n./packet-capture.sh -i eth0 -d 60 -o ./captures\n./packet-capture.sh -f \"port 443 or port 80\" -d 30\n./packet-capture.sh -i any -f \"host 192.168.1.1\" -d 120\n```\n\n#### Capture Options\n\n**Windows (pktmon):**\n- Full packet capture (no truncation)\n- All network components\n- ETL format with optional PCAPNG conversion\n- Timestamp precision to nanoseconds\n\n**Unix (tcpdump):**\n- `-XX` Hex and ASCII dump\n- `-vvv` Maximum verbosity\n- `-tttt` Human-readable timestamps with date\n- `-S` Absolute sequence numbers\n- `--time-stamp-precision=nano` Nanosecond precision (if supported)\n- File rotation support\n\n## Detection Capabilities\n\n### DNS Diagnostics\n\n- DNS hijacking (fake IPs like 0.0.0.x)\n- LLMNR/NetBIOS poisoning (.lan/.local suffixes)\n- DNS response inconsistencies across servers\n- Temporary resolution failures (EAI_AGAIN)\n\n### Network Forensics\n\n- ARP spoofing (duplicate MAC addresses)\n- Suspicious listening ports\n- Malware C2 ports (4444, 5555, 31337, etc.)\n- Hosts file tampering\n- Firewall state analysis\n- Promiscuous mode detection\n\n### Infrastructure MITM Audit\n\n- **ASN Mismatch Detection**: Google domains not resolving to Google ASN, etc.\n- **VPS Provider Alert**: Auth traffic routed through DigitalOcean/Linode/Vultr/etc.\n- **DoH vs Local DNS Comparison**: Detects DNS manipulation at ISP/network level\n- **Certificate Anomalies**: Major tech domains with Let\u0027s Encrypt/ZeroSSL certs\n- **Enterprise MITM Tools**: Zscaler, BlueCoat, Forcepoint in root CA store\n- **Recently Added Root CAs**: Certs added within last 30 days flagged\n- **Suspicious Traceroute Hops**: Traffic routed through unexpected providers\n- **Client-Side Exploit Ruling Out**: Proxy, browser extensions, hosts file checks\n\n## Output Format\n\nAll tools output JSON files for programmatic analysis:\n\n```\n./network-diagnostics/\n  scan-2025-12-01_15-00-00.json\n  dns-diagnostics-2025-12-01_15-00-00.json\n\n./network-forensics/\n  summary.json\n  network/\n    connections.json\n    interfaces.json\n    arp-cache.json\n    routes.json\n    listeners.json\n  dns/\n    cache.json\n    hosts-file.json\n  security/\n    firewall.json\n  processes/\n    network-processes.json\n```\n\n## Requirements\n\n### Windows\n\n- PowerShell 7+\n- Administrator privileges recommended for full data collection\n\n### Unix/Linux/macOS\n\n- POSIX-compliant shell\n- One of: dig, nslookup, or host (for DNS)\n- One of: nc (netcat), or bash with /dev/tcp support (for scanning)\n- tcpdump for packet capture\n- root/sudo for packet capture and full forensics collection\n\n## License\n\nBSD-2-Clause\n\n## Signed-off-by\n\nNetwork Diagnostics Toolkit\n\n","languageId":"markdown"}],"capabilityType":15,"toolFormerData":{"tool":38,"toolCallId":"toolu_01YPphLrk7xqRM2NZ4rKTC2E","toolIndex":1,"modelCallId":"482a0b4b-9ee6-48d0-87f9-e72c212fb29f","status":"completed","rawArgs":"{\"file_path\": \"templates/network/README.md\", \"old_string\": \"## Configuration\\n\\nAll scripts use `network.cfg` with KEY=VALUE format:\\n\\n```\\nTARGET_HOST=192.168.1.1\\nTARGET_NETWORK=192.168.1.0/24\\nSCAN_PORTS=21,22,23,25,53,80,443,445,3389,8080,8443\\nDNS_SERVERS=1.1.1.1,8.8.8.8,9.9.9.9\\nDNS_TEST_DOMAINS=api2.cursor.sh,github.com,google.com\\nSCAN_TIMEOUT_MS=500\\nOUTPUT_DIR=./network-diagnostics\\n\\n# Packet capture settings\\nCAPTURE_SNAPLEN=0\\nCAPTURE_MAX_SIZE_MB=512\\nCAPTURE_ROTATE_COUNT=10\\nCAPTURE_TIMESTAMP_PRECISION=nano\\nCAPTURE_CONVERT_PCAPNG=true\\n```\", \"new_string\": \"## Configuration\\n\\n### Network Diagnostics (`network.cfg`)\\n\\n```\\nTARGET_HOST=192.168.1.1\\nTARGET_NETWORK=192.168.1.0/24\\nSCAN_PORTS=21,22,23,25,53,80,443,445,3389,8080,8443\\nDNS_SERVERS=1.1.1.1,8.8.8.8,9.9.9.9\\nDNS_TEST_DOMAINS=api2.cursor.sh,github.com,google.com\\nSCAN_TIMEOUT_MS=500\\nOUTPUT_DIR=./network-diagnostics\\n\\n# Packet capture settings\\nCAPTURE_SNAPLEN=0\\nCAPTURE_MAX_SIZE_MB=512\\nCAPTURE_ROTATE_COUNT=10\\nCAPTURE_TIMESTAMP_PRECISION=nano\\nCAPTURE_CONVERT_PCAPNG=true\\n```\\n\\n### MITM Audit (`mitm-audit.cfg`)\\n\\n```\\n# Target domains (high-value auth endpoints)\\nTARGETS=accounts.google.com,login.microsoftonline.com,appleid.apple.com,aws.amazon.com,github.com\\n\\n# DNS-over-HTTPS endpoint (control group)\\nDOH_ENDPOINT=https://dns.google/resolve\\n\\n# ASN lookup service\\nASN_LOOKUP_URL=http://ip-api.com/json\\nASN_LOOKUP_TIMEOUT_SEC=3\\n\\n# Expected ISP patterns (optional - leave empty to skip)\\nEXPECTED_ISP_PATTERNS=Vyve,Eagle,Lumen\\n\\n# Suspicious ASN patterns (VPS providers that should NOT serve auth traffic)\\nSUSPICIOUS_ASN_PATTERNS=DigitalOcean,Linode,Vultr,Choopa,Datacamp,OVH,Hetzner\\n\\n# Suspicious certificate issuers for major tech companies\\nSUSPICIOUS_CERT_ISSUERS=Let\u0027s Encrypt,ZeroSSL,Self-Signed,localhost\\n\\n# Enable/disable phases\\nTRACEROUTE_ENABLED=true\\nEXPORT_ROOT_CA=true\\nCHECK_PROXY_SETTINGS=true\\nCHECK_BROWSER_EXTENSIONS=true\\nCHECK_HOSTS_FILE=true\\nCHECK_ROOT_CA_ANOMALIES=true\\n```\"}","name":"search_replace","params":"{\"relativeWorkspacePath\":\"templates/network/README.md\"}","additionalData":{"codeblockId":"57db5d0a-79c4-4063-93e3-ba08de30dc74","reviewData":{"status":"None","selectedOption":"accept","isShowingInput":false,"firstTimeReviewMode":false}},"userDecision":"accepted","result":"{\"diff\":{\"chunks\":[{\"diffString\":\"  ## Configuration\\n  \\n- All scripts use `network.cfg` with KEY=VALUE format:\\n+ ### Network Diagnostics (`network.cfg`)\\n  \\n  ```\",\"oldStart\":21,\"newStart\":21,\"oldLines\":5,\"newLines\":5,\"linesRemoved\":1,\"linesAdded\":1},{\"diffString\":\"  CAPTURE_TIMESTAMP_PRECISION=nano\\n  CAPTURE_CONVERT_PCAPNG=true\\n+ ```\\n+ \\n+ ### MITM Audit (`mitm-audit.cfg`)\\n+ \\n+ ```\\n+ # Target domains (high-value auth endpoints)\\n+ TARGETS=accounts.google.com,login.microsoftonline.com,appleid.apple.com,aws.amazon.com,github.com\\n+ \\n+ # DNS-over-HTTPS endpoint (control group)\\n+ DOH_ENDPOINT=https://dns.google/resolve\\n+ \\n+ # ASN lookup service\\n+ ASN_LOOKUP_URL=http://ip-api.com/json\\n+ ASN_LOOKUP_TIMEOUT_SEC=3\\n+ \\n+ # Expected ISP patterns (optional - leave empty to skip)\\n+ EXPECTED_ISP_PATTERNS=Vyve,Eagle,Lumen\\n+ \\n+ # Suspicious ASN patterns (VPS providers that should NOT serve auth traffic)\\n+ SUSPICIOUS_ASN_PATTERNS=DigitalOcean,Linode,Vultr,Choopa,Datacamp,OVH,Hetzner\\n+ \\n+ # Suspicious certificate issuers for major tech companies\\n+ SUSPICIOUS_CERT_ISSUERS=Let\u0027s Encrypt,ZeroSSL,Self-Signed,localhost\\n+ \\n+ # Enable/disable phases\\n+ TRACEROUTE_ENABLED=true\\n+ EXPORT_ROOT_CA=true\\n+ CHECK_PROXY_SETTINGS=true\\n+ CHECK_BROWSER_EXTENSIONS=true\\n+ CHECK_HOSTS_FILE=true\\n+ CHECK_ROOT_CA_ANOMALIES=true\\n  ```\\n  \",\"oldStart\":38,\"newStart\":38,\"oldLines\":4,\"newLines\":35,\"linesAdded\":31}],\"editor\":\"EDITOR_AI\"},\"shouldAutoFixLints\":true,\"resultForModel\":\"The file templates/network/README.md has been updated.\",\"contentsAfterEdit\":\"# Network Diagnostics Toolkit\\n\\nNetwork scanning, DNS diagnostics, forensics collection, and Infrastructure MITM detection tools.\\n\\n## Scripts\\n\\n| Script | Platform | Purpose |\\n|--------|----------|---------|\\n| `Invoke-NetworkScan-v7.ps1` | Windows (PS7) | TCP port scanner with service detection |\\n| `Invoke-DnsDiagnostics-v7.ps1` | Windows (PS7) | DNS anomaly detection and consistency checks |\\n| `Invoke-NetworkForensics-v7.ps1` | Windows (PS7) | Forensic data collection and analysis |\\n| `Invoke-MitmAudit-v7.ps1` | Windows (PS7) | Infrastructure MITM detection with ASN/DoH/Cert analysis |\\n| `Invoke-BackgroundDiagnostics-v7.ps1` | Windows (PS7) | Background wrapper for all diagnostics |\\n| `network-scan.sh` | POSIX | TCP port scanner |\\n| `dns-diagnostics.sh` | POSIX | DNS testing and anomaly detection |\\n| `network-forensics.sh` | POSIX | Forensic data collection |\\n| `mitm-audit.sh` | POSIX | Infrastructure MITM detection with ASN/DoH/Cert analysis |\\n| `Invoke-PacketCapture-v7.ps1` | Windows (PS7) | Packet capture with pktmon (full detail, timestamps) |\\n| `packet-capture.sh` | POSIX | Packet capture with tcpdump (full detail, timestamps) |\\n\\n## Configuration\\n\\n### Network Diagnostics (`network.cfg`)\\n\\n```\\nTARGET_HOST=192.168.1.1\\nTARGET_NETWORK=192.168.1.0/24\\nSCAN_PORTS=21,22,23,25,53,80,443,445,3389,8080,8443\\nDNS_SERVERS=1.1.1.1,8.8.8.8,9.9.9.9\\nDNS_TEST_DOMAINS=api2.cursor.sh,github.com,google.com\\nSCAN_TIMEOUT_MS=500\\nOUTPUT_DIR=./network-diagnostics\\n\\n# Packet capture settings\\nCAPTURE_SNAPLEN=0\\nCAPTURE_MAX_SIZE_MB=512\\nCAPTURE_ROTATE_COUNT=10\\nCAPTURE_TIMESTAMP_PRECISION=nano\\nCAPTURE_CONVERT_PCAPNG=true\\n```\\n\\n### MITM Audit (`mitm-audit.cfg`)\\n\\n```\\n# Target domains (high-value auth endpoints)\\nTARGETS=accounts.google.com,login.microsoftonline.com,appleid.apple.com,aws.amazon.com,github.com\\n\\n# DNS-over-HTTPS endpoint (control group)\\nDOH_ENDPOINT=https://dns.google/resolve\\n\\n# ASN lookup service\\nASN_LOOKUP_URL=http://ip-api.com/json\\nASN_LOOKUP_TIMEOUT_SEC=3\\n\\n# Expected ISP patterns (optional - leave empty to skip)\\nEXPECTED_ISP_PATTERNS=Vyve,Eagle,Lumen\\n\\n# Suspicious ASN patterns (VPS providers that should NOT serve auth traffic)\\nSUSPICIOUS_ASN_PATTERNS=DigitalOcean,Linode,Vultr,Choopa,Datacamp,OVH,Hetzner\\n\\n# Suspicious certificate issuers for major tech companies\\nSUSPICIOUS_CERT_ISSUERS=Let\u0027s Encrypt,ZeroSSL,Self-Signed,localhost\\n\\n# Enable/disable phases\\nTRACEROUTE_ENABLED=true\\nEXPORT_ROOT_CA=true\\nCHECK_PROXY_SETTINGS=true\\nCHECK_BROWSER_EXTENSIONS=true\\nCHECK_HOSTS_FILE=true\\nCHECK_ROOT_CA_ANOMALIES=true\\n```\\n\\n## Usage Examples\\n\\n### Network Scanning\\n\\n```powershell\\n# Windows - Scan single host\\n.\\\\Invoke-NetworkScan-v7.ps1 -Target 192.168.1.1 -Ports \\\"22,80,443\\\"\\n\\n# Windows - Use config file\\n.\\\\Invoke-NetworkScan-v7.ps1 -ConfigFile .\\\\network.cfg\\n\\n# Unix\\n./network-scan.sh -t 192.168.1.1 -p \\\"22,80,443\\\"\\n```\\n\\n### DNS Diagnostics\\n\\n```powershell\\n# Windows - Test specific domain\\n.\\\\Invoke-DnsDiagnostics-v7.ps1 -Domain api2.cursor.sh\\n\\n# Windows - Full diagnostics with config\\n.\\\\Invoke-DnsDiagnostics-v7.ps1 -ConfigFile .\\\\network.cfg -OutputPath .\\\\results\\n\\n# Unix\\n./dns-diagnostics.sh -d api2.cursor.sh -s \\\"1.1.1.1,8.8.8.8\\\"\\n```\\n\\n### Network Forensics\\n\\n```powershell\\n# Windows - Full collection\\n.\\\\Invoke-NetworkForensics-v7.ps1 -OutputPath .\\\\forensics\\n\\n# Unix\\n./network-forensics.sh -o ./forensics\\n```\\n\\n### Background Execution (for Agent/Automation)\\n\\nFor scripts that may run indefinitely or timeout in agent sessions:\\n\\n```powershell\\n# Windows - Run any diagnostic in background\\n.\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script NetworkForensics -OutputPath .\\\\results\\n.\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script DnsDiagnostics -WaitSeconds 30\\n.\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script PacketCapture -ScriptArgs @{Duration=60}\\n\\n# Check status\\nGet-Content .\\\\results\\\\*-status.json\\n\\n# Read output when complete\\nGet-Content .\\\\results\\\\*-stdout.txt\\n```\\n\\n```sh\\n# Unix - Use nohup for background\\nnohup ./network-forensics.sh -o ./results \u003e forensics.log 2\u003e\u00261 \u0026\\n\\n# Check later\\ncat forensics.log\\n```\\n\\n### Infrastructure MITM Audit\\n\\nDetects infrastructure-side Man-in-the-Middle attacks while ruling out client-side exploits. Uses `mitm-audit.cfg`.\\n\\n```powershell\\n# Windows - Full MITM audit\\n.\\\\Invoke-MitmAudit-v7.ps1\\n\\n# Windows - With custom config\\n.\\\\Invoke-MitmAudit-v7.ps1 -ConfigFile .\\\\mitm-audit.cfg\\n\\n# Windows - Custom targets, skip traceroute\\n.\\\\Invoke-MitmAudit-v7.ps1 -Targets \\\"accounts.google.com,github.com\\\" -SkipTraceroute\\n\\n# Unix\\n./mitm-audit.sh\\n\\n# Unix - With options\\n./mitm-audit.sh -c ./mitm-audit.cfg -t \\\"accounts.google.com,github.com\\\" --skip-traceroute\\n```\\n\\n#### MITM Detection Capabilities\\n\\n- **ASN Integrity**: Verifies Google/Microsoft/Apple/Amazon/GitHub resolve to their ASNs\\n- **DoH Comparison**: Compares local DNS to DNS-over-HTTPS (dns.google) as control group\\n- **Certificate Analysis**: Captures TLS certs, detects anomalous issuers for major tech\\n- **Root CA Audit**: Exports trust store, detects enterprise MITM tools and suspicious CAs\\n- **Traceroute Mapping**: Identifies suspicious hops through VPS providers\\n- **Client-Side Checks**: Proxy settings, browser extensions, hosts file tampering\\n\\n#### Evidence Processing\\n\\n1. Check `_RedFlags.txt` first - if empty, MITM may be passive/logging only\\n2. Certificate Serial Check - copy serial to [crt.sh](https://crt.sh) on clean device:\\n   - \\\"No certificates found\\\" = 100% MITM by private root CA\\n   - Cert shown for different domain = collision/hash attack or mis-issuance\\n3. Zip evidence folder, hash the zip for chain of custody\\n\\n#### Output Structure\\n\\n```\\nForensicEvidence_YYYYMMDD_HHMMSS/\\n  _AuditLog.txt          # Full audit log\\n  _RedFlags.txt          # Immediate alerts (check this first)\\n  _FileHashes.json       # SHA256 hashes for chain of custody\\n  Summary.json           # Audit verdict and configuration\\n  environment/\\n    NetworkConfig.json   # IP/DNS configuration\\n    ExternalIP.json      # External IP and ISP info\\n    SystemInfo.json      # System identification\\n  trust-store/\\n    RootStore_Dump.csv   # All root CAs (Windows)\\n    RootCA_Snapshot.crt  # CA bundle (Linux/macOS)\\n    RootCA_Hash.json     # Hash of CA store\\n    SuspiciousCAs.json   # Flagged certificates\\n  targets/\\n    accounts_google_com/\\n      Analysis.json      # Full analysis results\\n      Certificate.json   # TLS certificate details\\n      dns.txt            # DNS resolution data\\n    (... other targets ...)\\n  traceroute/\\n    Trace_*.txt          # Raw traceroute output\\n    Trace_*.json         # Hops with ASN lookup\\n  client-side/\\n    ProxySettings.json   # System/environment proxy\\n    HostsFile.json       # /etc/hosts analysis\\n    BrowserExtensions.json # Installed extensions\\n```\\n\\n### Packet Capture\\n\\n```powershell\\n# Windows - Capture with pktmon (requires Admin)\\n.\\\\Invoke-PacketCapture-v7.ps1 -Duration 60 -OutputPath .\\\\captures\\n.\\\\Invoke-PacketCapture-v7.ps1 -Filter \\\"port 443\\\" -Duration 30 -ConvertToPcap\\n\\n# Unix - Capture with tcpdump (requires root/sudo)\\n./packet-capture.sh -i eth0 -d 60 -o ./captures\\n./packet-capture.sh -f \\\"port 443 or port 80\\\" -d 30\\n./packet-capture.sh -i any -f \\\"host 192.168.1.1\\\" -d 120\\n```\\n\\n#### Capture Options\\n\\n**Windows (pktmon):**\\n- Full packet capture (no truncation)\\n- All network components\\n- ETL format with optional PCAPNG conversion\\n- Timestamp precision to nanoseconds\\n\\n**Unix (tcpdump):**\\n- `-XX` Hex and ASCII dump\\n- `-vvv` Maximum verbosity\\n- `-tttt` Human-readable timestamps with date\\n- `-S` Absolute sequence numbers\\n- `--time-stamp-precision=nano` Nanosecond precision (if supported)\\n- File rotation support\\n\\n## Detection Capabilities\\n\\n### DNS Diagnostics\\n\\n- DNS hijacking (fake IPs like 0.0.0.x)\\n- LLMNR/NetBIOS poisoning (.lan/.local suffixes)\\n- DNS response inconsistencies across servers\\n- Temporary resolution failures (EAI_AGAIN)\\n\\n### Network Forensics\\n\\n- ARP spoofing (duplicate MAC addresses)\\n- Suspicious listening ports\\n- Malware C2 ports (4444, 5555, 31337, etc.)\\n- Hosts file tampering\\n- Firewall state analysis\\n- Promiscuous mode detection\\n\\n### Infrastructure MITM Audit\\n\\n- **ASN Mismatch Detection**: Google domains not resolving to Google ASN, etc.\\n- **VPS Provider Alert**: Auth traffic routed through DigitalOcean/Linode/Vultr/etc.\\n- **DoH vs Local DNS Comparison**: Detects DNS manipulation at ISP/network level\\n- **Certificate Anomalies**: Major tech domains with Let\u0027s Encrypt/ZeroSSL certs\\n- **Enterprise MITM Tools**: Zscaler, BlueCoat, Forcepoint in root CA store\\n- **Recently Added Root CAs**: Certs added within last 30 days flagged\\n- **Suspicious Traceroute Hops**: Traffic routed through unexpected providers\\n- **Client-Side Exploit Ruling Out**: Proxy, browser extensions, hosts file checks\\n\\n## Output Format\\n\\nAll tools output JSON files for programmatic analysis:\\n\\n```\\n./network-diagnostics/\\n  scan-2025-12-01_15-00-00.json\\n  dns-diagnostics-2025-12-01_15-00-00.json\\n\\n./network-forensics/\\n  summary.json\\n  network/\\n    connections.json\\n    interfaces.json\\n    arp-cache.json\\n    routes.json\\n    listeners.json\\n  dns/\\n    cache.json\\n    hosts-file.json\\n  security/\\n    firewall.json\\n  processes/\\n    network-processes.json\\n```\\n\\n## Requirements\\n\\n### Windows\\n\\n- PowerShell 7+\\n- Administrator privileges recommended for full data collection\\n\\n### Unix/Linux/macOS\\n\\n- POSIX-compliant shell\\n- One of: dig, nslookup, or host (for DNS)\\n- One of: nc (netcat), or bash with /dev/tcp support (for scanning)\\n- tcpdump for packet capture\\n- root/sudo for packet capture and full forensics collection\\n\\n## License\\n\\nBSD-2-Clause\\n\\n## Signed-off-by\\n\\nNetwork Diagnostics Toolkit\\n\\n\"}"},"checkpointId":"98e0290e-3a7f-4cca-83ef-1ccdc9e682b7"},"bubbleId":"60b443b2-ccbb-4569-818a-1970206d8126"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"6462060b-5f26-49c8-b450-acdda9a62a82","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:41:02.934Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"text":"","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","codeBlocks":[{"uri":{"scheme":"file","authority":"","path":"/c:/Users/user/Downloads/Cursor_working_directory_misc/AGENT_ONBOARD.md","query":"","fragment":"","_formatted":"file:///c%3A/Users/user/Downloads/Cursor_working_directory_misc/AGENT_ONBOARD.md","_fsPath":null},"codeblockId":"1dbb1616-348b-493e-b9ba-345a7ecc7435","codeBlockIdx":0,"content":"# AGENT ONBOARDING - READ FIRST\n\n**STOP. Before generating any code, read this file completely.**\n\nThis workspace uses pre-built helper scripts and templates to minimize token consumption and maximize code quality. Do NOT generate multi-step shell/git commands manually. Use the scripts below.\n\n---\n\n## Critical Rules\n\n1. **No emojis** in source code, configs, or documentation\n2. **Default languages**: PowerShell (Windows), POSIX sh (Unix), C17, AMD64/ARM64 assembly\n3. **Universal config paradigm**: One `.cfg` file consumed by three scripts (POSIX sh, PowerShell v5, PowerShell v7)\n4. **Use existing scripts** instead of generating equivalent commands\n5. **BSD-2-Clause** license with DCO sign-off required\n6. **Check BROKEN_SCRIPTS.md** for scripts that need verification before use\n\n---\n\n## CRITICAL: NEVER DELEGATE WORK TO THE USER\n\n**THIS IS NON-NEGOTIABLE. READ CAREFULLY.**\n\nAgents exist to DO THE WORK. The user is NOT your assistant. You are THEIR assistant.\n\n- NEVER ask the user to run commands for you\n- NEVER ask the user to copy-paste output\n- NEVER ask the user to check something manually\n- NEVER say \"please run this in your terminal\"\n- USE the native shell tool directly (shell bug resolved 2025-12-14)\n\nIf you cannot complete a task, explain WHY and propose an AUTOMATED solution. Do NOT make the user do your job.\n\n---\n\n## GENERAL Scripts, SPECIFIC Tasks\n\n**CRITICAL CONCEPT:** The scripts in this workspace are GENERAL-PURPOSE building blocks, NOT task-specific solutions.\n\nAgents must understand:\n\n1. **Scripts are composable** - Combine multiple general scripts to accomplish specific tasks\n2. **Templates are parameterized** - One template serves many use cases via `.cfg` substitution\n3. **No script-per-task assumption** - Do NOT expect `do-exactly-what-I-need.ps1` to exist\n4. **Adapt and compose** - Use existing scripts creatively; extend only when necessary\n\n**Example - Creating a New C Project:**\n```powershell\n# WRONG: Looking for \"New-CProject.ps1\"\n# RIGHT: Compose general tools\n.\\New-Project-v7.ps1 -ConfigFile project.cfg  # General scaffolding\n.\\Invoke-Template.ps1 -Language c             # Language-specific templates\n.\\git-ops\\New-Repo.ps1 -WithBackup            # Git setup\n```\n\n---\n\n## Fravia Search Strategy + Suckless Principles\n\nApply reverse-engineering search methodology with minimal-complexity execution.\n\n### Fravia Method: Search Strategy Formulation\n\nBefore searching, PLAN the search:\n\n1. **Define the target** - What exactly are you looking for? (file, function, pattern, concept)\n2. **Predict locations** - Where would this logically exist? (directory, file type, naming convention)\n3. **Choose search depth** - Broad reconnaissance first, then targeted drilling\n4. **Formulate patterns** - Build regex from known fragments, not guesses\n5. **Cross-reference results** - Validate findings against multiple indicators\n\n### Suckless Principles: Minimal Complexity, Maximum Effect\n\n**AVOID** these anti-patterns (Useless Use of Cat and friends):\n\n```sh\n# BAD: UUoC - Useless Use of Cat\ncat file.txt | grep pattern\ncat file.txt | wc -l\ncat file.txt | awk \u0027{print $1}\u0027\ncat file.txt | sed \u0027s/foo/bar/\u0027\n\n# GOOD: Direct invocation\ngrep pattern file.txt\nwc -l \u003c file.txt\nawk \u0027{print $1}\u0027 file.txt\nsed \u0027s/foo/bar/\u0027 file.txt\n```\n\n**AVOID** unnecessary tool chains:\n\n```sh\n# BAD: Multi-tool chain for simple task\ncat file | grep foo | sed \u0027s/bar/baz/\u0027 | awk \u0027{print $2}\u0027 | wc -l\n\n# GOOD: Single tool when possible\nawk \u0027/foo/ { gsub(/bar/, \"baz\"); print $2; count++ } END { print count }\u0027 file\n```\n\n**PREFER** heredoc and ed/vi for edits:\n\n```sh\n# BAD: Multiple sed invocations\nsed -i \u0027s/old1/new1/\u0027 file\nsed -i \u0027s/old2/new2/\u0027 file\nsed -i \u0027s/old3/new3/\u0027 file\n\n# GOOD: Single heredoc with ed\ned -s file \u003c\u003c\u0027EOF\u0027\n%s/old1/new1/g\n%s/old2/new2/g\n%s/old3/new3/g\nw\nq\nEOF\n\n# GOOD: Single sed with multiple expressions\nsed -i -e \u0027s/old1/new1/g\u0027 -e \u0027s/old2/new2/g\u0027 -e \u0027s/old3/new3/g\u0027 file\n```\n\n### Search Tool Priority\n\nUse tools in this order (most efficient first):\n\n| Priority | Tool | Use Case |\n|----------|------|----------|\n| 1 | `grep -r` / `rg` | Known pattern, broad search |\n| 2 | `find` + `-name` | Known filename pattern |\n| 3 | `git grep` | Within git repo, respects .gitignore |\n| 4 | Codebase semantic search | Concept/meaning-based queries |\n| 5 | Web search | External documentation, APIs |\n\n### PowerShell Equivalents\n\n```powershell\n# BAD: Pipeline abuse\nGet-Content file.txt | Select-String pattern\nGet-Content file.txt | Measure-Object -Line\nGet-Content file.txt | ForEach-Object { $_.Split()[0] }\n\n# GOOD: Direct parameter usage\nSelect-String -Path file.txt -Pattern pattern\n(Get-Content file.txt).Count\n(Get-Content file.txt) -replace \u0027pattern\u0027, \u0027replacement\u0027\n\n# GOOD: Single expression for complex operations\nGet-Content file.txt | ForEach-Object -Begin { $count = 0 } -Process {\n    if ($_ -match \u0027pattern\u0027) { $count++ }\n} -End { $count }\n```\n\n### The Suckless Test\n\nBefore executing a command chain, ask:\n\n1. Can this be done with ONE tool instead of many?\n2. Am I piping cat/Get-Content unnecessarily?\n3. Would a heredoc/here-string be cleaner?\n4. Is there a built-in flag that eliminates a pipeline stage?\n5. Am I using awk/sed when grep alone suffices (or vice versa)?\n\n**Rule of thumb:** If your command has more than 2 pipes, reconsider the approach.\n\n---\n\n## RESOLVED: Agent Shell Bug Workaround (Windows 11)\n\n**Status:** RESOLVED as of 2025-12-14. Shell tool now works correctly.\n\n**History:** Between 2025-12-07 and 2025-12-14, Cursor Shell tool returned `pid: -1` on Windows 11 (build 26200, Cursor 2.1.50+). This has been fixed.\n\n### File-Based Shell Bridge (Archived - For Reference Only)\n\nThe bridge workaround below is no longer needed but preserved for reference if the issue recurs.\n\n\u003cdetails\u003e\n\u003csummary\u003eClick to expand archived workaround\u003c/summary\u003e\n\nWhen the Cursor Shell tool fails, use `agent-shell-bridge.ps1` which runs in the user\u0027s manual terminal.\n\n**To execute shell commands:**\n\n1. Write command to `.agent-command.txt` using the Write tool\n2. Wait briefly, then read `.agent-status.txt` (should say `DONE`)\n3. Read result from `.agent-result.txt`\n\n**Example:**\n\n```\n# Step 1: Write command\nWrite tool -\u003e .agent-command.txt -\u003e \"hostname; Get-Date\"\n\n# Step 2: Check status\nRead tool -\u003e .agent-status.txt -\u003e \"DONE\"\n\n# Step 3: Read result\nRead tool -\u003e .agent-result.txt -\u003e \"EXIT_CODE=0\\nDESKTOP-7KTB236\\n...\"\n```\n\n**Files:**\n\n| File | Purpose |\n|------|---------|\n| `.agent-command.txt` | Write your command here (bridge consumes it) |\n| `.agent-status.txt` | READY/RUNNING/DONE |\n| `.agent-result.txt` | EXIT_CODE=N followed by output |\n| `agent-shell-bridge.ps1` | The bridge script (user starts once) |\n\n\u003c/details\u003e\n\n---\n\n---\n\n## Known Issues: BROKEN_SCRIPTS.md\n\nBefore using or modifying scripts, check `BROKEN_SCRIPTS.md` for:\n\n- Scripts that silently skip critical functionality\n- Useless Use of Cat (UUoC) patterns in shell scripts\n- Placeholder values that should be complete functions\n- Templates with unsubstituted variables\n- Scripts requiring verification\n\n**When a script fails during agent operations:**\n1. Do NOT attempt to fix inline\n2. Add to `BROKEN_SCRIPTS.md` with filename, filepath, and issue description\n3. Mark as unchecked `[ ]`\n4. Only check off `[x]` when fully verified working\n\n---\n\n## Helper Script Index (General-Purpose Building Blocks)\n\n**These are GENERAL scripts.** Combine them to accomplish SPECIFIC tasks. Do not expect a dedicated script for every operation.\n\nAll scripts are in `github-backup/cursor-project-scaffolding-backup/ludoplex-cursor-project-scaffolding-backup-*/`\n\n### Project Scaffolding (General)\n\n| Task | Script | Config |\n|------|--------|--------|\n| Create new project | `new-project.sh` / `New-Project-v5.ps1` / `New-Project-v7.ps1` | `project.cfg` |\n| Watch/backup files | `watch-project.sh` / `Watch-Project-v5.ps1` / `Watch-Project-v7.ps1` | `watcher.cfg` |\n| Process templates | `Invoke-Template.ps1` | (inline params) |\n\n### Git Operations (git-ops/) - General\n\n| Task | Script |\n|------|--------|\n| Create GitHub repo | `New-Repo.ps1` / `new-repo.sh` |\n| Clone with backup | `Import-Repo.ps1` / `import-repo.sh` (legacy) |\n\n### Import Repository (github-backup/) - General, with gh fallback\n\n| Task | Script | Config |\n|------|--------|--------|\n| Import repo | `import-repo.sh` / `Import-Repo-v5.ps1` / `Import-Repo-v7.ps1` | `import-repo.cfg` |\n\nTries git clone first, falls back to gh api zip download when git fails.\n| Create branch | `New-Branch.ps1` / `new-branch.sh` |\n| Archive project | `Archive-Repo.ps1` / `archive-repo.sh` |\n| Sync backups | `Sync-Backup.ps1` / `sync-backup.sh` |\n| Update index | `Update-RepoIndex.ps1` / `update-index.sh` |\n\n### Utilities (utils/) - General Search/Reconnaissance\n\n| Task | Script |\n|------|--------|\n| Project tree | `Get-ProjectStructure.ps1` |\n| Find files | `Search-Files.ps1` / `search-files.sh` |\n| Search content | `Search-Content.ps1` / `search-content.sh` |\n\n**Note:** These wrap grep/find with sensible defaults. Use directly when wrappers add overhead.\n\n### Production Readiness (prr/)\n\n| Task | Script |\n|------|--------|\n| Run PRR checks | `Invoke-PRR.ps1` / `prr-check.sh` |\n\n### Network Diagnostics (templates/network/)\n\n| Task | Script (Windows) | Script (POSIX) | Config |\n|------|------------------|----------------|--------|\n| Port scanning | `Invoke-NetworkScan-v7.ps1` | `network-scan.sh` | `network.cfg` |\n| DNS diagnostics | `Invoke-DnsDiagnostics-v7.ps1` | `dns-diagnostics.sh` | `network.cfg` |\n| Network forensics | `Invoke-NetworkForensics-v7.ps1` | `network-forensics.sh` | `network.cfg` |\n| Infrastructure MITM audit | `Invoke-MitmAudit-v7.ps1` | `mitm-audit.sh` | `mitm-audit.cfg` |\n| Packet capture | `Invoke-PacketCapture-v7.ps1` (pktmon) | `packet-capture.sh` (tcpdump) | `network.cfg` |\n| Background wrapper | `Invoke-BackgroundDiagnostics-v7.ps1` | (use nohup/\u0026) | `network.cfg` |\n\nDetects: DNS hijacking, ARP spoofing, LLMNR poisoning, suspicious connections, firewall issues.\n\n**MITM Audit specifically detects:**\n- ASN integrity violations (Google traffic not going to Google ASN)\n- DoH vs local DNS discrepancies\n- Certificate anomalies (Let\u0027s Encrypt on accounts.google.com)\n- Enterprise MITM tools in root CA store\n- Traffic routing through VPS providers (DigitalOcean, Linode, etc.)\n- Client-side exploits (proxy settings, browser extensions, hosts file)\n\n### Linting (workspace root)\n\n| Task | Script | Config |\n|------|--------|--------|\n| Aggregate linting | `lint-project.sh` / `Lint-Project-v5.ps1` / `Lint-Project-v7.ps1` | `lint.cfg` |\n\nRuns C, Shell, PowerShell, JSON, YAML, Markdown linters plus ROSE-style policy checks:\n- No tab characters in source files\n- Maximum line length (default 132)\n- Unix line endings (LF not CRLF)\n- No \"using\" directives in headers\n\n### Nuclei Vulnerability Scanning (nuclei-ops/)\n\n| Task | Script | Config |\n|------|--------|--------|\n| Run nuclei scan | `nuclei-scan.sh` / `Invoke-NucleiScan-v5.ps1` / `Invoke-NucleiScan-v7.ps1` | `nuclei-scan.cfg` |\n\nFeatures: Unified config for target, templates, rate limiting, output format. Auto-detects nuclei binary.\n\n### Cursor Backup Extension (cursor-backup-ops/)\n\n| Task | Script | Config |\n|------|--------|--------|\n| Install extension | `install-backup-extension.sh` / `Install-BackupExtension-v5.ps1` / `Install-BackupExtension-v7.ps1` | `backup-extension.cfg` |\n\nFeatures: Builds TypeScript, packages VSIX, auto-detects IDE (Cursor/VS Code/Codium).\n\n### Portmaster DNS Firewall (portmaster-ops/)\n\n| Task | Script | Config |\n|------|--------|--------|\n| Status check | `portmaster-status.sh` / `Get-PortmasterStatus-v5.ps1` / `Get-PortmasterStatus-v7.ps1` | `portmaster.cfg` |\n| Full diagnostics | `Invoke-PortmasterDiagnostics-v7.ps1` | `portmaster.cfg` |\n\n### WSL2 KVM for Docker-OSX (wsl-kvm-ops/)\n\n| Task | Script | Config |\n|------|--------|--------|\n| Enable features | `Install-WslKvm-v5.ps1 -Step Features` | `wsl-kvm.cfg` |\n| Install distro | `Install-WslKvm-v5.ps1 -Step Distro` | `wsl-kvm.cfg` |\n| Build KVM kernel | `Install-WslKvm-v5.ps1 -Step Kernel` | `wsl-kvm.cfg` |\n| Configure WSL | `Install-WslKvm-v5.ps1 -Step Configure` | `wsl-kvm.cfg` |\n| Setup Docker-OSX | `Install-WslKvm-v5.ps1 -Step DockerOsx` | `wsl-kvm.cfg` |\n| Check status | `Install-WslKvm-v5.ps1 -Step Status` | `wsl-kvm.cfg` |\n\nWorkflow: Features (reboot) -\u003e Distro -\u003e Kernel -\u003e Configure -\u003e DockerOsx\n\nFeatures:\n- Detects if Portmaster is sole DNS resolver (`noAssignedNameservers: true`)\n- Tests DoT (DNS-over-TLS) server connectivity\n- Compares DNS resolution through Portmaster vs external servers\n- Analyzes logs for blocked connections and resolver failures\n- Identifies common DNS error patterns (0.0.0.17, .lan suffix, no compliant resolvers)\n\nKey Portmaster paths:\n- Config: `C:\\ProgramData\\Portmaster\\config.json`\n- Logs: `C:\\ProgramData\\Portmaster\\logs\\`\n- UI: `http://127.0.0.1:817`\n\n---\n\n## Token Savings Example\n\n**WITHOUT scripts** (agent generates each command):\n```powershell\ngh repo create owner/name --private\ngh repo create owner/name-backup --private\ncd /path/to/project\ngit init\ngit remote add origin https://github.com/owner/name.git\ngit remote add backup https://github.com/owner/name-backup.git\ngit add -A\ngit commit -s -m \"Initial commit\"\ngit branch -M main\ngit push -u origin main\ngit push backup main\n```\n**Tokens: ~800-1200**\n\n**WITH scripts** (single invocation):\n```powershell\n.\\git-ops\\New-Repo.ps1 -Path \".\" -Private -WithBackup\n```\n**Tokens: ~50** (94% savings)\n\n---\n\n## Agent Instruction Files\n\nProject-specific agent instructions are in `.copilot/` directories:\n\n| Agent | Purpose | File |\n|-------|---------|------|\n| checks-agent | CI/CD monitoring | `checks-agent-instructions.md` |\n| code-maintainer | C/ASM code quality | `code-maintainer-instructions.md` |\n| database-maintainer | SQLite schema/migrations | `database-maintainer-instructions.md` |\n| docs-maintainer | Documentation quality | `docs-maintainer-instructions.md` |\n| github-actions-agent | Workflow management | `github-actions-agent-instructions.md` |\n| prd-agent | Requirements alignment | `prd-agent-instructions.md` |\n| test-runner | Test execution | `test-runner-instructions.md` |\n| validator | Script/config validation | `validator-instructions.md` |\n| workflow-maintainer | CI/CD configuration | `workflow-maintainer-instructions.md` |\n\n---\n\n## Template System\n\nTemplates in `templates/` use `{{VARIABLE}}` substitution:\n\n- `templates/base/` - Common files (LICENSE, README, CONTRIBUTING)\n- `templates/languages/` - Language-specific (c, python, rust, go, sh, powershell)\n- `templates/ci-cd/` - CI/CD workflows (github-actions)\n- `templates/platforms/` - Platform-specific\n\nInvoke with:\n```powershell\n.\\Invoke-Template.ps1 -ConfigFile project.cfg -Language c -OutputPath ./my-project\n```\n\n---\n\n## Platform Detection\n\nScripts auto-detect platform and set defaults:\n\n| Platform | Shell | Language | Assembly |\n|----------|-------|----------|----------|\n| Windows x64 | PowerShell | C17 | MASM/AMD64 |\n| Windows ARM64 | PowerShell | C17 | ARM64 |\n| macOS x64 | sh | C17 | AMD64 |\n| macOS ARM64 | sh | C17 | A64 |\n| Linux x64 | sh | C17 | AMD64 |\n| Linux ARM64 | sh | C17 | A64 |\n\n---\n\n## Before Generating Code\n\n1. Check if a helper script exists for the task\n2. Use `Search-Files.ps1` to find relevant templates\n3. Use `Get-ProjectStructure.ps1` to understand layout\n4. Read relevant `.copilot/*-instructions.md` files\n5. Follow PRR guidelines for production readiness\n\n---\n\n## Background Execution for Long-Running Processes\n\nWhen running scripts that have no definite end time (diagnostics, watchers, packet captures, servers), use background execution to avoid blocking the agent session.\n\n### Problem\n\nAgent tool calls timeout when scripts run too long. Scripts that:\n- Collect data over extended periods (packet capture, forensics)\n- Watch for file changes indefinitely\n- Wait for network events\n- Run servers or daemons\n\nwill cause `Tool call errored or timed out` errors.\n\n### Solution: Background Wrapper Pattern\n\n**Windows (PowerShell 7+):**\n```powershell\n# Use the background diagnostics wrapper\n.\\templates\\network\\Invoke-BackgroundDiagnostics-v7.ps1 -Script NetworkForensics -OutputPath .\\results\n\n# Or run any script in background with output capture\n$job = Start-Job -ScriptBlock { \u0026 .\\SomeLongScript.ps1 *\u003e\u00261 | Tee-Object -FilePath .\\output.txt }\n\n# Check status later\nGet-Content .\\diagnostics-output\\*-status.json\nGet-Content .\\diagnostics-output\\*-stdout.txt\n```\n\n**Unix (POSIX sh):**\n```sh\n# Run with nohup and redirect output\nnohup ./network-forensics.sh -o ./results \u003e ./forensics.log 2\u003e\u00261 \u0026\necho $! \u003e ./forensics.pid\n\n# Check status later\ncat ./forensics.log\nkill -0 $(cat ./forensics.pid) \u0026\u0026 echo \"Still running\" || echo \"Completed\"\n```\n\n### Background Wrapper Scripts\n\n| Task | Script | Output |\n|------|--------|--------|\n| Network diagnostics | `Invoke-BackgroundDiagnostics-v7.ps1` | `*-status.json`, `*-stdout.txt` |\n| File watcher | `Watch-Project-v7.ps1` (run with Start-Job) | watcher.log |\n| Packet capture | `Invoke-PacketCapture-v7.ps1` | ETL/PCAP files |\n\n### Agent Workflow for Background Tasks\n\n1. **Start**: Launch script with background wrapper, capture job/PID\n2. **Continue**: Proceed with other tasks while script runs\n3. **Check**: Read status file or stdout file to get results\n4. **Retrieve**: Parse JSON output files for programmatic access\n\n### Example: Network Diagnostics\n\n```powershell\n# Start forensics in background (returns immediately)\n.\\templates\\network\\Invoke-BackgroundDiagnostics-v7.ps1 -Script NetworkForensics -OutputPath .\\forensics-results\n\n# Do other work...\n\n# Later, check results\nGet-Content .\\forensics-results\\*-status.json | ConvertFrom-Json\nGet-Content .\\forensics-results\\*-stdout.txt\nGet-Content .\\forensics-results\\summary.json | ConvertFrom-Json\n```\n\n### Key Files After Background Execution\n\n| File | Purpose |\n|------|---------|\n| `*-status.json` | Job state: Running/Completed/Failed, timestamps, exit code |\n| `*-stdout.txt` | Captured console output |\n| `*-stderr.txt` | Error output (if any) |\n| `summary.json` | Structured results from the diagnostic script |\n\n### Critical Rule\n\n**DO NOT** run these scripts directly via `run_terminal_cmd` without background:\n- `Invoke-NetworkForensics-v7.ps1`\n- `Invoke-PacketCapture-v7.ps1`\n- `Watch-Project-*.ps1`\n- Any script with indefinite runtime\n\n**DO** use `Invoke-BackgroundDiagnostics-v7.ps1` or `Start-Job` wrapper, then read output files.\n\n---\n\n## Config File Format\n\nUniversal `.cfg` files use `KEY=VALUE` format:\n\n```\n# Comment lines start with #\nPROJECT_NAME=MyApp\nTYPE=cli\nLANGUAGE=c\nAUTHOR=username\nLICENSE=BSD-2-Clause\nBACKUP_ENABLED=true\n```\n\nParsed identically by all three script consumers.\n\n---\n\n## Validation Before Commit\n\nRun these before declaring work complete:\n\n```powershell\n# Aggregate linting (uses lint.cfg)\n.\\Lint-Project-v7.ps1       # PowerShell 7+ (Windows/macOS/Linux)\n.\\Lint-Project-v5.ps1       # PowerShell 5.1 (Windows 10)\n./lint-project.sh           # POSIX shell (macOS/Linux)\n```\n\n```sh\n# Project-specific validation\n./scripts/workflows.sh      # Validate GitHub Actions\n./scripts/actions.sh        # Check action versions\n./scripts/json-configs.sh   # Validate JSON files\n./scripts/run-core-tests.sh # Run unit tests\n```\n\n---\n\n## ROSE Policy Checkers\n\nIntegrated from `rose-1/scripts/policies/` (configure via `lint.cfg`):\n\n| Config Key | Check |\n|-----------|-------|\n| `ROSE_NO_TABS` | No tab characters in source |\n| `ROSE_MAX_LINE_LENGTH` | Lines \u003c= N chars (default 132) |\n| `ROSE_UNIX_LINE_ENDINGS` | LF only, no CRLF |\n| `ROSE_NO_USING_IN_HEADERS` | No `using` directives in headers |\n| `ROSE_CASE_INSENSITIVE_NAMES` | No files differing only by case |\n| `ROSE_UNIQUE_HEADER_NAMES` | No duplicate header names |\n\nSet `ROSE_SOURCE_EXTENSIONS` to control which files are checked.\n\n---\n\n## Required Reading for New Sessions\n\n1. This file (`AGENT_ONBOARD.md`)\n2. Project\u0027s `.cursorrules` if present\n3. Project\u0027s `.copilot/` agent instructions if present\n4. `git-ops/agent-instructions.md` for Git operations\n5. `prr/agent-instructions-cursor.md` for production readiness\n\n---\n\n**DO NOT:**\n- Generate multi-command sequences when a single script exists\n- Assume a task-specific script exists for every operation\n- Use cat/Get-Content in pipelines when direct tool invocation works\n- Chain awk/sed/wc when a single tool with flags suffices\n- Ask the user to run commands or copy-paste output\n\n**DO:**\n- Compose GENERAL scripts to accomplish SPECIFIC tasks\n- Apply Fravia search strategy before grepping blindly\n- Use suckless principles: minimum complexity, maximum effect\n- Prefer heredoc/ed for multi-line edits over repeated sed calls\n- Invoke scripts with appropriate parameters; extend only when necessary\n\n---\n\nGenerated: 2025-12-01\nUpdated: 2025-12-14 (shell bug resolved)\nPurpose: Agent onboarding for token efficiency\n\n","languageId":"markdown"}],"capabilityType":15,"toolFormerData":{"tool":38,"toolCallId":"toolu_01WE1KjrYFpaWsKRQxQAEnMN","toolIndex":1,"modelCallId":"cabbf63e-4430-404d-948f-f22fef57dcde","status":"completed","rawArgs":"{\"file_path\": \"AGENT_ONBOARD.md\", \"old_string\": \"### Network Diagnostics (templates/network/)\\n\\n| Task | Script (Windows) | Script (POSIX) | Config |\\n|------|------------------|----------------|--------|\\n| Port scanning | `Invoke-NetworkScan-v7.ps1` | `network-scan.sh` | `network.cfg` |\\n| DNS diagnostics | `Invoke-DnsDiagnostics-v7.ps1` | `dns-diagnostics.sh` | `network.cfg` |\\n| Network forensics | `Invoke-NetworkForensics-v7.ps1` | `network-forensics.sh` | `network.cfg` |\\n| Packet capture | `Invoke-PacketCapture-v7.ps1` (pktmon) | `packet-capture.sh` (tcpdump) | `network.cfg` |\\n| Background wrapper | `Invoke-BackgroundDiagnostics-v7.ps1` | (use nohup/\u0026) | `network.cfg` |\\n\\nDetects: DNS hijacking, ARP spoofing, LLMNR poisoning, suspicious connections, firewall issues.\", \"new_string\": \"### Network Diagnostics (templates/network/)\\n\\n| Task | Script (Windows) | Script (POSIX) | Config |\\n|------|------------------|----------------|--------|\\n| Port scanning | `Invoke-NetworkScan-v7.ps1` | `network-scan.sh` | `network.cfg` |\\n| DNS diagnostics | `Invoke-DnsDiagnostics-v7.ps1` | `dns-diagnostics.sh` | `network.cfg` |\\n| Network forensics | `Invoke-NetworkForensics-v7.ps1` | `network-forensics.sh` | `network.cfg` |\\n| Infrastructure MITM audit | `Invoke-MitmAudit-v7.ps1` | `mitm-audit.sh` | `mitm-audit.cfg` |\\n| Packet capture | `Invoke-PacketCapture-v7.ps1` (pktmon) | `packet-capture.sh` (tcpdump) | `network.cfg` |\\n| Background wrapper | `Invoke-BackgroundDiagnostics-v7.ps1` | (use nohup/\u0026) | `network.cfg` |\\n\\nDetects: DNS hijacking, ARP spoofing, LLMNR poisoning, suspicious connections, firewall issues.\\n\\n**MITM Audit specifically detects:**\\n- ASN integrity violations (Google traffic not going to Google ASN)\\n- DoH vs local DNS discrepancies\\n- Certificate anomalies (Let\u0027s Encrypt on accounts.google.com)\\n- Enterprise MITM tools in root CA store\\n- Traffic routing through VPS providers (DigitalOcean, Linode, etc.)\\n- Client-side exploits (proxy settings, browser extensions, hosts file)\"}","name":"search_replace","params":"{\"relativeWorkspacePath\":\"AGENT_ONBOARD.md\"}","additionalData":{"codeblockId":"1dbb1616-348b-493e-b9ba-345a7ecc7435","reviewData":{"status":"None","selectedOption":"accept","isShowingInput":false,"firstTimeReviewMode":false}},"userDecision":"accepted","result":"{\"diff\":{\"chunks\":[{\"diffString\":\"  | DNS diagnostics | `Invoke-DnsDiagnostics-v7.ps1` | `dns-diagnostics.sh` | `network.cfg` |\\n  | Network forensics | `Invoke-NetworkForensics-v7.ps1` | `network-forensics.sh` | `network.cfg` |\\n+ | Infrastructure MITM audit | `Invoke-MitmAudit-v7.ps1` | `mitm-audit.sh` | `mitm-audit.cfg` |\\n  | Packet capture | `Invoke-PacketCapture-v7.ps1` (pktmon) | `packet-capture.sh` (tcpdump) | `network.cfg` |\\n  | Background wrapper | `Invoke-BackgroundDiagnostics-v7.ps1` | (use nohup/\u0026) | `network.cfg` |\\n  \\n  Detects: DNS hijacking, ARP spoofing, LLMNR poisoning, suspicious connections, firewall issues.\\n+ \\n+ **MITM Audit specifically detects:**\\n+ - ASN integrity violations (Google traffic not going to Google ASN)\\n+ - DoH vs local DNS discrepancies\\n+ - Certificate anomalies (Let\u0027s Encrypt on accounts.google.com)\\n+ - Enterprise MITM tools in root CA store\\n+ - Traffic routing through VPS providers (DigitalOcean, Linode, etc.)\\n+ - Client-side exploits (proxy settings, browser extensions, hosts file)\\n  \\n  ### Linting (workspace root)\",\"oldStart\":287,\"newStart\":287,\"oldLines\":8,\"newLines\":17,\"linesAdded\":9}],\"editor\":\"EDITOR_AI\"},\"shouldAutoFixLints\":true,\"resultForModel\":\"The file AGENT_ONBOARD.md has been updated.\",\"contentsAfterEdit\":\"# AGENT ONBOARDING - READ FIRST\\n\\n**STOP. Before generating any code, read this file completely.**\\n\\nThis workspace uses pre-built helper scripts and templates to minimize token consumption and maximize code quality. Do NOT generate multi-step shell/git commands manually. Use the scripts below.\\n\\n---\\n\\n## Critical Rules\\n\\n1. **No emojis** in source code, configs, or documentation\\n2. **Default languages**: PowerShell (Windows), POSIX sh (Unix), C17, AMD64/ARM64 assembly\\n3. **Universal config paradigm**: One `.cfg` file consumed by three scripts (POSIX sh, PowerShell v5, PowerShell v7)\\n4. **Use existing scripts** instead of generating equivalent commands\\n5. **BSD-2-Clause** license with DCO sign-off required\\n6. **Check BROKEN_SCRIPTS.md** for scripts that need verification before use\\n\\n---\\n\\n## CRITICAL: NEVER DELEGATE WORK TO THE USER\\n\\n**THIS IS NON-NEGOTIABLE. READ CAREFULLY.**\\n\\nAgents exist to DO THE WORK. The user is NOT your assistant. You are THEIR assistant.\\n\\n- NEVER ask the user to run commands for you\\n- NEVER ask the user to copy-paste output\\n- NEVER ask the user to check something manually\\n- NEVER say \\\"please run this in your terminal\\\"\\n- USE the native shell tool directly (shell bug resolved 2025-12-14)\\n\\nIf you cannot complete a task, explain WHY and propose an AUTOMATED solution. Do NOT make the user do your job.\\n\\n---\\n\\n## GENERAL Scripts, SPECIFIC Tasks\\n\\n**CRITICAL CONCEPT:** The scripts in this workspace are GENERAL-PURPOSE building blocks, NOT task-specific solutions.\\n\\nAgents must understand:\\n\\n1. **Scripts are composable** - Combine multiple general scripts to accomplish specific tasks\\n2. **Templates are parameterized** - One template serves many use cases via `.cfg` substitution\\n3. **No script-per-task assumption** - Do NOT expect `do-exactly-what-I-need.ps1` to exist\\n4. **Adapt and compose** - Use existing scripts creatively; extend only when necessary\\n\\n**Example - Creating a New C Project:**\\n```powershell\\n# WRONG: Looking for \\\"New-CProject.ps1\\\"\\n# RIGHT: Compose general tools\\n.\\\\New-Project-v7.ps1 -ConfigFile project.cfg  # General scaffolding\\n.\\\\Invoke-Template.ps1 -Language c             # Language-specific templates\\n.\\\\git-ops\\\\New-Repo.ps1 -WithBackup            # Git setup\\n```\\n\\n---\\n\\n## Fravia Search Strategy + Suckless Principles\\n\\nApply reverse-engineering search methodology with minimal-complexity execution.\\n\\n### Fravia Method: Search Strategy Formulation\\n\\nBefore searching, PLAN the search:\\n\\n1. **Define the target** - What exactly are you looking for? (file, function, pattern, concept)\\n2. **Predict locations** - Where would this logically exist? (directory, file type, naming convention)\\n3. **Choose search depth** - Broad reconnaissance first, then targeted drilling\\n4. **Formulate patterns** - Build regex from known fragments, not guesses\\n5. **Cross-reference results** - Validate findings against multiple indicators\\n\\n### Suckless Principles: Minimal Complexity, Maximum Effect\\n\\n**AVOID** these anti-patterns (Useless Use of Cat and friends):\\n\\n```sh\\n# BAD: UUoC - Useless Use of Cat\\ncat file.txt | grep pattern\\ncat file.txt | wc -l\\ncat file.txt | awk \u0027{print $1}\u0027\\ncat file.txt | sed \u0027s/foo/bar/\u0027\\n\\n# GOOD: Direct invocation\\ngrep pattern file.txt\\nwc -l \u003c file.txt\\nawk \u0027{print $1}\u0027 file.txt\\nsed \u0027s/foo/bar/\u0027 file.txt\\n```\\n\\n**AVOID** unnecessary tool chains:\\n\\n```sh\\n# BAD: Multi-tool chain for simple task\\ncat file | grep foo | sed \u0027s/bar/baz/\u0027 | awk \u0027{print $2}\u0027 | wc -l\\n\\n# GOOD: Single tool when possible\\nawk \u0027/foo/ { gsub(/bar/, \\\"baz\\\"); print $2; count++ } END { print count }\u0027 file\\n```\\n\\n**PREFER** heredoc and ed/vi for edits:\\n\\n```sh\\n# BAD: Multiple sed invocations\\nsed -i \u0027s/old1/new1/\u0027 file\\nsed -i \u0027s/old2/new2/\u0027 file\\nsed -i \u0027s/old3/new3/\u0027 file\\n\\n# GOOD: Single heredoc with ed\\ned -s file \u003c\u003c\u0027EOF\u0027\\n%s/old1/new1/g\\n%s/old2/new2/g\\n%s/old3/new3/g\\nw\\nq\\nEOF\\n\\n# GOOD: Single sed with multiple expressions\\nsed -i -e \u0027s/old1/new1/g\u0027 -e \u0027s/old2/new2/g\u0027 -e \u0027s/old3/new3/g\u0027 file\\n```\\n\\n### Search Tool Priority\\n\\nUse tools in this order (most efficient first):\\n\\n| Priority | Tool | Use Case |\\n|----------|------|----------|\\n| 1 | `grep -r` / `rg` | Known pattern, broad search |\\n| 2 | `find` + `-name` | Known filename pattern |\\n| 3 | `git grep` | Within git repo, respects .gitignore |\\n| 4 | Codebase semantic search | Concept/meaning-based queries |\\n| 5 | Web search | External documentation, APIs |\\n\\n### PowerShell Equivalents\\n\\n```powershell\\n# BAD: Pipeline abuse\\nGet-Content file.txt | Select-String pattern\\nGet-Content file.txt | Measure-Object -Line\\nGet-Content file.txt | ForEach-Object { $_.Split()[0] }\\n\\n# GOOD: Direct parameter usage\\nSelect-String -Path file.txt -Pattern pattern\\n(Get-Content file.txt).Count\\n(Get-Content file.txt) -replace \u0027pattern\u0027, \u0027replacement\u0027\\n\\n# GOOD: Single expression for complex operations\\nGet-Content file.txt | ForEach-Object -Begin { $count = 0 } -Process {\\n    if ($_ -match \u0027pattern\u0027) { $count++ }\\n} -End { $count }\\n```\\n\\n### The Suckless Test\\n\\nBefore executing a command chain, ask:\\n\\n1. Can this be done with ONE tool instead of many?\\n2. Am I piping cat/Get-Content unnecessarily?\\n3. Would a heredoc/here-string be cleaner?\\n4. Is there a built-in flag that eliminates a pipeline stage?\\n5. Am I using awk/sed when grep alone suffices (or vice versa)?\\n\\n**Rule of thumb:** If your command has more than 2 pipes, reconsider the approach.\\n\\n---\\n\\n## RESOLVED: Agent Shell Bug Workaround (Windows 11)\\n\\n**Status:** RESOLVED as of 2025-12-14. Shell tool now works correctly.\\n\\n**History:** Between 2025-12-07 and 2025-12-14, Cursor Shell tool returned `pid: -1` on Windows 11 (build 26200, Cursor 2.1.50+). This has been fixed.\\n\\n### File-Based Shell Bridge (Archived - For Reference Only)\\n\\nThe bridge workaround below is no longer needed but preserved for reference if the issue recurs.\\n\\n\u003cdetails\u003e\\n\u003csummary\u003eClick to expand archived workaround\u003c/summary\u003e\\n\\nWhen the Cursor Shell tool fails, use `agent-shell-bridge.ps1` which runs in the user\u0027s manual terminal.\\n\\n**To execute shell commands:**\\n\\n1. Write command to `.agent-command.txt` using the Write tool\\n2. Wait briefly, then read `.agent-status.txt` (should say `DONE`)\\n3. Read result from `.agent-result.txt`\\n\\n**Example:**\\n\\n```\\n# Step 1: Write command\\nWrite tool -\u003e .agent-command.txt -\u003e \\\"hostname; Get-Date\\\"\\n\\n# Step 2: Check status\\nRead tool -\u003e .agent-status.txt -\u003e \\\"DONE\\\"\\n\\n# Step 3: Read result\\nRead tool -\u003e .agent-result.txt -\u003e \\\"EXIT_CODE=0\\\\nDESKTOP-7KTB236\\\\n...\\\"\\n```\\n\\n**Files:**\\n\\n| File | Purpose |\\n|------|---------|\\n| `.agent-command.txt` | Write your command here (bridge consumes it) |\\n| `.agent-status.txt` | READY/RUNNING/DONE |\\n| `.agent-result.txt` | EXIT_CODE=N followed by output |\\n| `agent-shell-bridge.ps1` | The bridge script (user starts once) |\\n\\n\u003c/details\u003e\\n\\n---\\n\\n---\\n\\n## Known Issues: BROKEN_SCRIPTS.md\\n\\nBefore using or modifying scripts, check `BROKEN_SCRIPTS.md` for:\\n\\n- Scripts that silently skip critical functionality\\n- Useless Use of Cat (UUoC) patterns in shell scripts\\n- Placeholder values that should be complete functions\\n- Templates with unsubstituted variables\\n- Scripts requiring verification\\n\\n**When a script fails during agent operations:**\\n1. Do NOT attempt to fix inline\\n2. Add to `BROKEN_SCRIPTS.md` with filename, filepath, and issue description\\n3. Mark as unchecked `[ ]`\\n4. Only check off `[x]` when fully verified working\\n\\n---\\n\\n## Helper Script Index (General-Purpose Building Blocks)\\n\\n**These are GENERAL scripts.** Combine them to accomplish SPECIFIC tasks. Do not expect a dedicated script for every operation.\\n\\nAll scripts are in `github-backup/cursor-project-scaffolding-backup/ludoplex-cursor-project-scaffolding-backup-*/`\\n\\n### Project Scaffolding (General)\\n\\n| Task | Script | Config |\\n|------|--------|--------|\\n| Create new project | `new-project.sh` / `New-Project-v5.ps1` / `New-Project-v7.ps1` | `project.cfg` |\\n| Watch/backup files | `watch-project.sh` / `Watch-Project-v5.ps1` / `Watch-Project-v7.ps1` | `watcher.cfg` |\\n| Process templates | `Invoke-Template.ps1` | (inline params) |\\n\\n### Git Operations (git-ops/) - General\\n\\n| Task | Script |\\n|------|--------|\\n| Create GitHub repo | `New-Repo.ps1` / `new-repo.sh` |\\n| Clone with backup | `Import-Repo.ps1` / `import-repo.sh` (legacy) |\\n\\n### Import Repository (github-backup/) - General, with gh fallback\\n\\n| Task | Script | Config |\\n|------|--------|--------|\\n| Import repo | `import-repo.sh` / `Import-Repo-v5.ps1` / `Import-Repo-v7.ps1` | `import-repo.cfg` |\\n\\nTries git clone first, falls back to gh api zip download when git fails.\\n| Create branch | `New-Branch.ps1` / `new-branch.sh` |\\n| Archive project | `Archive-Repo.ps1` / `archive-repo.sh` |\\n| Sync backups | `Sync-Backup.ps1` / `sync-backup.sh` |\\n| Update index | `Update-RepoIndex.ps1` / `update-index.sh` |\\n\\n### Utilities (utils/) - General Search/Reconnaissance\\n\\n| Task | Script |\\n|------|--------|\\n| Project tree | `Get-ProjectStructure.ps1` |\\n| Find files | `Search-Files.ps1` / `search-files.sh` |\\n| Search content | `Search-Content.ps1` / `search-content.sh` |\\n\\n**Note:** These wrap grep/find with sensible defaults. Use directly when wrappers add overhead.\\n\\n### Production Readiness (prr/)\\n\\n| Task | Script |\\n|------|--------|\\n| Run PRR checks | `Invoke-PRR.ps1` / `prr-check.sh` |\\n\\n### Network Diagnostics (templates/network/)\\n\\n| Task | Script (Windows) | Script (POSIX) | Config |\\n|------|------------------|----------------|--------|\\n| Port scanning | `Invoke-NetworkScan-v7.ps1` | `network-scan.sh` | `network.cfg` |\\n| DNS diagnostics | `Invoke-DnsDiagnostics-v7.ps1` | `dns-diagnostics.sh` | `network.cfg` |\\n| Network forensics | `Invoke-NetworkForensics-v7.ps1` | `network-forensics.sh` | `network.cfg` |\\n| Infrastructure MITM audit | `Invoke-MitmAudit-v7.ps1` | `mitm-audit.sh` | `mitm-audit.cfg` |\\n| Packet capture | `Invoke-PacketCapture-v7.ps1` (pktmon) | `packet-capture.sh` (tcpdump) | `network.cfg` |\\n| Background wrapper | `Invoke-BackgroundDiagnostics-v7.ps1` | (use nohup/\u0026) | `network.cfg` |\\n\\nDetects: DNS hijacking, ARP spoofing, LLMNR poisoning, suspicious connections, firewall issues.\\n\\n**MITM Audit specifically detects:**\\n- ASN integrity violations (Google traffic not going to Google ASN)\\n- DoH vs local DNS discrepancies\\n- Certificate anomalies (Let\u0027s Encrypt on accounts.google.com)\\n- Enterprise MITM tools in root CA store\\n- Traffic routing through VPS providers (DigitalOcean, Linode, etc.)\\n- Client-side exploits (proxy settings, browser extensions, hosts file)\\n\\n### Linting (workspace root)\\n\\n| Task | Script | Config |\\n|------|--------|--------|\\n| Aggregate linting | `lint-project.sh` / `Lint-Project-v5.ps1` / `Lint-Project-v7.ps1` | `lint.cfg` |\\n\\nRuns C, Shell, PowerShell, JSON, YAML, Markdown linters plus ROSE-style policy checks:\\n- No tab characters in source files\\n- Maximum line length (default 132)\\n- Unix line endings (LF not CRLF)\\n- No \\\"using\\\" directives in headers\\n\\n### Nuclei Vulnerability Scanning (nuclei-ops/)\\n\\n| Task | Script | Config |\\n|------|--------|--------|\\n| Run nuclei scan | `nuclei-scan.sh` / `Invoke-NucleiScan-v5.ps1` / `Invoke-NucleiScan-v7.ps1` | `nuclei-scan.cfg` |\\n\\nFeatures: Unified config for target, templates, rate limiting, output format. Auto-detects nuclei binary.\\n\\n### Cursor Backup Extension (cursor-backup-ops/)\\n\\n| Task | Script | Config |\\n|------|--------|--------|\\n| Install extension | `install-backup-extension.sh` / `Install-BackupExtension-v5.ps1` / `Install-BackupExtension-v7.ps1` | `backup-extension.cfg` |\\n\\nFeatures: Builds TypeScript, packages VSIX, auto-detects IDE (Cursor/VS Code/Codium).\\n\\n### Portmaster DNS Firewall (portmaster-ops/)\\n\\n| Task | Script | Config |\\n|------|--------|--------|\\n| Status check | `portmaster-status.sh` / `Get-PortmasterStatus-v5.ps1` / `Get-PortmasterStatus-v7.ps1` | `portmaster.cfg` |\\n| Full diagnostics | `Invoke-PortmasterDiagnostics-v7.ps1` | `portmaster.cfg` |\\n\\n### WSL2 KVM for Docker-OSX (wsl-kvm-ops/)\\n\\n| Task | Script | Config |\\n|------|--------|--------|\\n| Enable features | `Install-WslKvm-v5.ps1 -Step Features` | `wsl-kvm.cfg` |\\n| Install distro | `Install-WslKvm-v5.ps1 -Step Distro` | `wsl-kvm.cfg` |\\n| Build KVM kernel | `Install-WslKvm-v5.ps1 -Step Kernel` | `wsl-kvm.cfg` |\\n| Configure WSL | `Install-WslKvm-v5.ps1 -Step Configure` | `wsl-kvm.cfg` |\\n| Setup Docker-OSX | `Install-WslKvm-v5.ps1 -Step DockerOsx` | `wsl-kvm.cfg` |\\n| Check status | `Install-WslKvm-v5.ps1 -Step Status` | `wsl-kvm.cfg` |\\n\\nWorkflow: Features (reboot) -\u003e Distro -\u003e Kernel -\u003e Configure -\u003e DockerOsx\\n\\nFeatures:\\n- Detects if Portmaster is sole DNS resolver (`noAssignedNameservers: true`)\\n- Tests DoT (DNS-over-TLS) server connectivity\\n- Compares DNS resolution through Portmaster vs external servers\\n- Analyzes logs for blocked connections and resolver failures\\n- Identifies common DNS error patterns (0.0.0.17, .lan suffix, no compliant resolvers)\\n\\nKey Portmaster paths:\\n- Config: `C:\\\\ProgramData\\\\Portmaster\\\\config.json`\\n- Logs: `C:\\\\ProgramData\\\\Portmaster\\\\logs\\\\`\\n- UI: `http://127.0.0.1:817`\\n\\n---\\n\\n## Token Savings Example\\n\\n**WITHOUT scripts** (agent generates each command):\\n```powershell\\ngh repo create owner/name --private\\ngh repo create owner/name-backup --private\\ncd /path/to/project\\ngit init\\ngit remote add origin https://github.com/owner/name.git\\ngit remote add backup https://github.com/owner/name-backup.git\\ngit add -A\\ngit commit -s -m \\\"Initial commit\\\"\\ngit branch -M main\\ngit push -u origin main\\ngit push backup main\\n```\\n**Tokens: ~800-1200**\\n\\n**WITH scripts** (single invocation):\\n```powershell\\n.\\\\git-ops\\\\New-Repo.ps1 -Path \\\".\\\" -Private -WithBackup\\n```\\n**Tokens: ~50** (94% savings)\\n\\n---\\n\\n## Agent Instruction Files\\n\\nProject-specific agent instructions are in `.copilot/` directories:\\n\\n| Agent | Purpose | File |\\n|-------|---------|------|\\n| checks-agent | CI/CD monitoring | `checks-agent-instructions.md` |\\n| code-maintainer | C/ASM code quality | `code-maintainer-instructions.md` |\\n| database-maintainer | SQLite schema/migrations | `database-maintainer-instructions.md` |\\n| docs-maintainer | Documentation quality | `docs-maintainer-instructions.md` |\\n| github-actions-agent | Workflow management | `github-actions-agent-instructions.md` |\\n| prd-agent | Requirements alignment | `prd-agent-instructions.md` |\\n| test-runner | Test execution | `test-runner-instructions.md` |\\n| validator | Script/config validation | `validator-instructions.md` |\\n| workflow-maintainer | CI/CD configuration | `workflow-maintainer-instructions.md` |\\n\\n---\\n\\n## Template System\\n\\nTemplates in `templates/` use `{{VARIABLE}}` substitution:\\n\\n- `templates/base/` - Common files (LICENSE, README, CONTRIBUTING)\\n- `templates/languages/` - Language-specific (c, python, rust, go, sh, powershell)\\n- `templates/ci-cd/` - CI/CD workflows (github-actions)\\n- `templates/platforms/` - Platform-specific\\n\\nInvoke with:\\n```powershell\\n.\\\\Invoke-Template.ps1 -ConfigFile project.cfg -Language c -OutputPath ./my-project\\n```\\n\\n---\\n\\n## Platform Detection\\n\\nScripts auto-detect platform and set defaults:\\n\\n| Platform | Shell | Language | Assembly |\\n|----------|-------|----------|----------|\\n| Windows x64 | PowerShell | C17 | MASM/AMD64 |\\n| Windows ARM64 | PowerShell | C17 | ARM64 |\\n| macOS x64 | sh | C17 | AMD64 |\\n| macOS ARM64 | sh | C17 | A64 |\\n| Linux x64 | sh | C17 | AMD64 |\\n| Linux ARM64 | sh | C17 | A64 |\\n\\n---\\n\\n## Before Generating Code\\n\\n1. Check if a helper script exists for the task\\n2. Use `Search-Files.ps1` to find relevant templates\\n3. Use `Get-ProjectStructure.ps1` to understand layout\\n4. Read relevant `.copilot/*-instructions.md` files\\n5. Follow PRR guidelines for production readiness\\n\\n---\\n\\n## Background Execution for Long-Running Processes\\n\\nWhen running scripts that have no definite end time (diagnostics, watchers, packet captures, servers), use background execution to avoid blocking the agent session.\\n\\n### Problem\\n\\nAgent tool calls timeout when scripts run too long. Scripts that:\\n- Collect data over extended periods (packet capture, forensics)\\n- Watch for file changes indefinitely\\n- Wait for network events\\n- Run servers or daemons\\n\\nwill cause `Tool call errored or timed out` errors.\\n\\n### Solution: Background Wrapper Pattern\\n\\n**Windows (PowerShell 7+):**\\n```powershell\\n# Use the background diagnostics wrapper\\n.\\\\templates\\\\network\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script NetworkForensics -OutputPath .\\\\results\\n\\n# Or run any script in background with output capture\\n$job = Start-Job -ScriptBlock { \u0026 .\\\\SomeLongScript.ps1 *\u003e\u00261 | Tee-Object -FilePath .\\\\output.txt }\\n\\n# Check status later\\nGet-Content .\\\\diagnostics-output\\\\*-status.json\\nGet-Content .\\\\diagnostics-output\\\\*-stdout.txt\\n```\\n\\n**Unix (POSIX sh):**\\n```sh\\n# Run with nohup and redirect output\\nnohup ./network-forensics.sh -o ./results \u003e ./forensics.log 2\u003e\u00261 \u0026\\necho $! \u003e ./forensics.pid\\n\\n# Check status later\\ncat ./forensics.log\\nkill -0 $(cat ./forensics.pid) \u0026\u0026 echo \\\"Still running\\\" || echo \\\"Completed\\\"\\n```\\n\\n### Background Wrapper Scripts\\n\\n| Task | Script | Output |\\n|------|--------|--------|\\n| Network diagnostics | `Invoke-BackgroundDiagnostics-v7.ps1` | `*-status.json`, `*-stdout.txt` |\\n| File watcher | `Watch-Project-v7.ps1` (run with Start-Job) | watcher.log |\\n| Packet capture | `Invoke-PacketCapture-v7.ps1` | ETL/PCAP files |\\n\\n### Agent Workflow for Background Tasks\\n\\n1. **Start**: Launch script with background wrapper, capture job/PID\\n2. **Continue**: Proceed with other tasks while script runs\\n3. **Check**: Read status file or stdout file to get results\\n4. **Retrieve**: Parse JSON output files for programmatic access\\n\\n### Example: Network Diagnostics\\n\\n```powershell\\n# Start forensics in background (returns immediately)\\n.\\\\templates\\\\network\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script NetworkForensics -OutputPath .\\\\forensics-results\\n\\n# Do other work...\\n\\n# Later, check results\\nGet-Content .\\\\forensics-results\\\\*-status.json | ConvertFrom-Json\\nGet-Content .\\\\forensics-results\\\\*-stdout.txt\\nGet-Content .\\\\forensics-results\\\\summary.json | ConvertFrom-Json\\n```\\n\\n### Key Files After Background Execution\\n\\n| File | Purpose |\\n|------|---------|\\n| `*-status.json` | Job state: Running/Completed/Failed, timestamps, exit code |\\n| `*-stdout.txt` | Captured console output |\\n| `*-stderr.txt` | Error output (if any) |\\n| `summary.json` | Structured results from the diagnostic script |\\n\\n### Critical Rule\\n\\n**DO NOT** run these scripts directly via `run_terminal_cmd` without background:\\n- `Invoke-NetworkForensics-v7.ps1`\\n- `Invoke-PacketCapture-v7.ps1`\\n- `Watch-Project-*.ps1`\\n- Any script with indefinite runtime\\n\\n**DO** use `Invoke-BackgroundDiagnostics-v7.ps1` or `Start-Job` wrapper, then read output files.\\n\\n---\\n\\n## Config File Format\\n\\nUniversal `.cfg` files use `KEY=VALUE` format:\\n\\n```\\n# Comment lines start with #\\nPROJECT_NAME=MyApp\\nTYPE=cli\\nLANGUAGE=c\\nAUTHOR=username\\nLICENSE=BSD-2-Clause\\nBACKUP_ENABLED=true\\n```\\n\\nParsed identically by all three script consumers.\\n\\n---\\n\\n## Validation Before Commit\\n\\nRun these before declaring work complete:\\n\\n```powershell\\n# Aggregate linting (uses lint.cfg)\\n.\\\\Lint-Project-v7.ps1       # PowerShell 7+ (Windows/macOS/Linux)\\n.\\\\Lint-Project-v5.ps1       # PowerShell 5.1 (Windows 10)\\n./lint-project.sh           # POSIX shell (macOS/Linux)\\n```\\n\\n```sh\\n# Project-specific validation\\n./scripts/workflows.sh      # Validate GitHub Actions\\n./scripts/actions.sh        # Check action versions\\n./scripts/json-configs.sh   # Validate JSON files\\n./scripts/run-core-tests.sh # Run unit tests\\n```\\n\\n---\\n\\n## ROSE Policy Checkers\\n\\nIntegrated from `rose-1/scripts/policies/` (configure via `lint.cfg`):\\n\\n| Config Key | Check |\\n|-----------|-------|\\n| `ROSE_NO_TABS` | No tab characters in source |\\n| `ROSE_MAX_LINE_LENGTH` | Lines \u003c= N chars (default 132) |\\n| `ROSE_UNIX_LINE_ENDINGS` | LF only, no CRLF |\\n| `ROSE_NO_USING_IN_HEADERS` | No `using` directives in headers |\\n| `ROSE_CASE_INSENSITIVE_NAMES` | No files differing only by case |\\n| `ROSE_UNIQUE_HEADER_NAMES` | No duplicate header names |\\n\\nSet `ROSE_SOURCE_EXTENSIONS` to control which files are checked.\\n\\n---\\n\\n## Required Reading for New Sessions\\n\\n1. This file (`AGENT_ONBOARD.md`)\\n2. Project\u0027s `.cursorrules` if present\\n3. Project\u0027s `.copilot/` agent instructions if present\\n4. `git-ops/agent-instructions.md` for Git operations\\n5. `prr/agent-instructions-cursor.md` for production readiness\\n\\n---\\n\\n**DO NOT:**\\n- Generate multi-command sequences when a single script exists\\n- Assume a task-specific script exists for every operation\\n- Use cat/Get-Content in pipelines when direct tool invocation works\\n- Chain awk/sed/wc when a single tool with flags suffices\\n- Ask the user to run commands or copy-paste output\\n\\n**DO:**\\n- Compose GENERAL scripts to accomplish SPECIFIC tasks\\n- Apply Fravia search strategy before grepping blindly\\n- Use suckless principles: minimum complexity, maximum effect\\n- Prefer heredoc/ed for multi-line edits over repeated sed calls\\n- Invoke scripts with appropriate parameters; extend only when necessary\\n\\n---\\n\\nGenerated: 2025-12-01\\nUpdated: 2025-12-14 (shell bug resolved)\\nPurpose: Agent onboarding for token efficiency\\n\\n\"}"},"checkpointId":"65163e59-18e5-4194-8c96-002d32e42ffc"},"bubbleId":"6462060b-5f26-49c8-b450-acdda9a62a82"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"6539fa28-84a2-4e7b-a609-45fd43c2622b","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:34:28.798Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"text":"I\u0027ll first read the `AGENT_ONBOARD.md` as required by the workspace rules, then reconcile these scripts into a unified forensic evidence system.","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878"},"bubbleId":"6539fa28-84a2-4e7b-a609-45fd43c2622b"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"705e6296-1911-4a3e-a8e2-2c53a3db45d3","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:34:47.291Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"text":"Let me examine the existing network forensics scripts and the templates directory structure:","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878"},"bubbleId":"705e6296-1911-4a3e-a8e2-2c53a3db45d3"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"730de21b-f776-4df3-9b9c-ba38eaa5f475","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:35:04.634Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","capabilityType":15,"toolFormerData":{"tool":40,"toolIndex":1,"modelCallId":"7848ff73-4eef-46fc-916d-d1213162695c","toolCallId":"toolu_01URKLfEzcjHEwZ59zSxGU3r","status":"completed","rawArgs":"{\"target_file\": \"templates/network/network.cfg\"}","name":"read_file","params":"{\"targetFile\":\"templates/network/network.cfg\",\"charsLimit\":100000,\"effectiveUri\":\"file:///c%3A/Users/user/Downloads/Cursor_working_directory_misc/templates/network/network.cfg\"}","additionalData":{},"result":"{\"contents\":\"# Network Diagnostics Configuration\\r\\n# Format: KEY=VALUE (consumed by POSIX sh, PowerShell v5, PowerShell v7)\\r\\n\\r\\n# Target Configuration\\r\\nTARGET_HOST=192.168.1.1\\r\\nTARGET_NETWORK=192.168.1.0/24\\r\\nSCAN_PORTS=21,22,23,25,53,80,443,445,3389,8080,8443\\r\\n\\r\\n# DNS Configuration\\r\\nDNS_SERVERS=1.1.1.1,8.8.8.8,9.9.9.9\\r\\nDNS_TEST_DOMAINS=api2.cursor.sh,github.com,google.com\\r\\n\\r\\n# Scan Configuration\\r\\nSCAN_TIMEOUT_MS=500\\r\\nSCAN_THREADS=10\\r\\nPING_COUNT=4\\r\\n\\r\\n# Output Configuration\\r\\nOUTPUT_DIR=./network-diagnostics\\r\\nLOG_LEVEL=INFO\\r\\nTIMESTAMP_FORMAT=yyyy-MM-dd_HH-mm-ss\\r\\n\\r\\n# Forensics Configuration\\r\\nCAPTURE_DURATION_SEC=60\\r\\nCAPTURE_INTERFACE=Ethernet\\r\\nSAVE_PCAP=false\\r\\n\\r\\n# Packet Capture Configuration\\r\\nCAPTURE_SNAPLEN=0\\r\\nCAPTURE_MAX_SIZE_MB=512\\r\\nCAPTURE_ROTATE_COUNT=10\\r\\nCAPTURE_TIMESTAMP_PRECISION=nano\\r\\nCAPTURE_BUFFER_SIZE=4096\\r\\nCAPTURE_CONVERT_PCAPNG=true\\r\\n\\r\\n# Security\\r\\nREQUIRE_ADMIN=true\\r\\nSAFE_MODE=true\\r\\n\\r\\n\",\"numCharactersInRequestedRange\":894,\"totalLinesInFile\":40}"}},"bubbleId":"730de21b-f776-4df3-9b9c-ba38eaa5f475"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"76f96166-067f-445c-8831-b7401dcf2ec3","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:40:56.262Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","serverBubbleId":"6082cccc-0258-4b07-ba9a-eb32f066c8db","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","capabilityType":30,"thinking":{"text":"Now let me also update the AGENT_ONBOARD.md to include the new MITM audit scripts in the helper script index.","signature":"EpUCCkYIChgCKkBX1NLja5mgL+dhU/7Y7Zx7NlWKHVocBfpqM4CzlvMMFxvas+/Etjod/n4/EMyDeV0V50GxCKufhMCLaJCsWwWOEgxdR1OvCDOHH3pWVLwaDCMWO1Dyv1NPqLVDCyIweMp78dQ3kRTAgR4oUs008Ivay/EYI9fX/i69N3HFye4b4X6ETSqFiJLTQRAIDcoxKn0VyzVHKG4K4+6MVG/YLVwPv3H3eXBeIdIKeAZPxkFv7Po4MRB3lVDL3qyBwmP/g3zrPy0CU2MU+XqVuSEmQY0SOhf0cGxaL+h4ItpQPHr2FFYl5gGbBO0mUcFSOO3T3uSLMYLx6rpYscdfg+sa9FCnMeOx2ZH/TeB3xJ0DChgB"},"thinkingStyle":1,"thinkingDurationMs":1161},"bubbleId":"76f96166-067f-445c-8831-b7401dcf2ec3"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"825647f8-93c2-4a68-8426-4ec22311fecb","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:37:40.973Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[{"uri":{"scheme":"file","authority":"","path":"/c:/Users/user/Downloads/Cursor_working_directory_misc/templates/network/mitm-audit.sh","query":"","fragment":"","_formatted":"file:///c%3A/Users/user/Downloads/Cursor_working_directory_misc/templates/network/mitm-audit.sh","_fsPath":null},"codeblockId":"0c1f10d2-800b-4578-a95c-7358281ae534","codeBlockIdx":0,"content":"#!/bin/sh\n# Infrastructure MITM Audit - Forensic Evidence Collection for TLS Interception Detection\n# License: BSD-2-Clause\n# Signed-off-by: Network Diagnostics Toolkit\n#\n# Combines environment baselining, Root CA dumping, ASN-based integrity checking,\n# and DoH comparison to detect infrastructure-side Man-in-the-Middle attacks while\n# ruling out client-side exploits.\n#\n# Produces a timestamped evidence package suitable for chain of custody.\n#\n# Usage: ./mitm-audit.sh [OPTIONS]\n#   -c, --config FILE    Path to mitm-audit.cfg\n#   -o, --output DIR     Output directory (default: ~/ForensicEvidence_timestamp)\n#   -t, --targets LIST   Override targets (comma-separated)\n#   --skip-traceroute    Skip traceroute collection\n#   --skip-client-side   Skip client-side exploit detection\n#   -h, --help           Show this help\n#\n# EVIDENCE PROCESSING:\n# 1. Check _RedFlags.txt first - if empty, MITM may be passive/logging only\n# 2. Certificate Serial Check - copy serial to crt.sh on clean device\n#    - If \"No certificates found\": 100% MITM by private root CA\n#    - If cert shown for different domain: collision/hash attack\n# 3. Zip evidence folder, hash the zip for chain of custody\n\nset -e\n\n#######################################\n# Default Configuration\n#######################################\nTARGETS=\"accounts.google.com login.microsoftonline.com appleid.apple.com aws.amazon.com github.com\"\nPUBLIC_RESOLVERS=\"1.1.1.1 8.8.8.8 9.9.9.9\"\nDOH_ENDPOINT=\"https://dns.google/resolve\"\nASN_LOOKUP_URL=\"http://ip-api.com/json\"\nASN_LOOKUP_TIMEOUT=3\nEXTERNAL_IP_URL=\"https://ipinfo.io/json\"\nEXTERNAL_IP_TIMEOUT=5\nEXPECTED_ISP_PATTERNS=\"\"\nSUSPICIOUS_ASN_PATTERNS=\"DigitalOcean Linode Vultr Choopa Datacamp OVH Hetzner\"\nSUSPICIOUS_CERT_ISSUERS=\"Let\u0027s Encrypt ZeroSSL Self-Signed localhost\"\nTRACEROUTE_MAX_HOPS=15\nTRACEROUTE_TIMEOUT=2\nTRACEROUTE_ENABLED=1\nEXPORT_ROOT_CA=1\nHASH_ROOT_CA=1\nCHECK_PROXY_SETTINGS=1\nCHECK_HOSTS_FILE=1\nCHECK_ROOT_CA_ANOMALIES=1\nHASH_ALGORITHM=\"sha256\"\nSKIP_TRACEROUTE=0\nSKIP_CLIENT_SIDE=0\n\n#######################################\n# Variables\n#######################################\nBASE_DIR=\"\"\nLOG_FILE=\"\"\nALERT_FILE=\"\"\nTIMESTAMP=\"\"\n\n#######################################\n# Usage\n#######################################\nusage() {\n    cat \u003c\u003c \u0027EOF\u0027\nUsage: mitm-audit.sh [OPTIONS]\n\nInfrastructure MITM Audit - Forensic Evidence Collection\n\nOptions:\n    -c, --config FILE    Path to mitm-audit.cfg\n    -o, --output DIR     Output directory (default: ~/ForensicEvidence_timestamp)\n    -t, --targets LIST   Override targets (comma-separated)\n    --skip-traceroute    Skip traceroute collection\n    --skip-client-side   Skip client-side exploit detection\n    -h, --help           Show this help\n\nExamples:\n    ./mitm-audit.sh\n    ./mitm-audit.sh -c ./mitm-audit.cfg\n    ./mitm-audit.sh -t \"accounts.google.com,github.com\"\n    ./mitm-audit.sh --skip-traceroute\n\nEvidence Processing:\n    1. Review _RedFlags.txt first\n    2. Check certificate serials against crt.sh (on clean network)\n    3. Zip evidence folder and hash for chain of custody\nEOF\n    exit 0\n}\n\n#######################################\n# Configuration Loading\n#######################################\nload_config() {\n    config_file=\"$1\"\n    if [ ! -f \"$config_file\" ]; then\n        echo \"[WARN] Config file not found: $config_file (using defaults)\"\n        return\n    fi\n\n    while IFS=\u0027=\u0027 read -r key value; do\n        # Skip comments and empty lines\n        case \"$key\" in\n            \\#*|\"\") continue ;;\n        esac\n        # Remove leading/trailing whitespace\n        key=$(echo \"$key\" | sed \u0027s/^[[:space:]]*//;s/[[:space:]]*$//\u0027)\n        value=$(echo \"$value\" | sed \u0027s/^[[:space:]]*//;s/[[:space:]]*$//\u0027)\n\n        case \"$key\" in\n            TARGETS) TARGETS=$(echo \"$value\" | tr \u0027,\u0027 \u0027 \u0027) ;;\n            PUBLIC_RESOLVERS) PUBLIC_RESOLVERS=$(echo \"$value\" | tr \u0027,\u0027 \u0027 \u0027) ;;\n            DOH_ENDPOINT) DOH_ENDPOINT=\"$value\" ;;\n            ASN_LOOKUP_URL) ASN_LOOKUP_URL=\"$value\" ;;\n            ASN_LOOKUP_TIMEOUT_SEC) ASN_LOOKUP_TIMEOUT=\"$value\" ;;\n            EXTERNAL_IP_URL) EXTERNAL_IP_URL=\"$value\" ;;\n            EXTERNAL_IP_TIMEOUT_SEC) EXTERNAL_IP_TIMEOUT=\"$value\" ;;\n            EXPECTED_ISP_PATTERNS) EXPECTED_ISP_PATTERNS=$(echo \"$value\" | tr \u0027,\u0027 \u0027 \u0027) ;;\n            SUSPICIOUS_ASN_PATTERNS) SUSPICIOUS_ASN_PATTERNS=$(echo \"$value\" | tr \u0027,\u0027 \u0027 \u0027) ;;\n            SUSPICIOUS_CERT_ISSUERS) SUSPICIOUS_CERT_ISSUERS=$(echo \"$value\" | tr \u0027,\u0027 \u0027 \u0027) ;;\n            TRACEROUTE_MAX_HOPS) TRACEROUTE_MAX_HOPS=\"$value\" ;;\n            TRACEROUTE_TIMEOUT_SEC) TRACEROUTE_TIMEOUT=\"$value\" ;;\n            TRACEROUTE_ENABLED) [ \"$value\" = \"true\" ] \u0026\u0026 TRACEROUTE_ENABLED=1 || TRACEROUTE_ENABLED=0 ;;\n            EXPORT_ROOT_CA) [ \"$value\" = \"true\" ] \u0026\u0026 EXPORT_ROOT_CA=1 || EXPORT_ROOT_CA=0 ;;\n            HASH_ROOT_CA) [ \"$value\" = \"true\" ] \u0026\u0026 HASH_ROOT_CA=1 || HASH_ROOT_CA=0 ;;\n            CHECK_PROXY_SETTINGS) [ \"$value\" = \"true\" ] \u0026\u0026 CHECK_PROXY_SETTINGS=1 || CHECK_PROXY_SETTINGS=0 ;;\n            CHECK_HOSTS_FILE) [ \"$value\" = \"true\" ] \u0026\u0026 CHECK_HOSTS_FILE=1 || CHECK_HOSTS_FILE=0 ;;\n            CHECK_ROOT_CA_ANOMALIES) [ \"$value\" = \"true\" ] \u0026\u0026 CHECK_ROOT_CA_ANOMALIES=1 || CHECK_ROOT_CA_ANOMALIES=0 ;;\n            HASH_ALGORITHM) HASH_ALGORITHM=\"$value\" ;;\n        esac\n    done \u003c \"$config_file\"\n}\n\n#######################################\n# Logging Functions\n#######################################\ninit_output_dir() {\n    TIMESTAMP=$(date +\"%Y%m%d_%H%M%S\")\n\n    if [ -n \"$1\" ]; then\n        BASE_DIR=\"$1\"\n    else\n        BASE_DIR=\"$HOME/ForensicEvidence_$TIMESTAMP\"\n    fi\n\n    mkdir -p \"$BASE_DIR\"\n    LOG_FILE=\"$BASE_DIR/_AuditLog.txt\"\n    ALERT_FILE=\"$BASE_DIR/_RedFlags.txt\"\n\n    : \u003e \"$ALERT_FILE\"\n}\n\nlog() {\n    level=\"${2:-INFO}\"\n    timestamp=$(date +\"%Y-%m-%d %H:%M:%S\")\n    msg=\"[$timestamp] [$level] $1\"\n    echo \"$msg\"\n    echo \"$msg\" \u003e\u003e \"$LOG_FILE\"\n}\n\nalert() {\n    timestamp=$(date +\"%Y-%m-%d %H:%M:%S\")\n    echo \"[!] $1\"\n    echo \"[$timestamp] $1\" \u003e\u003e \"$ALERT_FILE\"\n    log \"$1\" \"ALERT\"\n}\n\nprint_section() {\n    echo \"\"\n    echo \"======================================================================\"\n    echo \" $1\"\n    echo \"======================================================================\"\n    log \"=== $1 ===\" \"INFO\"\n}\n\nprint_subsection() {\n    echo \"\"\n    echo \"[*] $1\"\n    echo \"--------------------------------------------------\"\n    log \"--- $1 ---\" \"INFO\"\n}\n\n#######################################\n# ASN and DNS Functions\n#######################################\nget_asn() {\n    ip=\"$1\"\n    result=$(curl -s --max-time \"$ASN_LOOKUP_TIMEOUT\" \"${ASN_LOOKUP_URL}/${ip}?fields=status,message,org,as\" 2\u003e/dev/null || echo \"\")\n\n    if [ -z \"$result\" ]; then\n        echo \"Lookup Failed (Blocked?)\"\n        return\n    fi\n\n    status=$(echo \"$result\" | grep -o \u0027\"status\":\"[^\"]*\"\u0027 | cut -d\u0027\"\u0027 -f4)\n    if [ \"$status\" = \"success\" ]; then\n        org=$(echo \"$result\" | grep -o \u0027\"org\":\"[^\"]*\"\u0027 | cut -d\u0027\"\u0027 -f4)\n        as=$(echo \"$result\" | grep -o \u0027\"as\":\"[^\"]*\"\u0027 | cut -d\u0027\"\u0027 -f4)\n        echo \"$org ($as)\"\n    else\n        echo \"Unknown\"\n    fi\n}\n\nget_doh_resolution() {\n    domain=\"$1\"\n    result=$(curl -s --max-time 5 \"${DOH_ENDPOINT}?name=${domain}\u0026type=A\" 2\u003e/dev/null || echo \"\")\n\n    if [ -z \"$result\" ]; then\n        echo \"\"\n        return\n    fi\n\n    # Extract IP from Answer section (simplified JSON parsing)\n    echo \"$result\" | grep -o \u0027\"data\":\"[0-9.]*\"\u0027 | head -1 | cut -d\u0027\"\u0027 -f4\n}\n\ntest_asn_integrity() {\n    domain=\"$1\"\n    asn=\"$2\"\n\n    if [ \"$asn\" = \"Lookup Failed (Blocked?)\" ]; then\n        return 0\n    fi\n\n    alert_msg=\"\"\n\n    # Check Google\n    if echo \"$domain\" | grep -qi \"google\"; then\n        if ! echo \"$asn\" | grep -qi \"Google\"; then\n            alert_msg=\"MITM DETECTED: $domain resolving to non-Google ASN ($asn)\"\n        fi\n    fi\n\n    # Check Microsoft\n    if echo \"$domain\" | grep -qi \"microsoft\"; then\n        if ! echo \"$asn\" | grep -qi \"Microsoft\"; then\n            alert_msg=\"MITM DETECTED: $domain resolving to non-Microsoft ASN ($asn)\"\n        fi\n    fi\n\n    # Check Apple\n    if echo \"$domain\" | grep -qi \"apple\"; then\n        if ! echo \"$asn\" | grep -qi \"Apple\"; then\n            alert_msg=\"MITM DETECTED: $domain resolving to non-Apple ASN ($asn)\"\n        fi\n    fi\n\n    # Check Amazon\n    if echo \"$domain\" | grep -qi \"aws\\|amazon\"; then\n        if ! echo \"$asn\" | grep -qi \"Amazon\\|AMAZON\"; then\n            alert_msg=\"MITM DETECTED: $domain resolving to non-Amazon ASN ($asn)\"\n        fi\n    fi\n\n    # Check GitHub\n    if echo \"$domain\" | grep -qi \"github\"; then\n        if ! echo \"$asn\" | grep -qi \"GitHub\\|Microsoft\"; then\n            alert_msg=\"MITM DETECTED: $domain resolving to non-GitHub/Microsoft ASN ($asn)\"\n        fi\n    fi\n\n    # Check for suspicious VPS providers\n    if [ -z \"$alert_msg\" ]; then\n        for pattern in $SUSPICIOUS_ASN_PATTERNS; do\n            if echo \"$asn\" | grep -qi \"$pattern\"; then\n                alert_msg=\"MITM DETECTED: High-value target routed to VPS provider ($pattern)\"\n                break\n            fi\n        done\n    fi\n\n    if [ -n \"$alert_msg\" ]; then\n        echo \"$alert_msg\"\n        return 1\n    fi\n\n    return 0\n}\n\n#######################################\n# Certificate Functions\n#######################################\nget_tls_certificate() {\n    domain=\"$1\"\n    output_file=\"$2\"\n\n    if ! command -v openssl \u003e/dev/null 2\u003e\u00261; then\n        echo \"OpenSSL not available\" \u003e \"$output_file\"\n        return 1\n    fi\n\n    # Capture full certificate chain\n    echo | openssl s_client -showcerts -connect \"${domain}:443\" -servername \"$domain\" 2\u003e/dev/null \u003e \"${output_file}.pem\"\n\n    # Extract certificate details\n    cert_info_file=\"${output_file}.txt\"\n    {\n        echo \"=== Certificate Details for $domain ===\"\n        echo \"\"\n        echo \"Subject:\"\n        openssl x509 -in \"${output_file}.pem\" -noout -subject 2\u003e/dev/null || echo \"  Unable to extract\"\n        echo \"\"\n        echo \"Issuer:\"\n        openssl x509 -in \"${output_file}.pem\" -noout -issuer 2\u003e/dev/null || echo \"  Unable to extract\"\n        echo \"\"\n        echo \"Serial Number:\"\n        openssl x509 -in \"${output_file}.pem\" -noout -serial 2\u003e/dev/null || echo \"  Unable to extract\"\n        echo \"\"\n        echo \"Validity:\"\n        openssl x509 -in \"${output_file}.pem\" -noout -dates 2\u003e/dev/null || echo \"  Unable to extract\"\n        echo \"\"\n        echo \"Fingerprint (SHA256):\"\n        openssl x509 -in \"${output_file}.pem\" -noout -fingerprint -sha256 2\u003e/dev/null || echo \"  Unable to extract\"\n    } \u003e \"$cert_info_file\"\n\n    # Extract just serial and issuer for quick checking\n    serial=$(openssl x509 -in \"${output_file}.pem\" -noout -serial 2\u003e/dev/null | cut -d\u0027=\u0027 -f2)\n    issuer=$(openssl x509 -in \"${output_file}.pem\" -noout -issuer 2\u003e/dev/null)\n\n    echo \"$serial|$issuer\"\n}\n\ntest_certificate_anomaly() {\n    domain=\"$1\"\n    issuer=\"$2\"\n\n    # Check for suspicious issuers on major tech domains\n    is_major_tech=0\n    for pattern in google microsoft apple amazon github; do\n        if echo \"$domain\" | grep -qi \"$pattern\"; then\n            is_major_tech=1\n            break\n        fi\n    done\n\n    if [ \"$is_major_tech\" = \"1\" ]; then\n        for suspicious_issuer in $SUSPICIOUS_CERT_ISSUERS; do\n            if echo \"$issuer\" | grep -qi \"$suspicious_issuer\"; then\n                echo \"CERTIFICATE ANOMALY: $domain using $suspicious_issuer issuer - highly suspicious for major tech corp\"\n                return 1\n            fi\n        done\n    fi\n\n    return 0\n}\n\n#######################################\n# Phase 1: Environment Snapshot\n#######################################\nphase1_environment() {\n    print_section \"PHASE 1: ENVIRONMENT SNAPSHOT\"\n\n    env_dir=\"$BASE_DIR/environment\"\n    mkdir -p \"$env_dir\"\n\n    # Network configuration\n    print_subsection \"Network Configuration\"\n    {\n        echo \"=== Network Interfaces ===\"\n        if command -v ip \u003e/dev/null 2\u003e\u00261; then\n            ip addr show\n        elif command -v ifconfig \u003e/dev/null 2\u003e\u00261; then\n            ifconfig -a\n        else\n            echo \"No interface command available\"\n        fi\n    } \u003e \"$env_dir/NetworkConfig.txt\"\n\n    # DNS configuration\n    {\n        echo \"=== DNS Configuration ===\"\n        if [ -f /etc/resolv.conf ]; then\n            cat /etc/resolv.conf\n        fi\n    } \u003e\u003e \"$env_dir/NetworkConfig.txt\"\n\n    # External IP\n    print_subsection \"External IP Identification\"\n    ext_ip_json=$(curl -s --max-time \"$EXTERNAL_IP_TIMEOUT\" \"$EXTERNAL_IP_URL\" 2\u003e/dev/null || echo \"\")\n\n    if [ -n \"$ext_ip_json\" ]; then\n        echo \"$ext_ip_json\" \u003e \"$env_dir/ExternalIP.json\"\n\n        ext_ip=$(echo \"$ext_ip_json\" | grep -o \u0027\"ip\":\"[^\"]*\"\u0027 | cut -d\u0027\"\u0027 -f4)\n        ext_org=$(echo \"$ext_ip_json\" | grep -o \u0027\"org\":\"[^\"]*\"\u0027 | cut -d\u0027\"\u0027 -f4)\n        ext_city=$(echo \"$ext_ip_json\" | grep -o \u0027\"city\":\"[^\"]*\"\u0027 | cut -d\u0027\"\u0027 -f4)\n        ext_region=$(echo \"$ext_ip_json\" | grep -o \u0027\"region\":\"[^\"]*\"\u0027 | cut -d\u0027\"\u0027 -f4)\n        ext_country=$(echo \"$ext_ip_json\" | grep -o \u0027\"country\":\"[^\"]*\"\u0027 | cut -d\u0027\"\u0027 -f4)\n\n        log \"External IP: $ext_ip\"\n        log \"External Org: $ext_org\"\n        log \"Location: $ext_city, $ext_region, $ext_country\"\n\n        # Check expected ISP\n        if [ -n \"$EXPECTED_ISP_PATTERNS\" ]; then\n            is_expected=0\n            for pattern in $EXPECTED_ISP_PATTERNS; do\n                if echo \"$ext_org\" | grep -qi \"$pattern\"; then\n                    is_expected=1\n                    break\n                fi\n            done\n            if [ \"$is_expected\" = \"0\" ]; then\n                alert \"External IP Org ($ext_org) does not match expected ISP patterns - traffic may be tunneled/proxied\"\n            fi\n        fi\n    else\n        alert \"Unable to determine External IP - connection may be blocked or filtered\"\n    fi\n\n    # System info\n    print_subsection \"System Information\"\n    {\n        echo \"Hostname: $(hostname)\"\n        echo \"User: $(whoami)\"\n        echo \"Date: $(date)\"\n        echo \"Kernel: $(uname -a)\"\n        echo \"Timestamp: $(date -Iseconds 2\u003e/dev/null || date)\"\n    } \u003e \"$env_dir/SystemInfo.txt\"\n\n    log \"System: $(hostname) / User: $(whoami)\"\n}\n\n#######################################\n# Phase 2: Trust Store Export\n#######################################\nphase2_trust_store() {\n    print_section \"PHASE 2: TRUST STORE EXPORT\"\n\n    trust_dir=\"$BASE_DIR/trust-store\"\n    mkdir -p \"$trust_dir\"\n\n    if [ \"$EXPORT_ROOT_CA\" = \"0\" ]; then\n        log \"Root CA export disabled in configuration\"\n        return\n    fi\n\n    print_subsection \"Exporting Root CA Store\"\n\n    # Linux - common CA bundle locations\n    ca_exported=0\n    for ca_path in /etc/ssl/certs/ca-certificates.crt /etc/pki/tls/certs/ca-bundle.crt /etc/ssl/ca-bundle.pem; do\n        if [ -f \"$ca_path\" ]; then\n            cp \"$ca_path\" \"$trust_dir/RootCA_Snapshot.crt\"\n            log \"Root CA Store exported from $ca_path\"\n            ca_exported=1\n\n            if [ \"$HASH_ROOT_CA\" = \"1\" ]; then\n                hash_value=$(${HASH_ALGORITHM}sum \"$ca_path\" 2\u003e/dev/null | cut -d\u0027 \u0027 -f1 || shasum -a 256 \"$ca_path\" 2\u003e/dev/null | cut -d\u0027 \u0027 -f1)\n                echo \"{\\\"algorithm\\\":\\\"$HASH_ALGORITHM\\\",\\\"hash\\\":\\\"$hash_value\\\",\\\"source\\\":\\\"$ca_path\\\"}\" \u003e \"$trust_dir/RootCA_Hash.json\"\n                log \"Root CA hash: $hash_value\"\n            fi\n            break\n        fi\n    done\n\n    # macOS - export from Keychain\n    if [ \"$(uname)\" = \"Darwin\" ]; then\n        print_subsection \"Exporting macOS Keychain Root CAs\"\n        if command -v security \u003e/dev/null 2\u003e\u00261; then\n            security find-certificate -a -p /System/Library/Keychains/SystemRootCertificates.keychain \u003e \"$trust_dir/MacOS_SystemRoots.pem\" 2\u003e/dev/null || true\n            security find-certificate -a -p /Library/Keychains/System.keychain \u003e \"$trust_dir/MacOS_SystemKeychain.pem\" 2\u003e/dev/null || true\n            log \"macOS Root Keychains exported\"\n            ca_exported=1\n        fi\n    fi\n\n    if [ \"$ca_exported\" = \"0\" ]; then\n        log \"Could not locate CA bundle\" \"WARN\"\n    fi\n\n    # Anomaly detection for Linux/macOS (limited compared to Windows)\n    if [ \"$CHECK_ROOT_CA_ANOMALIES\" = \"1\" ] \u0026\u0026 [ -f \"$trust_dir/RootCA_Snapshot.crt\" ]; then\n        print_subsection \"Root CA Anomaly Detection\"\n\n        # Check for suspicious patterns in certificate subjects\n        suspicious_found=0\n        for pattern in \"Self\" \"Test\" \"Admin\" \"Local\" \"Proxy\" \"Intercept\" \"MITM\" \"Zscaler\" \"BlueCoat\" \"Forcepoint\"; do\n            matches=$(grep -i \"Subject:.*$pattern\" \"$trust_dir/RootCA_Snapshot.crt\" 2\u003e/dev/null || true)\n            if [ -n \"$matches\" ]; then\n                alert \"Suspicious Root CA pattern found: $pattern\"\n                echo \"$matches\" \u003e\u003e \"$trust_dir/SuspiciousCAs.txt\"\n                suspicious_found=1\n            fi\n        done\n\n        if [ \"$suspicious_found\" = \"0\" ]; then\n            log \"No suspicious root CAs detected by pattern matching\"\n        fi\n    fi\n}\n\n#######################################\n# Phase 3: Target Analysis\n#######################################\nphase3_target_analysis() {\n    print_section \"PHASE 3: TARGET ANALYSIS AND ASN INTEGRITY\"\n\n    targets_dir=\"$BASE_DIR/targets\"\n    mkdir -p \"$targets_dir\"\n\n    for domain in $TARGETS; do\n        print_subsection \"Analyzing: $domain\"\n\n        safe_domain=$(echo \"$domain\" | tr \u0027.\u0027 \u0027_\u0027)\n        domain_dir=\"$targets_dir/$safe_domain\"\n        mkdir -p \"$domain_dir\"\n\n        # A. Local DNS Resolution\n        local_ip=\"\"\n        if command -v dig \u003e/dev/null 2\u003e\u00261; then\n            local_ip=$(dig +short \"$domain\" A | tail -n1)\n        elif command -v host \u003e/dev/null 2\u003e\u00261; then\n            local_ip=$(host -t A \"$domain\" 2\u003e/dev/null | grep \"has address\" | head -1 | awk \u0027{print $NF}\u0027)\n        elif command -v nslookup \u003e/dev/null 2\u003e\u00261; then\n            local_ip=$(nslookup \"$domain\" 2\u003e/dev/null | grep -A1 \"Name:\" | grep \"Address:\" | awk \u0027{print $2}\u0027 | head -1)\n        fi\n\n        if [ -n \"$local_ip\" ]; then\n            local_asn=$(get_asn \"$local_ip\")\n            log \"Local DNS: $local_ip | ASN: $local_asn\"\n            echo \"local_ip=$local_ip\" \u003e \"$domain_dir/dns.txt\"\n            echo \"local_asn=$local_asn\" \u003e\u003e \"$domain_dir/dns.txt\"\n        else\n            log \"Local DNS resolution failed\" \"WARN\"\n            local_asn=\"\"\n        fi\n\n        # B. DoH Resolution (Control Group)\n        doh_ip=$(get_doh_resolution \"$domain\")\n        if [ -n \"$doh_ip\" ]; then\n            doh_asn=$(get_asn \"$doh_ip\")\n            log \"DoH DNS:   $doh_ip | ASN: $doh_asn\"\n            echo \"doh_ip=$doh_ip\" \u003e\u003e \"$domain_dir/dns.txt\"\n            echo \"doh_asn=$doh_asn\" \u003e\u003e \"$domain_dir/dns.txt\"\n\n            # Compare IPs\n            if [ -n \"$local_ip\" ] \u0026\u0026 [ \"$local_ip\" != \"$doh_ip\" ]; then\n                log \"DNS MISMATCH: Local ($local_ip) vs DoH ($doh_ip)\" \"WARN\"\n            fi\n        else\n            log \"DoH resolution failed (network may be blocking)\" \"WARN\"\n        fi\n\n        # C. ASN Integrity Check\n        if [ -n \"$local_asn\" ]; then\n            asn_alert=$(test_asn_integrity \"$domain\" \"$local_asn\" || true)\n            if [ -n \"$asn_alert\" ]; then\n                alert \"$asn_alert\"\n            fi\n        fi\n\n        # D. Certificate Capture\n        log \"Capturing TLS certificate...\"\n        cert_result=$(get_tls_certificate \"$domain\" \"$domain_dir/Certificate\")\n\n        if [ -n \"$cert_result\" ]; then\n            serial=$(echo \"$cert_result\" | cut -d\u0027|\u0027 -f1)\n            issuer=$(echo \"$cert_result\" | cut -d\u0027|\u0027 -f2)\n\n            if [ -n \"$serial\" ]; then\n                log \"Certificate Serial: $serial\"\n                log \"Certificate Issuer: $issuer\"\n\n                # Check for certificate anomalies\n                cert_alert=$(test_certificate_anomaly \"$domain\" \"$issuer\" || true)\n                if [ -n \"$cert_alert\" ]; then\n                    alert \"$cert_alert\"\n                fi\n            else\n                alert \"TLS Handshake Failed for $domain - could not extract certificate\"\n            fi\n        fi\n\n        # Save analysis summary\n        {\n            echo \"{\"\n            echo \"  \\\"domain\\\": \\\"$domain\\\",\"\n            echo \"  \\\"timestamp\\\": \\\"$(date -Iseconds 2\u003e/dev/null || date)\\\",\"\n            echo \"  \\\"local_dns\\\": \\\"$local_ip\\\",\"\n            echo \"  \\\"local_asn\\\": \\\"$local_asn\\\",\"\n            echo \"  \\\"doh_dns\\\": \\\"$doh_ip\\\",\"\n            echo \"  \\\"doh_asn\\\": \\\"$doh_asn\\\"\"\n            echo \"}\"\n        } \u003e \"$domain_dir/Analysis.json\"\n    done\n}\n\n#######################################\n# Phase 4: Traceroute Mapping\n#######################################\nphase4_traceroute() {\n    print_section \"PHASE 4: TRACEROUTE MAPPING\"\n\n    if [ \"$TRACEROUTE_ENABLED\" = \"0\" ] || [ \"$SKIP_TRACEROUTE\" = \"1\" ]; then\n        log \"Traceroute skipped (disabled or --skip-traceroute specified)\"\n        return\n    fi\n\n    trace_dir=\"$BASE_DIR/traceroute\"\n    mkdir -p \"$trace_dir\"\n\n    # Determine traceroute command\n    trace_cmd=\"\"\n    if command -v traceroute \u003e/dev/null 2\u003e\u00261; then\n        trace_cmd=\"traceroute\"\n    elif command -v tracepath \u003e/dev/null 2\u003e\u00261; then\n        trace_cmd=\"tracepath\"\n    else\n        log \"No traceroute command available\" \"WARN\"\n        return\n    fi\n\n    for domain in $TARGETS; do\n        print_subsection \"Tracing: $domain\"\n\n        safe_domain=$(echo \"$domain\" | tr \u0027.\u0027 \u0027_\u0027)\n        trace_file=\"$trace_dir/Trace_${safe_domain}.txt\"\n        trace_json=\"$trace_dir/Trace_${safe_domain}.json\"\n\n        if [ \"$trace_cmd\" = \"traceroute\" ]; then\n            traceroute -m \"$TRACEROUTE_MAX_HOPS\" -w \"$TRACEROUTE_TIMEOUT\" \"$domain\" \u003e \"$trace_file\" 2\u003e\u00261 || true\n        else\n            tracepath -m \"$TRACEROUTE_MAX_HOPS\" \"$domain\" \u003e \"$trace_file\" 2\u003e\u00261 || true\n        fi\n\n        # Extract IPs and lookup ASNs\n        hop_num=1\n        echo \"[\" \u003e \"$trace_json\"\n        first_hop=1\n\n        # Parse traceroute output for IPs\n        while IFS= read -r line; do\n            # Extract IP addresses from the line\n            for ip in $(echo \"$line\" | grep -oE \u0027([0-9]{1,3}\\.){3}[0-9]{1,3}\u0027); do\n                if [ \"$ip\" != \"0.0.0.0\" ]; then\n                    asn=$(get_asn \"$ip\")\n\n                    if [ \"$first_hop\" = \"0\" ]; then\n                        echo \",\" \u003e\u003e \"$trace_json\"\n                    fi\n                    first_hop=0\n\n                    echo \"  {\\\"hop\\\": $hop_num, \\\"ip\\\": \\\"$ip\\\", \\\"asn\\\": \\\"$asn\\\"}\" \u003e\u003e \"$trace_json\"\n\n                    # Check for suspicious hops\n                    for pattern in $SUSPICIOUS_ASN_PATTERNS; do\n                        if echo \"$asn\" | grep -qi \"$pattern\"; then\n                            alert \"Suspicious hop in traceroute to $domain - Hop $hop_num ($ip) routes through $pattern\"\n                        fi\n                    done\n                fi\n                hop_num=$((hop_num + 1))\n            done\n        done \u003c \"$trace_file\"\n\n        echo \"\" \u003e\u003e \"$trace_json\"\n        echo \"]\" \u003e\u003e \"$trace_json\"\n\n        log \"Trace complete to $domain\"\n    done\n}\n\n#######################################\n# Phase 5: Client-Side Exploit Detection\n#######################################\nphase5_client_side() {\n    print_section \"PHASE 5: CLIENT-SIDE EXPLOIT DETECTION\"\n\n    if [ \"$SKIP_CLIENT_SIDE\" = \"1\" ]; then\n        log \"Client-side checks skipped (--skip-client-side specified)\"\n        return\n    fi\n\n    client_dir=\"$BASE_DIR/client-side\"\n    mkdir -p \"$client_dir\"\n\n    # A. Proxy Settings\n    if [ \"$CHECK_PROXY_SETTINGS\" = \"1\" ]; then\n        print_subsection \"Proxy Settings Check\"\n\n        {\n            echo \"=== Environment Proxy Variables ===\"\n            echo \"HTTP_PROXY: ${HTTP_PROXY:-\u003cnot set\u003e}\"\n            echo \"HTTPS_PROXY: ${HTTPS_PROXY:-\u003cnot set\u003e}\"\n            echo \"http_proxy: ${http_proxy:-\u003cnot set\u003e}\"\n            echo \"https_proxy: ${https_proxy:-\u003cnot set\u003e}\"\n            echo \"ALL_PROXY: ${ALL_PROXY:-\u003cnot set\u003e}\"\n            echo \"NO_PROXY: ${NO_PROXY:-\u003cnot set\u003e}\"\n            echo \"\"\n\n            # Check for proxy in common config files\n            echo \"=== Git Proxy Configuration ===\"\n            if command -v git \u003e/dev/null 2\u003e\u00261; then\n                git config --global --get http.proxy 2\u003e/dev/null || echo \"\u003cnot set\u003e\"\n                git config --global --get https.proxy 2\u003e/dev/null || echo \"\u003cnot set\u003e\"\n            fi\n            echo \"\"\n\n            # macOS network proxy\n            if [ \"$(uname)\" = \"Darwin\" ]; then\n                echo \"=== macOS Network Proxy (scutil) ===\"\n                scutil --proxy 2\u003e/dev/null || echo \"Unable to query\"\n            fi\n\n            # Linux proxy via gsettings\n            if command -v gsettings \u003e/dev/null 2\u003e\u00261; then\n                echo \"=== GNOME Proxy Settings ===\"\n                gsettings get org.gnome.system.proxy mode 2\u003e/dev/null || echo \"Unable to query\"\n            fi\n        } \u003e \"$client_dir/ProxySettings.txt\"\n\n        # Alert on set proxy variables\n        for var in HTTP_PROXY HTTPS_PROXY http_proxy https_proxy ALL_PROXY; do\n            eval \"val=\\$$var\"\n            if [ -n \"$val\" ]; then\n                alert \"Environment proxy variable set: $var = $val\"\n            fi\n        done\n\n        log \"Proxy settings captured\"\n    fi\n\n    # B. Hosts File Check\n    if [ \"$CHECK_HOSTS_FILE\" = \"1\" ]; then\n        print_subsection \"Hosts File Analysis\"\n\n        hosts_path=\"/etc/hosts\"\n        if [ -f \"$hosts_path\" ]; then\n            cp \"$hosts_path\" \"$client_dir/hosts_backup\"\n\n            sensitive_patterns=\"google microsoft apple amazon github cursor openai anthropic\"\n            suspicious_found=0\n\n            for pattern in $sensitive_patterns; do\n                # Find non-comment lines matching pattern that don\u0027t point to localhost\n                matches=$(grep -i \"$pattern\" \"$hosts_path\" 2\u003e/dev/null | grep -v \"^#\" | grep -v \"127.0.0.1\" | grep -v \"::1\" | grep -v \"0.0.0.0\" || true)\n                if [ -n \"$matches\" ]; then\n                    alert \"Hosts file redirect for $pattern pattern: $matches\"\n                    echo \"$matches\" \u003e\u003e \"$client_dir/SuspiciousHosts.txt\"\n                    suspicious_found=1\n                fi\n            done\n\n            if [ \"$suspicious_found\" = \"0\" ]; then\n                log \"No suspicious hosts file entries found\"\n            fi\n\n            # Count entries\n            entry_count=$(grep -v \"^#\" \"$hosts_path\" 2\u003e/dev/null | grep -v \"^$\" | wc -l | tr -d \u0027 \u0027)\n            log \"Hosts file entries: $entry_count\"\n        else\n            log \"Hosts file not found at $hosts_path\" \"WARN\"\n        fi\n    fi\n\n    # C. Browser Extension Check (Firefox on Linux/macOS)\n    print_subsection \"Browser Extension Audit\"\n\n    {\n        echo \"=== Firefox Extensions ===\"\n        # Firefox profile locations\n        for firefox_dir in \"$HOME/.mozilla/firefox\" \"$HOME/Library/Application Support/Firefox/Profiles\"; do\n            if [ -d \"$firefox_dir\" ]; then\n                find \"$firefox_dir\" -name \"extensions.json\" -exec cat {} \\; 2\u003e/dev/null | head -100 || echo \"No extensions.json found\"\n            fi\n        done\n\n        echo \"\"\n        echo \"=== Chrome Extensions (Linux) ===\"\n        chrome_ext_dir=\"$HOME/.config/google-chrome/Default/Extensions\"\n        if [ -d \"$chrome_ext_dir\" ]; then\n            ls -la \"$chrome_ext_dir\" 2\u003e/dev/null | head -20\n        else\n            echo \"Chrome extensions directory not found\"\n        fi\n\n        echo \"\"\n        echo \"=== Chromium Extensions ===\"\n        chromium_ext_dir=\"$HOME/.config/chromium/Default/Extensions\"\n        if [ -d \"$chromium_ext_dir\" ]; then\n            ls -la \"$chromium_ext_dir\" 2\u003e/dev/null | head -20\n        else\n            echo \"Chromium extensions directory not found\"\n        fi\n    } \u003e \"$client_dir/BrowserExtensions.txt\"\n\n    log \"Browser extension information captured\"\n}\n\n#######################################\n# Phase 6: Evidence Finalization\n#######################################\nphase6_finalize() {\n    print_section \"PHASE 6: EVIDENCE FINALIZATION\"\n\n    print_subsection \"Generating Summary\"\n\n    alert_count=$(grep -c . \"$ALERT_FILE\" 2\u003e/dev/null || echo \"0\")\n\n    if [ \"$alert_count\" = \"0\" ]; then\n        verdict=\"No obvious MITM indicators detected\"\n    else\n        verdict=\"REVIEW REQUIRED - $alert_count alerts found\"\n    fi\n\n    {\n        echo \"{\"\n        echo \"  \\\"audit_timestamp\\\": \\\"$(date -Iseconds 2\u003e/dev/null || date)\\\",\"\n        echo \"  \\\"evidence_directory\\\": \\\"$BASE_DIR\\\",\"\n        echo \"  \\\"total_alerts\\\": $alert_count,\"\n        echo \"  \\\"targets\\\": \\\"$TARGETS\\\",\"\n        echo \"  \\\"traceroute_enabled\\\": $TRACEROUTE_ENABLED,\"\n        echo \"  \\\"client_side_checks\\\": $((1 - SKIP_CLIENT_SIDE)),\"\n        echo \"  \\\"verdict\\\": \\\"$verdict\\\"\"\n        echo \"}\"\n    } \u003e \"$BASE_DIR/Summary.json\"\n\n    # Generate file hashes\n    print_subsection \"Generating Evidence Hashes\"\n\n    hash_manifest=\"$BASE_DIR/_FileHashes.txt\"\n    : \u003e \"$hash_manifest\"\n\n    file_count=0\n    find \"$BASE_DIR\" -type f ! -name \"_FileHashes.txt\" | while read -r file; do\n        if command -v ${HASH_ALGORITHM}sum \u003e/dev/null 2\u003e\u00261; then\n            hash=$(${HASH_ALGORITHM}sum \"$file\" | cut -d\u0027 \u0027 -f1)\n        elif command -v shasum \u003e/dev/null 2\u003e\u00261; then\n            hash=$(shasum -a 256 \"$file\" | cut -d\u0027 \u0027 -f1)\n        else\n            hash=\"\u003cunable to compute\u003e\"\n        fi\n        rel_path=$(echo \"$file\" | sed \"s|$BASE_DIR/||\")\n        echo \"$hash  $rel_path\" \u003e\u003e \"$hash_manifest\"\n        file_count=$((file_count + 1))\n    done\n\n    log \"Generated hashes for evidence files\"\n\n    # Final output\n    echo \"\"\n    echo \"======================================================================\"\n    echo \" AUDIT COMPLETE\"\n    echo \"======================================================================\"\n    echo \"\"\n    echo \"Evidence Directory: $BASE_DIR\"\n    echo \"\"\n\n    if [ \"$alert_count\" -gt 0 ]; then\n        echo \"ALERTS FOUND: $alert_count\"\n        echo \"Review _RedFlags.txt immediately!\"\n        echo \"\"\n        echo \"--- ALERTS ---\"\n        cat \"$ALERT_FILE\"\n    else\n        echo \"No obvious MITM indicators detected.\"\n        echo \"Note: Passive interception (logging only) may not trigger alerts.\"\n    fi\n\n    echo \"\"\n    echo \"NEXT STEPS:\"\n    echo \"  1. Review _RedFlags.txt for immediate concerns\"\n    echo \"  2. Check certificate serials against crt.sh (on clean network)\"\n    echo \"  3. Zip the evidence folder and hash the zip for chain of custody\"\n    echo \"\"\n}\n\n#######################################\n# Parse Arguments\n#######################################\nCONFIG_FILE=\"\"\nOUTPUT_DIR=\"\"\nOVERRIDE_TARGETS=\"\"\n\nwhile [ $# -gt 0 ]; do\n    case \"$1\" in\n        -c|--config)\n            CONFIG_FILE=\"$2\"\n            shift 2\n            ;;\n        -o|--output)\n            OUTPUT_DIR=\"$2\"\n            shift 2\n            ;;\n        -t|--targets)\n            OVERRIDE_TARGETS=\"$2\"\n            shift 2\n            ;;\n        --skip-traceroute)\n            SKIP_TRACEROUTE=1\n            shift\n            ;;\n        --skip-client-side)\n            SKIP_CLIENT_SIDE=1\n            shift\n            ;;\n        -h|--help)\n            usage\n            ;;\n        *)\n            echo \"Unknown option: $1\" \u003e\u00262\n            usage\n            ;;\n    esac\ndone\n\n#######################################\n# Main Execution\n#######################################\n\n# Load config if specified\nif [ -n \"$CONFIG_FILE\" ]; then\n    load_config \"$CONFIG_FILE\"\nelse\n    # Try default config in same directory\n    script_dir=$(dirname \"$0\")\n    default_config=\"$script_dir/mitm-audit.cfg\"\n    if [ -f \"$default_config\" ]; then\n        load_config \"$default_config\"\n    fi\nfi\n\n# Override targets if specified\nif [ -n \"$OVERRIDE_TARGETS\" ]; then\n    TARGETS=$(echo \"$OVERRIDE_TARGETS\" | tr \u0027,\u0027 \u0027 \u0027)\nfi\n\n# Initialize output\ninit_output_dir \"$OUTPUT_DIR\"\n\necho \"\"\necho \"======================================================================\"\necho \" INFRASTRUCTURE MITM AUDIT - FORENSIC EVIDENCE COLLECTION\"\necho \"======================================================================\"\necho \"Timestamp: $(date)\"\necho \"Evidence Directory: $BASE_DIR\"\necho \"Targets: $TARGETS\"\necho \"\"\n\nlog \"Audit started\"\nlog \"Targets: $TARGETS\"\n\n# Execute phases\nphase1_environment\nphase2_trust_store\nphase3_target_analysis\nphase4_traceroute\nphase5_client_side\nphase6_finalize\n\nlog \"Audit completed\"\n","languageId":"shellscript"}],"text":"","capabilityType":15,"toolFormerData":{"tool":38,"toolIndex":1,"modelCallId":"e44cbde7-2d43-4c1f-8aba-e5f025104bee","toolCallId":"toolu_019BEHff9Ybr7BoGKX7p33zF","status":"completed","rawArgs":"{\"file_path\": \"templates/network/mitm-audit.sh\", \"contents\": \"#!/bin/sh\\n# Infrastructure MITM Audit - Forensic Evidence Collection for TLS Interception Detection\\n# License: BSD-2-Clause\\n# Signed-off-by: Network Diagnostics Toolkit\\n#\\n# Combines environment baselining, Root CA dumping, ASN-based integrity checking,\\n# and DoH comparison to detect infrastructure-side Man-in-the-Middle attacks while\\n# ruling out client-side exploits.\\n#\\n# Produces a timestamped evidence package suitable for chain of custody.\\n#\\n# Usage: ./mitm-audit.sh [OPTIONS]\\n#   -c, --config FILE    Path to mitm-audit.cfg\\n#   -o, --output DIR     Output directory (default: ~/ForensicEvidence_timestamp)\\n#   -t, --targets LIST   Override targets (comma-separated)\\n#   --skip-traceroute    Skip traceroute collection\\n#   --skip-client-side   Skip client-side exploit detection\\n#   -h, --help           Show this help\\n#\\n# EVIDENCE PROCESSING:\\n# 1. Check _RedFlags.txt first - if empty, MITM may be passive/logging only\\n# 2. Certificate Serial Check - copy serial to crt.sh on clean device\\n#    - If \\\"No certificates found\\\": 100% MITM by private root CA\\n#    - If cert shown for different domain: collision/hash attack\\n# 3. Zip evidence folder, hash the zip for chain of custody\\n\\nset -e\\n\\n#######################################\\n# Default Configuration\\n#######################################\\nTARGETS=\\\"accounts.google.com login.microsoftonline.com appleid.apple.com aws.amazon.com github.com\\\"\\nPUBLIC_RESOLVERS=\\\"1.1.1.1 8.8.8.8 9.9.9.9\\\"\\nDOH_ENDPOINT=\\\"https://dns.google/resolve\\\"\\nASN_LOOKUP_URL=\\\"http://ip-api.com/json\\\"\\nASN_LOOKUP_TIMEOUT=3\\nEXTERNAL_IP_URL=\\\"https://ipinfo.io/json\\\"\\nEXTERNAL_IP_TIMEOUT=5\\nEXPECTED_ISP_PATTERNS=\\\"\\\"\\nSUSPICIOUS_ASN_PATTERNS=\\\"DigitalOcean Linode Vultr Choopa Datacamp OVH Hetzner\\\"\\nSUSPICIOUS_CERT_ISSUERS=\\\"Let\u0027s Encrypt ZeroSSL Self-Signed localhost\\\"\\nTRACEROUTE_MAX_HOPS=15\\nTRACEROUTE_TIMEOUT=2\\nTRACEROUTE_ENABLED=1\\nEXPORT_ROOT_CA=1\\nHASH_ROOT_CA=1\\nCHECK_PROXY_SETTINGS=1\\nCHECK_HOSTS_FILE=1\\nCHECK_ROOT_CA_ANOMALIES=1\\nHASH_ALGORITHM=\\\"sha256\\\"\\nSKIP_TRACEROUTE=0\\nSKIP_CLIENT_SIDE=0\\n\\n#######################################\\n# Variables\\n#######################################\\nBASE_DIR=\\\"\\\"\\nLOG_FILE=\\\"\\\"\\nALERT_FILE=\\\"\\\"\\nTIMESTAMP=\\\"\\\"\\n\\n#######################################\\n# Usage\\n#######################################\\nusage() {\\n    cat \u003c\u003c \u0027EOF\u0027\\nUsage: mitm-audit.sh [OPTIONS]\\n\\nInfrastructure MITM Audit - Forensic Evidence Collection\\n\\nOptions:\\n    -c, --config FILE    Path to mitm-audit.cfg\\n    -o, --output DIR     Output directory (default: ~/ForensicEvidence_timestamp)\\n    -t, --targets LIST   Override targets (comma-separated)\\n    --skip-traceroute    Skip traceroute collection\\n    --skip-client-side   Skip client-side exploit detection\\n    -h, --help           Show this help\\n\\nExamples:\\n    ./mitm-audit.sh\\n    ./mitm-audit.sh -c ./mitm-audit.cfg\\n    ./mitm-audit.sh -t \\\"accounts.google.com,github.com\\\"\\n    ./mitm-audit.sh --skip-traceroute\\n\\nEvidence Processing:\\n    1. Review _RedFlags.txt first\\n    2. Check certificate serials against crt.sh (on clean network)\\n    3. Zip evidence folder and hash for chain of custody\\nEOF\\n    exit 0\\n}\\n\\n#######################################\\n# Configuration Loading\\n#######################################\\nload_config() {\\n    config_file=\\\"$1\\\"\\n    if [ ! -f \\\"$config_file\\\" ]; then\\n        echo \\\"[WARN] Config file not found: $config_file (using defaults)\\\"\\n        return\\n    fi\\n\\n    while IFS=\u0027=\u0027 read -r key value; do\\n        # Skip comments and empty lines\\n        case \\\"$key\\\" in\\n            \\\\#*|\\\"\\\") continue ;;\\n        esac\\n        # Remove leading/trailing whitespace\\n        key=$(echo \\\"$key\\\" | sed \u0027s/^[[:space:]]*//;s/[[:space:]]*$//\u0027)\\n        value=$(echo \\\"$value\\\" | sed \u0027s/^[[:space:]]*//;s/[[:space:]]*$//\u0027)\\n\\n        case \\\"$key\\\" in\\n            TARGETS) TARGETS=$(echo \\\"$value\\\" | tr \u0027,\u0027 \u0027 \u0027) ;;\\n            PUBLIC_RESOLVERS) PUBLIC_RESOLVERS=$(echo \\\"$value\\\" | tr \u0027,\u0027 \u0027 \u0027) ;;\\n            DOH_ENDPOINT) DOH_ENDPOINT=\\\"$value\\\" ;;\\n            ASN_LOOKUP_URL) ASN_LOOKUP_URL=\\\"$value\\\" ;;\\n            ASN_LOOKUP_TIMEOUT_SEC) ASN_LOOKUP_TIMEOUT=\\\"$value\\\" ;;\\n            EXTERNAL_IP_URL) EXTERNAL_IP_URL=\\\"$value\\\" ;;\\n            EXTERNAL_IP_TIMEOUT_SEC) EXTERNAL_IP_TIMEOUT=\\\"$value\\\" ;;\\n            EXPECTED_ISP_PATTERNS) EXPECTED_ISP_PATTERNS=$(echo \\\"$value\\\" | tr \u0027,\u0027 \u0027 \u0027) ;;\\n            SUSPICIOUS_ASN_PATTERNS) SUSPICIOUS_ASN_PATTERNS=$(echo \\\"$value\\\" | tr \u0027,\u0027 \u0027 \u0027) ;;\\n            SUSPICIOUS_CERT_ISSUERS) SUSPICIOUS_CERT_ISSUERS=$(echo \\\"$value\\\" | tr \u0027,\u0027 \u0027 \u0027) ;;\\n            TRACEROUTE_MAX_HOPS) TRACEROUTE_MAX_HOPS=\\\"$value\\\" ;;\\n            TRACEROUTE_TIMEOUT_SEC) TRACEROUTE_TIMEOUT=\\\"$value\\\" ;;\\n            TRACEROUTE_ENABLED) [ \\\"$value\\\" = \\\"true\\\" ] \u0026\u0026 TRACEROUTE_ENABLED=1 || TRACEROUTE_ENABLED=0 ;;\\n            EXPORT_ROOT_CA) [ \\\"$value\\\" = \\\"true\\\" ] \u0026\u0026 EXPORT_ROOT_CA=1 || EXPORT_ROOT_CA=0 ;;\\n            HASH_ROOT_CA) [ \\\"$value\\\" = \\\"true\\\" ] \u0026\u0026 HASH_ROOT_CA=1 || HASH_ROOT_CA=0 ;;\\n            CHECK_PROXY_SETTINGS) [ \\\"$value\\\" = \\\"true\\\" ] \u0026\u0026 CHECK_PROXY_SETTINGS=1 || CHECK_PROXY_SETTINGS=0 ;;\\n            CHECK_HOSTS_FILE) [ \\\"$value\\\" = \\\"true\\\" ] \u0026\u0026 CHECK_HOSTS_FILE=1 || CHECK_HOSTS_FILE=0 ;;\\n            CHECK_ROOT_CA_ANOMALIES) [ \\\"$value\\\" = \\\"true\\\" ] \u0026\u0026 CHECK_ROOT_CA_ANOMALIES=1 || CHECK_ROOT_CA_ANOMALIES=0 ;;\\n            HASH_ALGORITHM) HASH_ALGORITHM=\\\"$value\\\" ;;\\n        esac\\n    done \u003c \\\"$config_file\\\"\\n}\\n\\n#######################################\\n# Logging Functions\\n#######################################\\ninit_output_dir() {\\n    TIMESTAMP=$(date +\\\"%Y%m%d_%H%M%S\\\")\\n\\n    if [ -n \\\"$1\\\" ]; then\\n        BASE_DIR=\\\"$1\\\"\\n    else\\n        BASE_DIR=\\\"$HOME/ForensicEvidence_$TIMESTAMP\\\"\\n    fi\\n\\n    mkdir -p \\\"$BASE_DIR\\\"\\n    LOG_FILE=\\\"$BASE_DIR/_AuditLog.txt\\\"\\n    ALERT_FILE=\\\"$BASE_DIR/_RedFlags.txt\\\"\\n\\n    : \u003e \\\"$ALERT_FILE\\\"\\n}\\n\\nlog() {\\n    level=\\\"${2:-INFO}\\\"\\n    timestamp=$(date +\\\"%Y-%m-%d %H:%M:%S\\\")\\n    msg=\\\"[$timestamp] [$level] $1\\\"\\n    echo \\\"$msg\\\"\\n    echo \\\"$msg\\\" \u003e\u003e \\\"$LOG_FILE\\\"\\n}\\n\\nalert() {\\n    timestamp=$(date +\\\"%Y-%m-%d %H:%M:%S\\\")\\n    echo \\\"[!] $1\\\"\\n    echo \\\"[$timestamp] $1\\\" \u003e\u003e \\\"$ALERT_FILE\\\"\\n    log \\\"$1\\\" \\\"ALERT\\\"\\n}\\n\\nprint_section() {\\n    echo \\\"\\\"\\n    echo \\\"======================================================================\\\"\\n    echo \\\" $1\\\"\\n    echo \\\"======================================================================\\\"\\n    log \\\"=== $1 ===\\\" \\\"INFO\\\"\\n}\\n\\nprint_subsection() {\\n    echo \\\"\\\"\\n    echo \\\"[*] $1\\\"\\n    echo \\\"--------------------------------------------------\\\"\\n    log \\\"--- $1 ---\\\" \\\"INFO\\\"\\n}\\n\\n#######################################\\n# ASN and DNS Functions\\n#######################################\\nget_asn() {\\n    ip=\\\"$1\\\"\\n    result=$(curl -s --max-time \\\"$ASN_LOOKUP_TIMEOUT\\\" \\\"${ASN_LOOKUP_URL}/${ip}?fields=status,message,org,as\\\" 2\u003e/dev/null || echo \\\"\\\")\\n\\n    if [ -z \\\"$result\\\" ]; then\\n        echo \\\"Lookup Failed (Blocked?)\\\"\\n        return\\n    fi\\n\\n    status=$(echo \\\"$result\\\" | grep -o \u0027\\\"status\\\":\\\"[^\\\"]*\\\"\u0027 | cut -d\u0027\\\"\u0027 -f4)\\n    if [ \\\"$status\\\" = \\\"success\\\" ]; then\\n        org=$(echo \\\"$result\\\" | grep -o \u0027\\\"org\\\":\\\"[^\\\"]*\\\"\u0027 | cut -d\u0027\\\"\u0027 -f4)\\n        as=$(echo \\\"$result\\\" | grep -o \u0027\\\"as\\\":\\\"[^\\\"]*\\\"\u0027 | cut -d\u0027\\\"\u0027 -f4)\\n        echo \\\"$org ($as)\\\"\\n    else\\n        echo \\\"Unknown\\\"\\n    fi\\n}\\n\\nget_doh_resolution() {\\n    domain=\\\"$1\\\"\\n    result=$(curl -s --max-time 5 \\\"${DOH_ENDPOINT}?name=${domain}\u0026type=A\\\" 2\u003e/dev/null || echo \\\"\\\")\\n\\n    if [ -z \\\"$result\\\" ]; then\\n        echo \\\"\\\"\\n        return\\n    fi\\n\\n    # Extract IP from Answer section (simplified JSON parsing)\\n    echo \\\"$result\\\" | grep -o \u0027\\\"data\\\":\\\"[0-9.]*\\\"\u0027 | head -1 | cut -d\u0027\\\"\u0027 -f4\\n}\\n\\ntest_asn_integrity() {\\n    domain=\\\"$1\\\"\\n    asn=\\\"$2\\\"\\n\\n    if [ \\\"$asn\\\" = \\\"Lookup Failed (Blocked?)\\\" ]; then\\n        return 0\\n    fi\\n\\n    alert_msg=\\\"\\\"\\n\\n    # Check Google\\n    if echo \\\"$domain\\\" | grep -qi \\\"google\\\"; then\\n        if ! echo \\\"$asn\\\" | grep -qi \\\"Google\\\"; then\\n            alert_msg=\\\"MITM DETECTED: $domain resolving to non-Google ASN ($asn)\\\"\\n        fi\\n    fi\\n\\n    # Check Microsoft\\n    if echo \\\"$domain\\\" | grep -qi \\\"microsoft\\\"; then\\n        if ! echo \\\"$asn\\\" | grep -qi \\\"Microsoft\\\"; then\\n            alert_msg=\\\"MITM DETECTED: $domain resolving to non-Microsoft ASN ($asn)\\\"\\n        fi\\n    fi\\n\\n    # Check Apple\\n    if echo \\\"$domain\\\" | grep -qi \\\"apple\\\"; then\\n        if ! echo \\\"$asn\\\" | grep -qi \\\"Apple\\\"; then\\n            alert_msg=\\\"MITM DETECTED: $domain resolving to non-Apple ASN ($asn)\\\"\\n        fi\\n    fi\\n\\n    # Check Amazon\\n    if echo \\\"$domain\\\" | grep -qi \\\"aws\\\\|amazon\\\"; then\\n        if ! echo \\\"$asn\\\" | grep -qi \\\"Amazon\\\\|AMAZON\\\"; then\\n            alert_msg=\\\"MITM DETECTED: $domain resolving to non-Amazon ASN ($asn)\\\"\\n        fi\\n    fi\\n\\n    # Check GitHub\\n    if echo \\\"$domain\\\" | grep -qi \\\"github\\\"; then\\n        if ! echo \\\"$asn\\\" | grep -qi \\\"GitHub\\\\|Microsoft\\\"; then\\n            alert_msg=\\\"MITM DETECTED: $domain resolving to non-GitHub/Microsoft ASN ($asn)\\\"\\n        fi\\n    fi\\n\\n    # Check for suspicious VPS providers\\n    if [ -z \\\"$alert_msg\\\" ]; then\\n        for pattern in $SUSPICIOUS_ASN_PATTERNS; do\\n            if echo \\\"$asn\\\" | grep -qi \\\"$pattern\\\"; then\\n                alert_msg=\\\"MITM DETECTED: High-value target routed to VPS provider ($pattern)\\\"\\n                break\\n            fi\\n        done\\n    fi\\n\\n    if [ -n \\\"$alert_msg\\\" ]; then\\n        echo \\\"$alert_msg\\\"\\n        return 1\\n    fi\\n\\n    return 0\\n}\\n\\n#######################################\\n# Certificate Functions\\n#######################################\\nget_tls_certificate() {\\n    domain=\\\"$1\\\"\\n    output_file=\\\"$2\\\"\\n\\n    if ! command -v openssl \u003e/dev/null 2\u003e\u00261; then\\n        echo \\\"OpenSSL not available\\\" \u003e \\\"$output_file\\\"\\n        return 1\\n    fi\\n\\n    # Capture full certificate chain\\n    echo | openssl s_client -showcerts -connect \\\"${domain}:443\\\" -servername \\\"$domain\\\" 2\u003e/dev/null \u003e \\\"${output_file}.pem\\\"\\n\\n    # Extract certificate details\\n    cert_info_file=\\\"${output_file}.txt\\\"\\n    {\\n        echo \\\"=== Certificate Details for $domain ===\\\"\\n        echo \\\"\\\"\\n        echo \\\"Subject:\\\"\\n        openssl x509 -in \\\"${output_file}.pem\\\" -noout -subject 2\u003e/dev/null || echo \\\"  Unable to extract\\\"\\n        echo \\\"\\\"\\n        echo \\\"Issuer:\\\"\\n        openssl x509 -in \\\"${output_file}.pem\\\" -noout -issuer 2\u003e/dev/null || echo \\\"  Unable to extract\\\"\\n        echo \\\"\\\"\\n        echo \\\"Serial Number:\\\"\\n        openssl x509 -in \\\"${output_file}.pem\\\" -noout -serial 2\u003e/dev/null || echo \\\"  Unable to extract\\\"\\n        echo \\\"\\\"\\n        echo \\\"Validity:\\\"\\n        openssl x509 -in \\\"${output_file}.pem\\\" -noout -dates 2\u003e/dev/null || echo \\\"  Unable to extract\\\"\\n        echo \\\"\\\"\\n        echo \\\"Fingerprint (SHA256):\\\"\\n        openssl x509 -in \\\"${output_file}.pem\\\" -noout -fingerprint -sha256 2\u003e/dev/null || echo \\\"  Unable to extract\\\"\\n    } \u003e \\\"$cert_info_file\\\"\\n\\n    # Extract just serial and issuer for quick checking\\n    serial=$(openssl x509 -in \\\"${output_file}.pem\\\" -noout -serial 2\u003e/dev/null | cut -d\u0027=\u0027 -f2)\\n    issuer=$(openssl x509 -in \\\"${output_file}.pem\\\" -noout -issuer 2\u003e/dev/null)\\n\\n    echo \\\"$serial|$issuer\\\"\\n}\\n\\ntest_certificate_anomaly() {\\n    domain=\\\"$1\\\"\\n    issuer=\\\"$2\\\"\\n\\n    # Check for suspicious issuers on major tech domains\\n    is_major_tech=0\\n    for pattern in google microsoft apple amazon github; do\\n        if echo \\\"$domain\\\" | grep -qi \\\"$pattern\\\"; then\\n            is_major_tech=1\\n            break\\n        fi\\n    done\\n\\n    if [ \\\"$is_major_tech\\\" = \\\"1\\\" ]; then\\n        for suspicious_issuer in $SUSPICIOUS_CERT_ISSUERS; do\\n            if echo \\\"$issuer\\\" | grep -qi \\\"$suspicious_issuer\\\"; then\\n                echo \\\"CERTIFICATE ANOMALY: $domain using $suspicious_issuer issuer - highly suspicious for major tech corp\\\"\\n                return 1\\n            fi\\n        done\\n    fi\\n\\n    return 0\\n}\\n\\n#######################################\\n# Phase 1: Environment Snapshot\\n#######################################\\nphase1_environment() {\\n    print_section \\\"PHASE 1: ENVIRONMENT SNAPSHOT\\\"\\n\\n    env_dir=\\\"$BASE_DIR/environment\\\"\\n    mkdir -p \\\"$env_dir\\\"\\n\\n    # Network configuration\\n    print_subsection \\\"Network Configuration\\\"\\n    {\\n        echo \\\"=== Network Interfaces ===\\\"\\n        if command -v ip \u003e/dev/null 2\u003e\u00261; then\\n            ip addr show\\n        elif command -v ifconfig \u003e/dev/null 2\u003e\u00261; then\\n            ifconfig -a\\n        else\\n            echo \\\"No interface command available\\\"\\n        fi\\n    } \u003e \\\"$env_dir/NetworkConfig.txt\\\"\\n\\n    # DNS configuration\\n    {\\n        echo \\\"=== DNS Configuration ===\\\"\\n        if [ -f /etc/resolv.conf ]; then\\n            cat /etc/resolv.conf\\n        fi\\n    } \u003e\u003e \\\"$env_dir/NetworkConfig.txt\\\"\\n\\n    # External IP\\n    print_subsection \\\"External IP Identification\\\"\\n    ext_ip_json=$(curl -s --max-time \\\"$EXTERNAL_IP_TIMEOUT\\\" \\\"$EXTERNAL_IP_URL\\\" 2\u003e/dev/null || echo \\\"\\\")\\n\\n    if [ -n \\\"$ext_ip_json\\\" ]; then\\n        echo \\\"$ext_ip_json\\\" \u003e \\\"$env_dir/ExternalIP.json\\\"\\n\\n        ext_ip=$(echo \\\"$ext_ip_json\\\" | grep -o \u0027\\\"ip\\\":\\\"[^\\\"]*\\\"\u0027 | cut -d\u0027\\\"\u0027 -f4)\\n        ext_org=$(echo \\\"$ext_ip_json\\\" | grep -o \u0027\\\"org\\\":\\\"[^\\\"]*\\\"\u0027 | cut -d\u0027\\\"\u0027 -f4)\\n        ext_city=$(echo \\\"$ext_ip_json\\\" | grep -o \u0027\\\"city\\\":\\\"[^\\\"]*\\\"\u0027 | cut -d\u0027\\\"\u0027 -f4)\\n        ext_region=$(echo \\\"$ext_ip_json\\\" | grep -o \u0027\\\"region\\\":\\\"[^\\\"]*\\\"\u0027 | cut -d\u0027\\\"\u0027 -f4)\\n        ext_country=$(echo \\\"$ext_ip_json\\\" | grep -o \u0027\\\"country\\\":\\\"[^\\\"]*\\\"\u0027 | cut -d\u0027\\\"\u0027 -f4)\\n\\n        log \\\"External IP: $ext_ip\\\"\\n        log \\\"External Org: $ext_org\\\"\\n        log \\\"Location: $ext_city, $ext_region, $ext_country\\\"\\n\\n        # Check expected ISP\\n        if [ -n \\\"$EXPECTED_ISP_PATTERNS\\\" ]; then\\n            is_expected=0\\n            for pattern in $EXPECTED_ISP_PATTERNS; do\\n                if echo \\\"$ext_org\\\" | grep -qi \\\"$pattern\\\"; then\\n                    is_expected=1\\n                    break\\n                fi\\n            done\\n            if [ \\\"$is_expected\\\" = \\\"0\\\" ]; then\\n                alert \\\"External IP Org ($ext_org) does not match expected ISP patterns - traffic may be tunneled/proxied\\\"\\n            fi\\n        fi\\n    else\\n        alert \\\"Unable to determine External IP - connection may be blocked or filtered\\\"\\n    fi\\n\\n    # System info\\n    print_subsection \\\"System Information\\\"\\n    {\\n        echo \\\"Hostname: $(hostname)\\\"\\n        echo \\\"User: $(whoami)\\\"\\n        echo \\\"Date: $(date)\\\"\\n        echo \\\"Kernel: $(uname -a)\\\"\\n        echo \\\"Timestamp: $(date -Iseconds 2\u003e/dev/null || date)\\\"\\n    } \u003e \\\"$env_dir/SystemInfo.txt\\\"\\n\\n    log \\\"System: $(hostname) / User: $(whoami)\\\"\\n}\\n\\n#######################################\\n# Phase 2: Trust Store Export\\n#######################################\\nphase2_trust_store() {\\n    print_section \\\"PHASE 2: TRUST STORE EXPORT\\\"\\n\\n    trust_dir=\\\"$BASE_DIR/trust-store\\\"\\n    mkdir -p \\\"$trust_dir\\\"\\n\\n    if [ \\\"$EXPORT_ROOT_CA\\\" = \\\"0\\\" ]; then\\n        log \\\"Root CA export disabled in configuration\\\"\\n        return\\n    fi\\n\\n    print_subsection \\\"Exporting Root CA Store\\\"\\n\\n    # Linux - common CA bundle locations\\n    ca_exported=0\\n    for ca_path in /etc/ssl/certs/ca-certificates.crt /etc/pki/tls/certs/ca-bundle.crt /etc/ssl/ca-bundle.pem; do\\n        if [ -f \\\"$ca_path\\\" ]; then\\n            cp \\\"$ca_path\\\" \\\"$trust_dir/RootCA_Snapshot.crt\\\"\\n            log \\\"Root CA Store exported from $ca_path\\\"\\n            ca_exported=1\\n\\n            if [ \\\"$HASH_ROOT_CA\\\" = \\\"1\\\" ]; then\\n                hash_value=$(${HASH_ALGORITHM}sum \\\"$ca_path\\\" 2\u003e/dev/null | cut -d\u0027 \u0027 -f1 || shasum -a 256 \\\"$ca_path\\\" 2\u003e/dev/null | cut -d\u0027 \u0027 -f1)\\n                echo \\\"{\\\\\\\"algorithm\\\\\\\":\\\\\\\"$HASH_ALGORITHM\\\\\\\",\\\\\\\"hash\\\\\\\":\\\\\\\"$hash_value\\\\\\\",\\\\\\\"source\\\\\\\":\\\\\\\"$ca_path\\\\\\\"}\\\" \u003e \\\"$trust_dir/RootCA_Hash.json\\\"\\n                log \\\"Root CA hash: $hash_value\\\"\\n            fi\\n            break\\n        fi\\n    done\\n\\n    # macOS - export from Keychain\\n    if [ \\\"$(uname)\\\" = \\\"Darwin\\\" ]; then\\n        print_subsection \\\"Exporting macOS Keychain Root CAs\\\"\\n        if command -v security \u003e/dev/null 2\u003e\u00261; then\\n            security find-certificate -a -p /System/Library/Keychains/SystemRootCertificates.keychain \u003e \\\"$trust_dir/MacOS_SystemRoots.pem\\\" 2\u003e/dev/null || true\\n            security find-certificate -a -p /Library/Keychains/System.keychain \u003e \\\"$trust_dir/MacOS_SystemKeychain.pem\\\" 2\u003e/dev/null || true\\n            log \\\"macOS Root Keychains exported\\\"\\n            ca_exported=1\\n        fi\\n    fi\\n\\n    if [ \\\"$ca_exported\\\" = \\\"0\\\" ]; then\\n        log \\\"Could not locate CA bundle\\\" \\\"WARN\\\"\\n    fi\\n\\n    # Anomaly detection for Linux/macOS (limited compared to Windows)\\n    if [ \\\"$CHECK_ROOT_CA_ANOMALIES\\\" = \\\"1\\\" ] \u0026\u0026 [ -f \\\"$trust_dir/RootCA_Snapshot.crt\\\" ]; then\\n        print_subsection \\\"Root CA Anomaly Detection\\\"\\n\\n        # Check for suspicious patterns in certificate subjects\\n        suspicious_found=0\\n        for pattern in \\\"Self\\\" \\\"Test\\\" \\\"Admin\\\" \\\"Local\\\" \\\"Proxy\\\" \\\"Intercept\\\" \\\"MITM\\\" \\\"Zscaler\\\" \\\"BlueCoat\\\" \\\"Forcepoint\\\"; do\\n            matches=$(grep -i \\\"Subject:.*$pattern\\\" \\\"$trust_dir/RootCA_Snapshot.crt\\\" 2\u003e/dev/null || true)\\n            if [ -n \\\"$matches\\\" ]; then\\n                alert \\\"Suspicious Root CA pattern found: $pattern\\\"\\n                echo \\\"$matches\\\" \u003e\u003e \\\"$trust_dir/SuspiciousCAs.txt\\\"\\n                suspicious_found=1\\n            fi\\n        done\\n\\n        if [ \\\"$suspicious_found\\\" = \\\"0\\\" ]; then\\n            log \\\"No suspicious root CAs detected by pattern matching\\\"\\n        fi\\n    fi\\n}\\n\\n#######################################\\n# Phase 3: Target Analysis\\n#######################################\\nphase3_target_analysis() {\\n    print_section \\\"PHASE 3: TARGET ANALYSIS AND ASN INTEGRITY\\\"\\n\\n    targets_dir=\\\"$BASE_DIR/targets\\\"\\n    mkdir -p \\\"$targets_dir\\\"\\n\\n    for domain in $TARGETS; do\\n        print_subsection \\\"Analyzing: $domain\\\"\\n\\n        safe_domain=$(echo \\\"$domain\\\" | tr \u0027.\u0027 \u0027_\u0027)\\n        domain_dir=\\\"$targets_dir/$safe_domain\\\"\\n        mkdir -p \\\"$domain_dir\\\"\\n\\n        # A. Local DNS Resolution\\n        local_ip=\\\"\\\"\\n        if command -v dig \u003e/dev/null 2\u003e\u00261; then\\n            local_ip=$(dig +short \\\"$domain\\\" A | tail -n1)\\n        elif command -v host \u003e/dev/null 2\u003e\u00261; then\\n            local_ip=$(host -t A \\\"$domain\\\" 2\u003e/dev/null | grep \\\"has address\\\" | head -1 | awk \u0027{print $NF}\u0027)\\n        elif command -v nslookup \u003e/dev/null 2\u003e\u00261; then\\n            local_ip=$(nslookup \\\"$domain\\\" 2\u003e/dev/null | grep -A1 \\\"Name:\\\" | grep \\\"Address:\\\" | awk \u0027{print $2}\u0027 | head -1)\\n        fi\\n\\n        if [ -n \\\"$local_ip\\\" ]; then\\n            local_asn=$(get_asn \\\"$local_ip\\\")\\n            log \\\"Local DNS: $local_ip | ASN: $local_asn\\\"\\n            echo \\\"local_ip=$local_ip\\\" \u003e \\\"$domain_dir/dns.txt\\\"\\n            echo \\\"local_asn=$local_asn\\\" \u003e\u003e \\\"$domain_dir/dns.txt\\\"\\n        else\\n            log \\\"Local DNS resolution failed\\\" \\\"WARN\\\"\\n            local_asn=\\\"\\\"\\n        fi\\n\\n        # B. DoH Resolution (Control Group)\\n        doh_ip=$(get_doh_resolution \\\"$domain\\\")\\n        if [ -n \\\"$doh_ip\\\" ]; then\\n            doh_asn=$(get_asn \\\"$doh_ip\\\")\\n            log \\\"DoH DNS:   $doh_ip | ASN: $doh_asn\\\"\\n            echo \\\"doh_ip=$doh_ip\\\" \u003e\u003e \\\"$domain_dir/dns.txt\\\"\\n            echo \\\"doh_asn=$doh_asn\\\" \u003e\u003e \\\"$domain_dir/dns.txt\\\"\\n\\n            # Compare IPs\\n            if [ -n \\\"$local_ip\\\" ] \u0026\u0026 [ \\\"$local_ip\\\" != \\\"$doh_ip\\\" ]; then\\n                log \\\"DNS MISMATCH: Local ($local_ip) vs DoH ($doh_ip)\\\" \\\"WARN\\\"\\n            fi\\n        else\\n            log \\\"DoH resolution failed (network may be blocking)\\\" \\\"WARN\\\"\\n        fi\\n\\n        # C. ASN Integrity Check\\n        if [ -n \\\"$local_asn\\\" ]; then\\n            asn_alert=$(test_asn_integrity \\\"$domain\\\" \\\"$local_asn\\\" || true)\\n            if [ -n \\\"$asn_alert\\\" ]; then\\n                alert \\\"$asn_alert\\\"\\n            fi\\n        fi\\n\\n        # D. Certificate Capture\\n        log \\\"Capturing TLS certificate...\\\"\\n        cert_result=$(get_tls_certificate \\\"$domain\\\" \\\"$domain_dir/Certificate\\\")\\n\\n        if [ -n \\\"$cert_result\\\" ]; then\\n            serial=$(echo \\\"$cert_result\\\" | cut -d\u0027|\u0027 -f1)\\n            issuer=$(echo \\\"$cert_result\\\" | cut -d\u0027|\u0027 -f2)\\n\\n            if [ -n \\\"$serial\\\" ]; then\\n                log \\\"Certificate Serial: $serial\\\"\\n                log \\\"Certificate Issuer: $issuer\\\"\\n\\n                # Check for certificate anomalies\\n                cert_alert=$(test_certificate_anomaly \\\"$domain\\\" \\\"$issuer\\\" || true)\\n                if [ -n \\\"$cert_alert\\\" ]; then\\n                    alert \\\"$cert_alert\\\"\\n                fi\\n            else\\n                alert \\\"TLS Handshake Failed for $domain - could not extract certificate\\\"\\n            fi\\n        fi\\n\\n        # Save analysis summary\\n        {\\n            echo \\\"{\\\"\\n            echo \\\"  \\\\\\\"domain\\\\\\\": \\\\\\\"$domain\\\\\\\",\\\"\\n            echo \\\"  \\\\\\\"timestamp\\\\\\\": \\\\\\\"$(date -Iseconds 2\u003e/dev/null || date)\\\\\\\",\\\"\\n            echo \\\"  \\\\\\\"local_dns\\\\\\\": \\\\\\\"$local_ip\\\\\\\",\\\"\\n            echo \\\"  \\\\\\\"local_asn\\\\\\\": \\\\\\\"$local_asn\\\\\\\",\\\"\\n            echo \\\"  \\\\\\\"doh_dns\\\\\\\": \\\\\\\"$doh_ip\\\\\\\",\\\"\\n            echo \\\"  \\\\\\\"doh_asn\\\\\\\": \\\\\\\"$doh_asn\\\\\\\"\\\"\\n            echo \\\"}\\\"\\n        } \u003e \\\"$domain_dir/Analysis.json\\\"\\n    done\\n}\\n\\n#######################################\\n# Phase 4: Traceroute Mapping\\n#######################################\\nphase4_traceroute() {\\n    print_section \\\"PHASE 4: TRACEROUTE MAPPING\\\"\\n\\n    if [ \\\"$TRACEROUTE_ENABLED\\\" = \\\"0\\\" ] || [ \\\"$SKIP_TRACEROUTE\\\" = \\\"1\\\" ]; then\\n        log \\\"Traceroute skipped (disabled or --skip-traceroute specified)\\\"\\n        return\\n    fi\\n\\n    trace_dir=\\\"$BASE_DIR/traceroute\\\"\\n    mkdir -p \\\"$trace_dir\\\"\\n\\n    # Determine traceroute command\\n    trace_cmd=\\\"\\\"\\n    if command -v traceroute \u003e/dev/null 2\u003e\u00261; then\\n        trace_cmd=\\\"traceroute\\\"\\n    elif command -v tracepath \u003e/dev/null 2\u003e\u00261; then\\n        trace_cmd=\\\"tracepath\\\"\\n    else\\n        log \\\"No traceroute command available\\\" \\\"WARN\\\"\\n        return\\n    fi\\n\\n    for domain in $TARGETS; do\\n        print_subsection \\\"Tracing: $domain\\\"\\n\\n        safe_domain=$(echo \\\"$domain\\\" | tr \u0027.\u0027 \u0027_\u0027)\\n        trace_file=\\\"$trace_dir/Trace_${safe_domain}.txt\\\"\\n        trace_json=\\\"$trace_dir/Trace_${safe_domain}.json\\\"\\n\\n        if [ \\\"$trace_cmd\\\" = \\\"traceroute\\\" ]; then\\n            traceroute -m \\\"$TRACEROUTE_MAX_HOPS\\\" -w \\\"$TRACEROUTE_TIMEOUT\\\" \\\"$domain\\\" \u003e \\\"$trace_file\\\" 2\u003e\u00261 || true\\n        else\\n            tracepath -m \\\"$TRACEROUTE_MAX_HOPS\\\" \\\"$domain\\\" \u003e \\\"$trace_file\\\" 2\u003e\u00261 || true\\n        fi\\n\\n        # Extract IPs and lookup ASNs\\n        hop_num=1\\n        echo \\\"[\\\" \u003e \\\"$trace_json\\\"\\n        first_hop=1\\n\\n        # Parse traceroute output for IPs\\n        while IFS= read -r line; do\\n            # Extract IP addresses from the line\\n            for ip in $(echo \\\"$line\\\" | grep -oE \u0027([0-9]{1,3}\\\\.){3}[0-9]{1,3}\u0027); do\\n                if [ \\\"$ip\\\" != \\\"0.0.0.0\\\" ]; then\\n                    asn=$(get_asn \\\"$ip\\\")\\n\\n                    if [ \\\"$first_hop\\\" = \\\"0\\\" ]; then\\n                        echo \\\",\\\" \u003e\u003e \\\"$trace_json\\\"\\n                    fi\\n                    first_hop=0\\n\\n                    echo \\\"  {\\\\\\\"hop\\\\\\\": $hop_num, \\\\\\\"ip\\\\\\\": \\\\\\\"$ip\\\\\\\", \\\\\\\"asn\\\\\\\": \\\\\\\"$asn\\\\\\\"}\\\" \u003e\u003e \\\"$trace_json\\\"\\n\\n                    # Check for suspicious hops\\n                    for pattern in $SUSPICIOUS_ASN_PATTERNS; do\\n                        if echo \\\"$asn\\\" | grep -qi \\\"$pattern\\\"; then\\n                            alert \\\"Suspicious hop in traceroute to $domain - Hop $hop_num ($ip) routes through $pattern\\\"\\n                        fi\\n                    done\\n                fi\\n                hop_num=$((hop_num + 1))\\n            done\\n        done \u003c \\\"$trace_file\\\"\\n\\n        echo \\\"\\\" \u003e\u003e \\\"$trace_json\\\"\\n        echo \\\"]\\\" \u003e\u003e \\\"$trace_json\\\"\\n\\n        log \\\"Trace complete to $domain\\\"\\n    done\\n}\\n\\n#######################################\\n# Phase 5: Client-Side Exploit Detection\\n#######################################\\nphase5_client_side() {\\n    print_section \\\"PHASE 5: CLIENT-SIDE EXPLOIT DETECTION\\\"\\n\\n    if [ \\\"$SKIP_CLIENT_SIDE\\\" = \\\"1\\\" ]; then\\n        log \\\"Client-side checks skipped (--skip-client-side specified)\\\"\\n        return\\n    fi\\n\\n    client_dir=\\\"$BASE_DIR/client-side\\\"\\n    mkdir -p \\\"$client_dir\\\"\\n\\n    # A. Proxy Settings\\n    if [ \\\"$CHECK_PROXY_SETTINGS\\\" = \\\"1\\\" ]; then\\n        print_subsection \\\"Proxy Settings Check\\\"\\n\\n        {\\n            echo \\\"=== Environment Proxy Variables ===\\\"\\n            echo \\\"HTTP_PROXY: ${HTTP_PROXY:-\u003cnot set\u003e}\\\"\\n            echo \\\"HTTPS_PROXY: ${HTTPS_PROXY:-\u003cnot set\u003e}\\\"\\n            echo \\\"http_proxy: ${http_proxy:-\u003cnot set\u003e}\\\"\\n            echo \\\"https_proxy: ${https_proxy:-\u003cnot set\u003e}\\\"\\n            echo \\\"ALL_PROXY: ${ALL_PROXY:-\u003cnot set\u003e}\\\"\\n            echo \\\"NO_PROXY: ${NO_PROXY:-\u003cnot set\u003e}\\\"\\n            echo \\\"\\\"\\n\\n            # Check for proxy in common config files\\n            echo \\\"=== Git Proxy Configuration ===\\\"\\n            if command -v git \u003e/dev/null 2\u003e\u00261; then\\n                git config --global --get http.proxy 2\u003e/dev/null || echo \\\"\u003cnot set\u003e\\\"\\n                git config --global --get https.proxy 2\u003e/dev/null || echo \\\"\u003cnot set\u003e\\\"\\n            fi\\n            echo \\\"\\\"\\n\\n            # macOS network proxy\\n            if [ \\\"$(uname)\\\" = \\\"Darwin\\\" ]; then\\n                echo \\\"=== macOS Network Proxy (scutil) ===\\\"\\n                scutil --proxy 2\u003e/dev/null || echo \\\"Unable to query\\\"\\n            fi\\n\\n            # Linux proxy via gsettings\\n            if command -v gsettings \u003e/dev/null 2\u003e\u00261; then\\n                echo \\\"=== GNOME Proxy Settings ===\\\"\\n                gsettings get org.gnome.system.proxy mode 2\u003e/dev/null || echo \\\"Unable to query\\\"\\n            fi\\n        } \u003e \\\"$client_dir/ProxySettings.txt\\\"\\n\\n        # Alert on set proxy variables\\n        for var in HTTP_PROXY HTTPS_PROXY http_proxy https_proxy ALL_PROXY; do\\n            eval \\\"val=\\\\$$var\\\"\\n            if [ -n \\\"$val\\\" ]; then\\n                alert \\\"Environment proxy variable set: $var = $val\\\"\\n            fi\\n        done\\n\\n        log \\\"Proxy settings captured\\\"\\n    fi\\n\\n    # B. Hosts File Check\\n    if [ \\\"$CHECK_HOSTS_FILE\\\" = \\\"1\\\" ]; then\\n        print_subsection \\\"Hosts File Analysis\\\"\\n\\n        hosts_path=\\\"/etc/hosts\\\"\\n        if [ -f \\\"$hosts_path\\\" ]; then\\n            cp \\\"$hosts_path\\\" \\\"$client_dir/hosts_backup\\\"\\n\\n            sensitive_patterns=\\\"google microsoft apple amazon github cursor openai anthropic\\\"\\n            suspicious_found=0\\n\\n            for pattern in $sensitive_patterns; do\\n                # Find non-comment lines matching pattern that don\u0027t point to localhost\\n                matches=$(grep -i \\\"$pattern\\\" \\\"$hosts_path\\\" 2\u003e/dev/null | grep -v \\\"^#\\\" | grep -v \\\"127.0.0.1\\\" | grep -v \\\"::1\\\" | grep -v \\\"0.0.0.0\\\" || true)\\n                if [ -n \\\"$matches\\\" ]; then\\n                    alert \\\"Hosts file redirect for $pattern pattern: $matches\\\"\\n                    echo \\\"$matches\\\" \u003e\u003e \\\"$client_dir/SuspiciousHosts.txt\\\"\\n                    suspicious_found=1\\n                fi\\n            done\\n\\n            if [ \\\"$suspicious_found\\\" = \\\"0\\\" ]; then\\n                log \\\"No suspicious hosts file entries found\\\"\\n            fi\\n\\n            # Count entries\\n            entry_count=$(grep -v \\\"^#\\\" \\\"$hosts_path\\\" 2\u003e/dev/null | grep -v \\\"^$\\\" | wc -l | tr -d \u0027 \u0027)\\n            log \\\"Hosts file entries: $entry_count\\\"\\n        else\\n            log \\\"Hosts file not found at $hosts_path\\\" \\\"WARN\\\"\\n        fi\\n    fi\\n\\n    # C. Browser Extension Check (Firefox on Linux/macOS)\\n    print_subsection \\\"Browser Extension Audit\\\"\\n\\n    {\\n        echo \\\"=== Firefox Extensions ===\\\"\\n        # Firefox profile locations\\n        for firefox_dir in \\\"$HOME/.mozilla/firefox\\\" \\\"$HOME/Library/Application Support/Firefox/Profiles\\\"; do\\n            if [ -d \\\"$firefox_dir\\\" ]; then\\n                find \\\"$firefox_dir\\\" -name \\\"extensions.json\\\" -exec cat {} \\\\; 2\u003e/dev/null | head -100 || echo \\\"No extensions.json found\\\"\\n            fi\\n        done\\n\\n        echo \\\"\\\"\\n        echo \\\"=== Chrome Extensions (Linux) ===\\\"\\n        chrome_ext_dir=\\\"$HOME/.config/google-chrome/Default/Extensions\\\"\\n        if [ -d \\\"$chrome_ext_dir\\\" ]; then\\n            ls -la \\\"$chrome_ext_dir\\\" 2\u003e/dev/null | head -20\\n        else\\n            echo \\\"Chrome extensions directory not found\\\"\\n        fi\\n\\n        echo \\\"\\\"\\n        echo \\\"=== Chromium Extensions ===\\\"\\n        chromium_ext_dir=\\\"$HOME/.config/chromium/Default/Extensions\\\"\\n        if [ -d \\\"$chromium_ext_dir\\\" ]; then\\n            ls -la \\\"$chromium_ext_dir\\\" 2\u003e/dev/null | head -20\\n        else\\n            echo \\\"Chromium extensions directory not found\\\"\\n        fi\\n    } \u003e \\\"$client_dir/BrowserExtensions.txt\\\"\\n\\n    log \\\"Browser extension information captured\\\"\\n}\\n\\n#######################################\\n# Phase 6: Evidence Finalization\\n#######################################\\nphase6_finalize() {\\n    print_section \\\"PHASE 6: EVIDENCE FINALIZATION\\\"\\n\\n    print_subsection \\\"Generating Summary\\\"\\n\\n    alert_count=$(grep -c . \\\"$ALERT_FILE\\\" 2\u003e/dev/null || echo \\\"0\\\")\\n\\n    if [ \\\"$alert_count\\\" = \\\"0\\\" ]; then\\n        verdict=\\\"No obvious MITM indicators detected\\\"\\n    else\\n        verdict=\\\"REVIEW REQUIRED - $alert_count alerts found\\\"\\n    fi\\n\\n    {\\n        echo \\\"{\\\"\\n        echo \\\"  \\\\\\\"audit_timestamp\\\\\\\": \\\\\\\"$(date -Iseconds 2\u003e/dev/null || date)\\\\\\\",\\\"\\n        echo \\\"  \\\\\\\"evidence_directory\\\\\\\": \\\\\\\"$BASE_DIR\\\\\\\",\\\"\\n        echo \\\"  \\\\\\\"total_alerts\\\\\\\": $alert_count,\\\"\\n        echo \\\"  \\\\\\\"targets\\\\\\\": \\\\\\\"$TARGETS\\\\\\\",\\\"\\n        echo \\\"  \\\\\\\"traceroute_enabled\\\\\\\": $TRACEROUTE_ENABLED,\\\"\\n        echo \\\"  \\\\\\\"client_side_checks\\\\\\\": $((1 - SKIP_CLIENT_SIDE)),\\\"\\n        echo \\\"  \\\\\\\"verdict\\\\\\\": \\\\\\\"$verdict\\\\\\\"\\\"\\n        echo \\\"}\\\"\\n    } \u003e \\\"$BASE_DIR/Summary.json\\\"\\n\\n    # Generate file hashes\\n    print_subsection \\\"Generating Evidence Hashes\\\"\\n\\n    hash_manifest=\\\"$BASE_DIR/_FileHashes.txt\\\"\\n    : \u003e \\\"$hash_manifest\\\"\\n\\n    file_count=0\\n    find \\\"$BASE_DIR\\\" -type f ! -name \\\"_FileHashes.txt\\\" | while read -r file; do\\n        if command -v ${HASH_ALGORITHM}sum \u003e/dev/null 2\u003e\u00261; then\\n            hash=$(${HASH_ALGORITHM}sum \\\"$file\\\" | cut -d\u0027 \u0027 -f1)\\n        elif command -v shasum \u003e/dev/null 2\u003e\u00261; then\\n            hash=$(shasum -a 256 \\\"$file\\\" | cut -d\u0027 \u0027 -f1)\\n        else\\n            hash=\\\"\u003cunable to compute\u003e\\\"\\n        fi\\n        rel_path=$(echo \\\"$file\\\" | sed \\\"s|$BASE_DIR/||\\\")\\n        echo \\\"$hash  $rel_path\\\" \u003e\u003e \\\"$hash_manifest\\\"\\n        file_count=$((file_count + 1))\\n    done\\n\\n    log \\\"Generated hashes for evidence files\\\"\\n\\n    # Final output\\n    echo \\\"\\\"\\n    echo \\\"======================================================================\\\"\\n    echo \\\" AUDIT COMPLETE\\\"\\n    echo \\\"======================================================================\\\"\\n    echo \\\"\\\"\\n    echo \\\"Evidence Directory: $BASE_DIR\\\"\\n    echo \\\"\\\"\\n\\n    if [ \\\"$alert_count\\\" -gt 0 ]; then\\n        echo \\\"ALERTS FOUND: $alert_count\\\"\\n        echo \\\"Review _RedFlags.txt immediately!\\\"\\n        echo \\\"\\\"\\n        echo \\\"--- ALERTS ---\\\"\\n        cat \\\"$ALERT_FILE\\\"\\n    else\\n        echo \\\"No obvious MITM indicators detected.\\\"\\n        echo \\\"Note: Passive interception (logging only) may not trigger alerts.\\\"\\n    fi\\n\\n    echo \\\"\\\"\\n    echo \\\"NEXT STEPS:\\\"\\n    echo \\\"  1. Review _RedFlags.txt for immediate concerns\\\"\\n    echo \\\"  2. Check certificate serials against crt.sh (on clean network)\\\"\\n    echo \\\"  3. Zip the evidence folder and hash the zip for chain of custody\\\"\\n    echo \\\"\\\"\\n}\\n\\n#######################################\\n# Parse Arguments\\n#######################################\\nCONFIG_FILE=\\\"\\\"\\nOUTPUT_DIR=\\\"\\\"\\nOVERRIDE_TARGETS=\\\"\\\"\\n\\nwhile [ $# -gt 0 ]; do\\n    case \\\"$1\\\" in\\n        -c|--config)\\n            CONFIG_FILE=\\\"$2\\\"\\n            shift 2\\n            ;;\\n        -o|--output)\\n            OUTPUT_DIR=\\\"$2\\\"\\n            shift 2\\n            ;;\\n        -t|--targets)\\n            OVERRIDE_TARGETS=\\\"$2\\\"\\n            shift 2\\n            ;;\\n        --skip-traceroute)\\n            SKIP_TRACEROUTE=1\\n            shift\\n            ;;\\n        --skip-client-side)\\n            SKIP_CLIENT_SIDE=1\\n            shift\\n            ;;\\n        -h|--help)\\n            usage\\n            ;;\\n        *)\\n            echo \\\"Unknown option: $1\\\" \u003e\u00262\\n            usage\\n            ;;\\n    esac\\ndone\\n\\n#######################################\\n# Main Execution\\n#######################################\\n\\n# Load config if specified\\nif [ -n \\\"$CONFIG_FILE\\\" ]; then\\n    load_config \\\"$CONFIG_FILE\\\"\\nelse\\n    # Try default config in same directory\\n    script_dir=$(dirname \\\"$0\\\")\\n    default_config=\\\"$script_dir/mitm-audit.cfg\\\"\\n    if [ -f \\\"$default_config\\\" ]; then\\n        load_config \\\"$default_config\\\"\\n    fi\\nfi\\n\\n# Override targets if specified\\nif [ -n \\\"$OVERRIDE_TARGETS\\\" ]; then\\n    TARGETS=$(echo \\\"$OVERRIDE_TARGETS\\\" | tr \u0027,\u0027 \u0027 \u0027)\\nfi\\n\\n# Initialize output\\ninit_output_dir \\\"$OUTPUT_DIR\\\"\\n\\necho \\\"\\\"\\necho \\\"======================================================================\\\"\\necho \\\" INFRASTRUCTURE MITM AUDIT - FORENSIC EVIDENCE COLLECTION\\\"\\necho \\\"======================================================================\\\"\\necho \\\"Timestamp: $(date)\\\"\\necho \\\"Evidence Directory: $BASE_DIR\\\"\\necho \\\"Targets: $TARGETS\\\"\\necho \\\"\\\"\\n\\nlog \\\"Audit started\\\"\\nlog \\\"Targets: $TARGETS\\\"\\n\\n# Execute phases\\nphase1_environment\\nphase2_trust_store\\nphase3_target_analysis\\nphase4_traceroute\\nphase5_client_side\\nphase6_finalize\\n\\nlog \\\"Audit completed\\\"\\n\"}","name":"write","params":"{\"relativeWorkspacePath\":\"templates/network/mitm-audit.sh\",\"code\":{\"code\":\"#!/bin/sh\"}}","additionalData":{"codeblockId":"0c1f10d2-800b-4578-a95c-7358281ae534","reviewData":{"status":"None","selectedOption":"accept","isShowingInput":false,"firstTimeReviewMode":false}},"userDecision":"accepted","result":"{\"diff\":{\"chunks\":[{\"diffString\":\"- \\n+ #!/bin/sh\\n+ # Infrastructure MITM Audit - Forensic Evidence Collection for TLS Interception Detection\\n+ # License: BSD-2-Clause\\n+ # Signed-off-by: Network Diagnostics Toolkit\\n+ #\\n+ # Combines environment baselining, Root CA dumping, ASN-based integrity checking,\\n+ # and DoH comparison to detect infrastructure-side Man-in-the-Middle attacks while\\n+ # ruling out client-side exploits.\\n+ #\\n+ # Produces a timestamped evidence package suitable for chain of custody.\\n+ #\\n+ # Usage: ./mitm-audit.sh [OPTIONS]\\n+ #   -c, --config FILE    Path to mitm-audit.cfg\\n+ #   -o, --output DIR     Output directory (default: ~/ForensicEvidence_timestamp)\\n+ #   -t, --targets LIST   Override targets (comma-separated)\\n+ #   --skip-traceroute    Skip traceroute collection\\n+ #   --skip-client-side   Skip client-side exploit detection\\n+ #   -h, --help           Show this help\\n+ #\\n+ # EVIDENCE PROCESSING:\\n+ # 1. Check _RedFlags.txt first - if empty, MITM may be passive/logging only\\n+ # 2. Certificate Serial Check - copy serial to crt.sh on clean device\\n+ #    - If \\\"No certificates found\\\": 100% MITM by private root CA\\n+ #    - If cert shown for different domain: collision/hash attack\\n+ # 3. Zip evidence folder, hash the zip for chain of custody\\n+ \\n+ set -e\\n+ \\n+ #######################################\\n+ # Default Configuration\\n+ #######################################\\n+ TARGETS=\\\"accounts.google.com login.microsoftonline.com appleid.apple.com aws.amazon.com github.com\\\"\\n+ PUBLIC_RESOLVERS=\\\"1.1.1.1 8.8.8.8 9.9.9.9\\\"\\n+ DOH_ENDPOINT=\\\"https://dns.google/resolve\\\"\\n+ ASN_LOOKUP_URL=\\\"http://ip-api.com/json\\\"\\n+ ASN_LOOKUP_TIMEOUT=3\\n+ EXTERNAL_IP_URL=\\\"https://ipinfo.io/json\\\"\\n+ EXTERNAL_IP_TIMEOUT=5\\n+ EXPECTED_ISP_PATTERNS=\\\"\\\"\\n+ SUSPICIOUS_ASN_PATTERNS=\\\"DigitalOcean Linode Vultr Choopa Datacamp OVH Hetzner\\\"\\n+ SUSPICIOUS_CERT_ISSUERS=\\\"Let\u0027s Encrypt ZeroSSL Self-Signed localhost\\\"\\n+ TRACEROUTE_MAX_HOPS=15\\n+ TRACEROUTE_TIMEOUT=2\\n+ TRACEROUTE_ENABLED=1\\n+ EXPORT_ROOT_CA=1\\n+ HASH_ROOT_CA=1\\n+ CHECK_PROXY_SETTINGS=1\\n+ CHECK_HOSTS_FILE=1\\n+ CHECK_ROOT_CA_ANOMALIES=1\\n+ HASH_ALGORITHM=\\\"sha256\\\"\\n+ SKIP_TRACEROUTE=0\\n+ SKIP_CLIENT_SIDE=0\\n+ \\n+ #######################################\\n+ # Variables\\n+ #######################################\\n+ BASE_DIR=\\\"\\\"\\n+ LOG_FILE=\\\"\\\"\\n+ ALERT_FILE=\\\"\\\"\\n+ TIMESTAMP=\\\"\\\"\\n+ \\n+ #######################################\\n+ # Usage\\n+ #######################################\\n+ usage() {\\n+     cat \u003c\u003c \u0027EOF\u0027\\n+ Usage: mitm-audit.sh [OPTIONS]\\n+ \\n+ Infrastructure MITM Audit - Forensic Evidence Collection\\n+ \\n+ Options:\\n+     -c, --config FILE    Path to mitm-audit.cfg\\n+     -o, --output DIR     Output directory (default: ~/ForensicEvidence_timestamp)\\n+     -t, --targets LIST   Override targets (comma-separated)\\n+     --skip-traceroute    Skip traceroute collection\\n+     --skip-client-side   Skip client-side exploit detection\\n+     -h, --help           Show this help\\n+ \\n+ Examples:\\n+     ./mitm-audit.sh\\n+     ./mitm-audit.sh -c ./mitm-audit.cfg\\n+     ./mitm-audit.sh -t \\\"accounts.google.com,github.com\\\"\\n+     ./mitm-audit.sh --skip-traceroute\\n+ \\n+ Evidence Processing:\\n+     1. Review _RedFlags.txt first\\n+     2. Check certificate serials against crt.sh (on clean network)\\n+     3. Zip evidence folder and hash for chain of custody\\n+ EOF\\n+     exit 0\\n+ }\\n+ \\n+ #######################################\\n+ # Configuration Loading\\n+ #######################################\\n+ load_config() {\\n+     config_file=\\\"$1\\\"\\n+     if [ ! -f \\\"$config_file\\\" ]; then\\n+         echo \\\"[WARN] Config file not found: $config_file (using defaults)\\\"\\n+         return\\n+     fi\\n+ \\n+     while IFS=\u0027=\u0027 read -r key value; do\\n+         # Skip comments and empty lines\\n+         case \\\"$key\\\" in\\n+             \\\\#*|\\\"\\\") continue ;;\\n+         esac\\n+         # Remove leading/trailing whitespace\\n+         key=$(echo \\\"$key\\\" | sed \u0027s/^[[:space:]]*//;s/[[:space:]]*$//\u0027)\\n+         value=$(echo \\\"$value\\\" | sed \u0027s/^[[:space:]]*//;s/[[:space:]]*$//\u0027)\\n+ \\n+         case \\\"$key\\\" in\\n+             TARGETS) TARGETS=$(echo \\\"$value\\\" | tr \u0027,\u0027 \u0027 \u0027) ;;\\n+             PUBLIC_RESOLVERS) PUBLIC_RESOLVERS=$(echo \\\"$value\\\" | tr \u0027,\u0027 \u0027 \u0027) ;;\\n+             DOH_ENDPOINT) DOH_ENDPOINT=\\\"$value\\\" ;;\\n+             ASN_LOOKUP_URL) ASN_LOOKUP_URL=\\\"$value\\\" ;;\\n+             ASN_LOOKUP_TIMEOUT_SEC) ASN_LOOKUP_TIMEOUT=\\\"$value\\\" ;;\\n+             EXTERNAL_IP_URL) EXTERNAL_IP_URL=\\\"$value\\\" ;;\\n+             EXTERNAL_IP_TIMEOUT_SEC) EXTERNAL_IP_TIMEOUT=\\\"$value\\\" ;;\\n+             EXPECTED_ISP_PATTERNS) EXPECTED_ISP_PATTERNS=$(echo \\\"$value\\\" | tr \u0027,\u0027 \u0027 \u0027) ;;\\n+             SUSPICIOUS_ASN_PATTERNS) SUSPICIOUS_ASN_PATTERNS=$(echo \\\"$value\\\" | tr \u0027,\u0027 \u0027 \u0027) ;;\\n+             SUSPICIOUS_CERT_ISSUERS) SUSPICIOUS_CERT_ISSUERS=$(echo \\\"$value\\\" | tr \u0027,\u0027 \u0027 \u0027) ;;\\n+             TRACEROUTE_MAX_HOPS) TRACEROUTE_MAX_HOPS=\\\"$value\\\" ;;\\n+             TRACEROUTE_TIMEOUT_SEC) TRACEROUTE_TIMEOUT=\\\"$value\\\" ;;\\n+             TRACEROUTE_ENABLED) [ \\\"$value\\\" = \\\"true\\\" ] \u0026\u0026 TRACEROUTE_ENABLED=1 || TRACEROUTE_ENABLED=0 ;;\\n+             EXPORT_ROOT_CA) [ \\\"$value\\\" = \\\"true\\\" ] \u0026\u0026 EXPORT_ROOT_CA=1 || EXPORT_ROOT_CA=0 ;;\\n+             HASH_ROOT_CA) [ \\\"$value\\\" = \\\"true\\\" ] \u0026\u0026 HASH_ROOT_CA=1 || HASH_ROOT_CA=0 ;;\\n+             CHECK_PROXY_SETTINGS) [ \\\"$value\\\" = \\\"true\\\" ] \u0026\u0026 CHECK_PROXY_SETTINGS=1 || CHECK_PROXY_SETTINGS=0 ;;\\n+             CHECK_HOSTS_FILE) [ \\\"$value\\\" = \\\"true\\\" ] \u0026\u0026 CHECK_HOSTS_FILE=1 || CHECK_HOSTS_FILE=0 ;;\\n+             CHECK_ROOT_CA_ANOMALIES) [ \\\"$value\\\" = \\\"true\\\" ] \u0026\u0026 CHECK_ROOT_CA_ANOMALIES=1 || CHECK_ROOT_CA_ANOMALIES=0 ;;\\n+             HASH_ALGORITHM) HASH_ALGORITHM=\\\"$value\\\" ;;\\n+         esac\\n+     done \u003c \\\"$config_file\\\"\\n+ }\\n+ \\n+ #######################################\\n+ # Logging Functions\\n+ #######################################\\n+ init_output_dir() {\\n+     TIMESTAMP=$(date +\\\"%Y%m%d_%H%M%S\\\")\\n+ \\n+     if [ -n \\\"$1\\\" ]; then\\n+         BASE_DIR=\\\"$1\\\"\\n+     else\\n+         BASE_DIR=\\\"$HOME/ForensicEvidence_$TIMESTAMP\\\"\\n+     fi\\n+ \\n+     mkdir -p \\\"$BASE_DIR\\\"\\n+     LOG_FILE=\\\"$BASE_DIR/_AuditLog.txt\\\"\\n+     ALERT_FILE=\\\"$BASE_DIR/_RedFlags.txt\\\"\\n+ \\n+     : \u003e \\\"$ALERT_FILE\\\"\\n+ }\\n+ \\n+ log() {\\n+     level=\\\"${2:-INFO}\\\"\\n+     timestamp=$(date +\\\"%Y-%m-%d %H:%M:%S\\\")\\n+     msg=\\\"[$timestamp] [$level] $1\\\"\\n+     echo \\\"$msg\\\"\\n+     echo \\\"$msg\\\" \u003e\u003e \\\"$LOG_FILE\\\"\\n+ }\\n+ \\n+ alert() {\\n+     timestamp=$(date +\\\"%Y-%m-%d %H:%M:%S\\\")\\n+     echo \\\"[!] $1\\\"\\n+     echo \\\"[$timestamp] $1\\\" \u003e\u003e \\\"$ALERT_FILE\\\"\\n+     log \\\"$1\\\" \\\"ALERT\\\"\\n+ }\\n+ \\n+ print_section() {\\n+     echo \\\"\\\"\\n+     echo \\\"======================================================================\\\"\\n+     echo \\\" $1\\\"\\n+     echo \\\"======================================================================\\\"\\n+     log \\\"=== $1 ===\\\" \\\"INFO\\\"\\n+ }\\n+ \\n+ print_subsection() {\\n+     echo \\\"\\\"\\n+     echo \\\"[*] $1\\\"\\n+     echo \\\"--------------------------------------------------\\\"\\n+     log \\\"--- $1 ---\\\" \\\"INFO\\\"\\n+ }\\n+ \\n+ #######################################\\n+ # ASN and DNS Functions\\n+ #######################################\\n+ get_asn() {\\n+     ip=\\\"$1\\\"\\n+     result=$(curl -s --max-time \\\"$ASN_LOOKUP_TIMEOUT\\\" \\\"${ASN_LOOKUP_URL}/${ip}?fields=status,message,org,as\\\" 2\u003e/dev/null || echo \\\"\\\")\\n+ \\n+     if [ -z \\\"$result\\\" ]; then\\n+         echo \\\"Lookup Failed (Blocked?)\\\"\\n+         return\\n+     fi\\n+ \\n+     status=$(echo \\\"$result\\\" | grep -o \u0027\\\"status\\\":\\\"[^\\\"]*\\\"\u0027 | cut -d\u0027\\\"\u0027 -f4)\\n+     if [ \\\"$status\\\" = \\\"success\\\" ]; then\\n+         org=$(echo \\\"$result\\\" | grep -o \u0027\\\"org\\\":\\\"[^\\\"]*\\\"\u0027 | cut -d\u0027\\\"\u0027 -f4)\\n+         as=$(echo \\\"$result\\\" | grep -o \u0027\\\"as\\\":\\\"[^\\\"]*\\\"\u0027 | cut -d\u0027\\\"\u0027 -f4)\\n+         echo \\\"$org ($as)\\\"\\n+     else\\n+         echo \\\"Unknown\\\"\\n+     fi\\n+ }\\n+ \\n+ get_doh_resolution() {\\n+     domain=\\\"$1\\\"\\n+     result=$(curl -s --max-time 5 \\\"${DOH_ENDPOINT}?name=${domain}\u0026type=A\\\" 2\u003e/dev/null || echo \\\"\\\")\\n+ \\n+     if [ -z \\\"$result\\\" ]; then\\n+         echo \\\"\\\"\\n+         return\\n+     fi\\n+ \\n+     # Extract IP from Answer section (simplified JSON parsing)\\n+     echo \\\"$result\\\" | grep -o \u0027\\\"data\\\":\\\"[0-9.]*\\\"\u0027 | head -1 | cut -d\u0027\\\"\u0027 -f4\\n+ }\\n+ \\n+ test_asn_integrity() {\\n+     domain=\\\"$1\\\"\\n+     asn=\\\"$2\\\"\\n+ \\n+     if [ \\\"$asn\\\" = \\\"Lookup Failed (Blocked?)\\\" ]; then\\n+         return 0\\n+     fi\\n+ \\n+     alert_msg=\\\"\\\"\\n+ \\n+     # Check Google\\n+     if echo \\\"$domain\\\" | grep -qi \\\"google\\\"; then\\n+         if ! echo \\\"$asn\\\" | grep -qi \\\"Google\\\"; then\\n+             alert_msg=\\\"MITM DETECTED: $domain resolving to non-Google ASN ($asn)\\\"\\n+         fi\\n+     fi\\n+ \\n+     # Check Microsoft\\n+     if echo \\\"$domain\\\" | grep -qi \\\"microsoft\\\"; then\\n+         if ! echo \\\"$asn\\\" | grep -qi \\\"Microsoft\\\"; then\\n+             alert_msg=\\\"MITM DETECTED: $domain resolving to non-Microsoft ASN ($asn)\\\"\\n+         fi\\n+     fi\\n+ \\n+     # Check Apple\\n+     if echo \\\"$domain\\\" | grep -qi \\\"apple\\\"; then\\n+         if ! echo \\\"$asn\\\" | grep -qi \\\"Apple\\\"; then\\n+             alert_msg=\\\"MITM DETECTED: $domain resolving to non-Apple ASN ($asn)\\\"\\n+         fi\\n+     fi\\n+ \\n+     # Check Amazon\\n+     if echo \\\"$domain\\\" | grep -qi \\\"aws\\\\|amazon\\\"; then\\n+         if ! echo \\\"$asn\\\" | grep -qi \\\"Amazon\\\\|AMAZON\\\"; then\\n+             alert_msg=\\\"MITM DETECTED: $domain resolving to non-Amazon ASN ($asn)\\\"\\n+         fi\\n+     fi\\n+ \\n+     # Check GitHub\\n+     if echo \\\"$domain\\\" | grep -qi \\\"github\\\"; then\\n+         if ! echo \\\"$asn\\\" | grep -qi \\\"GitHub\\\\|Microsoft\\\"; then\\n+             alert_msg=\\\"MITM DETECTED: $domain resolving to non-GitHub/Microsoft ASN ($asn)\\\"\\n+         fi\\n+     fi\\n+ \\n+     # Check for suspicious VPS providers\\n+     if [ -z \\\"$alert_msg\\\" ]; then\\n+         for pattern in $SUSPICIOUS_ASN_PATTERNS; do\\n+             if echo \\\"$asn\\\" | grep -qi \\\"$pattern\\\"; then\\n+                 alert_msg=\\\"MITM DETECTED: High-value target routed to VPS provider ($pattern)\\\"\\n+                 break\\n+             fi\\n+         done\\n+     fi\\n+ \\n+     if [ -n \\\"$alert_msg\\\" ]; then\\n+         echo \\\"$alert_msg\\\"\\n+         return 1\\n+     fi\\n+ \\n+     return 0\\n+ }\\n+ \\n+ #######################################\\n+ # Certificate Functions\\n+ #######################################\\n+ get_tls_certificate() {\\n+     domain=\\\"$1\\\"\\n+     output_file=\\\"$2\\\"\\n+ \\n+     if ! command -v openssl \u003e/dev/null 2\u003e\u00261; then\\n+         echo \\\"OpenSSL not available\\\" \u003e \\\"$output_file\\\"\\n+         return 1\\n+     fi\\n+ \\n+     # Capture full certificate chain\\n+     echo | openssl s_client -showcerts -connect \\\"${domain}:443\\\" -servername \\\"$domain\\\" 2\u003e/dev/null \u003e \\\"${output_file}.pem\\\"\\n+ \\n+     # Extract certificate details\\n+     cert_info_file=\\\"${output_file}.txt\\\"\\n+     {\\n+         echo \\\"=== Certificate Details for $domain ===\\\"\\n+         echo \\\"\\\"\\n+         echo \\\"Subject:\\\"\\n+         openssl x509 -in \\\"${output_file}.pem\\\" -noout -subject 2\u003e/dev/null || echo \\\"  Unable to extract\\\"\\n+         echo \\\"\\\"\\n+         echo \\\"Issuer:\\\"\\n+         openssl x509 -in \\\"${output_file}.pem\\\" -noout -issuer 2\u003e/dev/null || echo \\\"  Unable to extract\\\"\\n+         echo \\\"\\\"\\n+         echo \\\"Serial Number:\\\"\\n+         openssl x509 -in \\\"${output_file}.pem\\\" -noout -serial 2\u003e/dev/null || echo \\\"  Unable to extract\\\"\\n+         echo \\\"\\\"\\n+         echo \\\"Validity:\\\"\\n+         openssl x509 -in \\\"${output_file}.pem\\\" -noout -dates 2\u003e/dev/null || echo \\\"  Unable to extract\\\"\\n+         echo \\\"\\\"\\n+         echo \\\"Fingerprint (SHA256):\\\"\\n+         openssl x509 -in \\\"${output_file}.pem\\\" -noout -fingerprint -sha256 2\u003e/dev/null || echo \\\"  Unable to extract\\\"\\n+     } \u003e \\\"$cert_info_file\\\"\\n+ \\n+     # Extract just serial and issuer for quick checking\\n+     serial=$(openssl x509 -in \\\"${output_file}.pem\\\" -noout -serial 2\u003e/dev/null | cut -d\u0027=\u0027 -f2)\\n+     issuer=$(openssl x509 -in \\\"${output_file}.pem\\\" -noout -issuer 2\u003e/dev/null)\\n+ \\n+     echo \\\"$serial|$issuer\\\"\\n+ }\\n+ \\n+ test_certificate_anomaly() {\\n+     domain=\\\"$1\\\"\\n+     issuer=\\\"$2\\\"\\n+ \\n+     # Check for suspicious issuers on major tech domains\\n+     is_major_tech=0\\n+     for pattern in google microsoft apple amazon github; do\\n+         if echo \\\"$domain\\\" | grep -qi \\\"$pattern\\\"; then\\n+             is_major_tech=1\\n+             break\\n+         fi\\n+     done\\n+ \\n+     if [ \\\"$is_major_tech\\\" = \\\"1\\\" ]; then\\n+         for suspicious_issuer in $SUSPICIOUS_CERT_ISSUERS; do\\n+             if echo \\\"$issuer\\\" | grep -qi \\\"$suspicious_issuer\\\"; then\\n+                 echo \\\"CERTIFICATE ANOMALY: $domain using $suspicious_issuer issuer - highly suspicious for major tech corp\\\"\\n+                 return 1\\n+             fi\\n+         done\\n+     fi\\n+ \\n+     return 0\\n+ }\\n+ \\n+ #######################################\\n+ # Phase 1: Environment Snapshot\\n+ #######################################\\n+ phase1_environment() {\\n+     print_section \\\"PHASE 1: ENVIRONMENT SNAPSHOT\\\"\\n+ \\n+     env_dir=\\\"$BASE_DIR/environment\\\"\\n+     mkdir -p \\\"$env_dir\\\"\\n+ \\n+     # Network configuration\\n+     print_subsection \\\"Network Configuration\\\"\\n+     {\\n+         echo \\\"=== Network Interfaces ===\\\"\\n+         if command -v ip \u003e/dev/null 2\u003e\u00261; then\\n+             ip addr show\\n+         elif command -v ifconfig \u003e/dev/null 2\u003e\u00261; then\\n+             ifconfig -a\\n+         else\\n+             echo \\\"No interface command available\\\"\\n+         fi\\n+     } \u003e \\\"$env_dir/NetworkConfig.txt\\\"\\n+ \\n+     # DNS configuration\\n+     {\\n+         echo \\\"=== DNS Configuration ===\\\"\\n+         if [ -f /etc/resolv.conf ]; then\\n+             cat /etc/resolv.conf\\n+         fi\\n+     } \u003e\u003e \\\"$env_dir/NetworkConfig.txt\\\"\\n+ \\n+     # External IP\\n+     print_subsection \\\"External IP Identification\\\"\\n+     ext_ip_json=$(curl -s --max-time \\\"$EXTERNAL_IP_TIMEOUT\\\" \\\"$EXTERNAL_IP_URL\\\" 2\u003e/dev/null || echo \\\"\\\")\\n+ \\n+     if [ -n \\\"$ext_ip_json\\\" ]; then\\n+         echo \\\"$ext_ip_json\\\" \u003e \\\"$env_dir/ExternalIP.json\\\"\\n+ \\n+         ext_ip=$(echo \\\"$ext_ip_json\\\" | grep -o \u0027\\\"ip\\\":\\\"[^\\\"]*\\\"\u0027 | cut -d\u0027\\\"\u0027 -f4)\\n+         ext_org=$(echo \\\"$ext_ip_json\\\" | grep -o \u0027\\\"org\\\":\\\"[^\\\"]*\\\"\u0027 | cut -d\u0027\\\"\u0027 -f4)\\n+         ext_city=$(echo \\\"$ext_ip_json\\\" | grep -o \u0027\\\"city\\\":\\\"[^\\\"]*\\\"\u0027 | cut -d\u0027\\\"\u0027 -f4)\\n+         ext_region=$(echo \\\"$ext_ip_json\\\" | grep -o \u0027\\\"region\\\":\\\"[^\\\"]*\\\"\u0027 | cut -d\u0027\\\"\u0027 -f4)\\n+         ext_country=$(echo \\\"$ext_ip_json\\\" | grep -o \u0027\\\"country\\\":\\\"[^\\\"]*\\\"\u0027 | cut -d\u0027\\\"\u0027 -f4)\\n+ \\n+         log \\\"External IP: $ext_ip\\\"\\n+         log \\\"External Org: $ext_org\\\"\\n+         log \\\"Location: $ext_city, $ext_region, $ext_country\\\"\\n+ \\n+         # Check expected ISP\\n+         if [ -n \\\"$EXPECTED_ISP_PATTERNS\\\" ]; then\\n+             is_expected=0\\n+             for pattern in $EXPECTED_ISP_PATTERNS; do\\n+                 if echo \\\"$ext_org\\\" | grep -qi \\\"$pattern\\\"; then\\n+                     is_expected=1\\n+                     break\\n+                 fi\\n+             done\\n+             if [ \\\"$is_expected\\\" = \\\"0\\\" ]; then\\n+                 alert \\\"External IP Org ($ext_org) does not match expected ISP patterns - traffic may be tunneled/proxied\\\"\\n+             fi\\n+         fi\\n+     else\\n+         alert \\\"Unable to determine External IP - connection may be blocked or filtered\\\"\\n+     fi\\n+ \\n+     # System info\\n+     print_subsection \\\"System Information\\\"\\n+     {\\n+         echo \\\"Hostname: $(hostname)\\\"\\n+         echo \\\"User: $(whoami)\\\"\\n+         echo \\\"Date: $(date)\\\"\\n+         echo \\\"Kernel: $(uname -a)\\\"\\n+         echo \\\"Timestamp: $(date -Iseconds 2\u003e/dev/null || date)\\\"\\n+     } \u003e \\\"$env_dir/SystemInfo.txt\\\"\\n+ \\n+     log \\\"System: $(hostname) / User: $(whoami)\\\"\\n+ }\\n+ \\n+ #######################################\\n+ # Phase 2: Trust Store Export\\n+ #######################################\\n+ phase2_trust_store() {\\n+     print_section \\\"PHASE 2: TRUST STORE EXPORT\\\"\\n+ \\n+     trust_dir=\\\"$BASE_DIR/trust-store\\\"\\n+     mkdir -p \\\"$trust_dir\\\"\\n+ \\n+     if [ \\\"$EXPORT_ROOT_CA\\\" = \\\"0\\\" ]; then\\n+         log \\\"Root CA export disabled in configuration\\\"\\n+         return\\n+     fi\\n+ \\n+     print_subsection \\\"Exporting Root CA Store\\\"\\n+ \\n+     # Linux - common CA bundle locations\\n+     ca_exported=0\\n+     for ca_path in /etc/ssl/certs/ca-certificates.crt /etc/pki/tls/certs/ca-bundle.crt /etc/ssl/ca-bundle.pem; do\\n+         if [ -f \\\"$ca_path\\\" ]; then\\n+             cp \\\"$ca_path\\\" \\\"$trust_dir/RootCA_Snapshot.crt\\\"\\n+             log \\\"Root CA Store exported from $ca_path\\\"\\n+             ca_exported=1\\n+ \\n+             if [ \\\"$HASH_ROOT_CA\\\" = \\\"1\\\" ]; then\\n+                 hash_value=$(${HASH_ALGORITHM}sum \\\"$ca_path\\\" 2\u003e/dev/null | cut -d\u0027 \u0027 -f1 || shasum -a 256 \\\"$ca_path\\\" 2\u003e/dev/null | cut -d\u0027 \u0027 -f1)\\n+                 echo \\\"{\\\\\\\"algorithm\\\\\\\":\\\\\\\"$HASH_ALGORITHM\\\\\\\",\\\\\\\"hash\\\\\\\":\\\\\\\"$hash_value\\\\\\\",\\\\\\\"source\\\\\\\":\\\\\\\"$ca_path\\\\\\\"}\\\" \u003e \\\"$trust_dir/RootCA_Hash.json\\\"\\n+                 log \\\"Root CA hash: $hash_value\\\"\\n+             fi\\n+             break\\n+         fi\\n+     done\\n+ \\n+     # macOS - export from Keychain\\n+     if [ \\\"$(uname)\\\" = \\\"Darwin\\\" ]; then\\n+         print_subsection \\\"Exporting macOS Keychain Root CAs\\\"\\n+         if command -v security \u003e/dev/null 2\u003e\u00261; then\\n+             security find-certificate -a -p /System/Library/Keychains/SystemRootCertificates.keychain \u003e \\\"$trust_dir/MacOS_SystemRoots.pem\\\" 2\u003e/dev/null || true\\n+             security find-certificate -a -p /Library/Keychains/System.keychain \u003e \\\"$trust_dir/MacOS_SystemKeychain.pem\\\" 2\u003e/dev/null || true\\n+             log \\\"macOS Root Keychains exported\\\"\\n+             ca_exported=1\\n+         fi\\n+     fi\\n+ \\n+     if [ \\\"$ca_exported\\\" = \\\"0\\\" ]; then\\n+         log \\\"Could not locate CA bundle\\\" \\\"WARN\\\"\\n+     fi\\n+ \\n+     # Anomaly detection for Linux/macOS (limited compared to Windows)\\n+     if [ \\\"$CHECK_ROOT_CA_ANOMALIES\\\" = \\\"1\\\" ] \u0026\u0026 [ -f \\\"$trust_dir/RootCA_Snapshot.crt\\\" ]; then\\n+         print_subsection \\\"Root CA Anomaly Detection\\\"\\n+ \\n+         # Check for suspicious patterns in certificate subjects\\n+         suspicious_found=0\\n+         for pattern in \\\"Self\\\" \\\"Test\\\" \\\"Admin\\\" \\\"Local\\\" \\\"Proxy\\\" \\\"Intercept\\\" \\\"MITM\\\" \\\"Zscaler\\\" \\\"BlueCoat\\\" \\\"Forcepoint\\\"; do\\n+             matches=$(grep -i \\\"Subject:.*$pattern\\\" \\\"$trust_dir/RootCA_Snapshot.crt\\\" 2\u003e/dev/null || true)\\n+             if [ -n \\\"$matches\\\" ]; then\\n+                 alert \\\"Suspicious Root CA pattern found: $pattern\\\"\\n+                 echo \\\"$matches\\\" \u003e\u003e \\\"$trust_dir/SuspiciousCAs.txt\\\"\\n+                 suspicious_found=1\\n+             fi\\n+         done\\n+ \\n+         if [ \\\"$suspicious_found\\\" = \\\"0\\\" ]; then\\n+             log \\\"No suspicious root CAs detected by pattern matching\\\"\\n+         fi\\n+     fi\\n+ }\\n+ \\n+ #######################################\\n+ # Phase 3: Target Analysis\\n+ #######################################\\n+ phase3_target_analysis() {\\n+     print_section \\\"PHASE 3: TARGET ANALYSIS AND ASN INTEGRITY\\\"\\n+ \\n+     targets_dir=\\\"$BASE_DIR/targets\\\"\\n+     mkdir -p \\\"$targets_dir\\\"\\n+ \\n+     for domain in $TARGETS; do\\n+         print_subsection \\\"Analyzing: $domain\\\"\\n+ \\n+         safe_domain=$(echo \\\"$domain\\\" | tr \u0027.\u0027 \u0027_\u0027)\\n+         domain_dir=\\\"$targets_dir/$safe_domain\\\"\\n+         mkdir -p \\\"$domain_dir\\\"\\n+ \\n+         # A. Local DNS Resolution\\n+         local_ip=\\\"\\\"\\n+         if command -v dig \u003e/dev/null 2\u003e\u00261; then\\n+             local_ip=$(dig +short \\\"$domain\\\" A | tail -n1)\\n+         elif command -v host \u003e/dev/null 2\u003e\u00261; then\\n+             local_ip=$(host -t A \\\"$domain\\\" 2\u003e/dev/null | grep \\\"has address\\\" | head -1 | awk \u0027{print $NF}\u0027)\\n+         elif command -v nslookup \u003e/dev/null 2\u003e\u00261; then\\n+             local_ip=$(nslookup \\\"$domain\\\" 2\u003e/dev/null | grep -A1 \\\"Name:\\\" | grep \\\"Address:\\\" | awk \u0027{print $2}\u0027 | head -1)\\n+         fi\\n+ \\n+         if [ -n \\\"$local_ip\\\" ]; then\\n+             local_asn=$(get_asn \\\"$local_ip\\\")\\n+             log \\\"Local DNS: $local_ip | ASN: $local_asn\\\"\\n+             echo \\\"local_ip=$local_ip\\\" \u003e \\\"$domain_dir/dns.txt\\\"\\n+             echo \\\"local_asn=$local_asn\\\" \u003e\u003e \\\"$domain_dir/dns.txt\\\"\\n+         else\\n+             log \\\"Local DNS resolution failed\\\" \\\"WARN\\\"\\n+             local_asn=\\\"\\\"\\n+         fi\\n+ \\n+         # B. DoH Resolution (Control Group)\\n+         doh_ip=$(get_doh_resolution \\\"$domain\\\")\\n+         if [ -n \\\"$doh_ip\\\" ]; then\\n+             doh_asn=$(get_asn \\\"$doh_ip\\\")\\n+             log \\\"DoH DNS:   $doh_ip | ASN: $doh_asn\\\"\\n+             echo \\\"doh_ip=$doh_ip\\\" \u003e\u003e \\\"$domain_dir/dns.txt\\\"\\n+             echo \\\"doh_asn=$doh_asn\\\" \u003e\u003e \\\"$domain_dir/dns.txt\\\"\\n+ \\n+             # Compare IPs\\n+             if [ -n \\\"$local_ip\\\" ] \u0026\u0026 [ \\\"$local_ip\\\" != \\\"$doh_ip\\\" ]; then\\n+                 log \\\"DNS MISMATCH: Local ($local_ip) vs DoH ($doh_ip)\\\" \\\"WARN\\\"\\n+             fi\\n+         else\\n+             log \\\"DoH resolution failed (network may be blocking)\\\" \\\"WARN\\\"\\n+         fi\\n+ \\n+         # C. ASN Integrity Check\\n+         if [ -n \\\"$local_asn\\\" ]; then\\n+             asn_alert=$(test_asn_integrity \\\"$domain\\\" \\\"$local_asn\\\" || true)\\n+             if [ -n \\\"$asn_alert\\\" ]; then\\n+                 alert \\\"$asn_alert\\\"\\n+             fi\\n+         fi\\n+ \\n+         # D. Certificate Capture\\n+         log \\\"Capturing TLS certificate...\\\"\\n+         cert_result=$(get_tls_certificate \\\"$domain\\\" \\\"$domain_dir/Certificate\\\")\\n+ \\n+         if [ -n \\\"$cert_result\\\" ]; then\\n+             serial=$(echo \\\"$cert_result\\\" | cut -d\u0027|\u0027 -f1)\\n+             issuer=$(echo \\\"$cert_result\\\" | cut -d\u0027|\u0027 -f2)\\n+ \\n+             if [ -n \\\"$serial\\\" ]; then\\n+                 log \\\"Certificate Serial: $serial\\\"\\n+                 log \\\"Certificate Issuer: $issuer\\\"\\n+ \\n+                 # Check for certificate anomalies\\n+                 cert_alert=$(test_certificate_anomaly \\\"$domain\\\" \\\"$issuer\\\" || true)\\n+                 if [ -n \\\"$cert_alert\\\" ]; then\\n+                     alert \\\"$cert_alert\\\"\\n+                 fi\\n+             else\\n+                 alert \\\"TLS Handshake Failed for $domain - could not extract certificate\\\"\\n+             fi\\n+         fi\\n+ \\n+         # Save analysis summary\\n+         {\\n+             echo \\\"{\\\"\\n+             echo \\\"  \\\\\\\"domain\\\\\\\": \\\\\\\"$domain\\\\\\\",\\\"\\n+             echo \\\"  \\\\\\\"timestamp\\\\\\\": \\\\\\\"$(date -Iseconds 2\u003e/dev/null || date)\\\\\\\",\\\"\\n+             echo \\\"  \\\\\\\"local_dns\\\\\\\": \\\\\\\"$local_ip\\\\\\\",\\\"\\n+             echo \\\"  \\\\\\\"local_asn\\\\\\\": \\\\\\\"$local_asn\\\\\\\",\\\"\\n+             echo \\\"  \\\\\\\"doh_dns\\\\\\\": \\\\\\\"$doh_ip\\\\\\\",\\\"\\n+             echo \\\"  \\\\\\\"doh_asn\\\\\\\": \\\\\\\"$doh_asn\\\\\\\"\\\"\\n+             echo \\\"}\\\"\\n+         } \u003e \\\"$domain_dir/Analysis.json\\\"\\n+     done\\n+ }\\n+ \\n+ #######################################\\n+ # Phase 4: Traceroute Mapping\\n+ #######################################\\n+ phase4_traceroute() {\\n+     print_section \\\"PHASE 4: TRACEROUTE MAPPING\\\"\\n+ \\n+     if [ \\\"$TRACEROUTE_ENABLED\\\" = \\\"0\\\" ] || [ \\\"$SKIP_TRACEROUTE\\\" = \\\"1\\\" ]; then\\n+         log \\\"Traceroute skipped (disabled or --skip-traceroute specified)\\\"\\n+         return\\n+     fi\\n+ \\n+     trace_dir=\\\"$BASE_DIR/traceroute\\\"\\n+     mkdir -p \\\"$trace_dir\\\"\\n+ \\n+     # Determine traceroute command\\n+     trace_cmd=\\\"\\\"\\n+     if command -v traceroute \u003e/dev/null 2\u003e\u00261; then\\n+         trace_cmd=\\\"traceroute\\\"\\n+     elif command -v tracepath \u003e/dev/null 2\u003e\u00261; then\\n+         trace_cmd=\\\"tracepath\\\"\\n+     else\\n+         log \\\"No traceroute command available\\\" \\\"WARN\\\"\\n+         return\\n+     fi\\n+ \\n+     for domain in $TARGETS; do\\n+         print_subsection \\\"Tracing: $domain\\\"\\n+ \\n+         safe_domain=$(echo \\\"$domain\\\" | tr \u0027.\u0027 \u0027_\u0027)\\n+         trace_file=\\\"$trace_dir/Trace_${safe_domain}.txt\\\"\\n+         trace_json=\\\"$trace_dir/Trace_${safe_domain}.json\\\"\\n+ \\n+         if [ \\\"$trace_cmd\\\" = \\\"traceroute\\\" ]; then\\n+             traceroute -m \\\"$TRACEROUTE_MAX_HOPS\\\" -w \\\"$TRACEROUTE_TIMEOUT\\\" \\\"$domain\\\" \u003e \\\"$trace_file\\\" 2\u003e\u00261 || true\\n+         else\\n+             tracepath -m \\\"$TRACEROUTE_MAX_HOPS\\\" \\\"$domain\\\" \u003e \\\"$trace_file\\\" 2\u003e\u00261 || true\\n+         fi\\n+ \\n+         # Extract IPs and lookup ASNs\\n+         hop_num=1\\n+         echo \\\"[\\\" \u003e \\\"$trace_json\\\"\\n+         first_hop=1\\n+ \\n+         # Parse traceroute output for IPs\\n+         while IFS= read -r line; do\\n+             # Extract IP addresses from the line\\n+             for ip in $(echo \\\"$line\\\" | grep -oE \u0027([0-9]{1,3}\\\\.){3}[0-9]{1,3}\u0027); do\\n+                 if [ \\\"$ip\\\" != \\\"0.0.0.0\\\" ]; then\\n+                     asn=$(get_asn \\\"$ip\\\")\\n+ \\n+                     if [ \\\"$first_hop\\\" = \\\"0\\\" ]; then\\n+                         echo \\\",\\\" \u003e\u003e \\\"$trace_json\\\"\\n+                     fi\\n+                     first_hop=0\\n+ \\n+                     echo \\\"  {\\\\\\\"hop\\\\\\\": $hop_num, \\\\\\\"ip\\\\\\\": \\\\\\\"$ip\\\\\\\", \\\\\\\"asn\\\\\\\": \\\\\\\"$asn\\\\\\\"}\\\" \u003e\u003e \\\"$trace_json\\\"\\n+ \\n+                     # Check for suspicious hops\\n+                     for pattern in $SUSPICIOUS_ASN_PATTERNS; do\\n+                         if echo \\\"$asn\\\" | grep -qi \\\"$pattern\\\"; then\\n+                             alert \\\"Suspicious hop in traceroute to $domain - Hop $hop_num ($ip) routes through $pattern\\\"\\n+                         fi\\n+                     done\\n+                 fi\\n+                 hop_num=$((hop_num + 1))\\n+             done\\n+         done \u003c \\\"$trace_file\\\"\\n+ \\n+         echo \\\"\\\" \u003e\u003e \\\"$trace_json\\\"\\n+         echo \\\"]\\\" \u003e\u003e \\\"$trace_json\\\"\\n+ \\n+         log \\\"Trace complete to $domain\\\"\\n+     done\\n+ }\\n+ \\n+ #######################################\\n+ # Phase 5: Client-Side Exploit Detection\\n+ #######################################\\n+ phase5_client_side() {\\n+     print_section \\\"PHASE 5: CLIENT-SIDE EXPLOIT DETECTION\\\"\\n+ \\n+     if [ \\\"$SKIP_CLIENT_SIDE\\\" = \\\"1\\\" ]; then\\n+         log \\\"Client-side checks skipped (--skip-client-side specified)\\\"\\n+         return\\n+     fi\\n+ \\n+     client_dir=\\\"$BASE_DIR/client-side\\\"\\n+     mkdir -p \\\"$client_dir\\\"\\n+ \\n+     # A. Proxy Settings\\n+     if [ \\\"$CHECK_PROXY_SETTINGS\\\" = \\\"1\\\" ]; then\\n+         print_subsection \\\"Proxy Settings Check\\\"\\n+ \\n+         {\\n+             echo \\\"=== Environment Proxy Variables ===\\\"\\n+             echo \\\"HTTP_PROXY: ${HTTP_PROXY:-\u003cnot set\u003e}\\\"\\n+             echo \\\"HTTPS_PROXY: ${HTTPS_PROXY:-\u003cnot set\u003e}\\\"\\n+             echo \\\"http_proxy: ${http_proxy:-\u003cnot set\u003e}\\\"\\n+             echo \\\"https_proxy: ${https_proxy:-\u003cnot set\u003e}\\\"\\n+             echo \\\"ALL_PROXY: ${ALL_PROXY:-\u003cnot set\u003e}\\\"\\n+             echo \\\"NO_PROXY: ${NO_PROXY:-\u003cnot set\u003e}\\\"\\n+             echo \\\"\\\"\\n+ \\n+             # Check for proxy in common config files\\n+             echo \\\"=== Git Proxy Configuration ===\\\"\\n+             if command -v git \u003e/dev/null 2\u003e\u00261; then\\n+                 git config --global --get http.proxy 2\u003e/dev/null || echo \\\"\u003cnot set\u003e\\\"\\n+                 git config --global --get https.proxy 2\u003e/dev/null || echo \\\"\u003cnot set\u003e\\\"\\n+             fi\\n+             echo \\\"\\\"\\n+ \\n+             # macOS network proxy\\n+             if [ \\\"$(uname)\\\" = \\\"Darwin\\\" ]; then\\n+                 echo \\\"=== macOS Network Proxy (scutil) ===\\\"\\n+                 scutil --proxy 2\u003e/dev/null || echo \\\"Unable to query\\\"\\n+             fi\\n+ \\n+             # Linux proxy via gsettings\\n+             if command -v gsettings \u003e/dev/null 2\u003e\u00261; then\\n+                 echo \\\"=== GNOME Proxy Settings ===\\\"\\n+                 gsettings get org.gnome.system.proxy mode 2\u003e/dev/null || echo \\\"Unable to query\\\"\\n+             fi\\n+         } \u003e \\\"$client_dir/ProxySettings.txt\\\"\\n+ \\n+         # Alert on set proxy variables\\n+         for var in HTTP_PROXY HTTPS_PROXY http_proxy https_proxy ALL_PROXY; do\\n+             eval \\\"val=\\\\$$var\\\"\\n+             if [ -n \\\"$val\\\" ]; then\\n+                 alert \\\"Environment proxy variable set: $var = $val\\\"\\n+             fi\\n+         done\\n+ \\n+         log \\\"Proxy settings captured\\\"\\n+     fi\\n+ \\n+     # B. Hosts File Check\\n+     if [ \\\"$CHECK_HOSTS_FILE\\\" = \\\"1\\\" ]; then\\n+         print_subsection \\\"Hosts File Analysis\\\"\\n+ \\n+         hosts_path=\\\"/etc/hosts\\\"\\n+         if [ -f \\\"$hosts_path\\\" ]; then\\n+             cp \\\"$hosts_path\\\" \\\"$client_dir/hosts_backup\\\"\\n+ \\n+             sensitive_patterns=\\\"google microsoft apple amazon github cursor openai anthropic\\\"\\n+             suspicious_found=0\\n+ \\n+             for pattern in $sensitive_patterns; do\\n+                 # Find non-comment lines matching pattern that don\u0027t point to localhost\\n+                 matches=$(grep -i \\\"$pattern\\\" \\\"$hosts_path\\\" 2\u003e/dev/null | grep -v \\\"^#\\\" | grep -v \\\"127.0.0.1\\\" | grep -v \\\"::1\\\" | grep -v \\\"0.0.0.0\\\" || true)\\n+                 if [ -n \\\"$matches\\\" ]; then\\n+                     alert \\\"Hosts file redirect for $pattern pattern: $matches\\\"\\n+                     echo \\\"$matches\\\" \u003e\u003e \\\"$client_dir/SuspiciousHosts.txt\\\"\\n+                     suspicious_found=1\\n+                 fi\\n+             done\\n+ \\n+             if [ \\\"$suspicious_found\\\" = \\\"0\\\" ]; then\\n+                 log \\\"No suspicious hosts file entries found\\\"\\n+             fi\\n+ \\n+             # Count entries\\n+             entry_count=$(grep -v \\\"^#\\\" \\\"$hosts_path\\\" 2\u003e/dev/null | grep -v \\\"^$\\\" | wc -l | tr -d \u0027 \u0027)\\n+             log \\\"Hosts file entries: $entry_count\\\"\\n+         else\\n+             log \\\"Hosts file not found at $hosts_path\\\" \\\"WARN\\\"\\n+         fi\\n+     fi\\n+ \\n+     # C. Browser Extension Check (Firefox on Linux/macOS)\\n+     print_subsection \\\"Browser Extension Audit\\\"\\n+ \\n+     {\\n+         echo \\\"=== Firefox Extensions ===\\\"\\n+         # Firefox profile locations\\n+         for firefox_dir in \\\"$HOME/.mozilla/firefox\\\" \\\"$HOME/Library/Application Support/Firefox/Profiles\\\"; do\\n+             if [ -d \\\"$firefox_dir\\\" ]; then\\n+                 find \\\"$firefox_dir\\\" -name \\\"extensions.json\\\" -exec cat {} \\\\; 2\u003e/dev/null | head -100 || echo \\\"No extensions.json found\\\"\\n+             fi\\n+         done\\n+ \\n+         echo \\\"\\\"\\n+         echo \\\"=== Chrome Extensions (Linux) ===\\\"\\n+         chrome_ext_dir=\\\"$HOME/.config/google-chrome/Default/Extensions\\\"\\n+         if [ -d \\\"$chrome_ext_dir\\\" ]; then\\n+             ls -la \\\"$chrome_ext_dir\\\" 2\u003e/dev/null | head -20\\n+         else\\n+             echo \\\"Chrome extensions directory not found\\\"\\n+         fi\\n+ \\n+         echo \\\"\\\"\\n+         echo \\\"=== Chromium Extensions ===\\\"\\n+         chromium_ext_dir=\\\"$HOME/.config/chromium/Default/Extensions\\\"\\n+         if [ -d \\\"$chromium_ext_dir\\\" ]; then\\n+             ls -la \\\"$chromium_ext_dir\\\" 2\u003e/dev/null | head -20\\n+         else\\n+             echo \\\"Chromium extensions directory not found\\\"\\n+         fi\\n+     } \u003e \\\"$client_dir/BrowserExtensions.txt\\\"\\n+ \\n+     log \\\"Browser extension information captured\\\"\\n+ }\\n+ \\n+ #######################################\\n+ # Phase 6: Evidence Finalization\\n+ #######################################\\n+ phase6_finalize() {\\n+     print_section \\\"PHASE 6: EVIDENCE FINALIZATION\\\"\\n+ \\n+     print_subsection \\\"Generating Summary\\\"\\n+ \\n+     alert_count=$(grep -c . \\\"$ALERT_FILE\\\" 2\u003e/dev/null || echo \\\"0\\\")\\n+ \\n+     if [ \\\"$alert_count\\\" = \\\"0\\\" ]; then\\n+         verdict=\\\"No obvious MITM indicators detected\\\"\\n+     else\\n+         verdict=\\\"REVIEW REQUIRED - $alert_count alerts found\\\"\\n+     fi\\n+ \\n+     {\\n+         echo \\\"{\\\"\\n+         echo \\\"  \\\\\\\"audit_timestamp\\\\\\\": \\\\\\\"$(date -Iseconds 2\u003e/dev/null || date)\\\\\\\",\\\"\\n+         echo \\\"  \\\\\\\"evidence_directory\\\\\\\": \\\\\\\"$BASE_DIR\\\\\\\",\\\"\\n+         echo \\\"  \\\\\\\"total_alerts\\\\\\\": $alert_count,\\\"\\n+         echo \\\"  \\\\\\\"targets\\\\\\\": \\\\\\\"$TARGETS\\\\\\\",\\\"\\n+         echo \\\"  \\\\\\\"traceroute_enabled\\\\\\\": $TRACEROUTE_ENABLED,\\\"\\n+         echo \\\"  \\\\\\\"client_side_checks\\\\\\\": $((1 - SKIP_CLIENT_SIDE)),\\\"\\n+         echo \\\"  \\\\\\\"verdict\\\\\\\": \\\\\\\"$verdict\\\\\\\"\\\"\\n+         echo \\\"}\\\"\\n+     } \u003e \\\"$BASE_DIR/Summary.json\\\"\\n+ \\n+     # Generate file hashes\\n+     print_subsection \\\"Generating Evidence Hashes\\\"\\n+ \\n+     hash_manifest=\\\"$BASE_DIR/_FileHashes.txt\\\"\\n+     : \u003e \\\"$hash_manifest\\\"\\n+ \\n+     file_count=0\\n+     find \\\"$BASE_DIR\\\" -type f ! -name \\\"_FileHashes.txt\\\" | while read -r file; do\\n+         if command -v ${HASH_ALGORITHM}sum \u003e/dev/null 2\u003e\u00261; then\\n+             hash=$(${HASH_ALGORITHM}sum \\\"$file\\\" | cut -d\u0027 \u0027 -f1)\\n+         elif command -v shasum \u003e/dev/null 2\u003e\u00261; then\\n+             hash=$(shasum -a 256 \\\"$file\\\" | cut -d\u0027 \u0027 -f1)\\n+         else\\n+             hash=\\\"\u003cunable to compute\u003e\\\"\\n+         fi\\n+         rel_path=$(echo \\\"$file\\\" | sed \\\"s|$BASE_DIR/||\\\")\\n+         echo \\\"$hash  $rel_path\\\" \u003e\u003e \\\"$hash_manifest\\\"\\n+         file_count=$((file_count + 1))\\n+     done\\n+ \\n+     log \\\"Generated hashes for evidence files\\\"\\n+ \\n+     # Final output\\n+     echo \\\"\\\"\\n+     echo \\\"======================================================================\\\"\\n+     echo \\\" AUDIT COMPLETE\\\"\\n+     echo \\\"======================================================================\\\"\\n+     echo \\\"\\\"\\n+     echo \\\"Evidence Directory: $BASE_DIR\\\"\\n+     echo \\\"\\\"\\n+ \\n+     if [ \\\"$alert_count\\\" -gt 0 ]; then\\n+         echo \\\"ALERTS FOUND: $alert_count\\\"\\n+         echo \\\"Review _RedFlags.txt immediately!\\\"\\n+         echo \\\"\\\"\\n+         echo \\\"--- ALERTS ---\\\"\\n+         cat \\\"$ALERT_FILE\\\"\\n+     else\\n+         echo \\\"No obvious MITM indicators detected.\\\"\\n+         echo \\\"Note: Passive interception (logging only) may not trigger alerts.\\\"\\n+     fi\\n+ \\n+     echo \\\"\\\"\\n+     echo \\\"NEXT STEPS:\\\"\\n+     echo \\\"  1. Review _RedFlags.txt for immediate concerns\\\"\\n+     echo \\\"  2. Check certificate serials against crt.sh (on clean network)\\\"\\n+     echo \\\"  3. Zip the evidence folder and hash the zip for chain of custody\\\"\\n+     echo \\\"\\\"\\n+ }\\n+ \\n+ #######################################\\n+ # Parse Arguments\\n+ #######################################\\n+ CONFIG_FILE=\\\"\\\"\\n+ OUTPUT_DIR=\\\"\\\"\\n+ OVERRIDE_TARGETS=\\\"\\\"\\n+ \\n+ while [ $# -gt 0 ]; do\\n+     case \\\"$1\\\" in\\n+         -c|--config)\\n+             CONFIG_FILE=\\\"$2\\\"\\n+             shift 2\\n+             ;;\\n+         -o|--output)\\n+             OUTPUT_DIR=\\\"$2\\\"\\n+             shift 2\\n+             ;;\\n+         -t|--targets)\\n+             OVERRIDE_TARGETS=\\\"$2\\\"\\n+             shift 2\\n+             ;;\\n+         --skip-traceroute)\\n+             SKIP_TRACEROUTE=1\\n+             shift\\n+             ;;\\n+         --skip-client-side)\\n+             SKIP_CLIENT_SIDE=1\\n+             shift\\n+             ;;\\n+         -h|--help)\\n+             usage\\n+             ;;\\n+         *)\\n+             echo \\\"Unknown option: $1\\\" \u003e\u00262\\n+             usage\\n+             ;;\\n+     esac\\n+ done\\n+ \\n+ #######################################\\n+ # Main Execution\\n+ #######################################\\n+ \\n+ # Load config if specified\\n+ if [ -n \\\"$CONFIG_FILE\\\" ]; then\\n+     load_config \\\"$CONFIG_FILE\\\"\\n+ else\\n+     # Try default config in same directory\\n+     script_dir=$(dirname \\\"$0\\\")\\n+     default_config=\\\"$script_dir/mitm-audit.cfg\\\"\\n+     if [ -f \\\"$default_config\\\" ]; then\\n+         load_config \\\"$default_config\\\"\\n+     fi\\n+ fi\\n+ \\n+ # Override targets if specified\\n+ if [ -n \\\"$OVERRIDE_TARGETS\\\" ]; then\\n+     TARGETS=$(echo \\\"$OVERRIDE_TARGETS\\\" | tr \u0027,\u0027 \u0027 \u0027)\\n+ fi\\n+ \\n+ # Initialize output\\n+ init_output_dir \\\"$OUTPUT_DIR\\\"\\n+ \\n+ echo \\\"\\\"\\n+ echo \\\"======================================================================\\\"\\n+ echo \\\" INFRASTRUCTURE MITM AUDIT - FORENSIC EVIDENCE COLLECTION\\\"\\n+ echo \\\"======================================================================\\\"\\n+ echo \\\"Timestamp: $(date)\\\"\\n+ echo \\\"Evidence Directory: $BASE_DIR\\\"\\n+ echo \\\"Targets: $TARGETS\\\"\\n+ echo \\\"\\\"\\n+ \\n+ log \\\"Audit started\\\"\\n+ log \\\"Targets: $TARGETS\\\"\\n+ \\n+ # Execute phases\\n+ phase1_environment\\n+ phase2_trust_store\\n+ phase3_target_analysis\\n+ phase4_traceroute\\n+ phase5_client_side\\n+ phase6_finalize\\n+ \\n+ log \\\"Audit completed\\\"\\n+ \",\"oldStart\":1,\"newStart\":1,\"oldLines\":1,\"newLines\":957,\"linesRemoved\":1,\"linesAdded\":957}],\"editor\":\"EDITOR_AI\"},\"shouldAutoFixLints\":true,\"resultForModel\":\"Wrote contents to templates/network/mitm-audit.sh.\",\"contentsAfterEdit\":\"#!/bin/sh\\n# Infrastructure MITM Audit - Forensic Evidence Collection for TLS Interception Detection\\n# License: BSD-2-Clause\\n# Signed-off-by: Network Diagnostics Toolkit\\n#\\n# Combines environment baselining, Root CA dumping, ASN-based integrity checking,\\n# and DoH comparison to detect infrastructure-side Man-in-the-Middle attacks while\\n# ruling out client-side exploits.\\n#\\n# Produces a timestamped evidence package suitable for chain of custody.\\n#\\n# Usage: ./mitm-audit.sh [OPTIONS]\\n#   -c, --config FILE    Path to mitm-audit.cfg\\n#   -o, --output DIR     Output directory (default: ~/ForensicEvidence_timestamp)\\n#   -t, --targets LIST   Override targets (comma-separated)\\n#   --skip-traceroute    Skip traceroute collection\\n#   --skip-client-side   Skip client-side exploit detection\\n#   -h, --help           Show this help\\n#\\n# EVIDENCE PROCESSING:\\n# 1. Check _RedFlags.txt first - if empty, MITM may be passive/logging only\\n# 2. Certificate Serial Check - copy serial to crt.sh on clean device\\n#    - If \\\"No certificates found\\\": 100% MITM by private root CA\\n#    - If cert shown for different domain: collision/hash attack\\n# 3. Zip evidence folder, hash the zip for chain of custody\\n\\nset -e\\n\\n#######################################\\n# Default Configuration\\n#######################################\\nTARGETS=\\\"accounts.google.com login.microsoftonline.com appleid.apple.com aws.amazon.com github.com\\\"\\nPUBLIC_RESOLVERS=\\\"1.1.1.1 8.8.8.8 9.9.9.9\\\"\\nDOH_ENDPOINT=\\\"https://dns.google/resolve\\\"\\nASN_LOOKUP_URL=\\\"http://ip-api.com/json\\\"\\nASN_LOOKUP_TIMEOUT=3\\nEXTERNAL_IP_URL=\\\"https://ipinfo.io/json\\\"\\nEXTERNAL_IP_TIMEOUT=5\\nEXPECTED_ISP_PATTERNS=\\\"\\\"\\nSUSPICIOUS_ASN_PATTERNS=\\\"DigitalOcean Linode Vultr Choopa Datacamp OVH Hetzner\\\"\\nSUSPICIOUS_CERT_ISSUERS=\\\"Let\u0027s Encrypt ZeroSSL Self-Signed localhost\\\"\\nTRACEROUTE_MAX_HOPS=15\\nTRACEROUTE_TIMEOUT=2\\nTRACEROUTE_ENABLED=1\\nEXPORT_ROOT_CA=1\\nHASH_ROOT_CA=1\\nCHECK_PROXY_SETTINGS=1\\nCHECK_HOSTS_FILE=1\\nCHECK_ROOT_CA_ANOMALIES=1\\nHASH_ALGORITHM=\\\"sha256\\\"\\nSKIP_TRACEROUTE=0\\nSKIP_CLIENT_SIDE=0\\n\\n#######################################\\n# Variables\\n#######################################\\nBASE_DIR=\\\"\\\"\\nLOG_FILE=\\\"\\\"\\nALERT_FILE=\\\"\\\"\\nTIMESTAMP=\\\"\\\"\\n\\n#######################################\\n# Usage\\n#######################################\\nusage() {\\n    cat \u003c\u003c \u0027EOF\u0027\\nUsage: mitm-audit.sh [OPTIONS]\\n\\nInfrastructure MITM Audit - Forensic Evidence Collection\\n\\nOptions:\\n    -c, --config FILE    Path to mitm-audit.cfg\\n    -o, --output DIR     Output directory (default: ~/ForensicEvidence_timestamp)\\n    -t, --targets LIST   Override targets (comma-separated)\\n    --skip-traceroute    Skip traceroute collection\\n    --skip-client-side   Skip client-side exploit detection\\n    -h, --help           Show this help\\n\\nExamples:\\n    ./mitm-audit.sh\\n    ./mitm-audit.sh -c ./mitm-audit.cfg\\n    ./mitm-audit.sh -t \\\"accounts.google.com,github.com\\\"\\n    ./mitm-audit.sh --skip-traceroute\\n\\nEvidence Processing:\\n    1. Review _RedFlags.txt first\\n    2. Check certificate serials against crt.sh (on clean network)\\n    3. Zip evidence folder and hash for chain of custody\\nEOF\\n    exit 0\\n}\\n\\n#######################################\\n# Configuration Loading\\n#######################################\\nload_config() {\\n    config_file=\\\"$1\\\"\\n    if [ ! -f \\\"$config_file\\\" ]; then\\n        echo \\\"[WARN] Config file not found: $config_file (using defaults)\\\"\\n        return\\n    fi\\n\\n    while IFS=\u0027=\u0027 read -r key value; do\\n        # Skip comments and empty lines\\n        case \\\"$key\\\" in\\n            \\\\#*|\\\"\\\") continue ;;\\n        esac\\n        # Remove leading/trailing whitespace\\n        key=$(echo \\\"$key\\\" | sed \u0027s/^[[:space:]]*//;s/[[:space:]]*$//\u0027)\\n        value=$(echo \\\"$value\\\" | sed \u0027s/^[[:space:]]*//;s/[[:space:]]*$//\u0027)\\n\\n        case \\\"$key\\\" in\\n            TARGETS) TARGETS=$(echo \\\"$value\\\" | tr \u0027,\u0027 \u0027 \u0027) ;;\\n            PUBLIC_RESOLVERS) PUBLIC_RESOLVERS=$(echo \\\"$value\\\" | tr \u0027,\u0027 \u0027 \u0027) ;;\\n            DOH_ENDPOINT) DOH_ENDPOINT=\\\"$value\\\" ;;\\n            ASN_LOOKUP_URL) ASN_LOOKUP_URL=\\\"$value\\\" ;;\\n            ASN_LOOKUP_TIMEOUT_SEC) ASN_LOOKUP_TIMEOUT=\\\"$value\\\" ;;\\n            EXTERNAL_IP_URL) EXTERNAL_IP_URL=\\\"$value\\\" ;;\\n            EXTERNAL_IP_TIMEOUT_SEC) EXTERNAL_IP_TIMEOUT=\\\"$value\\\" ;;\\n            EXPECTED_ISP_PATTERNS) EXPECTED_ISP_PATTERNS=$(echo \\\"$value\\\" | tr \u0027,\u0027 \u0027 \u0027) ;;\\n            SUSPICIOUS_ASN_PATTERNS) SUSPICIOUS_ASN_PATTERNS=$(echo \\\"$value\\\" | tr \u0027,\u0027 \u0027 \u0027) ;;\\n            SUSPICIOUS_CERT_ISSUERS) SUSPICIOUS_CERT_ISSUERS=$(echo \\\"$value\\\" | tr \u0027,\u0027 \u0027 \u0027) ;;\\n            TRACEROUTE_MAX_HOPS) TRACEROUTE_MAX_HOPS=\\\"$value\\\" ;;\\n            TRACEROUTE_TIMEOUT_SEC) TRACEROUTE_TIMEOUT=\\\"$value\\\" ;;\\n            TRACEROUTE_ENABLED) [ \\\"$value\\\" = \\\"true\\\" ] \u0026\u0026 TRACEROUTE_ENABLED=1 || TRACEROUTE_ENABLED=0 ;;\\n            EXPORT_ROOT_CA) [ \\\"$value\\\" = \\\"true\\\" ] \u0026\u0026 EXPORT_ROOT_CA=1 || EXPORT_ROOT_CA=0 ;;\\n            HASH_ROOT_CA) [ \\\"$value\\\" = \\\"true\\\" ] \u0026\u0026 HASH_ROOT_CA=1 || HASH_ROOT_CA=0 ;;\\n            CHECK_PROXY_SETTINGS) [ \\\"$value\\\" = \\\"true\\\" ] \u0026\u0026 CHECK_PROXY_SETTINGS=1 || CHECK_PROXY_SETTINGS=0 ;;\\n            CHECK_HOSTS_FILE) [ \\\"$value\\\" = \\\"true\\\" ] \u0026\u0026 CHECK_HOSTS_FILE=1 || CHECK_HOSTS_FILE=0 ;;\\n            CHECK_ROOT_CA_ANOMALIES) [ \\\"$value\\\" = \\\"true\\\" ] \u0026\u0026 CHECK_ROOT_CA_ANOMALIES=1 || CHECK_ROOT_CA_ANOMALIES=0 ;;\\n            HASH_ALGORITHM) HASH_ALGORITHM=\\\"$value\\\" ;;\\n        esac\\n    done \u003c \\\"$config_file\\\"\\n}\\n\\n#######################################\\n# Logging Functions\\n#######################################\\ninit_output_dir() {\\n    TIMESTAMP=$(date +\\\"%Y%m%d_%H%M%S\\\")\\n\\n    if [ -n \\\"$1\\\" ]; then\\n        BASE_DIR=\\\"$1\\\"\\n    else\\n        BASE_DIR=\\\"$HOME/ForensicEvidence_$TIMESTAMP\\\"\\n    fi\\n\\n    mkdir -p \\\"$BASE_DIR\\\"\\n    LOG_FILE=\\\"$BASE_DIR/_AuditLog.txt\\\"\\n    ALERT_FILE=\\\"$BASE_DIR/_RedFlags.txt\\\"\\n\\n    : \u003e \\\"$ALERT_FILE\\\"\\n}\\n\\nlog() {\\n    level=\\\"${2:-INFO}\\\"\\n    timestamp=$(date +\\\"%Y-%m-%d %H:%M:%S\\\")\\n    msg=\\\"[$timestamp] [$level] $1\\\"\\n    echo \\\"$msg\\\"\\n    echo \\\"$msg\\\" \u003e\u003e \\\"$LOG_FILE\\\"\\n}\\n\\nalert() {\\n    timestamp=$(date +\\\"%Y-%m-%d %H:%M:%S\\\")\\n    echo \\\"[!] $1\\\"\\n    echo \\\"[$timestamp] $1\\\" \u003e\u003e \\\"$ALERT_FILE\\\"\\n    log \\\"$1\\\" \\\"ALERT\\\"\\n}\\n\\nprint_section() {\\n    echo \\\"\\\"\\n    echo \\\"======================================================================\\\"\\n    echo \\\" $1\\\"\\n    echo \\\"======================================================================\\\"\\n    log \\\"=== $1 ===\\\" \\\"INFO\\\"\\n}\\n\\nprint_subsection() {\\n    echo \\\"\\\"\\n    echo \\\"[*] $1\\\"\\n    echo \\\"--------------------------------------------------\\\"\\n    log \\\"--- $1 ---\\\" \\\"INFO\\\"\\n}\\n\\n#######################################\\n# ASN and DNS Functions\\n#######################################\\nget_asn() {\\n    ip=\\\"$1\\\"\\n    result=$(curl -s --max-time \\\"$ASN_LOOKUP_TIMEOUT\\\" \\\"${ASN_LOOKUP_URL}/${ip}?fields=status,message,org,as\\\" 2\u003e/dev/null || echo \\\"\\\")\\n\\n    if [ -z \\\"$result\\\" ]; then\\n        echo \\\"Lookup Failed (Blocked?)\\\"\\n        return\\n    fi\\n\\n    status=$(echo \\\"$result\\\" | grep -o \u0027\\\"status\\\":\\\"[^\\\"]*\\\"\u0027 | cut -d\u0027\\\"\u0027 -f4)\\n    if [ \\\"$status\\\" = \\\"success\\\" ]; then\\n        org=$(echo \\\"$result\\\" | grep -o \u0027\\\"org\\\":\\\"[^\\\"]*\\\"\u0027 | cut -d\u0027\\\"\u0027 -f4)\\n        as=$(echo \\\"$result\\\" | grep -o \u0027\\\"as\\\":\\\"[^\\\"]*\\\"\u0027 | cut -d\u0027\\\"\u0027 -f4)\\n        echo \\\"$org ($as)\\\"\\n    else\\n        echo \\\"Unknown\\\"\\n    fi\\n}\\n\\nget_doh_resolution() {\\n    domain=\\\"$1\\\"\\n    result=$(curl -s --max-time 5 \\\"${DOH_ENDPOINT}?name=${domain}\u0026type=A\\\" 2\u003e/dev/null || echo \\\"\\\")\\n\\n    if [ -z \\\"$result\\\" ]; then\\n        echo \\\"\\\"\\n        return\\n    fi\\n\\n    # Extract IP from Answer section (simplified JSON parsing)\\n    echo \\\"$result\\\" | grep -o \u0027\\\"data\\\":\\\"[0-9.]*\\\"\u0027 | head -1 | cut -d\u0027\\\"\u0027 -f4\\n}\\n\\ntest_asn_integrity() {\\n    domain=\\\"$1\\\"\\n    asn=\\\"$2\\\"\\n\\n    if [ \\\"$asn\\\" = \\\"Lookup Failed (Blocked?)\\\" ]; then\\n        return 0\\n    fi\\n\\n    alert_msg=\\\"\\\"\\n\\n    # Check Google\\n    if echo \\\"$domain\\\" | grep -qi \\\"google\\\"; then\\n        if ! echo \\\"$asn\\\" | grep -qi \\\"Google\\\"; then\\n            alert_msg=\\\"MITM DETECTED: $domain resolving to non-Google ASN ($asn)\\\"\\n        fi\\n    fi\\n\\n    # Check Microsoft\\n    if echo \\\"$domain\\\" | grep -qi \\\"microsoft\\\"; then\\n        if ! echo \\\"$asn\\\" | grep -qi \\\"Microsoft\\\"; then\\n            alert_msg=\\\"MITM DETECTED: $domain resolving to non-Microsoft ASN ($asn)\\\"\\n        fi\\n    fi\\n\\n    # Check Apple\\n    if echo \\\"$domain\\\" | grep -qi \\\"apple\\\"; then\\n        if ! echo \\\"$asn\\\" | grep -qi \\\"Apple\\\"; then\\n            alert_msg=\\\"MITM DETECTED: $domain resolving to non-Apple ASN ($asn)\\\"\\n        fi\\n    fi\\n\\n    # Check Amazon\\n    if echo \\\"$domain\\\" | grep -qi \\\"aws\\\\|amazon\\\"; then\\n        if ! echo \\\"$asn\\\" | grep -qi \\\"Amazon\\\\|AMAZON\\\"; then\\n            alert_msg=\\\"MITM DETECTED: $domain resolving to non-Amazon ASN ($asn)\\\"\\n        fi\\n    fi\\n\\n    # Check GitHub\\n    if echo \\\"$domain\\\" | grep -qi \\\"github\\\"; then\\n        if ! echo \\\"$asn\\\" | grep -qi \\\"GitHub\\\\|Microsoft\\\"; then\\n            alert_msg=\\\"MITM DETECTED: $domain resolving to non-GitHub/Microsoft ASN ($asn)\\\"\\n        fi\\n    fi\\n\\n    # Check for suspicious VPS providers\\n    if [ -z \\\"$alert_msg\\\" ]; then\\n        for pattern in $SUSPICIOUS_ASN_PATTERNS; do\\n            if echo \\\"$asn\\\" | grep -qi \\\"$pattern\\\"; then\\n                alert_msg=\\\"MITM DETECTED: High-value target routed to VPS provider ($pattern)\\\"\\n                break\\n            fi\\n        done\\n    fi\\n\\n    if [ -n \\\"$alert_msg\\\" ]; then\\n        echo \\\"$alert_msg\\\"\\n        return 1\\n    fi\\n\\n    return 0\\n}\\n\\n#######################################\\n# Certificate Functions\\n#######################################\\nget_tls_certificate() {\\n    domain=\\\"$1\\\"\\n    output_file=\\\"$2\\\"\\n\\n    if ! command -v openssl \u003e/dev/null 2\u003e\u00261; then\\n        echo \\\"OpenSSL not available\\\" \u003e \\\"$output_file\\\"\\n        return 1\\n    fi\\n\\n    # Capture full certificate chain\\n    echo | openssl s_client -showcerts -connect \\\"${domain}:443\\\" -servername \\\"$domain\\\" 2\u003e/dev/null \u003e \\\"${output_file}.pem\\\"\\n\\n    # Extract certificate details\\n    cert_info_file=\\\"${output_file}.txt\\\"\\n    {\\n        echo \\\"=== Certificate Details for $domain ===\\\"\\n        echo \\\"\\\"\\n        echo \\\"Subject:\\\"\\n        openssl x509 -in \\\"${output_file}.pem\\\" -noout -subject 2\u003e/dev/null || echo \\\"  Unable to extract\\\"\\n        echo \\\"\\\"\\n        echo \\\"Issuer:\\\"\\n        openssl x509 -in \\\"${output_file}.pem\\\" -noout -issuer 2\u003e/dev/null || echo \\\"  Unable to extract\\\"\\n        echo \\\"\\\"\\n        echo \\\"Serial Number:\\\"\\n        openssl x509 -in \\\"${output_file}.pem\\\" -noout -serial 2\u003e/dev/null || echo \\\"  Unable to extract\\\"\\n        echo \\\"\\\"\\n        echo \\\"Validity:\\\"\\n        openssl x509 -in \\\"${output_file}.pem\\\" -noout -dates 2\u003e/dev/null || echo \\\"  Unable to extract\\\"\\n        echo \\\"\\\"\\n        echo \\\"Fingerprint (SHA256):\\\"\\n        openssl x509 -in \\\"${output_file}.pem\\\" -noout -fingerprint -sha256 2\u003e/dev/null || echo \\\"  Unable to extract\\\"\\n    } \u003e \\\"$cert_info_file\\\"\\n\\n    # Extract just serial and issuer for quick checking\\n    serial=$(openssl x509 -in \\\"${output_file}.pem\\\" -noout -serial 2\u003e/dev/null | cut -d\u0027=\u0027 -f2)\\n    issuer=$(openssl x509 -in \\\"${output_file}.pem\\\" -noout -issuer 2\u003e/dev/null)\\n\\n    echo \\\"$serial|$issuer\\\"\\n}\\n\\ntest_certificate_anomaly() {\\n    domain=\\\"$1\\\"\\n    issuer=\\\"$2\\\"\\n\\n    # Check for suspicious issuers on major tech domains\\n    is_major_tech=0\\n    for pattern in google microsoft apple amazon github; do\\n        if echo \\\"$domain\\\" | grep -qi \\\"$pattern\\\"; then\\n            is_major_tech=1\\n            break\\n        fi\\n    done\\n\\n    if [ \\\"$is_major_tech\\\" = \\\"1\\\" ]; then\\n        for suspicious_issuer in $SUSPICIOUS_CERT_ISSUERS; do\\n            if echo \\\"$issuer\\\" | grep -qi \\\"$suspicious_issuer\\\"; then\\n                echo \\\"CERTIFICATE ANOMALY: $domain using $suspicious_issuer issuer - highly suspicious for major tech corp\\\"\\n                return 1\\n            fi\\n        done\\n    fi\\n\\n    return 0\\n}\\n\\n#######################################\\n# Phase 1: Environment Snapshot\\n#######################################\\nphase1_environment() {\\n    print_section \\\"PHASE 1: ENVIRONMENT SNAPSHOT\\\"\\n\\n    env_dir=\\\"$BASE_DIR/environment\\\"\\n    mkdir -p \\\"$env_dir\\\"\\n\\n    # Network configuration\\n    print_subsection \\\"Network Configuration\\\"\\n    {\\n        echo \\\"=== Network Interfaces ===\\\"\\n        if command -v ip \u003e/dev/null 2\u003e\u00261; then\\n            ip addr show\\n        elif command -v ifconfig \u003e/dev/null 2\u003e\u00261; then\\n            ifconfig -a\\n        else\\n            echo \\\"No interface command available\\\"\\n        fi\\n    } \u003e \\\"$env_dir/NetworkConfig.txt\\\"\\n\\n    # DNS configuration\\n    {\\n        echo \\\"=== DNS Configuration ===\\\"\\n        if [ -f /etc/resolv.conf ]; then\\n            cat /etc/resolv.conf\\n        fi\\n    } \u003e\u003e \\\"$env_dir/NetworkConfig.txt\\\"\\n\\n    # External IP\\n    print_subsection \\\"External IP Identification\\\"\\n    ext_ip_json=$(curl -s --max-time \\\"$EXTERNAL_IP_TIMEOUT\\\" \\\"$EXTERNAL_IP_URL\\\" 2\u003e/dev/null || echo \\\"\\\")\\n\\n    if [ -n \\\"$ext_ip_json\\\" ]; then\\n        echo \\\"$ext_ip_json\\\" \u003e \\\"$env_dir/ExternalIP.json\\\"\\n\\n        ext_ip=$(echo \\\"$ext_ip_json\\\" | grep -o \u0027\\\"ip\\\":\\\"[^\\\"]*\\\"\u0027 | cut -d\u0027\\\"\u0027 -f4)\\n        ext_org=$(echo \\\"$ext_ip_json\\\" | grep -o \u0027\\\"org\\\":\\\"[^\\\"]*\\\"\u0027 | cut -d\u0027\\\"\u0027 -f4)\\n        ext_city=$(echo \\\"$ext_ip_json\\\" | grep -o \u0027\\\"city\\\":\\\"[^\\\"]*\\\"\u0027 | cut -d\u0027\\\"\u0027 -f4)\\n        ext_region=$(echo \\\"$ext_ip_json\\\" | grep -o \u0027\\\"region\\\":\\\"[^\\\"]*\\\"\u0027 | cut -d\u0027\\\"\u0027 -f4)\\n        ext_country=$(echo \\\"$ext_ip_json\\\" | grep -o \u0027\\\"country\\\":\\\"[^\\\"]*\\\"\u0027 | cut -d\u0027\\\"\u0027 -f4)\\n\\n        log \\\"External IP: $ext_ip\\\"\\n        log \\\"External Org: $ext_org\\\"\\n        log \\\"Location: $ext_city, $ext_region, $ext_country\\\"\\n\\n        # Check expected ISP\\n        if [ -n \\\"$EXPECTED_ISP_PATTERNS\\\" ]; then\\n            is_expected=0\\n            for pattern in $EXPECTED_ISP_PATTERNS; do\\n                if echo \\\"$ext_org\\\" | grep -qi \\\"$pattern\\\"; then\\n                    is_expected=1\\n                    break\\n                fi\\n            done\\n            if [ \\\"$is_expected\\\" = \\\"0\\\" ]; then\\n                alert \\\"External IP Org ($ext_org) does not match expected ISP patterns - traffic may be tunneled/proxied\\\"\\n            fi\\n        fi\\n    else\\n        alert \\\"Unable to determine External IP - connection may be blocked or filtered\\\"\\n    fi\\n\\n    # System info\\n    print_subsection \\\"System Information\\\"\\n    {\\n        echo \\\"Hostname: $(hostname)\\\"\\n        echo \\\"User: $(whoami)\\\"\\n        echo \\\"Date: $(date)\\\"\\n        echo \\\"Kernel: $(uname -a)\\\"\\n        echo \\\"Timestamp: $(date -Iseconds 2\u003e/dev/null || date)\\\"\\n    } \u003e \\\"$env_dir/SystemInfo.txt\\\"\\n\\n    log \\\"System: $(hostname) / User: $(whoami)\\\"\\n}\\n\\n#######################################\\n# Phase 2: Trust Store Export\\n#######################################\\nphase2_trust_store() {\\n    print_section \\\"PHASE 2: TRUST STORE EXPORT\\\"\\n\\n    trust_dir=\\\"$BASE_DIR/trust-store\\\"\\n    mkdir -p \\\"$trust_dir\\\"\\n\\n    if [ \\\"$EXPORT_ROOT_CA\\\" = \\\"0\\\" ]; then\\n        log \\\"Root CA export disabled in configuration\\\"\\n        return\\n    fi\\n\\n    print_subsection \\\"Exporting Root CA Store\\\"\\n\\n    # Linux - common CA bundle locations\\n    ca_exported=0\\n    for ca_path in /etc/ssl/certs/ca-certificates.crt /etc/pki/tls/certs/ca-bundle.crt /etc/ssl/ca-bundle.pem; do\\n        if [ -f \\\"$ca_path\\\" ]; then\\n            cp \\\"$ca_path\\\" \\\"$trust_dir/RootCA_Snapshot.crt\\\"\\n            log \\\"Root CA Store exported from $ca_path\\\"\\n            ca_exported=1\\n\\n            if [ \\\"$HASH_ROOT_CA\\\" = \\\"1\\\" ]; then\\n                hash_value=$(${HASH_ALGORITHM}sum \\\"$ca_path\\\" 2\u003e/dev/null | cut -d\u0027 \u0027 -f1 || shasum -a 256 \\\"$ca_path\\\" 2\u003e/dev/null | cut -d\u0027 \u0027 -f1)\\n                echo \\\"{\\\\\\\"algorithm\\\\\\\":\\\\\\\"$HASH_ALGORITHM\\\\\\\",\\\\\\\"hash\\\\\\\":\\\\\\\"$hash_value\\\\\\\",\\\\\\\"source\\\\\\\":\\\\\\\"$ca_path\\\\\\\"}\\\" \u003e \\\"$trust_dir/RootCA_Hash.json\\\"\\n                log \\\"Root CA hash: $hash_value\\\"\\n            fi\\n            break\\n        fi\\n    done\\n\\n    # macOS - export from Keychain\\n    if [ \\\"$(uname)\\\" = \\\"Darwin\\\" ]; then\\n        print_subsection \\\"Exporting macOS Keychain Root CAs\\\"\\n        if command -v security \u003e/dev/null 2\u003e\u00261; then\\n            security find-certificate -a -p /System/Library/Keychains/SystemRootCertificates.keychain \u003e \\\"$trust_dir/MacOS_SystemRoots.pem\\\" 2\u003e/dev/null || true\\n            security find-certificate -a -p /Library/Keychains/System.keychain \u003e \\\"$trust_dir/MacOS_SystemKeychain.pem\\\" 2\u003e/dev/null || true\\n            log \\\"macOS Root Keychains exported\\\"\\n            ca_exported=1\\n        fi\\n    fi\\n\\n    if [ \\\"$ca_exported\\\" = \\\"0\\\" ]; then\\n        log \\\"Could not locate CA bundle\\\" \\\"WARN\\\"\\n    fi\\n\\n    # Anomaly detection for Linux/macOS (limited compared to Windows)\\n    if [ \\\"$CHECK_ROOT_CA_ANOMALIES\\\" = \\\"1\\\" ] \u0026\u0026 [ -f \\\"$trust_dir/RootCA_Snapshot.crt\\\" ]; then\\n        print_subsection \\\"Root CA Anomaly Detection\\\"\\n\\n        # Check for suspicious patterns in certificate subjects\\n        suspicious_found=0\\n        for pattern in \\\"Self\\\" \\\"Test\\\" \\\"Admin\\\" \\\"Local\\\" \\\"Proxy\\\" \\\"Intercept\\\" \\\"MITM\\\" \\\"Zscaler\\\" \\\"BlueCoat\\\" \\\"Forcepoint\\\"; do\\n            matches=$(grep -i \\\"Subject:.*$pattern\\\" \\\"$trust_dir/RootCA_Snapshot.crt\\\" 2\u003e/dev/null || true)\\n            if [ -n \\\"$matches\\\" ]; then\\n                alert \\\"Suspicious Root CA pattern found: $pattern\\\"\\n                echo \\\"$matches\\\" \u003e\u003e \\\"$trust_dir/SuspiciousCAs.txt\\\"\\n                suspicious_found=1\\n            fi\\n        done\\n\\n        if [ \\\"$suspicious_found\\\" = \\\"0\\\" ]; then\\n            log \\\"No suspicious root CAs detected by pattern matching\\\"\\n        fi\\n    fi\\n}\\n\\n#######################################\\n# Phase 3: Target Analysis\\n#######################################\\nphase3_target_analysis() {\\n    print_section \\\"PHASE 3: TARGET ANALYSIS AND ASN INTEGRITY\\\"\\n\\n    targets_dir=\\\"$BASE_DIR/targets\\\"\\n    mkdir -p \\\"$targets_dir\\\"\\n\\n    for domain in $TARGETS; do\\n        print_subsection \\\"Analyzing: $domain\\\"\\n\\n        safe_domain=$(echo \\\"$domain\\\" | tr \u0027.\u0027 \u0027_\u0027)\\n        domain_dir=\\\"$targets_dir/$safe_domain\\\"\\n        mkdir -p \\\"$domain_dir\\\"\\n\\n        # A. Local DNS Resolution\\n        local_ip=\\\"\\\"\\n        if command -v dig \u003e/dev/null 2\u003e\u00261; then\\n            local_ip=$(dig +short \\\"$domain\\\" A | tail -n1)\\n        elif command -v host \u003e/dev/null 2\u003e\u00261; then\\n            local_ip=$(host -t A \\\"$domain\\\" 2\u003e/dev/null | grep \\\"has address\\\" | head -1 | awk \u0027{print $NF}\u0027)\\n        elif command -v nslookup \u003e/dev/null 2\u003e\u00261; then\\n            local_ip=$(nslookup \\\"$domain\\\" 2\u003e/dev/null | grep -A1 \\\"Name:\\\" | grep \\\"Address:\\\" | awk \u0027{print $2}\u0027 | head -1)\\n        fi\\n\\n        if [ -n \\\"$local_ip\\\" ]; then\\n            local_asn=$(get_asn \\\"$local_ip\\\")\\n            log \\\"Local DNS: $local_ip | ASN: $local_asn\\\"\\n            echo \\\"local_ip=$local_ip\\\" \u003e \\\"$domain_dir/dns.txt\\\"\\n            echo \\\"local_asn=$local_asn\\\" \u003e\u003e \\\"$domain_dir/dns.txt\\\"\\n        else\\n            log \\\"Local DNS resolution failed\\\" \\\"WARN\\\"\\n            local_asn=\\\"\\\"\\n        fi\\n\\n        # B. DoH Resolution (Control Group)\\n        doh_ip=$(get_doh_resolution \\\"$domain\\\")\\n        if [ -n \\\"$doh_ip\\\" ]; then\\n            doh_asn=$(get_asn \\\"$doh_ip\\\")\\n            log \\\"DoH DNS:   $doh_ip | ASN: $doh_asn\\\"\\n            echo \\\"doh_ip=$doh_ip\\\" \u003e\u003e \\\"$domain_dir/dns.txt\\\"\\n            echo \\\"doh_asn=$doh_asn\\\" \u003e\u003e \\\"$domain_dir/dns.txt\\\"\\n\\n            # Compare IPs\\n            if [ -n \\\"$local_ip\\\" ] \u0026\u0026 [ \\\"$local_ip\\\" != \\\"$doh_ip\\\" ]; then\\n                log \\\"DNS MISMATCH: Local ($local_ip) vs DoH ($doh_ip)\\\" \\\"WARN\\\"\\n            fi\\n        else\\n            log \\\"DoH resolution failed (network may be blocking)\\\" \\\"WARN\\\"\\n        fi\\n\\n        # C. ASN Integrity Check\\n        if [ -n \\\"$local_asn\\\" ]; then\\n            asn_alert=$(test_asn_integrity \\\"$domain\\\" \\\"$local_asn\\\" || true)\\n            if [ -n \\\"$asn_alert\\\" ]; then\\n                alert \\\"$asn_alert\\\"\\n            fi\\n        fi\\n\\n        # D. Certificate Capture\\n        log \\\"Capturing TLS certificate...\\\"\\n        cert_result=$(get_tls_certificate \\\"$domain\\\" \\\"$domain_dir/Certificate\\\")\\n\\n        if [ -n \\\"$cert_result\\\" ]; then\\n            serial=$(echo \\\"$cert_result\\\" | cut -d\u0027|\u0027 -f1)\\n            issuer=$(echo \\\"$cert_result\\\" | cut -d\u0027|\u0027 -f2)\\n\\n            if [ -n \\\"$serial\\\" ]; then\\n                log \\\"Certificate Serial: $serial\\\"\\n                log \\\"Certificate Issuer: $issuer\\\"\\n\\n                # Check for certificate anomalies\\n                cert_alert=$(test_certificate_anomaly \\\"$domain\\\" \\\"$issuer\\\" || true)\\n                if [ -n \\\"$cert_alert\\\" ]; then\\n                    alert \\\"$cert_alert\\\"\\n                fi\\n            else\\n                alert \\\"TLS Handshake Failed for $domain - could not extract certificate\\\"\\n            fi\\n        fi\\n\\n        # Save analysis summary\\n        {\\n            echo \\\"{\\\"\\n            echo \\\"  \\\\\\\"domain\\\\\\\": \\\\\\\"$domain\\\\\\\",\\\"\\n            echo \\\"  \\\\\\\"timestamp\\\\\\\": \\\\\\\"$(date -Iseconds 2\u003e/dev/null || date)\\\\\\\",\\\"\\n            echo \\\"  \\\\\\\"local_dns\\\\\\\": \\\\\\\"$local_ip\\\\\\\",\\\"\\n            echo \\\"  \\\\\\\"local_asn\\\\\\\": \\\\\\\"$local_asn\\\\\\\",\\\"\\n            echo \\\"  \\\\\\\"doh_dns\\\\\\\": \\\\\\\"$doh_ip\\\\\\\",\\\"\\n            echo \\\"  \\\\\\\"doh_asn\\\\\\\": \\\\\\\"$doh_asn\\\\\\\"\\\"\\n            echo \\\"}\\\"\\n        } \u003e \\\"$domain_dir/Analysis.json\\\"\\n    done\\n}\\n\\n#######################################\\n# Phase 4: Traceroute Mapping\\n#######################################\\nphase4_traceroute() {\\n    print_section \\\"PHASE 4: TRACEROUTE MAPPING\\\"\\n\\n    if [ \\\"$TRACEROUTE_ENABLED\\\" = \\\"0\\\" ] || [ \\\"$SKIP_TRACEROUTE\\\" = \\\"1\\\" ]; then\\n        log \\\"Traceroute skipped (disabled or --skip-traceroute specified)\\\"\\n        return\\n    fi\\n\\n    trace_dir=\\\"$BASE_DIR/traceroute\\\"\\n    mkdir -p \\\"$trace_dir\\\"\\n\\n    # Determine traceroute command\\n    trace_cmd=\\\"\\\"\\n    if command -v traceroute \u003e/dev/null 2\u003e\u00261; then\\n        trace_cmd=\\\"traceroute\\\"\\n    elif command -v tracepath \u003e/dev/null 2\u003e\u00261; then\\n        trace_cmd=\\\"tracepath\\\"\\n    else\\n        log \\\"No traceroute command available\\\" \\\"WARN\\\"\\n        return\\n    fi\\n\\n    for domain in $TARGETS; do\\n        print_subsection \\\"Tracing: $domain\\\"\\n\\n        safe_domain=$(echo \\\"$domain\\\" | tr \u0027.\u0027 \u0027_\u0027)\\n        trace_file=\\\"$trace_dir/Trace_${safe_domain}.txt\\\"\\n        trace_json=\\\"$trace_dir/Trace_${safe_domain}.json\\\"\\n\\n        if [ \\\"$trace_cmd\\\" = \\\"traceroute\\\" ]; then\\n            traceroute -m \\\"$TRACEROUTE_MAX_HOPS\\\" -w \\\"$TRACEROUTE_TIMEOUT\\\" \\\"$domain\\\" \u003e \\\"$trace_file\\\" 2\u003e\u00261 || true\\n        else\\n            tracepath -m \\\"$TRACEROUTE_MAX_HOPS\\\" \\\"$domain\\\" \u003e \\\"$trace_file\\\" 2\u003e\u00261 || true\\n        fi\\n\\n        # Extract IPs and lookup ASNs\\n        hop_num=1\\n        echo \\\"[\\\" \u003e \\\"$trace_json\\\"\\n        first_hop=1\\n\\n        # Parse traceroute output for IPs\\n        while IFS= read -r line; do\\n            # Extract IP addresses from the line\\n            for ip in $(echo \\\"$line\\\" | grep -oE \u0027([0-9]{1,3}\\\\.){3}[0-9]{1,3}\u0027); do\\n                if [ \\\"$ip\\\" != \\\"0.0.0.0\\\" ]; then\\n                    asn=$(get_asn \\\"$ip\\\")\\n\\n                    if [ \\\"$first_hop\\\" = \\\"0\\\" ]; then\\n                        echo \\\",\\\" \u003e\u003e \\\"$trace_json\\\"\\n                    fi\\n                    first_hop=0\\n\\n                    echo \\\"  {\\\\\\\"hop\\\\\\\": $hop_num, \\\\\\\"ip\\\\\\\": \\\\\\\"$ip\\\\\\\", \\\\\\\"asn\\\\\\\": \\\\\\\"$asn\\\\\\\"}\\\" \u003e\u003e \\\"$trace_json\\\"\\n\\n                    # Check for suspicious hops\\n                    for pattern in $SUSPICIOUS_ASN_PATTERNS; do\\n                        if echo \\\"$asn\\\" | grep -qi \\\"$pattern\\\"; then\\n                            alert \\\"Suspicious hop in traceroute to $domain - Hop $hop_num ($ip) routes through $pattern\\\"\\n                        fi\\n                    done\\n                fi\\n                hop_num=$((hop_num + 1))\\n            done\\n        done \u003c \\\"$trace_file\\\"\\n\\n        echo \\\"\\\" \u003e\u003e \\\"$trace_json\\\"\\n        echo \\\"]\\\" \u003e\u003e \\\"$trace_json\\\"\\n\\n        log \\\"Trace complete to $domain\\\"\\n    done\\n}\\n\\n#######################################\\n# Phase 5: Client-Side Exploit Detection\\n#######################################\\nphase5_client_side() {\\n    print_section \\\"PHASE 5: CLIENT-SIDE EXPLOIT DETECTION\\\"\\n\\n    if [ \\\"$SKIP_CLIENT_SIDE\\\" = \\\"1\\\" ]; then\\n        log \\\"Client-side checks skipped (--skip-client-side specified)\\\"\\n        return\\n    fi\\n\\n    client_dir=\\\"$BASE_DIR/client-side\\\"\\n    mkdir -p \\\"$client_dir\\\"\\n\\n    # A. Proxy Settings\\n    if [ \\\"$CHECK_PROXY_SETTINGS\\\" = \\\"1\\\" ]; then\\n        print_subsection \\\"Proxy Settings Check\\\"\\n\\n        {\\n            echo \\\"=== Environment Proxy Variables ===\\\"\\n            echo \\\"HTTP_PROXY: ${HTTP_PROXY:-\u003cnot set\u003e}\\\"\\n            echo \\\"HTTPS_PROXY: ${HTTPS_PROXY:-\u003cnot set\u003e}\\\"\\n            echo \\\"http_proxy: ${http_proxy:-\u003cnot set\u003e}\\\"\\n            echo \\\"https_proxy: ${https_proxy:-\u003cnot set\u003e}\\\"\\n            echo \\\"ALL_PROXY: ${ALL_PROXY:-\u003cnot set\u003e}\\\"\\n            echo \\\"NO_PROXY: ${NO_PROXY:-\u003cnot set\u003e}\\\"\\n            echo \\\"\\\"\\n\\n            # Check for proxy in common config files\\n            echo \\\"=== Git Proxy Configuration ===\\\"\\n            if command -v git \u003e/dev/null 2\u003e\u00261; then\\n                git config --global --get http.proxy 2\u003e/dev/null || echo \\\"\u003cnot set\u003e\\\"\\n                git config --global --get https.proxy 2\u003e/dev/null || echo \\\"\u003cnot set\u003e\\\"\\n            fi\\n            echo \\\"\\\"\\n\\n            # macOS network proxy\\n            if [ \\\"$(uname)\\\" = \\\"Darwin\\\" ]; then\\n                echo \\\"=== macOS Network Proxy (scutil) ===\\\"\\n                scutil --proxy 2\u003e/dev/null || echo \\\"Unable to query\\\"\\n            fi\\n\\n            # Linux proxy via gsettings\\n            if command -v gsettings \u003e/dev/null 2\u003e\u00261; then\\n                echo \\\"=== GNOME Proxy Settings ===\\\"\\n                gsettings get org.gnome.system.proxy mode 2\u003e/dev/null || echo \\\"Unable to query\\\"\\n            fi\\n        } \u003e \\\"$client_dir/ProxySettings.txt\\\"\\n\\n        # Alert on set proxy variables\\n        for var in HTTP_PROXY HTTPS_PROXY http_proxy https_proxy ALL_PROXY; do\\n            eval \\\"val=\\\\$$var\\\"\\n            if [ -n \\\"$val\\\" ]; then\\n                alert \\\"Environment proxy variable set: $var = $val\\\"\\n            fi\\n        done\\n\\n        log \\\"Proxy settings captured\\\"\\n    fi\\n\\n    # B. Hosts File Check\\n    if [ \\\"$CHECK_HOSTS_FILE\\\" = \\\"1\\\" ]; then\\n        print_subsection \\\"Hosts File Analysis\\\"\\n\\n        hosts_path=\\\"/etc/hosts\\\"\\n        if [ -f \\\"$hosts_path\\\" ]; then\\n            cp \\\"$hosts_path\\\" \\\"$client_dir/hosts_backup\\\"\\n\\n            sensitive_patterns=\\\"google microsoft apple amazon github cursor openai anthropic\\\"\\n            suspicious_found=0\\n\\n            for pattern in $sensitive_patterns; do\\n                # Find non-comment lines matching pattern that don\u0027t point to localhost\\n                matches=$(grep -i \\\"$pattern\\\" \\\"$hosts_path\\\" 2\u003e/dev/null | grep -v \\\"^#\\\" | grep -v \\\"127.0.0.1\\\" | grep -v \\\"::1\\\" | grep -v \\\"0.0.0.0\\\" || true)\\n                if [ -n \\\"$matches\\\" ]; then\\n                    alert \\\"Hosts file redirect for $pattern pattern: $matches\\\"\\n                    echo \\\"$matches\\\" \u003e\u003e \\\"$client_dir/SuspiciousHosts.txt\\\"\\n                    suspicious_found=1\\n                fi\\n            done\\n\\n            if [ \\\"$suspicious_found\\\" = \\\"0\\\" ]; then\\n                log \\\"No suspicious hosts file entries found\\\"\\n            fi\\n\\n            # Count entries\\n            entry_count=$(grep -v \\\"^#\\\" \\\"$hosts_path\\\" 2\u003e/dev/null | grep -v \\\"^$\\\" | wc -l | tr -d \u0027 \u0027)\\n            log \\\"Hosts file entries: $entry_count\\\"\\n        else\\n            log \\\"Hosts file not found at $hosts_path\\\" \\\"WARN\\\"\\n        fi\\n    fi\\n\\n    # C. Browser Extension Check (Firefox on Linux/macOS)\\n    print_subsection \\\"Browser Extension Audit\\\"\\n\\n    {\\n        echo \\\"=== Firefox Extensions ===\\\"\\n        # Firefox profile locations\\n        for firefox_dir in \\\"$HOME/.mozilla/firefox\\\" \\\"$HOME/Library/Application Support/Firefox/Profiles\\\"; do\\n            if [ -d \\\"$firefox_dir\\\" ]; then\\n                find \\\"$firefox_dir\\\" -name \\\"extensions.json\\\" -exec cat {} \\\\; 2\u003e/dev/null | head -100 || echo \\\"No extensions.json found\\\"\\n            fi\\n        done\\n\\n        echo \\\"\\\"\\n        echo \\\"=== Chrome Extensions (Linux) ===\\\"\\n        chrome_ext_dir=\\\"$HOME/.config/google-chrome/Default/Extensions\\\"\\n        if [ -d \\\"$chrome_ext_dir\\\" ]; then\\n            ls -la \\\"$chrome_ext_dir\\\" 2\u003e/dev/null | head -20\\n        else\\n            echo \\\"Chrome extensions directory not found\\\"\\n        fi\\n\\n        echo \\\"\\\"\\n        echo \\\"=== Chromium Extensions ===\\\"\\n        chromium_ext_dir=\\\"$HOME/.config/chromium/Default/Extensions\\\"\\n        if [ -d \\\"$chromium_ext_dir\\\" ]; then\\n            ls -la \\\"$chromium_ext_dir\\\" 2\u003e/dev/null | head -20\\n        else\\n            echo \\\"Chromium extensions directory not found\\\"\\n        fi\\n    } \u003e \\\"$client_dir/BrowserExtensions.txt\\\"\\n\\n    log \\\"Browser extension information captured\\\"\\n}\\n\\n#######################################\\n# Phase 6: Evidence Finalization\\n#######################################\\nphase6_finalize() {\\n    print_section \\\"PHASE 6: EVIDENCE FINALIZATION\\\"\\n\\n    print_subsection \\\"Generating Summary\\\"\\n\\n    alert_count=$(grep -c . \\\"$ALERT_FILE\\\" 2\u003e/dev/null || echo \\\"0\\\")\\n\\n    if [ \\\"$alert_count\\\" = \\\"0\\\" ]; then\\n        verdict=\\\"No obvious MITM indicators detected\\\"\\n    else\\n        verdict=\\\"REVIEW REQUIRED - $alert_count alerts found\\\"\\n    fi\\n\\n    {\\n        echo \\\"{\\\"\\n        echo \\\"  \\\\\\\"audit_timestamp\\\\\\\": \\\\\\\"$(date -Iseconds 2\u003e/dev/null || date)\\\\\\\",\\\"\\n        echo \\\"  \\\\\\\"evidence_directory\\\\\\\": \\\\\\\"$BASE_DIR\\\\\\\",\\\"\\n        echo \\\"  \\\\\\\"total_alerts\\\\\\\": $alert_count,\\\"\\n        echo \\\"  \\\\\\\"targets\\\\\\\": \\\\\\\"$TARGETS\\\\\\\",\\\"\\n        echo \\\"  \\\\\\\"traceroute_enabled\\\\\\\": $TRACEROUTE_ENABLED,\\\"\\n        echo \\\"  \\\\\\\"client_side_checks\\\\\\\": $((1 - SKIP_CLIENT_SIDE)),\\\"\\n        echo \\\"  \\\\\\\"verdict\\\\\\\": \\\\\\\"$verdict\\\\\\\"\\\"\\n        echo \\\"}\\\"\\n    } \u003e \\\"$BASE_DIR/Summary.json\\\"\\n\\n    # Generate file hashes\\n    print_subsection \\\"Generating Evidence Hashes\\\"\\n\\n    hash_manifest=\\\"$BASE_DIR/_FileHashes.txt\\\"\\n    : \u003e \\\"$hash_manifest\\\"\\n\\n    file_count=0\\n    find \\\"$BASE_DIR\\\" -type f ! -name \\\"_FileHashes.txt\\\" | while read -r file; do\\n        if command -v ${HASH_ALGORITHM}sum \u003e/dev/null 2\u003e\u00261; then\\n            hash=$(${HASH_ALGORITHM}sum \\\"$file\\\" | cut -d\u0027 \u0027 -f1)\\n        elif command -v shasum \u003e/dev/null 2\u003e\u00261; then\\n            hash=$(shasum -a 256 \\\"$file\\\" | cut -d\u0027 \u0027 -f1)\\n        else\\n            hash=\\\"\u003cunable to compute\u003e\\\"\\n        fi\\n        rel_path=$(echo \\\"$file\\\" | sed \\\"s|$BASE_DIR/||\\\")\\n        echo \\\"$hash  $rel_path\\\" \u003e\u003e \\\"$hash_manifest\\\"\\n        file_count=$((file_count + 1))\\n    done\\n\\n    log \\\"Generated hashes for evidence files\\\"\\n\\n    # Final output\\n    echo \\\"\\\"\\n    echo \\\"======================================================================\\\"\\n    echo \\\" AUDIT COMPLETE\\\"\\n    echo \\\"======================================================================\\\"\\n    echo \\\"\\\"\\n    echo \\\"Evidence Directory: $BASE_DIR\\\"\\n    echo \\\"\\\"\\n\\n    if [ \\\"$alert_count\\\" -gt 0 ]; then\\n        echo \\\"ALERTS FOUND: $alert_count\\\"\\n        echo \\\"Review _RedFlags.txt immediately!\\\"\\n        echo \\\"\\\"\\n        echo \\\"--- ALERTS ---\\\"\\n        cat \\\"$ALERT_FILE\\\"\\n    else\\n        echo \\\"No obvious MITM indicators detected.\\\"\\n        echo \\\"Note: Passive interception (logging only) may not trigger alerts.\\\"\\n    fi\\n\\n    echo \\\"\\\"\\n    echo \\\"NEXT STEPS:\\\"\\n    echo \\\"  1. Review _RedFlags.txt for immediate concerns\\\"\\n    echo \\\"  2. Check certificate serials against crt.sh (on clean network)\\\"\\n    echo \\\"  3. Zip the evidence folder and hash the zip for chain of custody\\\"\\n    echo \\\"\\\"\\n}\\n\\n#######################################\\n# Parse Arguments\\n#######################################\\nCONFIG_FILE=\\\"\\\"\\nOUTPUT_DIR=\\\"\\\"\\nOVERRIDE_TARGETS=\\\"\\\"\\n\\nwhile [ $# -gt 0 ]; do\\n    case \\\"$1\\\" in\\n        -c|--config)\\n            CONFIG_FILE=\\\"$2\\\"\\n            shift 2\\n            ;;\\n        -o|--output)\\n            OUTPUT_DIR=\\\"$2\\\"\\n            shift 2\\n            ;;\\n        -t|--targets)\\n            OVERRIDE_TARGETS=\\\"$2\\\"\\n            shift 2\\n            ;;\\n        --skip-traceroute)\\n            SKIP_TRACEROUTE=1\\n            shift\\n            ;;\\n        --skip-client-side)\\n            SKIP_CLIENT_SIDE=1\\n            shift\\n            ;;\\n        -h|--help)\\n            usage\\n            ;;\\n        *)\\n            echo \\\"Unknown option: $1\\\" \u003e\u00262\\n            usage\\n            ;;\\n    esac\\ndone\\n\\n#######################################\\n# Main Execution\\n#######################################\\n\\n# Load config if specified\\nif [ -n \\\"$CONFIG_FILE\\\" ]; then\\n    load_config \\\"$CONFIG_FILE\\\"\\nelse\\n    # Try default config in same directory\\n    script_dir=$(dirname \\\"$0\\\")\\n    default_config=\\\"$script_dir/mitm-audit.cfg\\\"\\n    if [ -f \\\"$default_config\\\" ]; then\\n        load_config \\\"$default_config\\\"\\n    fi\\nfi\\n\\n# Override targets if specified\\nif [ -n \\\"$OVERRIDE_TARGETS\\\" ]; then\\n    TARGETS=$(echo \\\"$OVERRIDE_TARGETS\\\" | tr \u0027,\u0027 \u0027 \u0027)\\nfi\\n\\n# Initialize output\\ninit_output_dir \\\"$OUTPUT_DIR\\\"\\n\\necho \\\"\\\"\\necho \\\"======================================================================\\\"\\necho \\\" INFRASTRUCTURE MITM AUDIT - FORENSIC EVIDENCE COLLECTION\\\"\\necho \\\"======================================================================\\\"\\necho \\\"Timestamp: $(date)\\\"\\necho \\\"Evidence Directory: $BASE_DIR\\\"\\necho \\\"Targets: $TARGETS\\\"\\necho \\\"\\\"\\n\\nlog \\\"Audit started\\\"\\nlog \\\"Targets: $TARGETS\\\"\\n\\n# Execute phases\\nphase1_environment\\nphase2_trust_store\\nphase3_target_analysis\\nphase4_traceroute\\nphase5_client_side\\nphase6_finalize\\n\\nlog \\\"Audit completed\\\"\\n\\n\"}"},"checkpointId":"bfd5ab1c-1e12-407c-a26c-3ffd42d1694c"},"bubbleId":"825647f8-93c2-4a68-8426-4ec22311fecb"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"84ead5d8-b94e-4a64-b694-b10477211693","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:41:15.960Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","capabilityType":15,"toolFormerData":{"tool":15,"toolIndex":1,"modelCallId":"74ebdd72-dab7-4c78-965a-80fc6c3933c1","toolCallId":"toolu_018JXAXbz3f3iwV5qoPmnpmU","status":"completed","rawArgs":"{\"command\": \"chmod +x templates/network/mitm-audit.sh 2\u003e/dev/null || echo \\\"chmod not needed on Windows\\\"\", \"is_background\": false}","name":"run_terminal_cmd","params":"{\"command\":\"chmod +x templates/network/mitm-audit.sh 2\u003e/dev/null || echo \\\"chmod not needed on Windows\\\"\",\"requireUserApproval\":true,\"parsingResult\":{\"executableCommands\":[{\"name\":\"chmod\",\"args\":[{\"type\":\"word\",\"value\":\"+x\"},{\"type\":\"word\",\"value\":\"templates/network/mitm-audit.sh\"}],\"fullText\":\"chmod +x templates/network/mitm-audit.sh\"},{\"name\":\"echo\",\"args\":[{\"type\":\"string\",\"value\":\"\\\"chmod not needed on Windows\\\"\"}],\"fullText\":\"echo \\\"chmod not needed on Windows\\\"\"}],\"hasRedirects\":true},\"fileOutputThresholdBytes\":\"20000\"}","additionalData":{"status":"success","reviewData":{"status":"None","selectedOption":"rejectAndTellWhatToDoDifferently","isShowingInput":false,"candidatesForAllowlist":["chmod"],"approvalType":"user"},"sessionId":"a406937a-3145-4fa5-a71e-3012a3e3506f","startAtBufferLine":0,"previousAttempt":"{\"output\":\"work/mitm-audit.sh 2\u003e/dev/null || echo \\\"chmod not needed on Windows\\\"            \\nAt line:1 char:54\\n+ chmod +x templates/network/mitm-audit.sh 2\u003e/dev/null || echo \\\"chmod n ...\\n+                                                      ~~\\nThe token \u0027||\u0027 is not a valid statement separator in this version.\\n    + CategoryInfo          : ParserError: (:) [], ParentContainsErrorRecordEx \\n   ception\\n    + FullyQualifiedErrorId : InvalidEndOfLine\",\"rejected\":false,\"notInterrupted\":true,\"resultingWorkingDirectory\":\"C:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\",\"endedReason\":\"RUN_TERMINAL_COMMAND_ENDED_REASON_EXECUTION_COMPLETED\",\"exitCodeV2\":0,\"outputRaw\":\"\\u001b[91mAt line:1 char:54\\r\\n+ chmod +x templates/network/mitm-audit.sh 2\u003e/dev/null || echo \\\"chmod n ...\\r\\n+                                                      ~~\\r\\nThe token \u0027||\u0027 is not a valid statement separator in this version.\\r\\n    + CategoryInfo          : ParserError: (:) [], ParentContainsErrorRecordEx \\r\\n   ception\\r\\n    + FullyQualifiedErrorId : InvalidEndOfLine\\r\\n \\r\\n\\u001b[0mPS C:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\u003e \\u001b[?1004h\\n\",\"effectiveSandboxPolicy\":{\"type\":\"TYPE_INSECURE_NONE\"}}"},"userDecision":"accepted","result":"{\"output\":\"work/mitm-audit.sh 2\u003e/dev/null || echo \\\"chmod not needed on Windows\\\"            \\nAt line:1 char:54\\n+ chmod +x templates/network/mitm-audit.sh 2\u003e/dev/null || echo \\\"chmod n ...\\n+                                                      ~~\\nThe token \u0027||\u0027 is not a valid statement separator in this version.\\n    + CategoryInfo          : ParserError: (:) [], ParentContainsErrorRecordEx \\n   ception\\n    + FullyQualifiedErrorId : InvalidEndOfLine\",\"rejected\":false,\"notInterrupted\":true,\"resultingWorkingDirectory\":\"C:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\",\"endedReason\":\"RUN_TERMINAL_COMMAND_ENDED_REASON_EXECUTION_COMPLETED\",\"exitCodeV2\":0,\"outputRaw\":\"\\u001b[91mAt line:1 char:54\\r\\n+ chmod +x templates/network/mitm-audit.sh 2\u003e/dev/null || echo \\\"chmod n ...\\r\\n+                                                      ~~\\r\\nThe token \u0027||\u0027 is not a valid statement separator in this version.\\r\\n    + CategoryInfo          : ParserError: (:) [], ParentContainsErrorRecordEx \\r\\n   ception\\r\\n    + FullyQualifiedErrorId : InvalidEndOfLine\\r\\n \\r\\n\\u001b[0mPS C:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\u003e \\u001b[?1004h\\n\",\"effectiveSandboxPolicy\":{\"type\":\"TYPE_INSECURE_NONE\"}}"}},"bubbleId":"84ead5d8-b94e-4a64-b694-b10477211693"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"8534e064-237b-4ddb-8cda-eec8252ffa14","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:34:28.866Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","serverBubbleId":"42eedf7a-7e67-4c1b-94e7-cdda025567fc","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","capabilityType":30,"thinking":{"text":"Good - I\u0027ve read the AGENT_ONBOARD.md file. Key points for this task:\n1. No emojis in code/configs/docs\n2. Default languages: PowerShell (Windows), POSIX sh (Unix)\n3. Universal config paradigm: One `.cfg` file consumed by three scripts\n4. BSD-2-Clause license with DCO sign-off required\n\nThe workspace has a lot of files. Let me check if there are existing network forensics scripts I should be aware of to avoid duplication.\n\nFrom AGENT_ONBOARD.md:\n- Network Diagnostics are in `templates/network/`\n- `Invoke-NetworkForensics-v7.ps1` / `network-forensics.sh` exist\n\nI should check these existing scripts to understand the pattern, then create reconciled scripts that:\n1. Follow the same structure/conventions\n2. Use a unified .cfg file\n3. Have feature parity between PowerShell and POSIX shell\n4. Detect infrastructure MITM while ruling out client-side exploits\n\nLet me check the templates/network directory and existing forensics scripts.","signature":"EsUICkYIChgCKkC4+3hCt65svJtwFvjV52sFv/Iifu6+ntGmCnZZ5NZ8UaRbULqm39okt4RcODOnlA3Ea4eflOAhCc82pr7f05Q5EgxmOa7VZhG1leeqpE4aDCnr1A9Dejpn34V43iIw7ldszaf6K1ZFfhFwUTGDdFKNz4VqMCEWv/R4HJSxemG8CL1r8IOpMB+DHWHRP0wrKqwHZwIdTw3XllXEpsWHqlvZ1zWeEsGpPO3ORUoNTBkTh+DMhrcmBunNm4EdCA3E3oW7FMyBAQpGceLB7bxq1n5cKsyfc+lLS1ECKV/N6LfQPcrb2r/bAKZo8NV9QLuhlCfuRPRCJ7d+0pmB3hrz9QBSDGVh/tMqIVM4ZUFzIDi/iCHiU7P3wnmTZfqhYpB1SrUkolRnDuPISQrt1cm/c8+oz714YeJZSOd3Fbt3eTFali4zzvpBYIkkM/ZcR7lwiIJyR81XEUeRF4e8WOB1RK4kl/AvPB169mzHdxCXMrFVErEHhzkoy732lX6bbVIn8RK+Lk91fR5H0SLzP1p64Gv7pXyRQOAfbBcg3Jk9U4o+US9xqBixtZcP0OWKTFpreyoa3OehkQgvlVWBy2hF/LJiMzNdILiZfEiUhT+kaTDx8WYOg4RRJUN4t6QQD7Q4gai4FIqZL0g4L9/Zi22kqXUjfKQ4XhCHCQ0wEo1jVx+VgwpIUgoJM2ZwXWhl8lVNeJ/9wU/5tlqYwD7x6SbeiAQ84CaX9c9i+e3xzqXJTHhLKI0dFA4yKfS04S9HTvtDKB6WqpjNkIjqYEYCaeM5f2stKeqEJRJ1BlVZK83FC4FpvO5j5TmoLzB5nFTP5BYkm42yCEbO0b5g8ohVZKYOqr9vKmLcinluwrVjZsPtpzACNC4CAoJTBs/xAN9rliAlzzQuw0n+HViGIcexO2heCJR5R07OcGyVWHiy/8n8A9slXwYNu1fd0AAQ5CjxAc6M09sKTBEEzuVkfyNtG3ciuJGY723lBjHzoGvjUOF69dct6HPrnZPbM050Y4nSFOYXnysOdUPipoOEByJ3fUDtaIL6UA/gJ1a3PiEZ2dltNRrv9ZKteBC/xZeKa2EL2hn27fmVpceRXAeW9ADS22CAQEmm0yV5NmUtHLCTKO+jPjMVwF/X2rIRafGEFS30rbqX6+KQ17ieNbjOG+R1CfG9ouuWV3muhAtPDK2wCOAv3UiHgLfKGMUDvMuYqo369/6Wyz5M44i8JkbwPOjaxFmMvVhcIXWe6uaxyT0x1ERoWdYC+83XqBNWyAJVvaAVL2B3lDTp6PTuXsZyAJHioBrlJbGY1c9QF4bq00yhWH+UzXbN/DUDFeJrwqO/2z1SjsWWyD8oxPSVe+z+rfkHAy1dsC6nPpMXAoBK1T3pNlsKUjAQFhvzD9JxC4dT3bHoGeTTvzguXp83a0pHpUESQmvQ4G6904Y6ft7y3RBmHitzThgB"},"thinkingStyle":1,"thinkingDurationMs":6794},"bubbleId":"8534e064-237b-4ddb-8cda-eec8252ffa14"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"92e72fb4-ecd9-4087-8326-0fdc21ce7e6a","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:34:40.239Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","capabilityType":15,"toolFormerData":{"tool":42,"toolCallId":"toolu_01WdzjutbzjMYVn3oH9fnnt5","toolIndex":2,"modelCallId":"417cab30-1903-4e20-bcd5-a019d4fce47c","status":"completed","rawArgs":"{\"glob_pattern\": \"*forensic*.ps1\"}","name":"glob_file_search","params":"{\"globPattern\":\"**/*forensic*.ps1\"}","additionalData":{},"result":"{\"directories\":[{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\",\"files\":[{\"relPath\":\"github-backup\\\\cursor-backup-store-latest\\\\templates\\\\network\\\\Invoke-NetworkForensics-v7.ps1\"},{\"relPath\":\"github-backup\\\\cursor-backup-store-latest\\\\templates\\\\network\\\\Invoke-BrowserForensics-v7.ps1\"},{\"relPath\":\"templates\\\\network\\\\Invoke-NetworkForensics-v7.ps1\"},{\"relPath\":\"templates\\\\network\\\\Invoke-BrowserForensics-v7.ps1\"}],\"totalFiles\":4}]}"}},"bubbleId":"92e72fb4-ecd9-4087-8326-0fdc21ce7e6a"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"93ec63b8-745c-4db6-8bb6-86dacfc44785","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:40:56.248Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"text":"","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","codeBlocks":[{"uri":{"scheme":"file","authority":"","path":"/c:/Users/user/Downloads/Cursor_working_directory_misc/templates/network/Invoke-BackgroundDiagnostics-v7.ps1","query":"","fragment":"","_formatted":"file:///c%3A/Users/user/Downloads/Cursor_working_directory_misc/templates/network/Invoke-BackgroundDiagnostics-v7.ps1","_fsPath":null},"codeblockId":"a0619f8c-18dc-4f2e-9d3b-cd8124ab4b3d","codeBlockIdx":0,"content":"#Requires -Version 7.0\n\u003c#\n.SYNOPSIS\n    Background execution wrapper for network diagnostics scripts.\n\n.DESCRIPTION\n    Runs network diagnostic scripts as background jobs with output captured\n    to files. Allows agent to start diagnostics and retrieve results later\n    without blocking on long-running or indefinite processes.\n\n.PARAMETER Script\n    Name of the script to run: NetworkScan, DnsDiagnostics, NetworkForensics, PacketCapture\n\n.PARAMETER ConfigFile\n    Path to network.cfg configuration file.\n\n.PARAMETER OutputPath\n    Directory for results and job output.\n\n.PARAMETER ScriptArgs\n    Additional arguments to pass to the script as hashtable.\n\n.PARAMETER JobName\n    Custom name for the background job.\n\n.PARAMETER WaitSeconds\n    Seconds to wait for job completion (0 = no wait, return immediately).\n\n.EXAMPLE\n    .\\Invoke-BackgroundDiagnostics-v7.ps1 -Script NetworkForensics -OutputPath .\\results\n    .\\Invoke-BackgroundDiagnostics-v7.ps1 -Script DnsDiagnostics -WaitSeconds 30\n    .\\Invoke-BackgroundDiagnostics-v7.ps1 -Script PacketCapture -ScriptArgs @{Duration=60}\n\n.NOTES\n    License: BSD-2-Clause\n    Requires: PowerShell 7+\n    Signed-off-by: Network Diagnostics Toolkit\n#\u003e\n\n[CmdletBinding()]\nparam(\n    [Parameter(Mandatory)]\n    [ValidateSet(\u0027NetworkScan\u0027, \u0027DnsDiagnostics\u0027, \u0027NetworkForensics\u0027, \u0027PacketCapture\u0027, \u0027MitmAudit\u0027)]\n    [string]$Script,\n\n    [Parameter()]\n    [string]$ConfigFile,\n\n    [Parameter()]\n    [string]$OutputPath = \".\\diagnostics-output\",\n\n    [Parameter()]\n    [hashtable]$ScriptArgs = @{},\n\n    [Parameter()]\n    [string]$JobName,\n\n    [Parameter()]\n    [int]$WaitSeconds = 0\n)\n\nSet-StrictMode -Version Latest\n$ErrorActionPreference = \u0027Stop\u0027\n\n#region Script Mapping\n\n$scriptMap = @{\n    \u0027NetworkScan\u0027      = \u0027Invoke-NetworkScan-v7.ps1\u0027\n    \u0027DnsDiagnostics\u0027   = \u0027Invoke-DnsDiagnostics-v7.ps1\u0027\n    \u0027NetworkForensics\u0027 = \u0027Invoke-NetworkForensics-v7.ps1\u0027\n    \u0027PacketCapture\u0027    = \u0027Invoke-PacketCapture-v7.ps1\u0027\n    \u0027MitmAudit\u0027        = \u0027Invoke-MitmAudit-v7.ps1\u0027\n}\n\n#endregion\n\n#region Main\n\n$scriptDir = $PSScriptRoot\n$scriptPath = Join-Path $scriptDir $scriptMap[$Script]\n\nif (-not (Test-Path $scriptPath)) {\n    Write-Error \"Script not found: $scriptPath\"\n    exit 1\n}\n\n# Create output directory\nif (-not (Test-Path $OutputPath)) {\n    New-Item -ItemType Directory -Path $OutputPath -Force | Out-Null\n}\n\n$timestamp = Get-Date -Format \"yyyy-MM-dd_HH-mm-ss\"\n$jobNameFinal = if ($JobName) { $JobName } else { \"$Script-$timestamp\" }\n\n# Output files\n$stdoutFile = Join-Path $OutputPath \"$jobNameFinal-stdout.txt\"\n$stderrFile = Join-Path $OutputPath \"$jobNameFinal-stderr.txt\"\n$statusFile = Join-Path $OutputPath \"$jobNameFinal-status.json\"\n\n# Build argument list\n$argList = @()\nif ($ConfigFile) {\n    $argList += \"-ConfigFile\"\n    $argList += $ConfigFile\n}\n$argList += \"-OutputPath\"\n$argList += $OutputPath\n\nforeach ($key in $ScriptArgs.Keys) {\n    $argList += \"-$key\"\n    $value = $ScriptArgs[$key]\n    if ($value -isnot [switch] -and $value -ne $true) {\n        $argList += $value\n    }\n}\n\n# Write initial status\n$status = [PSCustomObject]@{\n    JobName     = $jobNameFinal\n    Script      = $Script\n    ScriptPath  = $scriptPath\n    Arguments   = $argList\n    StartTime   = (Get-Date).ToString(\"o\")\n    EndTime     = $null\n    Status      = \"Running\"\n    ExitCode    = $null\n    StdoutFile  = $stdoutFile\n    StderrFile  = $stderrFile\n    OutputPath  = $OutputPath\n}\n$status | ConvertTo-Json -Depth 3 | Set-Content $statusFile -Encoding UTF8\n\nWrite-Host \"============================================\" -ForegroundColor Cyan\nWrite-Host \" BACKGROUND DIAGNOSTICS LAUNCHER\" -ForegroundColor Cyan\nWrite-Host \"============================================\" -ForegroundColor Cyan\nWrite-Host \"Job Name:    $jobNameFinal\"\nWrite-Host \"Script:      $Script\"\nWrite-Host \"Output:      $OutputPath\"\nWrite-Host \"Status File: $statusFile\"\nWrite-Host \"\"\n\n# Start background job\n$job = Start-Job -Name $jobNameFinal -ScriptBlock {\n    param($ScriptPath, $ArgList, $StdoutFile, $StderrFile, $StatusFile)\n\n    try {\n        # Redirect output to files\n        $output = \u0026 $ScriptPath @ArgList 2\u003e\u00261\n        $output | Out-File -FilePath $StdoutFile -Encoding UTF8\n        $exitCode = $LASTEXITCODE\n        if ($null -eq $exitCode) { $exitCode = 0 }\n    } catch {\n        $_ | Out-File -FilePath $StderrFile -Encoding UTF8 -Append\n        $exitCode = 1\n    }\n\n    # Update status file\n    $status = Get-Content $StatusFile -Raw | ConvertFrom-Json\n    $status.EndTime = (Get-Date).ToString(\"o\")\n    $status.Status = if ($exitCode -eq 0) { \"Completed\" } else { \"Failed\" }\n    $status.ExitCode = $exitCode\n    $status | ConvertTo-Json -Depth 3 | Set-Content $StatusFile -Encoding UTF8\n\n    return $exitCode\n} -ArgumentList $scriptPath, $argList, $stdoutFile, $stderrFile, $statusFile\n\nWrite-Host \"Job started: $($job.Id)\" -ForegroundColor Green\nWrite-Host \"\"\n\nif ($WaitSeconds -gt 0) {\n    Write-Host \"Waiting up to $WaitSeconds seconds for completion...\" -ForegroundColor Yellow\n    $completed = Wait-Job -Job $job -Timeout $WaitSeconds\n\n    if ($completed) {\n        $result = Receive-Job -Job $job\n        Write-Host \"\"\n        Write-Host \"Job completed.\" -ForegroundColor Green\n\n        # Display output\n        if (Test-Path $stdoutFile) {\n            Write-Host \"\"\n            Write-Host \"--- OUTPUT ---\" -ForegroundColor Cyan\n            Get-Content $stdoutFile\n        }\n    } else {\n        Write-Host \"\"\n        Write-Host \"Job still running after $WaitSeconds seconds.\" -ForegroundColor Yellow\n        Write-Host \"Check status later with:\" -ForegroundColor Yellow\n        Write-Host \"  Get-Content \u0027$statusFile\u0027\" -ForegroundColor White\n        Write-Host \"  Get-Content \u0027$stdoutFile\u0027\" -ForegroundColor White\n    }\n} else {\n    Write-Host \"Job running in background.\" -ForegroundColor Yellow\n    Write-Host \"\"\n    Write-Host \"To check status:\" -ForegroundColor Cyan\n    Write-Host \"  Get-Content \u0027$statusFile\u0027\" -ForegroundColor White\n    Write-Host \"\"\n    Write-Host \"To read output when complete:\" -ForegroundColor Cyan\n    Write-Host \"  Get-Content \u0027$stdoutFile\u0027\" -ForegroundColor White\n    Write-Host \"\"\n    Write-Host \"To check job state:\" -ForegroundColor Cyan\n    Write-Host \"  Get-Job -Name \u0027$jobNameFinal\u0027\" -ForegroundColor White\n    Write-Host \"\"\n    Write-Host \"To wait and receive output:\" -ForegroundColor Cyan\n    Write-Host \"  Receive-Job -Name \u0027$jobNameFinal\u0027 -Wait\" -ForegroundColor White\n}\n\nWrite-Host \"\"\nWrite-Host \"============================================\" -ForegroundColor Cyan\n\n#endregion\n\n\n\n","languageId":"powershell"}],"capabilityType":15,"toolFormerData":{"tool":38,"toolCallId":"toolu_01BBA3TrAPQCVaJnr75cXPh2","toolIndex":1,"modelCallId":"0ad365cb-55f0-4868-b122-2ff0ead633bb","status":"completed","rawArgs":"{\"file_path\": \"templates/network/Invoke-BackgroundDiagnostics-v7.ps1\", \"old_string\": \"$scriptMap = @{\\n    \u0027NetworkScan\u0027      = \u0027Invoke-NetworkScan-v7.ps1\u0027\\n    \u0027DnsDiagnostics\u0027   = \u0027Invoke-DnsDiagnostics-v7.ps1\u0027\\n    \u0027NetworkForensics\u0027 = \u0027Invoke-NetworkForensics-v7.ps1\u0027\\n    \u0027PacketCapture\u0027    = \u0027Invoke-PacketCapture-v7.ps1\u0027\\n}\", \"new_string\": \"$scriptMap = @{\\n    \u0027NetworkScan\u0027      = \u0027Invoke-NetworkScan-v7.ps1\u0027\\n    \u0027DnsDiagnostics\u0027   = \u0027Invoke-DnsDiagnostics-v7.ps1\u0027\\n    \u0027NetworkForensics\u0027 = \u0027Invoke-NetworkForensics-v7.ps1\u0027\\n    \u0027PacketCapture\u0027    = \u0027Invoke-PacketCapture-v7.ps1\u0027\\n    \u0027MitmAudit\u0027        = \u0027Invoke-MitmAudit-v7.ps1\u0027\\n}\"}","name":"search_replace","params":"{\"relativeWorkspacePath\":\"templates/network/Invoke-BackgroundDiagnostics-v7.ps1\"}","additionalData":{"codeblockId":"a0619f8c-18dc-4f2e-9d3b-cd8124ab4b3d","reviewData":{"status":"None","selectedOption":"accept","isShowingInput":false,"firstTimeReviewMode":false}},"userDecision":"accepted","result":"{\"diff\":{\"chunks\":[{\"diffString\":\"      \u0027NetworkForensics\u0027 = \u0027Invoke-NetworkForensics-v7.ps1\u0027\\n      \u0027PacketCapture\u0027    = \u0027Invoke-PacketCapture-v7.ps1\u0027\\n+     \u0027MitmAudit\u0027        = \u0027Invoke-MitmAudit-v7.ps1\u0027\\n  }\\n  \",\"oldStart\":70,\"newStart\":70,\"oldLines\":4,\"newLines\":5,\"linesAdded\":1}],\"editor\":\"EDITOR_AI\"},\"shouldAutoFixLints\":true,\"resultForModel\":\"The file templates/network/Invoke-BackgroundDiagnostics-v7.ps1 has been updated.\",\"contentsAfterEdit\":\"#Requires -Version 7.0\\n\u003c#\\n.SYNOPSIS\\n    Background execution wrapper for network diagnostics scripts.\\n\\n.DESCRIPTION\\n    Runs network diagnostic scripts as background jobs with output captured\\n    to files. Allows agent to start diagnostics and retrieve results later\\n    without blocking on long-running or indefinite processes.\\n\\n.PARAMETER Script\\n    Name of the script to run: NetworkScan, DnsDiagnostics, NetworkForensics, PacketCapture\\n\\n.PARAMETER ConfigFile\\n    Path to network.cfg configuration file.\\n\\n.PARAMETER OutputPath\\n    Directory for results and job output.\\n\\n.PARAMETER ScriptArgs\\n    Additional arguments to pass to the script as hashtable.\\n\\n.PARAMETER JobName\\n    Custom name for the background job.\\n\\n.PARAMETER WaitSeconds\\n    Seconds to wait for job completion (0 = no wait, return immediately).\\n\\n.EXAMPLE\\n    .\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script NetworkForensics -OutputPath .\\\\results\\n    .\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script DnsDiagnostics -WaitSeconds 30\\n    .\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script PacketCapture -ScriptArgs @{Duration=60}\\n\\n.NOTES\\n    License: BSD-2-Clause\\n    Requires: PowerShell 7+\\n    Signed-off-by: Network Diagnostics Toolkit\\n#\u003e\\n\\n[CmdletBinding()]\\nparam(\\n    [Parameter(Mandatory)]\\n    [ValidateSet(\u0027NetworkScan\u0027, \u0027DnsDiagnostics\u0027, \u0027NetworkForensics\u0027, \u0027PacketCapture\u0027, \u0027MitmAudit\u0027)]\\n    [string]$Script,\\n\\n    [Parameter()]\\n    [string]$ConfigFile,\\n\\n    [Parameter()]\\n    [string]$OutputPath = \\\".\\\\diagnostics-output\\\",\\n\\n    [Parameter()]\\n    [hashtable]$ScriptArgs = @{},\\n\\n    [Parameter()]\\n    [string]$JobName,\\n\\n    [Parameter()]\\n    [int]$WaitSeconds = 0\\n)\\n\\nSet-StrictMode -Version Latest\\n$ErrorActionPreference = \u0027Stop\u0027\\n\\n#region Script Mapping\\n\\n$scriptMap = @{\\n    \u0027NetworkScan\u0027      = \u0027Invoke-NetworkScan-v7.ps1\u0027\\n    \u0027DnsDiagnostics\u0027   = \u0027Invoke-DnsDiagnostics-v7.ps1\u0027\\n    \u0027NetworkForensics\u0027 = \u0027Invoke-NetworkForensics-v7.ps1\u0027\\n    \u0027PacketCapture\u0027    = \u0027Invoke-PacketCapture-v7.ps1\u0027\\n    \u0027MitmAudit\u0027        = \u0027Invoke-MitmAudit-v7.ps1\u0027\\n}\\n\\n#endregion\\n\\n#region Main\\n\\n$scriptDir = $PSScriptRoot\\n$scriptPath = Join-Path $scriptDir $scriptMap[$Script]\\n\\nif (-not (Test-Path $scriptPath)) {\\n    Write-Error \\\"Script not found: $scriptPath\\\"\\n    exit 1\\n}\\n\\n# Create output directory\\nif (-not (Test-Path $OutputPath)) {\\n    New-Item -ItemType Directory -Path $OutputPath -Force | Out-Null\\n}\\n\\n$timestamp = Get-Date -Format \\\"yyyy-MM-dd_HH-mm-ss\\\"\\n$jobNameFinal = if ($JobName) { $JobName } else { \\\"$Script-$timestamp\\\" }\\n\\n# Output files\\n$stdoutFile = Join-Path $OutputPath \\\"$jobNameFinal-stdout.txt\\\"\\n$stderrFile = Join-Path $OutputPath \\\"$jobNameFinal-stderr.txt\\\"\\n$statusFile = Join-Path $OutputPath \\\"$jobNameFinal-status.json\\\"\\n\\n# Build argument list\\n$argList = @()\\nif ($ConfigFile) {\\n    $argList += \\\"-ConfigFile\\\"\\n    $argList += $ConfigFile\\n}\\n$argList += \\\"-OutputPath\\\"\\n$argList += $OutputPath\\n\\nforeach ($key in $ScriptArgs.Keys) {\\n    $argList += \\\"-$key\\\"\\n    $value = $ScriptArgs[$key]\\n    if ($value -isnot [switch] -and $value -ne $true) {\\n        $argList += $value\\n    }\\n}\\n\\n# Write initial status\\n$status = [PSCustomObject]@{\\n    JobName     = $jobNameFinal\\n    Script      = $Script\\n    ScriptPath  = $scriptPath\\n    Arguments   = $argList\\n    StartTime   = (Get-Date).ToString(\\\"o\\\")\\n    EndTime     = $null\\n    Status      = \\\"Running\\\"\\n    ExitCode    = $null\\n    StdoutFile  = $stdoutFile\\n    StderrFile  = $stderrFile\\n    OutputPath  = $OutputPath\\n}\\n$status | ConvertTo-Json -Depth 3 | Set-Content $statusFile -Encoding UTF8\\n\\nWrite-Host \\\"============================================\\\" -ForegroundColor Cyan\\nWrite-Host \\\" BACKGROUND DIAGNOSTICS LAUNCHER\\\" -ForegroundColor Cyan\\nWrite-Host \\\"============================================\\\" -ForegroundColor Cyan\\nWrite-Host \\\"Job Name:    $jobNameFinal\\\"\\nWrite-Host \\\"Script:      $Script\\\"\\nWrite-Host \\\"Output:      $OutputPath\\\"\\nWrite-Host \\\"Status File: $statusFile\\\"\\nWrite-Host \\\"\\\"\\n\\n# Start background job\\n$job = Start-Job -Name $jobNameFinal -ScriptBlock {\\n    param($ScriptPath, $ArgList, $StdoutFile, $StderrFile, $StatusFile)\\n\\n    try {\\n        # Redirect output to files\\n        $output = \u0026 $ScriptPath @ArgList 2\u003e\u00261\\n        $output | Out-File -FilePath $StdoutFile -Encoding UTF8\\n        $exitCode = $LASTEXITCODE\\n        if ($null -eq $exitCode) { $exitCode = 0 }\\n    } catch {\\n        $_ | Out-File -FilePath $StderrFile -Encoding UTF8 -Append\\n        $exitCode = 1\\n    }\\n\\n    # Update status file\\n    $status = Get-Content $StatusFile -Raw | ConvertFrom-Json\\n    $status.EndTime = (Get-Date).ToString(\\\"o\\\")\\n    $status.Status = if ($exitCode -eq 0) { \\\"Completed\\\" } else { \\\"Failed\\\" }\\n    $status.ExitCode = $exitCode\\n    $status | ConvertTo-Json -Depth 3 | Set-Content $StatusFile -Encoding UTF8\\n\\n    return $exitCode\\n} -ArgumentList $scriptPath, $argList, $stdoutFile, $stderrFile, $statusFile\\n\\nWrite-Host \\\"Job started: $($job.Id)\\\" -ForegroundColor Green\\nWrite-Host \\\"\\\"\\n\\nif ($WaitSeconds -gt 0) {\\n    Write-Host \\\"Waiting up to $WaitSeconds seconds for completion...\\\" -ForegroundColor Yellow\\n    $completed = Wait-Job -Job $job -Timeout $WaitSeconds\\n\\n    if ($completed) {\\n        $result = Receive-Job -Job $job\\n        Write-Host \\\"\\\"\\n        Write-Host \\\"Job completed.\\\" -ForegroundColor Green\\n\\n        # Display output\\n        if (Test-Path $stdoutFile) {\\n            Write-Host \\\"\\\"\\n            Write-Host \\\"--- OUTPUT ---\\\" -ForegroundColor Cyan\\n            Get-Content $stdoutFile\\n        }\\n    } else {\\n        Write-Host \\\"\\\"\\n        Write-Host \\\"Job still running after $WaitSeconds seconds.\\\" -ForegroundColor Yellow\\n        Write-Host \\\"Check status later with:\\\" -ForegroundColor Yellow\\n        Write-Host \\\"  Get-Content \u0027$statusFile\u0027\\\" -ForegroundColor White\\n        Write-Host \\\"  Get-Content \u0027$stdoutFile\u0027\\\" -ForegroundColor White\\n    }\\n} else {\\n    Write-Host \\\"Job running in background.\\\" -ForegroundColor Yellow\\n    Write-Host \\\"\\\"\\n    Write-Host \\\"To check status:\\\" -ForegroundColor Cyan\\n    Write-Host \\\"  Get-Content \u0027$statusFile\u0027\\\" -ForegroundColor White\\n    Write-Host \\\"\\\"\\n    Write-Host \\\"To read output when complete:\\\" -ForegroundColor Cyan\\n    Write-Host \\\"  Get-Content \u0027$stdoutFile\u0027\\\" -ForegroundColor White\\n    Write-Host \\\"\\\"\\n    Write-Host \\\"To check job state:\\\" -ForegroundColor Cyan\\n    Write-Host \\\"  Get-Job -Name \u0027$jobNameFinal\u0027\\\" -ForegroundColor White\\n    Write-Host \\\"\\\"\\n    Write-Host \\\"To wait and receive output:\\\" -ForegroundColor Cyan\\n    Write-Host \\\"  Receive-Job -Name \u0027$jobNameFinal\u0027 -Wait\\\" -ForegroundColor White\\n}\\n\\nWrite-Host \\\"\\\"\\nWrite-Host \\\"============================================\\\" -ForegroundColor Cyan\\n\\n#endregion\\n\\n\\n\\n\"}","attachments":"{\"shouldShowTodoWriteReminder\":true,\"todoReminderType\":\"TODO_REMINDER_TYPE_EVERY_10_TURNS\"}"},"checkpointId":"dc6c4eb8-fc38-4209-a025-35565154680e"},"bubbleId":"93ec63b8-745c-4db6-8bb6-86dacfc44785"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"a3b5f54a-5318-497f-9224-07d42e1a36fc","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:35:03.758Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"text":"Let me check the existing config file and also understand how to properly integrate with the workspace pattern:","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878"},"bubbleId":"a3b5f54a-5318-497f-9224-07d42e1a36fc"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"a4598bba-3fcf-4cde-8864-dd9c4f91cf2a","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:40:01.232Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","serverBubbleId":"9ab6ee0e-65ae-49fa-a363-30e3e8739c42","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","capabilityType":30,"thinking":{"text":"Now let me add the MITM detection capabilities to the detection section and the configuration section.","signature":"Eo4CCkYIChgCKkAkCtuFg8buWqXmw7DDf0hgQWYbQbDQfFLv6VExiEHkZuNWXKuGkADiwluMUpl2TpXpJnMRZx5RqfNXqxPSb7jkEgxUvhZqcUQWwuGRY08aDN9FwQS30oZCG0qG+SIwI4PWxEdDqa7HQ2JZIegp1s462KNyDlWe8aKPZ7tpH+658vo6k3LyLE58my+U5m2TKnbWC1ShVhAJA0/CnT+Ib369A28mJrGQuvidKrB76DRzSqndO2xMORq4w7EDdfTMUo9oLsEptOblpbZXAV8kd583ObmFqHoP4QSEJBhLjkCwJ6z3ytcsTXlF+r8CtbViksb8hwlY3vTcsvM1A/ATXGQtB2OkIUcQGAE="},"thinkingStyle":1,"thinkingDurationMs":713},"bubbleId":"a4598bba-3fcf-4cde-8864-dd9c4f91cf2a"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"a893df6c-9bd6-4220-84ba-9ef43d7331a1","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:34:40.963Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","capabilityType":15,"toolFormerData":{"tool":42,"toolCallId":"toolu_017NZjuMbW6NhcEKEMjkdJn3","toolIndex":3,"modelCallId":"417cab30-1903-4e20-bcd5-a019d4fce47c","status":"completed","rawArgs":"{\"glob_pattern\": \"*forensic*.sh\"}","name":"glob_file_search","params":"{\"globPattern\":\"**/*forensic*.sh\"}","additionalData":{},"result":"{\"directories\":[{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\",\"files\":[{\"relPath\":\"github-backup\\\\cursor-backup-store-latest\\\\templates\\\\network\\\\network-forensics.sh\"},{\"relPath\":\"templates\\\\network\\\\network-forensics.sh\"}],\"totalFiles\":2}]}"}},"bubbleId":"a893df6c-9bd6-4220-84ba-9ef43d7331a1"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"ad140871-3d0b-4854-86f4-675f073ba432","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:41:31.645Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[{"uri":{"scheme":"file","authority":"","path":"/c:/Users/user/Downloads/Cursor_working_directory_misc/templates/network/MITM-AUDIT-RECONCILIATION.md","query":"","fragment":"","_formatted":"file:///c%3A/Users/user/Downloads/Cursor_working_directory_misc/templates/network/MITM-AUDIT-RECONCILIATION.md","_fsPath":null},"codeblockId":"c994a159-942b-4481-866b-17004da133b4","codeBlockIdx":0,"content":"# Infrastructure MITM Audit - Reconciliation Summary\n\n## Overview\n\nThe `Invoke-MitmAudit-v7.ps1` (PowerShell) and `mitm-audit.sh` (POSIX shell) scripts are reconciled implementations of the \"Gold Standard\" forensic network audit for detecting infrastructure-side Man-in-the-Middle attacks.\n\n## Feature Parity Matrix\n\n| Feature | PowerShell | POSIX Shell | Notes |\n|---------|------------|-------------|-------|\n| **Phase 1: Environment Snapshot** ||||\n| Network configuration export | Y | Y | `Get-NetIPConfiguration` / `ip addr` |\n| External IP identification | Y | Y | ipinfo.io JSON API |\n| ISP validation | Y | Y | Configurable patterns |\n| System information | Y | Y | Full system context |\n| **Phase 2: Trust Store Export** ||||\n| Root CA export | Y | Y | CSV (Windows) / PEM (Unix) |\n| Root CA hashing | Y | Y | SHA256 for integrity |\n| Suspicious CA detection | Y | Y | Pattern matching |\n| Enterprise MITM tool detection | Y | Y | Zscaler, BlueCoat, etc. |\n| Recently added CA flagging | Y | Partial | Windows has date metadata |\n| **Phase 3: Target Analysis** ||||\n| Local DNS resolution | Y | Y | `Resolve-DnsName` / `dig`/`host` |\n| DoH resolution (control group) | Y | Y | dns.google/resolve |\n| ASN lookup | Y | Y | ip-api.com |\n| ASN integrity heuristics | Y | Y | Google-\u003eGoogle ASN, etc. |\n| VPS provider detection | Y | Y | DigitalOcean, Linode, etc. |\n| Certificate capture | Y | Y | TcpClient/SslStream / openssl |\n| Certificate anomaly detection | Y | Y | Let\u0027s Encrypt on Google, etc. |\n| **Phase 4: Traceroute Mapping** ||||\n| Route tracing | Y | Y | `Test-NetConnection` / `traceroute` |\n| Per-hop ASN lookup | Y | Y | Identifies suspicious routing |\n| VPS hop alerting | Y | Y | Alerts on unexpected providers |\n| **Phase 5: Client-Side Detection** ||||\n| System proxy check | Y | Y | Registry / env vars |\n| Environment proxy vars | Y | Y | HTTP_PROXY, HTTPS_PROXY, etc. |\n| WinHTTP proxy | Y | - | Windows-specific |\n| macOS scutil proxy | - | Y | macOS-specific |\n| Hosts file analysis | Y | Y | Sensitive domain redirects |\n| Browser extension audit | Y | Y | Chrome/Edge/Firefox |\n| webRequest permission flagging | Y | - | Chrome/Edge manifest parsing |\n| **Phase 6: Evidence Finalization** ||||\n| Alert summary | Y | Y | `_RedFlags.txt` |\n| File hashing | Y | Y | Chain of custody |\n| JSON summary | Y | Y | `Summary.json` |\n\n## Configuration File\n\nBoth scripts use `mitm-audit.cfg` with identical KEY=VALUE format:\n\n```\nTARGETS=accounts.google.com,login.microsoftonline.com,appleid.apple.com,aws.amazon.com,github.com\nDOH_ENDPOINT=https://dns.google/resolve\nASN_LOOKUP_URL=http://ip-api.com/json\nSUSPICIOUS_ASN_PATTERNS=DigitalOcean,Linode,Vultr,Choopa,Datacamp,OVH,Hetzner\nSUSPICIOUS_CERT_ISSUERS=Let\u0027s Encrypt,ZeroSSL,Self-Signed,localhost\nTRACEROUTE_ENABLED=true\nEXPORT_ROOT_CA=true\nCHECK_PROXY_SETTINGS=true\nCHECK_HOSTS_FILE=true\nCHECK_ROOT_CA_ANOMALIES=true\n```\n\n## Output Structure\n\nBoth scripts produce identical evidence package structure:\n\n```\nForensicEvidence_YYYYMMDD_HHMMSS/\n  _AuditLog.txt\n  _RedFlags.txt              \u003c-- CHECK THIS FIRST\n  _FileHashes.json           (PS) / _FileHashes.txt (sh)\n  Summary.json\n  environment/\n    NetworkConfig.json       (PS) / NetworkConfig.txt (sh)\n    ExternalIP.json\n    SystemInfo.json          (PS) / SystemInfo.txt (sh)\n  trust-store/\n    RootStore_Dump.csv       (Windows)\n    RootCA_Snapshot.crt      (Linux/macOS)\n    RootCA_Hash.json\n    SuspiciousCAs.json       (PS) / SuspiciousCAs.txt (sh)\n  targets/\n    accounts_google_com/\n      Analysis.json\n      Certificate.json       (PS) / Certificate.txt + .pem (sh)\n      dns.txt\n    ... (one per target)\n  traceroute/\n    Trace_*.txt\n    Trace_*.json\n  client-side/\n    ProxySettings.json       (PS) / ProxySettings.txt (sh)\n    HostsFile.json           (PS) / hosts_backup (sh)\n    BrowserExtensions.json   (PS) / BrowserExtensions.txt (sh)\n```\n\n## Detection Logic\n\n### ASN Integrity Checks\n\nBoth scripts implement identical heuristics:\n\n| Domain Pattern | Expected ASN Pattern |\n|----------------|---------------------|\n| `*google*` | Google |\n| `*microsoft*` | Microsoft |\n| `*apple*` | Apple |\n| `*aws*`, `*amazon*` | Amazon, AMAZON |\n| `*github*` | GitHub, Microsoft |\n\n### Suspicious Routing Detection\n\nTraffic to high-value authentication endpoints should NOT route through:\n- DigitalOcean\n- Linode\n- Vultr\n- Choopa\n- Datacamp\n- OVH\n- Hetzner\n\n### Certificate Anomalies\n\nMajor tech companies should NOT use these issuers:\n- Let\u0027s Encrypt (free DV certs)\n- ZeroSSL\n- Self-Signed\n- localhost\n\n## Client-Side Exploit Ruling Out\n\nTo distinguish infrastructure MITM from client-side compromise, both scripts check:\n\n1. **Proxy Settings**: System proxy, environment variables, WinHTTP\n2. **Hosts File**: Redirects of sensitive domains\n3. **Browser Extensions**: Extensions with `webRequest` permission or suspicious names\n4. **Root CA Store**: Recently added or suspiciously named certificates\n\nIf client-side checks trigger alerts but target analysis does not, the issue is likely client-side.\n\n## Usage\n\n### Windows (PowerShell 7+)\n\n```powershell\n# Run as Administrator for complete data collection\n.\\Invoke-MitmAudit-v7.ps1\n\n# With custom config\n.\\Invoke-MitmAudit-v7.ps1 -ConfigFile .\\mitm-audit.cfg\n\n# Custom targets\n.\\Invoke-MitmAudit-v7.ps1 -Targets \"accounts.google.com,github.com\"\n\n# Skip traceroute (faster)\n.\\Invoke-MitmAudit-v7.ps1 -SkipTraceroute\n\n# Background execution (for agent automation)\n.\\Invoke-BackgroundDiagnostics-v7.ps1 -Script MitmAudit -OutputPath .\\results\n```\n\n### Linux/macOS (POSIX Shell)\n\n```bash\n# Run with elevated privileges for complete data\nsudo ./mitm-audit.sh\n\n# With custom config\n./mitm-audit.sh -c ./mitm-audit.cfg\n\n# Custom targets\n./mitm-audit.sh -t \"accounts.google.com,github.com\"\n\n# Skip traceroute\n./mitm-audit.sh --skip-traceroute\n\n# Background execution\nnohup ./mitm-audit.sh -o ./results \u003e audit.log 2\u003e\u00261 \u0026\n```\n\n## Post-Audit Verification\n\n### The \"Kill Shot\" - Certificate Serial Check\n\n1. Open certificate files from `targets/*/Certificate.*`\n2. Copy the **Serial Number**\n3. Go to [crt.sh](https://crt.sh) on a **clean network/device**\n4. Search for the serial number\n\n**Results interpretation:**\n- \"No certificates found\" = **100% MITM** by private root CA\n- Certificate found for different domain = collision/hash attack\n- Certificate matches = no certificate-based MITM detected\n\n### Chain of Custody\n\n1. Zip the entire evidence folder\n2. Hash the zip: `Get-FileHash evidence.zip -Algorithm SHA256`\n3. This zip + hash is your evidence package for security engineers, EFF, or legal\n\n## License\n\nBSD-2-Clause\n\nSigned-off-by: Network Diagnostics Toolkit\n","languageId":"markdown"}],"text":"","capabilityType":15,"toolFormerData":{"tool":38,"toolIndex":1,"modelCallId":"75a8ae43-81c3-4e34-8964-53f54a210479","toolCallId":"toolu_01To5GCheVHjPGSb9AsJ8HV8","status":"completed","rawArgs":"{\"file_path\": \"templates/network/MITM-AUDIT-RECONCILIATION.md\", \"contents\": \"# Infrastructure MITM Audit - Reconciliation Summary\\n\\n## Overview\\n\\nThe `Invoke-MitmAudit-v7.ps1` (PowerShell) and `mitm-audit.sh` (POSIX shell) scripts are reconciled implementations of the \\\"Gold Standard\\\" forensic network audit for detecting infrastructure-side Man-in-the-Middle attacks.\\n\\n## Feature Parity Matrix\\n\\n| Feature | PowerShell | POSIX Shell | Notes |\\n|---------|------------|-------------|-------|\\n| **Phase 1: Environment Snapshot** ||||\\n| Network configuration export | Y | Y | `Get-NetIPConfiguration` / `ip addr` |\\n| External IP identification | Y | Y | ipinfo.io JSON API |\\n| ISP validation | Y | Y | Configurable patterns |\\n| System information | Y | Y | Full system context |\\n| **Phase 2: Trust Store Export** ||||\\n| Root CA export | Y | Y | CSV (Windows) / PEM (Unix) |\\n| Root CA hashing | Y | Y | SHA256 for integrity |\\n| Suspicious CA detection | Y | Y | Pattern matching |\\n| Enterprise MITM tool detection | Y | Y | Zscaler, BlueCoat, etc. |\\n| Recently added CA flagging | Y | Partial | Windows has date metadata |\\n| **Phase 3: Target Analysis** ||||\\n| Local DNS resolution | Y | Y | `Resolve-DnsName` / `dig`/`host` |\\n| DoH resolution (control group) | Y | Y | dns.google/resolve |\\n| ASN lookup | Y | Y | ip-api.com |\\n| ASN integrity heuristics | Y | Y | Google-\u003eGoogle ASN, etc. |\\n| VPS provider detection | Y | Y | DigitalOcean, Linode, etc. |\\n| Certificate capture | Y | Y | TcpClient/SslStream / openssl |\\n| Certificate anomaly detection | Y | Y | Let\u0027s Encrypt on Google, etc. |\\n| **Phase 4: Traceroute Mapping** ||||\\n| Route tracing | Y | Y | `Test-NetConnection` / `traceroute` |\\n| Per-hop ASN lookup | Y | Y | Identifies suspicious routing |\\n| VPS hop alerting | Y | Y | Alerts on unexpected providers |\\n| **Phase 5: Client-Side Detection** ||||\\n| System proxy check | Y | Y | Registry / env vars |\\n| Environment proxy vars | Y | Y | HTTP_PROXY, HTTPS_PROXY, etc. |\\n| WinHTTP proxy | Y | - | Windows-specific |\\n| macOS scutil proxy | - | Y | macOS-specific |\\n| Hosts file analysis | Y | Y | Sensitive domain redirects |\\n| Browser extension audit | Y | Y | Chrome/Edge/Firefox |\\n| webRequest permission flagging | Y | - | Chrome/Edge manifest parsing |\\n| **Phase 6: Evidence Finalization** ||||\\n| Alert summary | Y | Y | `_RedFlags.txt` |\\n| File hashing | Y | Y | Chain of custody |\\n| JSON summary | Y | Y | `Summary.json` |\\n\\n## Configuration File\\n\\nBoth scripts use `mitm-audit.cfg` with identical KEY=VALUE format:\\n\\n```\\nTARGETS=accounts.google.com,login.microsoftonline.com,appleid.apple.com,aws.amazon.com,github.com\\nDOH_ENDPOINT=https://dns.google/resolve\\nASN_LOOKUP_URL=http://ip-api.com/json\\nSUSPICIOUS_ASN_PATTERNS=DigitalOcean,Linode,Vultr,Choopa,Datacamp,OVH,Hetzner\\nSUSPICIOUS_CERT_ISSUERS=Let\u0027s Encrypt,ZeroSSL,Self-Signed,localhost\\nTRACEROUTE_ENABLED=true\\nEXPORT_ROOT_CA=true\\nCHECK_PROXY_SETTINGS=true\\nCHECK_HOSTS_FILE=true\\nCHECK_ROOT_CA_ANOMALIES=true\\n```\\n\\n## Output Structure\\n\\nBoth scripts produce identical evidence package structure:\\n\\n```\\nForensicEvidence_YYYYMMDD_HHMMSS/\\n  _AuditLog.txt\\n  _RedFlags.txt              \u003c-- CHECK THIS FIRST\\n  _FileHashes.json           (PS) / _FileHashes.txt (sh)\\n  Summary.json\\n  environment/\\n    NetworkConfig.json       (PS) / NetworkConfig.txt (sh)\\n    ExternalIP.json\\n    SystemInfo.json          (PS) / SystemInfo.txt (sh)\\n  trust-store/\\n    RootStore_Dump.csv       (Windows)\\n    RootCA_Snapshot.crt      (Linux/macOS)\\n    RootCA_Hash.json\\n    SuspiciousCAs.json       (PS) / SuspiciousCAs.txt (sh)\\n  targets/\\n    accounts_google_com/\\n      Analysis.json\\n      Certificate.json       (PS) / Certificate.txt + .pem (sh)\\n      dns.txt\\n    ... (one per target)\\n  traceroute/\\n    Trace_*.txt\\n    Trace_*.json\\n  client-side/\\n    ProxySettings.json       (PS) / ProxySettings.txt (sh)\\n    HostsFile.json           (PS) / hosts_backup (sh)\\n    BrowserExtensions.json   (PS) / BrowserExtensions.txt (sh)\\n```\\n\\n## Detection Logic\\n\\n### ASN Integrity Checks\\n\\nBoth scripts implement identical heuristics:\\n\\n| Domain Pattern | Expected ASN Pattern |\\n|----------------|---------------------|\\n| `*google*` | Google |\\n| `*microsoft*` | Microsoft |\\n| `*apple*` | Apple |\\n| `*aws*`, `*amazon*` | Amazon, AMAZON |\\n| `*github*` | GitHub, Microsoft |\\n\\n### Suspicious Routing Detection\\n\\nTraffic to high-value authentication endpoints should NOT route through:\\n- DigitalOcean\\n- Linode\\n- Vultr\\n- Choopa\\n- Datacamp\\n- OVH\\n- Hetzner\\n\\n### Certificate Anomalies\\n\\nMajor tech companies should NOT use these issuers:\\n- Let\u0027s Encrypt (free DV certs)\\n- ZeroSSL\\n- Self-Signed\\n- localhost\\n\\n## Client-Side Exploit Ruling Out\\n\\nTo distinguish infrastructure MITM from client-side compromise, both scripts check:\\n\\n1. **Proxy Settings**: System proxy, environment variables, WinHTTP\\n2. **Hosts File**: Redirects of sensitive domains\\n3. **Browser Extensions**: Extensions with `webRequest` permission or suspicious names\\n4. **Root CA Store**: Recently added or suspiciously named certificates\\n\\nIf client-side checks trigger alerts but target analysis does not, the issue is likely client-side.\\n\\n## Usage\\n\\n### Windows (PowerShell 7+)\\n\\n```powershell\\n# Run as Administrator for complete data collection\\n.\\\\Invoke-MitmAudit-v7.ps1\\n\\n# With custom config\\n.\\\\Invoke-MitmAudit-v7.ps1 -ConfigFile .\\\\mitm-audit.cfg\\n\\n# Custom targets\\n.\\\\Invoke-MitmAudit-v7.ps1 -Targets \\\"accounts.google.com,github.com\\\"\\n\\n# Skip traceroute (faster)\\n.\\\\Invoke-MitmAudit-v7.ps1 -SkipTraceroute\\n\\n# Background execution (for agent automation)\\n.\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script MitmAudit -OutputPath .\\\\results\\n```\\n\\n### Linux/macOS (POSIX Shell)\\n\\n```bash\\n# Run with elevated privileges for complete data\\nsudo ./mitm-audit.sh\\n\\n# With custom config\\n./mitm-audit.sh -c ./mitm-audit.cfg\\n\\n# Custom targets\\n./mitm-audit.sh -t \\\"accounts.google.com,github.com\\\"\\n\\n# Skip traceroute\\n./mitm-audit.sh --skip-traceroute\\n\\n# Background execution\\nnohup ./mitm-audit.sh -o ./results \u003e audit.log 2\u003e\u00261 \u0026\\n```\\n\\n## Post-Audit Verification\\n\\n### The \\\"Kill Shot\\\" - Certificate Serial Check\\n\\n1. Open certificate files from `targets/*/Certificate.*`\\n2. Copy the **Serial Number**\\n3. Go to [crt.sh](https://crt.sh) on a **clean network/device**\\n4. Search for the serial number\\n\\n**Results interpretation:**\\n- \\\"No certificates found\\\" = **100% MITM** by private root CA\\n- Certificate found for different domain = collision/hash attack\\n- Certificate matches = no certificate-based MITM detected\\n\\n### Chain of Custody\\n\\n1. Zip the entire evidence folder\\n2. Hash the zip: `Get-FileHash evidence.zip -Algorithm SHA256`\\n3. This zip + hash is your evidence package for security engineers, EFF, or legal\\n\\n## License\\n\\nBSD-2-Clause\\n\\nSigned-off-by: Network Diagnostics Toolkit\\n\"}","name":"write","params":"{\"relativeWorkspacePath\":\"templates/network/MITM-AUDIT-RECONCILIATION.md\",\"code\":{\"code\":\"# Infrastructure\"}}","additionalData":{"codeblockId":"c994a159-942b-4481-866b-17004da133b4","reviewData":{"status":"None","selectedOption":"accept","isShowingInput":false,"firstTimeReviewMode":false}},"userDecision":"accepted","result":"{\"diff\":{\"chunks\":[{\"diffString\":\"- \\n+ # Infrastructure MITM Audit - Reconciliation Summary\\n+ \\n+ ## Overview\\n+ \\n+ The `Invoke-MitmAudit-v7.ps1` (PowerShell) and `mitm-audit.sh` (POSIX shell) scripts are reconciled implementations of the \\\"Gold Standard\\\" forensic network audit for detecting infrastructure-side Man-in-the-Middle attacks.\\n+ \\n+ ## Feature Parity Matrix\\n+ \\n+ | Feature | PowerShell | POSIX Shell | Notes |\\n+ |---------|------------|-------------|-------|\\n+ | **Phase 1: Environment Snapshot** ||||\\n+ | Network configuration export | Y | Y | `Get-NetIPConfiguration` / `ip addr` |\\n+ | External IP identification | Y | Y | ipinfo.io JSON API |\\n+ | ISP validation | Y | Y | Configurable patterns |\\n+ | System information | Y | Y | Full system context |\\n+ | **Phase 2: Trust Store Export** ||||\\n+ | Root CA export | Y | Y | CSV (Windows) / PEM (Unix) |\\n+ | Root CA hashing | Y | Y | SHA256 for integrity |\\n+ | Suspicious CA detection | Y | Y | Pattern matching |\\n+ | Enterprise MITM tool detection | Y | Y | Zscaler, BlueCoat, etc. |\\n+ | Recently added CA flagging | Y | Partial | Windows has date metadata |\\n+ | **Phase 3: Target Analysis** ||||\\n+ | Local DNS resolution | Y | Y | `Resolve-DnsName` / `dig`/`host` |\\n+ | DoH resolution (control group) | Y | Y | dns.google/resolve |\\n+ | ASN lookup | Y | Y | ip-api.com |\\n+ | ASN integrity heuristics | Y | Y | Google-\u003eGoogle ASN, etc. |\\n+ | VPS provider detection | Y | Y | DigitalOcean, Linode, etc. |\\n+ | Certificate capture | Y | Y | TcpClient/SslStream / openssl |\\n+ | Certificate anomaly detection | Y | Y | Let\u0027s Encrypt on Google, etc. |\\n+ | **Phase 4: Traceroute Mapping** ||||\\n+ | Route tracing | Y | Y | `Test-NetConnection` / `traceroute` |\\n+ | Per-hop ASN lookup | Y | Y | Identifies suspicious routing |\\n+ | VPS hop alerting | Y | Y | Alerts on unexpected providers |\\n+ | **Phase 5: Client-Side Detection** ||||\\n+ | System proxy check | Y | Y | Registry / env vars |\\n+ | Environment proxy vars | Y | Y | HTTP_PROXY, HTTPS_PROXY, etc. |\\n+ | WinHTTP proxy | Y | - | Windows-specific |\\n+ | macOS scutil proxy | - | Y | macOS-specific |\\n+ | Hosts file analysis | Y | Y | Sensitive domain redirects |\\n+ | Browser extension audit | Y | Y | Chrome/Edge/Firefox |\\n+ | webRequest permission flagging | Y | - | Chrome/Edge manifest parsing |\\n+ | **Phase 6: Evidence Finalization** ||||\\n+ | Alert summary | Y | Y | `_RedFlags.txt` |\\n+ | File hashing | Y | Y | Chain of custody |\\n+ | JSON summary | Y | Y | `Summary.json` |\\n+ \\n+ ## Configuration File\\n+ \\n+ Both scripts use `mitm-audit.cfg` with identical KEY=VALUE format:\\n+ \\n+ ```\\n+ TARGETS=accounts.google.com,login.microsoftonline.com,appleid.apple.com,aws.amazon.com,github.com\\n+ DOH_ENDPOINT=https://dns.google/resolve\\n+ ASN_LOOKUP_URL=http://ip-api.com/json\\n+ SUSPICIOUS_ASN_PATTERNS=DigitalOcean,Linode,Vultr,Choopa,Datacamp,OVH,Hetzner\\n+ SUSPICIOUS_CERT_ISSUERS=Let\u0027s Encrypt,ZeroSSL,Self-Signed,localhost\\n+ TRACEROUTE_ENABLED=true\\n+ EXPORT_ROOT_CA=true\\n+ CHECK_PROXY_SETTINGS=true\\n+ CHECK_HOSTS_FILE=true\\n+ CHECK_ROOT_CA_ANOMALIES=true\\n+ ```\\n+ \\n+ ## Output Structure\\n+ \\n+ Both scripts produce identical evidence package structure:\\n+ \\n+ ```\\n+ ForensicEvidence_YYYYMMDD_HHMMSS/\\n+   _AuditLog.txt\\n+   _RedFlags.txt              \u003c-- CHECK THIS FIRST\\n+   _FileHashes.json           (PS) / _FileHashes.txt (sh)\\n+   Summary.json\\n+   environment/\\n+     NetworkConfig.json       (PS) / NetworkConfig.txt (sh)\\n+     ExternalIP.json\\n+     SystemInfo.json          (PS) / SystemInfo.txt (sh)\\n+   trust-store/\\n+     RootStore_Dump.csv       (Windows)\\n+     RootCA_Snapshot.crt      (Linux/macOS)\\n+     RootCA_Hash.json\\n+     SuspiciousCAs.json       (PS) / SuspiciousCAs.txt (sh)\\n+   targets/\\n+     accounts_google_com/\\n+       Analysis.json\\n+       Certificate.json       (PS) / Certificate.txt + .pem (sh)\\n+       dns.txt\\n+     ... (one per target)\\n+   traceroute/\\n+     Trace_*.txt\\n+     Trace_*.json\\n+   client-side/\\n+     ProxySettings.json       (PS) / ProxySettings.txt (sh)\\n+     HostsFile.json           (PS) / hosts_backup (sh)\\n+     BrowserExtensions.json   (PS) / BrowserExtensions.txt (sh)\\n+ ```\\n+ \\n+ ## Detection Logic\\n+ \\n+ ### ASN Integrity Checks\\n+ \\n+ Both scripts implement identical heuristics:\\n+ \\n+ | Domain Pattern | Expected ASN Pattern |\\n+ |----------------|---------------------|\\n+ | `*google*` | Google |\\n+ | `*microsoft*` | Microsoft |\\n+ | `*apple*` | Apple |\\n+ | `*aws*`, `*amazon*` | Amazon, AMAZON |\\n+ | `*github*` | GitHub, Microsoft |\\n+ \\n+ ### Suspicious Routing Detection\\n+ \\n+ Traffic to high-value authentication endpoints should NOT route through:\\n+ - DigitalOcean\\n+ - Linode\\n+ - Vultr\\n+ - Choopa\\n+ - Datacamp\\n+ - OVH\\n+ - Hetzner\\n+ \\n+ ### Certificate Anomalies\\n+ \\n+ Major tech companies should NOT use these issuers:\\n+ - Let\u0027s Encrypt (free DV certs)\\n+ - ZeroSSL\\n+ - Self-Signed\\n+ - localhost\\n+ \\n+ ## Client-Side Exploit Ruling Out\\n+ \\n+ To distinguish infrastructure MITM from client-side compromise, both scripts check:\\n+ \\n+ 1. **Proxy Settings**: System proxy, environment variables, WinHTTP\\n+ 2. **Hosts File**: Redirects of sensitive domains\\n+ 3. **Browser Extensions**: Extensions with `webRequest` permission or suspicious names\\n+ 4. **Root CA Store**: Recently added or suspiciously named certificates\\n+ \\n+ If client-side checks trigger alerts but target analysis does not, the issue is likely client-side.\\n+ \\n+ ## Usage\\n+ \\n+ ### Windows (PowerShell 7+)\\n+ \\n+ ```powershell\\n+ # Run as Administrator for complete data collection\\n+ .\\\\Invoke-MitmAudit-v7.ps1\\n+ \\n+ # With custom config\\n+ .\\\\Invoke-MitmAudit-v7.ps1 -ConfigFile .\\\\mitm-audit.cfg\\n+ \\n+ # Custom targets\\n+ .\\\\Invoke-MitmAudit-v7.ps1 -Targets \\\"accounts.google.com,github.com\\\"\\n+ \\n+ # Skip traceroute (faster)\\n+ .\\\\Invoke-MitmAudit-v7.ps1 -SkipTraceroute\\n+ \\n+ # Background execution (for agent automation)\\n+ .\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script MitmAudit -OutputPath .\\\\results\\n+ ```\\n+ \\n+ ### Linux/macOS (POSIX Shell)\\n+ \\n+ ```bash\\n+ # Run with elevated privileges for complete data\\n+ sudo ./mitm-audit.sh\\n+ \\n+ # With custom config\\n+ ./mitm-audit.sh -c ./mitm-audit.cfg\\n+ \\n+ # Custom targets\\n+ ./mitm-audit.sh -t \\\"accounts.google.com,github.com\\\"\\n+ \\n+ # Skip traceroute\\n+ ./mitm-audit.sh --skip-traceroute\\n+ \\n+ # Background execution\\n+ nohup ./mitm-audit.sh -o ./results \u003e audit.log 2\u003e\u00261 \u0026\\n+ ```\\n+ \\n+ ## Post-Audit Verification\\n+ \\n+ ### The \\\"Kill Shot\\\" - Certificate Serial Check\\n+ \\n+ 1. Open certificate files from `targets/*/Certificate.*`\\n+ 2. Copy the **Serial Number**\\n+ 3. Go to [crt.sh](https://crt.sh) on a **clean network/device**\\n+ 4. Search for the serial number\\n+ \\n+ **Results interpretation:**\\n+ - \\\"No certificates found\\\" = **100% MITM** by private root CA\\n+ - Certificate found for different domain = collision/hash attack\\n+ - Certificate matches = no certificate-based MITM detected\\n+ \\n+ ### Chain of Custody\\n+ \\n+ 1. Zip the entire evidence folder\\n+ 2. Hash the zip: `Get-FileHash evidence.zip -Algorithm SHA256`\\n+ 3. This zip + hash is your evidence package for security engineers, EFF, or legal\\n+ \\n+ ## License\\n+ \\n+ BSD-2-Clause\\n+ \\n+ Signed-off-by: Network Diagnostics Toolkit\\n+ \",\"oldStart\":1,\"newStart\":1,\"oldLines\":1,\"newLines\":207,\"linesRemoved\":1,\"linesAdded\":207}],\"editor\":\"EDITOR_AI\"},\"shouldAutoFixLints\":true,\"resultForModel\":\"Wrote contents to templates/network/MITM-AUDIT-RECONCILIATION.md.\",\"contentsAfterEdit\":\"# Infrastructure MITM Audit - Reconciliation Summary\\n\\n## Overview\\n\\nThe `Invoke-MitmAudit-v7.ps1` (PowerShell) and `mitm-audit.sh` (POSIX shell) scripts are reconciled implementations of the \\\"Gold Standard\\\" forensic network audit for detecting infrastructure-side Man-in-the-Middle attacks.\\n\\n## Feature Parity Matrix\\n\\n| Feature | PowerShell | POSIX Shell | Notes |\\n|---------|------------|-------------|-------|\\n| **Phase 1: Environment Snapshot** ||||\\n| Network configuration export | Y | Y | `Get-NetIPConfiguration` / `ip addr` |\\n| External IP identification | Y | Y | ipinfo.io JSON API |\\n| ISP validation | Y | Y | Configurable patterns |\\n| System information | Y | Y | Full system context |\\n| **Phase 2: Trust Store Export** ||||\\n| Root CA export | Y | Y | CSV (Windows) / PEM (Unix) |\\n| Root CA hashing | Y | Y | SHA256 for integrity |\\n| Suspicious CA detection | Y | Y | Pattern matching |\\n| Enterprise MITM tool detection | Y | Y | Zscaler, BlueCoat, etc. |\\n| Recently added CA flagging | Y | Partial | Windows has date metadata |\\n| **Phase 3: Target Analysis** ||||\\n| Local DNS resolution | Y | Y | `Resolve-DnsName` / `dig`/`host` |\\n| DoH resolution (control group) | Y | Y | dns.google/resolve |\\n| ASN lookup | Y | Y | ip-api.com |\\n| ASN integrity heuristics | Y | Y | Google-\u003eGoogle ASN, etc. |\\n| VPS provider detection | Y | Y | DigitalOcean, Linode, etc. |\\n| Certificate capture | Y | Y | TcpClient/SslStream / openssl |\\n| Certificate anomaly detection | Y | Y | Let\u0027s Encrypt on Google, etc. |\\n| **Phase 4: Traceroute Mapping** ||||\\n| Route tracing | Y | Y | `Test-NetConnection` / `traceroute` |\\n| Per-hop ASN lookup | Y | Y | Identifies suspicious routing |\\n| VPS hop alerting | Y | Y | Alerts on unexpected providers |\\n| **Phase 5: Client-Side Detection** ||||\\n| System proxy check | Y | Y | Registry / env vars |\\n| Environment proxy vars | Y | Y | HTTP_PROXY, HTTPS_PROXY, etc. |\\n| WinHTTP proxy | Y | - | Windows-specific |\\n| macOS scutil proxy | - | Y | macOS-specific |\\n| Hosts file analysis | Y | Y | Sensitive domain redirects |\\n| Browser extension audit | Y | Y | Chrome/Edge/Firefox |\\n| webRequest permission flagging | Y | - | Chrome/Edge manifest parsing |\\n| **Phase 6: Evidence Finalization** ||||\\n| Alert summary | Y | Y | `_RedFlags.txt` |\\n| File hashing | Y | Y | Chain of custody |\\n| JSON summary | Y | Y | `Summary.json` |\\n\\n## Configuration File\\n\\nBoth scripts use `mitm-audit.cfg` with identical KEY=VALUE format:\\n\\n```\\nTARGETS=accounts.google.com,login.microsoftonline.com,appleid.apple.com,aws.amazon.com,github.com\\nDOH_ENDPOINT=https://dns.google/resolve\\nASN_LOOKUP_URL=http://ip-api.com/json\\nSUSPICIOUS_ASN_PATTERNS=DigitalOcean,Linode,Vultr,Choopa,Datacamp,OVH,Hetzner\\nSUSPICIOUS_CERT_ISSUERS=Let\u0027s Encrypt,ZeroSSL,Self-Signed,localhost\\nTRACEROUTE_ENABLED=true\\nEXPORT_ROOT_CA=true\\nCHECK_PROXY_SETTINGS=true\\nCHECK_HOSTS_FILE=true\\nCHECK_ROOT_CA_ANOMALIES=true\\n```\\n\\n## Output Structure\\n\\nBoth scripts produce identical evidence package structure:\\n\\n```\\nForensicEvidence_YYYYMMDD_HHMMSS/\\n  _AuditLog.txt\\n  _RedFlags.txt              \u003c-- CHECK THIS FIRST\\n  _FileHashes.json           (PS) / _FileHashes.txt (sh)\\n  Summary.json\\n  environment/\\n    NetworkConfig.json       (PS) / NetworkConfig.txt (sh)\\n    ExternalIP.json\\n    SystemInfo.json          (PS) / SystemInfo.txt (sh)\\n  trust-store/\\n    RootStore_Dump.csv       (Windows)\\n    RootCA_Snapshot.crt      (Linux/macOS)\\n    RootCA_Hash.json\\n    SuspiciousCAs.json       (PS) / SuspiciousCAs.txt (sh)\\n  targets/\\n    accounts_google_com/\\n      Analysis.json\\n      Certificate.json       (PS) / Certificate.txt + .pem (sh)\\n      dns.txt\\n    ... (one per target)\\n  traceroute/\\n    Trace_*.txt\\n    Trace_*.json\\n  client-side/\\n    ProxySettings.json       (PS) / ProxySettings.txt (sh)\\n    HostsFile.json           (PS) / hosts_backup (sh)\\n    BrowserExtensions.json   (PS) / BrowserExtensions.txt (sh)\\n```\\n\\n## Detection Logic\\n\\n### ASN Integrity Checks\\n\\nBoth scripts implement identical heuristics:\\n\\n| Domain Pattern | Expected ASN Pattern |\\n|----------------|---------------------|\\n| `*google*` | Google |\\n| `*microsoft*` | Microsoft |\\n| `*apple*` | Apple |\\n| `*aws*`, `*amazon*` | Amazon, AMAZON |\\n| `*github*` | GitHub, Microsoft |\\n\\n### Suspicious Routing Detection\\n\\nTraffic to high-value authentication endpoints should NOT route through:\\n- DigitalOcean\\n- Linode\\n- Vultr\\n- Choopa\\n- Datacamp\\n- OVH\\n- Hetzner\\n\\n### Certificate Anomalies\\n\\nMajor tech companies should NOT use these issuers:\\n- Let\u0027s Encrypt (free DV certs)\\n- ZeroSSL\\n- Self-Signed\\n- localhost\\n\\n## Client-Side Exploit Ruling Out\\n\\nTo distinguish infrastructure MITM from client-side compromise, both scripts check:\\n\\n1. **Proxy Settings**: System proxy, environment variables, WinHTTP\\n2. **Hosts File**: Redirects of sensitive domains\\n3. **Browser Extensions**: Extensions with `webRequest` permission or suspicious names\\n4. **Root CA Store**: Recently added or suspiciously named certificates\\n\\nIf client-side checks trigger alerts but target analysis does not, the issue is likely client-side.\\n\\n## Usage\\n\\n### Windows (PowerShell 7+)\\n\\n```powershell\\n# Run as Administrator for complete data collection\\n.\\\\Invoke-MitmAudit-v7.ps1\\n\\n# With custom config\\n.\\\\Invoke-MitmAudit-v7.ps1 -ConfigFile .\\\\mitm-audit.cfg\\n\\n# Custom targets\\n.\\\\Invoke-MitmAudit-v7.ps1 -Targets \\\"accounts.google.com,github.com\\\"\\n\\n# Skip traceroute (faster)\\n.\\\\Invoke-MitmAudit-v7.ps1 -SkipTraceroute\\n\\n# Background execution (for agent automation)\\n.\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script MitmAudit -OutputPath .\\\\results\\n```\\n\\n### Linux/macOS (POSIX Shell)\\n\\n```bash\\n# Run with elevated privileges for complete data\\nsudo ./mitm-audit.sh\\n\\n# With custom config\\n./mitm-audit.sh -c ./mitm-audit.cfg\\n\\n# Custom targets\\n./mitm-audit.sh -t \\\"accounts.google.com,github.com\\\"\\n\\n# Skip traceroute\\n./mitm-audit.sh --skip-traceroute\\n\\n# Background execution\\nnohup ./mitm-audit.sh -o ./results \u003e audit.log 2\u003e\u00261 \u0026\\n```\\n\\n## Post-Audit Verification\\n\\n### The \\\"Kill Shot\\\" - Certificate Serial Check\\n\\n1. Open certificate files from `targets/*/Certificate.*`\\n2. Copy the **Serial Number**\\n3. Go to [crt.sh](https://crt.sh) on a **clean network/device**\\n4. Search for the serial number\\n\\n**Results interpretation:**\\n- \\\"No certificates found\\\" = **100% MITM** by private root CA\\n- Certificate found for different domain = collision/hash attack\\n- Certificate matches = no certificate-based MITM detected\\n\\n### Chain of Custody\\n\\n1. Zip the entire evidence folder\\n2. Hash the zip: `Get-FileHash evidence.zip -Algorithm SHA256`\\n3. This zip + hash is your evidence package for security engineers, EFF, or legal\\n\\n## License\\n\\nBSD-2-Clause\\n\\nSigned-off-by: Network Diagnostics Toolkit\\n\\n\"}"},"checkpointId":"15fdaeba-1cf5-41f5-b62d-c1d3ed882630"},"bubbleId":"ad140871-3d0b-4854-86f4-675f073ba432"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"b7319611-eb26-467a-9cd5-381d10403b0b","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:35:14.894Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","serverBubbleId":"dc69e08f-d037-4015-b231-251629dd09dd","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","capabilityType":30,"thinking":{"text":"Now let me create the PowerShell script. This is the \"Gold Standard\" reconciled version.","signature":"EoACCkYIChgCKkAwIk7va0O/30cWQVQj/aG7+c5+n4TvRS+D1kFCRAhIgWcUGR0qKaJGWqrS4lZg1xgA2tj8R6aV/BaRlHcc5Aq+EgyLrXDNkSmgjvwlm7saDMLA8PCJESwU3yHB8SIwoEr20pf8SoC56W50iIXnLe1Hj4FIusTZuaAVGK/yag3vkF+d80fZgO+/EL7Z2bLWKmgMZyTcIgEqOru5dJXksT30umI9e06F/RZ3zWmVBe2dJw+pjvdzlV+nHGvYzqNl4+BMA5S3PQwiG97W6PLqc21ZnIA0CPCcIDqlV+wjsIzX5qYMv2kkGmjweT3hIapbmbMks2AkvqjA+hgB"},"thinkingStyle":1,"thinkingDurationMs":761},"bubbleId":"b7319611-eb26-467a-9cd5-381d10403b0b"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"bd080593-4289-4e39-b321-0dca9ab00505","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:41:26.813Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"text":"","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","codeBlocks":[],"capabilityType":15,"toolFormerData":{"tool":39,"toolCallId":"toolu_016CD7NeJ2cybTypSiKW4mXD","toolIndex":1,"modelCallId":"fae1b5eb-8b19-46de-9e3c-8115b9679339","status":"completed","rawArgs":"{\"target_directory\": \"templates/network\"}","name":"list_dir","params":"{\"targetDirectory\":\"templates/network\",\"shouldEnrichTerminalMetadata\":true}","additionalData":{},"result":"{\"directoryTreeRoot\":{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\templates\\\\network\",\"childrenDirs\":[{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\templates\\\\network\\\\browser-forensics\",\"childrenDirs\":[{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\templates\\\\network\\\\browser-forensics\\\\chrome\",\"childrenFiles\":[{\"name\":\"full-capture.json\"}],\"childrenWereProcessed\":true,\"fullSubtreeExtensionCounts\":{\".json\":1},\"numFiles\":1}],\"childrenFiles\":[{\"name\":\"summary.json\"}],\"childrenWereProcessed\":true,\"fullSubtreeExtensionCounts\":{\".json\":2},\"numFiles\":2},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\templates\\\\network\\\\diagnostics-output\",\"childrenFiles\":[{\"name\":\"NetworkForensics-2025-12-01_20-12-11-status.json\"}],\"childrenWereProcessed\":true,\"fullSubtreeExtensionCounts\":{\".json\":1},\"numFiles\":1},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\templates\\\\network\\\\forensics\",\"childrenDirs\":[{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\templates\\\\network\\\\forensics\\\\dns\",\"childrenFiles\":[{\"name\":\"cache.json\"}],\"childrenWereProcessed\":true,\"fullSubtreeExtensionCounts\":{\".json\":1},\"numFiles\":1},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\templates\\\\network\\\\forensics\\\\network\",\"childrenFiles\":[{\"name\":\"arp-cache.json\"},{\"name\":\"connections.json\"},{\"name\":\"interfaces.json\"},{\"name\":\"listeners.json\"},{\"name\":\"routes.json\"}],\"childrenWereProcessed\":true,\"fullSubtreeExtensionCounts\":{\".json\":5},\"numFiles\":5},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\templates\\\\network\\\\forensics\\\\processes\",\"childrenFiles\":[{\"name\":\"network-processes.json\"}],\"childrenWereProcessed\":true,\"fullSubtreeExtensionCounts\":{\".json\":1},\"numFiles\":1},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\templates\\\\network\\\\forensics\\\\security\",\"childrenFiles\":[{\"name\":\"firewall.json\"}],\"childrenWereProcessed\":true,\"fullSubtreeExtensionCounts\":{\".json\":1},\"numFiles\":1}],\"childrenWereProcessed\":true,\"fullSubtreeExtensionCounts\":{\".json\":8},\"numFiles\":8},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\templates\\\\network\\\\oui-data\",\"childrenFiles\":[{\"name\":\"ieee-oui.csv\"},{\"name\":\"nmap-mac-prefixes.txt\"},{\"name\":\"oui-unified.json\"}],\"childrenWereProcessed\":true,\"fullSubtreeExtensionCounts\":{\".json\":1,\".txt\":1,\".csv\":1},\"numFiles\":3}],\"childrenFiles\":[{\"name\":\"dns-diagnostics.sh\"},{\"name\":\"Install-NetworkTools-v7.ps1\"},{\"name\":\"Invoke-BackgroundDiagnostics-v7.ps1\"},{\"name\":\"Invoke-BrowserForensics-v7.ps1\"},{\"name\":\"Invoke-DnsDiagnostics-v7.ps1\"},{\"name\":\"Invoke-MitmAudit-v7.ps1\"},{\"name\":\"Invoke-NetworkForensics-v7.ps1\"},{\"name\":\"Invoke-NetworkScan-v7.ps1\"},{\"name\":\"Invoke-PacketCapture-v7.ps1\"},{\"name\":\"mitm-audit.cfg\"},{\"name\":\"mitm-audit.sh\"},{\"name\":\"network-forensics.sh\"},{\"name\":\"network-scan.sh\"},{\"name\":\"network.cfg\"},{\"name\":\"packet-capture.sh\"},{\"name\":\"README.md\"},{\"name\":\"Update-OuiDatabase-v7.ps1\"}],\"childrenWereProcessed\":true,\"fullSubtreeExtensionCounts\":{\".ps1\":9,\".md\":1,\".sh\":5,\".json\":12,\".txt\":1,\".csv\":1,\".cfg\":2},\"numFiles\":31}}"}},"bubbleId":"bd080593-4289-4e39-b321-0dca9ab00505"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"bd66b802-0fe5-4063-8aa7-6e30afd12c27","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:41:15.380Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"text":"Let me make the shell script executable and verify the scripts work correctly:","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878"},"bubbleId":"bd66b802-0fe5-4063-8aa7-6e30afd12c27"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"bde072aa-cb0d-4c34-b8f0-f99f1d882e2e","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:40:01.220Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"text":"","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","codeBlocks":[{"uri":{"scheme":"file","authority":"","path":"/c:/Users/user/Downloads/Cursor_working_directory_misc/templates/network/README.md","query":"","fragment":"","_formatted":"file:///c%3A/Users/user/Downloads/Cursor_working_directory_misc/templates/network/README.md","_fsPath":null},"codeblockId":"8955c243-ad27-4d7e-8904-e0f865de3afb","codeBlockIdx":0,"content":"# Network Diagnostics Toolkit\n\nNetwork scanning, DNS diagnostics, forensics collection, and Infrastructure MITM detection tools.\n\n## Scripts\n\n| Script | Platform | Purpose |\n|--------|----------|---------|\n| `Invoke-NetworkScan-v7.ps1` | Windows (PS7) | TCP port scanner with service detection |\n| `Invoke-DnsDiagnostics-v7.ps1` | Windows (PS7) | DNS anomaly detection and consistency checks |\n| `Invoke-NetworkForensics-v7.ps1` | Windows (PS7) | Forensic data collection and analysis |\n| `Invoke-MitmAudit-v7.ps1` | Windows (PS7) | Infrastructure MITM detection with ASN/DoH/Cert analysis |\n| `Invoke-BackgroundDiagnostics-v7.ps1` | Windows (PS7) | Background wrapper for all diagnostics |\n| `network-scan.sh` | POSIX | TCP port scanner |\n| `dns-diagnostics.sh` | POSIX | DNS testing and anomaly detection |\n| `network-forensics.sh` | POSIX | Forensic data collection |\n| `mitm-audit.sh` | POSIX | Infrastructure MITM detection with ASN/DoH/Cert analysis |\n| `Invoke-PacketCapture-v7.ps1` | Windows (PS7) | Packet capture with pktmon (full detail, timestamps) |\n| `packet-capture.sh` | POSIX | Packet capture with tcpdump (full detail, timestamps) |\n\n## Configuration\n\nAll scripts use `network.cfg` with KEY=VALUE format:\n\n```\nTARGET_HOST=192.168.1.1\nTARGET_NETWORK=192.168.1.0/24\nSCAN_PORTS=21,22,23,25,53,80,443,445,3389,8080,8443\nDNS_SERVERS=1.1.1.1,8.8.8.8,9.9.9.9\nDNS_TEST_DOMAINS=api2.cursor.sh,github.com,google.com\nSCAN_TIMEOUT_MS=500\nOUTPUT_DIR=./network-diagnostics\n\n# Packet capture settings\nCAPTURE_SNAPLEN=0\nCAPTURE_MAX_SIZE_MB=512\nCAPTURE_ROTATE_COUNT=10\nCAPTURE_TIMESTAMP_PRECISION=nano\nCAPTURE_CONVERT_PCAPNG=true\n```\n\n## Usage Examples\n\n### Network Scanning\n\n```powershell\n# Windows - Scan single host\n.\\Invoke-NetworkScan-v7.ps1 -Target 192.168.1.1 -Ports \"22,80,443\"\n\n# Windows - Use config file\n.\\Invoke-NetworkScan-v7.ps1 -ConfigFile .\\network.cfg\n\n# Unix\n./network-scan.sh -t 192.168.1.1 -p \"22,80,443\"\n```\n\n### DNS Diagnostics\n\n```powershell\n# Windows - Test specific domain\n.\\Invoke-DnsDiagnostics-v7.ps1 -Domain api2.cursor.sh\n\n# Windows - Full diagnostics with config\n.\\Invoke-DnsDiagnostics-v7.ps1 -ConfigFile .\\network.cfg -OutputPath .\\results\n\n# Unix\n./dns-diagnostics.sh -d api2.cursor.sh -s \"1.1.1.1,8.8.8.8\"\n```\n\n### Network Forensics\n\n```powershell\n# Windows - Full collection\n.\\Invoke-NetworkForensics-v7.ps1 -OutputPath .\\forensics\n\n# Unix\n./network-forensics.sh -o ./forensics\n```\n\n### Background Execution (for Agent/Automation)\n\nFor scripts that may run indefinitely or timeout in agent sessions:\n\n```powershell\n# Windows - Run any diagnostic in background\n.\\Invoke-BackgroundDiagnostics-v7.ps1 -Script NetworkForensics -OutputPath .\\results\n.\\Invoke-BackgroundDiagnostics-v7.ps1 -Script DnsDiagnostics -WaitSeconds 30\n.\\Invoke-BackgroundDiagnostics-v7.ps1 -Script PacketCapture -ScriptArgs @{Duration=60}\n\n# Check status\nGet-Content .\\results\\*-status.json\n\n# Read output when complete\nGet-Content .\\results\\*-stdout.txt\n```\n\n```sh\n# Unix - Use nohup for background\nnohup ./network-forensics.sh -o ./results \u003e forensics.log 2\u003e\u00261 \u0026\n\n# Check later\ncat forensics.log\n```\n\n### Infrastructure MITM Audit\n\nDetects infrastructure-side Man-in-the-Middle attacks while ruling out client-side exploits. Uses `mitm-audit.cfg`.\n\n```powershell\n# Windows - Full MITM audit\n.\\Invoke-MitmAudit-v7.ps1\n\n# Windows - With custom config\n.\\Invoke-MitmAudit-v7.ps1 -ConfigFile .\\mitm-audit.cfg\n\n# Windows - Custom targets, skip traceroute\n.\\Invoke-MitmAudit-v7.ps1 -Targets \"accounts.google.com,github.com\" -SkipTraceroute\n\n# Unix\n./mitm-audit.sh\n\n# Unix - With options\n./mitm-audit.sh -c ./mitm-audit.cfg -t \"accounts.google.com,github.com\" --skip-traceroute\n```\n\n#### MITM Detection Capabilities\n\n- **ASN Integrity**: Verifies Google/Microsoft/Apple/Amazon/GitHub resolve to their ASNs\n- **DoH Comparison**: Compares local DNS to DNS-over-HTTPS (dns.google) as control group\n- **Certificate Analysis**: Captures TLS certs, detects anomalous issuers for major tech\n- **Root CA Audit**: Exports trust store, detects enterprise MITM tools and suspicious CAs\n- **Traceroute Mapping**: Identifies suspicious hops through VPS providers\n- **Client-Side Checks**: Proxy settings, browser extensions, hosts file tampering\n\n#### Evidence Processing\n\n1. Check `_RedFlags.txt` first - if empty, MITM may be passive/logging only\n2. Certificate Serial Check - copy serial to [crt.sh](https://crt.sh) on clean device:\n   - \"No certificates found\" = 100% MITM by private root CA\n   - Cert shown for different domain = collision/hash attack or mis-issuance\n3. Zip evidence folder, hash the zip for chain of custody\n\n#### Output Structure\n\n```\nForensicEvidence_YYYYMMDD_HHMMSS/\n  _AuditLog.txt          # Full audit log\n  _RedFlags.txt          # Immediate alerts (check this first)\n  _FileHashes.json       # SHA256 hashes for chain of custody\n  Summary.json           # Audit verdict and configuration\n  environment/\n    NetworkConfig.json   # IP/DNS configuration\n    ExternalIP.json      # External IP and ISP info\n    SystemInfo.json      # System identification\n  trust-store/\n    RootStore_Dump.csv   # All root CAs (Windows)\n    RootCA_Snapshot.crt  # CA bundle (Linux/macOS)\n    RootCA_Hash.json     # Hash of CA store\n    SuspiciousCAs.json   # Flagged certificates\n  targets/\n    accounts_google_com/\n      Analysis.json      # Full analysis results\n      Certificate.json   # TLS certificate details\n      dns.txt            # DNS resolution data\n    (... other targets ...)\n  traceroute/\n    Trace_*.txt          # Raw traceroute output\n    Trace_*.json         # Hops with ASN lookup\n  client-side/\n    ProxySettings.json   # System/environment proxy\n    HostsFile.json       # /etc/hosts analysis\n    BrowserExtensions.json # Installed extensions\n```\n\n### Packet Capture\n\n```powershell\n# Windows - Capture with pktmon (requires Admin)\n.\\Invoke-PacketCapture-v7.ps1 -Duration 60 -OutputPath .\\captures\n.\\Invoke-PacketCapture-v7.ps1 -Filter \"port 443\" -Duration 30 -ConvertToPcap\n\n# Unix - Capture with tcpdump (requires root/sudo)\n./packet-capture.sh -i eth0 -d 60 -o ./captures\n./packet-capture.sh -f \"port 443 or port 80\" -d 30\n./packet-capture.sh -i any -f \"host 192.168.1.1\" -d 120\n```\n\n#### Capture Options\n\n**Windows (pktmon):**\n- Full packet capture (no truncation)\n- All network components\n- ETL format with optional PCAPNG conversion\n- Timestamp precision to nanoseconds\n\n**Unix (tcpdump):**\n- `-XX` Hex and ASCII dump\n- `-vvv` Maximum verbosity\n- `-tttt` Human-readable timestamps with date\n- `-S` Absolute sequence numbers\n- `--time-stamp-precision=nano` Nanosecond precision (if supported)\n- File rotation support\n\n## Detection Capabilities\n\n### DNS Diagnostics\n\n- DNS hijacking (fake IPs like 0.0.0.x)\n- LLMNR/NetBIOS poisoning (.lan/.local suffixes)\n- DNS response inconsistencies across servers\n- Temporary resolution failures (EAI_AGAIN)\n\n### Network Forensics\n\n- ARP spoofing (duplicate MAC addresses)\n- Suspicious listening ports\n- Malware C2 ports (4444, 5555, 31337, etc.)\n- Hosts file tampering\n- Firewall state analysis\n- Promiscuous mode detection\n\n## Output Format\n\nAll tools output JSON files for programmatic analysis:\n\n```\n./network-diagnostics/\n  scan-2025-12-01_15-00-00.json\n  dns-diagnostics-2025-12-01_15-00-00.json\n\n./network-forensics/\n  summary.json\n  network/\n    connections.json\n    interfaces.json\n    arp-cache.json\n    routes.json\n    listeners.json\n  dns/\n    cache.json\n    hosts-file.json\n  security/\n    firewall.json\n  processes/\n    network-processes.json\n```\n\n## Requirements\n\n### Windows\n\n- PowerShell 7+\n- Administrator privileges recommended for full data collection\n\n### Unix/Linux/macOS\n\n- POSIX-compliant shell\n- One of: dig, nslookup, or host (for DNS)\n- One of: nc (netcat), or bash with /dev/tcp support (for scanning)\n- tcpdump for packet capture\n- root/sudo for packet capture and full forensics collection\n\n## License\n\nBSD-2-Clause\n\n## Signed-off-by\n\nNetwork Diagnostics Toolkit\n\n","languageId":"markdown"}],"capabilityType":15,"toolFormerData":{"tool":38,"toolCallId":"toolu_01VXScX9eHcYaus6VKBQHoCC","toolIndex":1,"modelCallId":"727963cf-35db-4be6-9371-257d7e1f71bc","status":"completed","rawArgs":"{\"file_path\": \"templates/network/README.md\", \"old_string\": \"### Packet Capture\\n\\n```powershell\\n# Windows - Capture with pktmon (requires Admin)\\n.\\\\Invoke-PacketCapture-v7.ps1 -Duration 60 -OutputPath .\\\\captures\\n.\\\\Invoke-PacketCapture-v7.ps1 -Filter \\\"port 443\\\" -Duration 30 -ConvertToPcap\\n\\n# Unix - Capture with tcpdump (requires root/sudo)\\n./packet-capture.sh -i eth0 -d 60 -o ./captures\\n./packet-capture.sh -f \\\"port 443 or port 80\\\" -d 30\\n./packet-capture.sh -i any -f \\\"host 192.168.1.1\\\" -d 120\\n```\", \"new_string\": \"### Infrastructure MITM Audit\\n\\nDetects infrastructure-side Man-in-the-Middle attacks while ruling out client-side exploits. Uses `mitm-audit.cfg`.\\n\\n```powershell\\n# Windows - Full MITM audit\\n.\\\\Invoke-MitmAudit-v7.ps1\\n\\n# Windows - With custom config\\n.\\\\Invoke-MitmAudit-v7.ps1 -ConfigFile .\\\\mitm-audit.cfg\\n\\n# Windows - Custom targets, skip traceroute\\n.\\\\Invoke-MitmAudit-v7.ps1 -Targets \\\"accounts.google.com,github.com\\\" -SkipTraceroute\\n\\n# Unix\\n./mitm-audit.sh\\n\\n# Unix - With options\\n./mitm-audit.sh -c ./mitm-audit.cfg -t \\\"accounts.google.com,github.com\\\" --skip-traceroute\\n```\\n\\n#### MITM Detection Capabilities\\n\\n- **ASN Integrity**: Verifies Google/Microsoft/Apple/Amazon/GitHub resolve to their ASNs\\n- **DoH Comparison**: Compares local DNS to DNS-over-HTTPS (dns.google) as control group\\n- **Certificate Analysis**: Captures TLS certs, detects anomalous issuers for major tech\\n- **Root CA Audit**: Exports trust store, detects enterprise MITM tools and suspicious CAs\\n- **Traceroute Mapping**: Identifies suspicious hops through VPS providers\\n- **Client-Side Checks**: Proxy settings, browser extensions, hosts file tampering\\n\\n#### Evidence Processing\\n\\n1. Check `_RedFlags.txt` first - if empty, MITM may be passive/logging only\\n2. Certificate Serial Check - copy serial to [crt.sh](https://crt.sh) on clean device:\\n   - \\\"No certificates found\\\" = 100% MITM by private root CA\\n   - Cert shown for different domain = collision/hash attack or mis-issuance\\n3. Zip evidence folder, hash the zip for chain of custody\\n\\n#### Output Structure\\n\\n```\\nForensicEvidence_YYYYMMDD_HHMMSS/\\n  _AuditLog.txt          # Full audit log\\n  _RedFlags.txt          # Immediate alerts (check this first)\\n  _FileHashes.json       # SHA256 hashes for chain of custody\\n  Summary.json           # Audit verdict and configuration\\n  environment/\\n    NetworkConfig.json   # IP/DNS configuration\\n    ExternalIP.json      # External IP and ISP info\\n    SystemInfo.json      # System identification\\n  trust-store/\\n    RootStore_Dump.csv   # All root CAs (Windows)\\n    RootCA_Snapshot.crt  # CA bundle (Linux/macOS)\\n    RootCA_Hash.json     # Hash of CA store\\n    SuspiciousCAs.json   # Flagged certificates\\n  targets/\\n    accounts_google_com/\\n      Analysis.json      # Full analysis results\\n      Certificate.json   # TLS certificate details\\n      dns.txt            # DNS resolution data\\n    (... other targets ...)\\n  traceroute/\\n    Trace_*.txt          # Raw traceroute output\\n    Trace_*.json         # Hops with ASN lookup\\n  client-side/\\n    ProxySettings.json   # System/environment proxy\\n    HostsFile.json       # /etc/hosts analysis\\n    BrowserExtensions.json # Installed extensions\\n```\\n\\n### Packet Capture\\n\\n```powershell\\n# Windows - Capture with pktmon (requires Admin)\\n.\\\\Invoke-PacketCapture-v7.ps1 -Duration 60 -OutputPath .\\\\captures\\n.\\\\Invoke-PacketCapture-v7.ps1 -Filter \\\"port 443\\\" -Duration 30 -ConvertToPcap\\n\\n# Unix - Capture with tcpdump (requires root/sudo)\\n./packet-capture.sh -i eth0 -d 60 -o ./captures\\n./packet-capture.sh -f \\\"port 443 or port 80\\\" -d 30\\n./packet-capture.sh -i any -f \\\"host 192.168.1.1\\\" -d 120\\n```\"}","name":"search_replace","params":"{\"relativeWorkspacePath\":\"templates/network/README.md\"}","additionalData":{"codeblockId":"8955c243-ad27-4d7e-8904-e0f865de3afb","reviewData":{"status":"None","selectedOption":"accept","isShowingInput":false,"firstTimeReviewMode":false}},"userDecision":"accepted","result":"{\"diff\":{\"chunks\":[{\"diffString\":\"  cat forensics.log\\n  ```\\n+ \\n+ ### Infrastructure MITM Audit\\n+ \\n+ Detects infrastructure-side Man-in-the-Middle attacks while ruling out client-side exploits. Uses `mitm-audit.cfg`.\\n+ \\n+ ```powershell\\n+ # Windows - Full MITM audit\\n+ .\\\\Invoke-MitmAudit-v7.ps1\\n+ \\n+ # Windows - With custom config\\n+ .\\\\Invoke-MitmAudit-v7.ps1 -ConfigFile .\\\\mitm-audit.cfg\\n+ \\n+ # Windows - Custom targets, skip traceroute\\n+ .\\\\Invoke-MitmAudit-v7.ps1 -Targets \\\"accounts.google.com,github.com\\\" -SkipTraceroute\\n+ \\n+ # Unix\\n+ ./mitm-audit.sh\\n+ \\n+ # Unix - With options\\n+ ./mitm-audit.sh -c ./mitm-audit.cfg -t \\\"accounts.google.com,github.com\\\" --skip-traceroute\\n+ ```\\n+ \\n+ #### MITM Detection Capabilities\\n+ \\n+ - **ASN Integrity**: Verifies Google/Microsoft/Apple/Amazon/GitHub resolve to their ASNs\\n+ - **DoH Comparison**: Compares local DNS to DNS-over-HTTPS (dns.google) as control group\\n+ - **Certificate Analysis**: Captures TLS certs, detects anomalous issuers for major tech\\n+ - **Root CA Audit**: Exports trust store, detects enterprise MITM tools and suspicious CAs\\n+ - **Traceroute Mapping**: Identifies suspicious hops through VPS providers\\n+ - **Client-Side Checks**: Proxy settings, browser extensions, hosts file tampering\\n+ \\n+ #### Evidence Processing\\n+ \\n+ 1. Check `_RedFlags.txt` first - if empty, MITM may be passive/logging only\\n+ 2. Certificate Serial Check - copy serial to [crt.sh](https://crt.sh) on clean device:\\n+    - \\\"No certificates found\\\" = 100% MITM by private root CA\\n+    - Cert shown for different domain = collision/hash attack or mis-issuance\\n+ 3. Zip evidence folder, hash the zip for chain of custody\\n+ \\n+ #### Output Structure\\n+ \\n+ ```\\n+ ForensicEvidence_YYYYMMDD_HHMMSS/\\n+   _AuditLog.txt          # Full audit log\\n+   _RedFlags.txt          # Immediate alerts (check this first)\\n+   _FileHashes.json       # SHA256 hashes for chain of custody\\n+   Summary.json           # Audit verdict and configuration\\n+   environment/\\n+     NetworkConfig.json   # IP/DNS configuration\\n+     ExternalIP.json      # External IP and ISP info\\n+     SystemInfo.json      # System identification\\n+   trust-store/\\n+     RootStore_Dump.csv   # All root CAs (Windows)\\n+     RootCA_Snapshot.crt  # CA bundle (Linux/macOS)\\n+     RootCA_Hash.json     # Hash of CA store\\n+     SuspiciousCAs.json   # Flagged certificates\\n+   targets/\\n+     accounts_google_com/\\n+       Analysis.json      # Full analysis results\\n+       Certificate.json   # TLS certificate details\\n+       dns.txt            # DNS resolution data\\n+     (... other targets ...)\\n+   traceroute/\\n+     Trace_*.txt          # Raw traceroute output\\n+     Trace_*.json         # Hops with ASN lookup\\n+   client-side/\\n+     ProxySettings.json   # System/environment proxy\\n+     HostsFile.json       # /etc/hosts analysis\\n+     BrowserExtensions.json # Installed extensions\\n+ ```\\n  \\n  ### Packet Capture\",\"oldStart\":102,\"newStart\":102,\"oldLines\":4,\"newLines\":74,\"linesAdded\":70}],\"editor\":\"EDITOR_AI\"},\"shouldAutoFixLints\":true,\"resultForModel\":\"The file templates/network/README.md has been updated.\",\"contentsAfterEdit\":\"# Network Diagnostics Toolkit\\n\\nNetwork scanning, DNS diagnostics, forensics collection, and Infrastructure MITM detection tools.\\n\\n## Scripts\\n\\n| Script | Platform | Purpose |\\n|--------|----------|---------|\\n| `Invoke-NetworkScan-v7.ps1` | Windows (PS7) | TCP port scanner with service detection |\\n| `Invoke-DnsDiagnostics-v7.ps1` | Windows (PS7) | DNS anomaly detection and consistency checks |\\n| `Invoke-NetworkForensics-v7.ps1` | Windows (PS7) | Forensic data collection and analysis |\\n| `Invoke-MitmAudit-v7.ps1` | Windows (PS7) | Infrastructure MITM detection with ASN/DoH/Cert analysis |\\n| `Invoke-BackgroundDiagnostics-v7.ps1` | Windows (PS7) | Background wrapper for all diagnostics |\\n| `network-scan.sh` | POSIX | TCP port scanner |\\n| `dns-diagnostics.sh` | POSIX | DNS testing and anomaly detection |\\n| `network-forensics.sh` | POSIX | Forensic data collection |\\n| `mitm-audit.sh` | POSIX | Infrastructure MITM detection with ASN/DoH/Cert analysis |\\n| `Invoke-PacketCapture-v7.ps1` | Windows (PS7) | Packet capture with pktmon (full detail, timestamps) |\\n| `packet-capture.sh` | POSIX | Packet capture with tcpdump (full detail, timestamps) |\\n\\n## Configuration\\n\\nAll scripts use `network.cfg` with KEY=VALUE format:\\n\\n```\\nTARGET_HOST=192.168.1.1\\nTARGET_NETWORK=192.168.1.0/24\\nSCAN_PORTS=21,22,23,25,53,80,443,445,3389,8080,8443\\nDNS_SERVERS=1.1.1.1,8.8.8.8,9.9.9.9\\nDNS_TEST_DOMAINS=api2.cursor.sh,github.com,google.com\\nSCAN_TIMEOUT_MS=500\\nOUTPUT_DIR=./network-diagnostics\\n\\n# Packet capture settings\\nCAPTURE_SNAPLEN=0\\nCAPTURE_MAX_SIZE_MB=512\\nCAPTURE_ROTATE_COUNT=10\\nCAPTURE_TIMESTAMP_PRECISION=nano\\nCAPTURE_CONVERT_PCAPNG=true\\n```\\n\\n## Usage Examples\\n\\n### Network Scanning\\n\\n```powershell\\n# Windows - Scan single host\\n.\\\\Invoke-NetworkScan-v7.ps1 -Target 192.168.1.1 -Ports \\\"22,80,443\\\"\\n\\n# Windows - Use config file\\n.\\\\Invoke-NetworkScan-v7.ps1 -ConfigFile .\\\\network.cfg\\n\\n# Unix\\n./network-scan.sh -t 192.168.1.1 -p \\\"22,80,443\\\"\\n```\\n\\n### DNS Diagnostics\\n\\n```powershell\\n# Windows - Test specific domain\\n.\\\\Invoke-DnsDiagnostics-v7.ps1 -Domain api2.cursor.sh\\n\\n# Windows - Full diagnostics with config\\n.\\\\Invoke-DnsDiagnostics-v7.ps1 -ConfigFile .\\\\network.cfg -OutputPath .\\\\results\\n\\n# Unix\\n./dns-diagnostics.sh -d api2.cursor.sh -s \\\"1.1.1.1,8.8.8.8\\\"\\n```\\n\\n### Network Forensics\\n\\n```powershell\\n# Windows - Full collection\\n.\\\\Invoke-NetworkForensics-v7.ps1 -OutputPath .\\\\forensics\\n\\n# Unix\\n./network-forensics.sh -o ./forensics\\n```\\n\\n### Background Execution (for Agent/Automation)\\n\\nFor scripts that may run indefinitely or timeout in agent sessions:\\n\\n```powershell\\n# Windows - Run any diagnostic in background\\n.\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script NetworkForensics -OutputPath .\\\\results\\n.\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script DnsDiagnostics -WaitSeconds 30\\n.\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script PacketCapture -ScriptArgs @{Duration=60}\\n\\n# Check status\\nGet-Content .\\\\results\\\\*-status.json\\n\\n# Read output when complete\\nGet-Content .\\\\results\\\\*-stdout.txt\\n```\\n\\n```sh\\n# Unix - Use nohup for background\\nnohup ./network-forensics.sh -o ./results \u003e forensics.log 2\u003e\u00261 \u0026\\n\\n# Check later\\ncat forensics.log\\n```\\n\\n### Infrastructure MITM Audit\\n\\nDetects infrastructure-side Man-in-the-Middle attacks while ruling out client-side exploits. Uses `mitm-audit.cfg`.\\n\\n```powershell\\n# Windows - Full MITM audit\\n.\\\\Invoke-MitmAudit-v7.ps1\\n\\n# Windows - With custom config\\n.\\\\Invoke-MitmAudit-v7.ps1 -ConfigFile .\\\\mitm-audit.cfg\\n\\n# Windows - Custom targets, skip traceroute\\n.\\\\Invoke-MitmAudit-v7.ps1 -Targets \\\"accounts.google.com,github.com\\\" -SkipTraceroute\\n\\n# Unix\\n./mitm-audit.sh\\n\\n# Unix - With options\\n./mitm-audit.sh -c ./mitm-audit.cfg -t \\\"accounts.google.com,github.com\\\" --skip-traceroute\\n```\\n\\n#### MITM Detection Capabilities\\n\\n- **ASN Integrity**: Verifies Google/Microsoft/Apple/Amazon/GitHub resolve to their ASNs\\n- **DoH Comparison**: Compares local DNS to DNS-over-HTTPS (dns.google) as control group\\n- **Certificate Analysis**: Captures TLS certs, detects anomalous issuers for major tech\\n- **Root CA Audit**: Exports trust store, detects enterprise MITM tools and suspicious CAs\\n- **Traceroute Mapping**: Identifies suspicious hops through VPS providers\\n- **Client-Side Checks**: Proxy settings, browser extensions, hosts file tampering\\n\\n#### Evidence Processing\\n\\n1. Check `_RedFlags.txt` first - if empty, MITM may be passive/logging only\\n2. Certificate Serial Check - copy serial to [crt.sh](https://crt.sh) on clean device:\\n   - \\\"No certificates found\\\" = 100% MITM by private root CA\\n   - Cert shown for different domain = collision/hash attack or mis-issuance\\n3. Zip evidence folder, hash the zip for chain of custody\\n\\n#### Output Structure\\n\\n```\\nForensicEvidence_YYYYMMDD_HHMMSS/\\n  _AuditLog.txt          # Full audit log\\n  _RedFlags.txt          # Immediate alerts (check this first)\\n  _FileHashes.json       # SHA256 hashes for chain of custody\\n  Summary.json           # Audit verdict and configuration\\n  environment/\\n    NetworkConfig.json   # IP/DNS configuration\\n    ExternalIP.json      # External IP and ISP info\\n    SystemInfo.json      # System identification\\n  trust-store/\\n    RootStore_Dump.csv   # All root CAs (Windows)\\n    RootCA_Snapshot.crt  # CA bundle (Linux/macOS)\\n    RootCA_Hash.json     # Hash of CA store\\n    SuspiciousCAs.json   # Flagged certificates\\n  targets/\\n    accounts_google_com/\\n      Analysis.json      # Full analysis results\\n      Certificate.json   # TLS certificate details\\n      dns.txt            # DNS resolution data\\n    (... other targets ...)\\n  traceroute/\\n    Trace_*.txt          # Raw traceroute output\\n    Trace_*.json         # Hops with ASN lookup\\n  client-side/\\n    ProxySettings.json   # System/environment proxy\\n    HostsFile.json       # /etc/hosts analysis\\n    BrowserExtensions.json # Installed extensions\\n```\\n\\n### Packet Capture\\n\\n```powershell\\n# Windows - Capture with pktmon (requires Admin)\\n.\\\\Invoke-PacketCapture-v7.ps1 -Duration 60 -OutputPath .\\\\captures\\n.\\\\Invoke-PacketCapture-v7.ps1 -Filter \\\"port 443\\\" -Duration 30 -ConvertToPcap\\n\\n# Unix - Capture with tcpdump (requires root/sudo)\\n./packet-capture.sh -i eth0 -d 60 -o ./captures\\n./packet-capture.sh -f \\\"port 443 or port 80\\\" -d 30\\n./packet-capture.sh -i any -f \\\"host 192.168.1.1\\\" -d 120\\n```\\n\\n#### Capture Options\\n\\n**Windows (pktmon):**\\n- Full packet capture (no truncation)\\n- All network components\\n- ETL format with optional PCAPNG conversion\\n- Timestamp precision to nanoseconds\\n\\n**Unix (tcpdump):**\\n- `-XX` Hex and ASCII dump\\n- `-vvv` Maximum verbosity\\n- `-tttt` Human-readable timestamps with date\\n- `-S` Absolute sequence numbers\\n- `--time-stamp-precision=nano` Nanosecond precision (if supported)\\n- File rotation support\\n\\n## Detection Capabilities\\n\\n### DNS Diagnostics\\n\\n- DNS hijacking (fake IPs like 0.0.0.x)\\n- LLMNR/NetBIOS poisoning (.lan/.local suffixes)\\n- DNS response inconsistencies across servers\\n- Temporary resolution failures (EAI_AGAIN)\\n\\n### Network Forensics\\n\\n- ARP spoofing (duplicate MAC addresses)\\n- Suspicious listening ports\\n- Malware C2 ports (4444, 5555, 31337, etc.)\\n- Hosts file tampering\\n- Firewall state analysis\\n- Promiscuous mode detection\\n\\n## Output Format\\n\\nAll tools output JSON files for programmatic analysis:\\n\\n```\\n./network-diagnostics/\\n  scan-2025-12-01_15-00-00.json\\n  dns-diagnostics-2025-12-01_15-00-00.json\\n\\n./network-forensics/\\n  summary.json\\n  network/\\n    connections.json\\n    interfaces.json\\n    arp-cache.json\\n    routes.json\\n    listeners.json\\n  dns/\\n    cache.json\\n    hosts-file.json\\n  security/\\n    firewall.json\\n  processes/\\n    network-processes.json\\n```\\n\\n## Requirements\\n\\n### Windows\\n\\n- PowerShell 7+\\n- Administrator privileges recommended for full data collection\\n\\n### Unix/Linux/macOS\\n\\n- POSIX-compliant shell\\n- One of: dig, nslookup, or host (for DNS)\\n- One of: nc (netcat), or bash with /dev/tcp support (for scanning)\\n- tcpdump for packet capture\\n- root/sudo for packet capture and full forensics collection\\n\\n## License\\n\\nBSD-2-Clause\\n\\n## Signed-off-by\\n\\nNetwork Diagnostics Toolkit\\n\\n\"}"},"checkpointId":"27b2eb4d-bf7f-4bbb-b6cb-35ccaeb148f1"},"bubbleId":"bde072aa-cb0d-4c34-b8f0-f99f1d882e2e"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"c399c050-446d-4212-8311-9747610bc3b5","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:34:48.938Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","capabilityType":15,"toolFormerData":{"tool":40,"toolCallId":"toolu_01X6diAMs1a6JLimcKDZPjyJ","toolIndex":2,"modelCallId":"15279199-0e5d-402b-bfdd-6e6fff2a3bbf","status":"completed","rawArgs":"{\"target_file\": \"templates/network/network-forensics.sh\"}","name":"read_file","params":"{\"targetFile\":\"templates/network/network-forensics.sh\",\"charsLimit\":100000,\"effectiveUri\":\"file:///c%3A/Users/user/Downloads/Cursor_working_directory_misc/templates/network/network-forensics.sh\"}","additionalData":{},"result":"{\"contents\":\"#!/bin/sh\\n# Network Forensics Collection - POSIX Shell\\n# License: BSD-2-Clause\\n# Signed-off-by: Network Diagnostics Toolkit\\n\\nset -e\\n\\n#######################################\\n# Configuration\\n#######################################\\nOUTPUT_DIR=\\\"./network-forensics\\\"\\nFULL_COLLECTION=0\\n\\n#######################################\\n# Usage\\n#######################################\\nusage() {\\n    cat \u003c\u003c \u0027EOF\u0027\\nUsage: network-forensics.sh [OPTIONS]\\n\\nCollect network forensics data for analysis.\\n\\nOptions:\\n    -o, --output DIR    Output directory (default: ./network-forensics)\\n    -f, --full          Full collection including logs\\n    -h, --help          Show this help\\n\\nExamples:\\n    ./network-forensics.sh -o ./forensics\\n    ./network-forensics.sh --full\\nEOF\\n    exit 0\\n}\\n\\n#######################################\\n# Parse arguments\\n#######################################\\nwhile [ $# -gt 0 ]; do\\n    case \\\"$1\\\" in\\n        -o|--output)\\n            OUTPUT_DIR=\\\"$2\\\"\\n            shift 2\\n            ;;\\n        -f|--full)\\n            FULL_COLLECTION=1\\n            shift\\n            ;;\\n        -h|--help)\\n            usage\\n            ;;\\n        *)\\n            echo \\\"Unknown option: $1\\\" \u003e\u00262\\n            usage\\n            ;;\\n    esac\\ndone\\n\\n#######################################\\n# Utility functions\\n#######################################\\nprint_section() {\\n    echo \\\"\\\"\\n    echo \\\"============================================================\\\"\\n    echo \\\" $1\\\"\\n    echo \\\"============================================================\\\"\\n}\\n\\nprint_subsection() {\\n    echo \\\"\\\"\\n    echo \\\"[*] $1\\\"\\n    echo \\\"------------------------------------------------------------\\\"\\n}\\n\\nsave_data() {\\n    category=\\\"$1\\\"\\n    name=\\\"$2\\\"\\n    \\n    category_dir=\\\"$OUTPUT_DIR/$category\\\"\\n    mkdir -p \\\"$category_dir\\\"\\n    \\n    cat \u003e \\\"$category_dir/$name.txt\\\"\\n}\\n\\n#######################################\\n# Collection functions\\n#######################################\\ncollect_network_interfaces() {\\n    print_subsection \\\"Network Interfaces\\\"\\n    \\n    if command -v ip \u003e/dev/null 2\u003e\u00261; then\\n        ip addr show\\n    elif command -v ifconfig \u003e/dev/null 2\u003e\u00261; then\\n        ifconfig -a\\n    else\\n        echo \\\"No interface command available\\\"\\n    fi\\n}\\n\\ncollect_connections() {\\n    print_subsection \\\"Active Connections\\\"\\n    \\n    if command -v ss \u003e/dev/null 2\u003e\u00261; then\\n        echo \\\"=== Listening Ports ===\\\"\\n        ss -tlnp 2\u003e/dev/null || ss -tln\\n        echo \\\"\\\"\\n        echo \\\"=== Established Connections ===\\\"\\n        ss -tnp 2\u003e/dev/null || ss -tn\\n    elif command -v netstat \u003e/dev/null 2\u003e\u00261; then\\n        echo \\\"=== All Connections ===\\\"\\n        netstat -an 2\u003e/dev/null\\n    else\\n        echo \\\"No connection command available\\\"\\n    fi\\n}\\n\\ncollect_routing() {\\n    print_subsection \\\"Routing Table\\\"\\n    \\n    if command -v ip \u003e/dev/null 2\u003e\u00261; then\\n        ip route show\\n    elif command -v netstat \u003e/dev/null 2\u003e\u00261; then\\n        netstat -rn\\n    elif command -v route \u003e/dev/null 2\u003e\u00261; then\\n        route -n\\n    else\\n        echo \\\"No routing command available\\\"\\n    fi\\n}\\n\\ncollect_arp() {\\n    print_subsection \\\"ARP Cache\\\"\\n    \\n    if command -v ip \u003e/dev/null 2\u003e\u00261; then\\n        ip neigh show\\n    elif command -v arp \u003e/dev/null 2\u003e\u00261; then\\n        arp -an\\n    else\\n        echo \\\"No ARP command available\\\"\\n    fi\\n    \\n    # Check for potential ARP spoofing\\n    echo \\\"\\\"\\n    echo \\\"=== ARP Spoofing Check ===\\\"\\n    if command -v ip \u003e/dev/null 2\u003e\u00261; then\\n        duplicates=$(ip neigh show | grep -v FAILED | awk \u0027{print $5}\u0027 | sort | uniq -d)\\n        if [ -n \\\"$duplicates\\\" ]; then\\n            echo \\\"[!] WARNING: Duplicate MAC addresses detected (possible ARP spoofing):\\\"\\n            echo \\\"$duplicates\\\"\\n        else\\n            echo \\\"No duplicate MAC addresses found\\\"\\n        fi\\n    fi\\n}\\n\\ncollect_dns() {\\n    print_subsection \\\"DNS Configuration\\\"\\n    \\n    echo \\\"=== /etc/resolv.conf ===\\\"\\n    if [ -f /etc/resolv.conf ]; then\\n        cat /etc/resolv.conf\\n    else\\n        echo \\\"Not found\\\"\\n    fi\\n    \\n    echo \\\"\\\"\\n    echo \\\"=== /etc/hosts ===\\\"\\n    if [ -f /etc/hosts ]; then\\n        grep -v \\\"^#\\\" /etc/hosts | grep -v \\\"^$\\\"\\n    fi\\n    \\n    # Check for suspicious host entries\\n    echo \\\"\\\"\\n    echo \\\"=== Suspicious Hosts Check ===\\\"\\n    suspicious=$(grep -iE \\\"(google|microsoft|apple|github|cursor)\\\" /etc/hosts 2\u003e/dev/null | grep -v \\\"^#\\\" | grep -v \\\"127.0.0.1\\\" | grep -v \\\"::1\\\" || true)\\n    if [ -n \\\"$suspicious\\\" ]; then\\n        echo \\\"[!] WARNING: Potential DNS hijacking in /etc/hosts:\\\"\\n        echo \\\"$suspicious\\\"\\n    else\\n        echo \\\"No suspicious entries found\\\"\\n    fi\\n}\\n\\ncollect_processes() {\\n    print_subsection \\\"Network Processes\\\"\\n    \\n    if command -v lsof \u003e/dev/null 2\u003e\u00261; then\\n        lsof -i -n -P 2\u003e/dev/null | head -50\\n    elif command -v ss \u003e/dev/null 2\u003e\u00261; then\\n        ss -tlnp 2\u003e/dev/null\\n    else\\n        echo \\\"Limited process information available\\\"\\n        ps aux | grep -E \\\"(ssh|http|ftp|smtp|dns)\\\" | grep -v grep\\n    fi\\n}\\n\\ncollect_firewall() {\\n    print_subsection \\\"Firewall Rules\\\"\\n    \\n    # Linux iptables\\n    if command -v iptables \u003e/dev/null 2\u003e\u00261; then\\n        echo \\\"=== iptables ===\\\"\\n        iptables -L -n 2\u003e/dev/null || echo \\\"Requires root\\\"\\n    fi\\n    \\n    # Linux nftables\\n    if command -v nft \u003e/dev/null 2\u003e\u00261; then\\n        echo \\\"\\\"\\n        echo \\\"=== nftables ===\\\"\\n        nft list ruleset 2\u003e/dev/null || echo \\\"Requires root\\\"\\n    fi\\n    \\n    # macOS pf\\n    if command -v pfctl \u003e/dev/null 2\u003e\u00261; then\\n        echo \\\"=== pf (macOS) ===\\\"\\n        pfctl -sr 2\u003e/dev/null || echo \\\"Requires root\\\"\\n    fi\\n    \\n    # ufw\\n    if command -v ufw \u003e/dev/null 2\u003e\u00261; then\\n        echo \\\"\\\"\\n        echo \\\"=== UFW ===\\\"\\n        ufw status 2\u003e/dev/null || echo \\\"Requires root\\\"\\n    fi\\n}\\n\\ncollect_listening_ports() {\\n    print_subsection \\\"Listening Ports Analysis\\\"\\n    \\n    echo \\\"Ports exposed on all interfaces (0.0.0.0):\\\"\\n    if command -v ss \u003e/dev/null 2\u003e\u00261; then\\n        ss -tln | grep \\\"0.0.0.0:\\\" | awk \u0027{print $4}\u0027 | cut -d: -f2 | sort -n | uniq\\n    elif command -v netstat \u003e/dev/null 2\u003e\u00261; then\\n        netstat -tln | grep \\\"0.0.0.0:\\\" | awk \u0027{print $4}\u0027 | rev | cut -d: -f1 | rev | sort -n | uniq\\n    fi\\n}\\n\\n#######################################\\n# Main\\n#######################################\\ntimestamp=$(date +%Y-%m-%d_%H-%M-%S)\\n\\nprint_section \\\"NETWORK FORENSICS COLLECTION\\\"\\necho \\\"Timestamp: $timestamp\\\"\\necho \\\"Output: $OUTPUT_DIR\\\"\\n\\nmkdir -p \\\"$OUTPUT_DIR\\\"\\n\\n# Collect all data\\n{\\n    print_section \\\"SYSTEM INFORMATION\\\"\\n    echo \\\"Hostname: $(hostname)\\\"\\n    echo \\\"Date: $(date)\\\"\\n    echo \\\"User: $(whoami)\\\"\\n    uname -a\\n    \\n    collect_network_interfaces\\n    collect_connections\\n    collect_routing\\n    collect_arp\\n    collect_dns\\n    collect_processes\\n    collect_firewall\\n    collect_listening_ports\\n    \\n} | tee \\\"$OUTPUT_DIR/forensics-$timestamp.txt\\\"\\n\\n# Save individual components\\ncollect_network_interfaces | save_data \\\"network\\\" \\\"interfaces\\\"\\ncollect_connections | save_data \\\"network\\\" \\\"connections\\\"\\ncollect_routing | save_data \\\"network\\\" \\\"routing\\\"\\ncollect_arp | save_data \\\"network\\\" \\\"arp-cache\\\"\\ncollect_dns | save_data \\\"dns\\\" \\\"configuration\\\"\\ncollect_processes | save_data \\\"processes\\\" \\\"network-processes\\\"\\ncollect_firewall | save_data \\\"security\\\" \\\"firewall\\\"\\n\\n# Summary\\nprint_section \\\"COLLECTION COMPLETE\\\"\\necho \\\"Data saved to: $OUTPUT_DIR\\\"\\necho \\\"\\\"\\necho \\\"Files created:\\\"\\nfind \\\"$OUTPUT_DIR\\\" -type f -name \\\"*.txt\\\" | while read -r f; do\\n    echo \\\"  - $f\\\"\\ndone\\n\\n\",\"numCharactersInRequestedRange\":7256,\"totalLinesInFile\":285}"}},"bubbleId":"c399c050-446d-4212-8311-9747610bc3b5"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"c8f0367e-f9be-495d-972f-f2c99d622857","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:34:49.149Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"codeBlocks":[],"text":"","capabilityType":15,"toolFormerData":{"tool":39,"toolCallId":"toolu_01WNjSXs6cbhhn9oYJ9FmC9x","toolIndex":3,"modelCallId":"15279199-0e5d-402b-bfdd-6e6fff2a3bbf","status":"completed","rawArgs":"{\"target_directory\": \"templates/network\"}","name":"list_dir","params":"{\"targetDirectory\":\"templates/network\",\"shouldEnrichTerminalMetadata\":true}","additionalData":{},"result":"{\"directoryTreeRoot\":{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\templates\\\\network\",\"childrenDirs\":[{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\templates\\\\network\\\\browser-forensics\",\"childrenDirs\":[{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\templates\\\\network\\\\browser-forensics\\\\chrome\",\"childrenFiles\":[{\"name\":\"full-capture.json\"}],\"childrenWereProcessed\":true,\"fullSubtreeExtensionCounts\":{\".json\":1},\"numFiles\":1}],\"childrenFiles\":[{\"name\":\"summary.json\"}],\"childrenWereProcessed\":true,\"fullSubtreeExtensionCounts\":{\".json\":2},\"numFiles\":2},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\templates\\\\network\\\\diagnostics-output\",\"childrenFiles\":[{\"name\":\"NetworkForensics-2025-12-01_20-12-11-status.json\"}],\"childrenWereProcessed\":true,\"fullSubtreeExtensionCounts\":{\".json\":1},\"numFiles\":1},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\templates\\\\network\\\\forensics\",\"childrenDirs\":[{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\templates\\\\network\\\\forensics\\\\dns\",\"childrenFiles\":[{\"name\":\"cache.json\"}],\"childrenWereProcessed\":true,\"fullSubtreeExtensionCounts\":{\".json\":1},\"numFiles\":1},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\templates\\\\network\\\\forensics\\\\network\",\"childrenFiles\":[{\"name\":\"arp-cache.json\"},{\"name\":\"connections.json\"},{\"name\":\"interfaces.json\"},{\"name\":\"listeners.json\"},{\"name\":\"routes.json\"}],\"childrenWereProcessed\":true,\"fullSubtreeExtensionCounts\":{\".json\":5},\"numFiles\":5},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\templates\\\\network\\\\forensics\\\\processes\",\"childrenFiles\":[{\"name\":\"network-processes.json\"}],\"childrenWereProcessed\":true,\"fullSubtreeExtensionCounts\":{\".json\":1},\"numFiles\":1},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\templates\\\\network\\\\forensics\\\\security\",\"childrenFiles\":[{\"name\":\"firewall.json\"}],\"childrenWereProcessed\":true,\"fullSubtreeExtensionCounts\":{\".json\":1},\"numFiles\":1}],\"childrenWereProcessed\":true,\"fullSubtreeExtensionCounts\":{\".json\":8},\"numFiles\":8},{\"absPath\":\"c:\\\\Users\\\\user\\\\Downloads\\\\Cursor_working_directory_misc\\\\templates\\\\network\\\\oui-data\",\"childrenFiles\":[{\"name\":\"ieee-oui.csv\"},{\"name\":\"nmap-mac-prefixes.txt\"},{\"name\":\"oui-unified.json\"}],\"childrenWereProcessed\":true,\"fullSubtreeExtensionCounts\":{\".json\":1,\".txt\":1,\".csv\":1},\"numFiles\":3}],\"childrenFiles\":[{\"name\":\"dns-diagnostics.sh\"},{\"name\":\"Install-NetworkTools-v7.ps1\"},{\"name\":\"Invoke-BackgroundDiagnostics-v7.ps1\"},{\"name\":\"Invoke-BrowserForensics-v7.ps1\"},{\"name\":\"Invoke-DnsDiagnostics-v7.ps1\"},{\"name\":\"Invoke-NetworkForensics-v7.ps1\"},{\"name\":\"Invoke-NetworkScan-v7.ps1\"},{\"name\":\"Invoke-PacketCapture-v7.ps1\"},{\"name\":\"network-forensics.sh\"},{\"name\":\"network-scan.sh\"},{\"name\":\"network.cfg\"},{\"name\":\"packet-capture.sh\"},{\"name\":\"README.md\"},{\"name\":\"Update-OuiDatabase-v7.ps1\"}],\"childrenWereProcessed\":true,\"fullSubtreeExtensionCounts\":{\".ps1\":8,\".md\":1,\".sh\":4,\".json\":12,\".txt\":1,\".csv\":1,\".cfg\":1},\"numFiles\":28}}"}},"bubbleId":"c8f0367e-f9be-495d-972f-f2c99d622857"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"d78eb378-1d32-4ff3-812f-93a34d555a21","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:35:31.838Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"text":"","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","codeBlocks":[{"uri":{"scheme":"file","authority":"","path":"/c:/Users/user/Downloads/Cursor_working_directory_misc/templates/network/Invoke-MitmAudit-v7.ps1","query":"","fragment":"","_formatted":"file:///c%3A/Users/user/Downloads/Cursor_working_directory_misc/templates/network/Invoke-MitmAudit-v7.ps1","_fsPath":null},"codeblockId":"d3b129e2-7ca6-4d73-bc41-462b5f2d1e0c","codeBlockIdx":0,"content":"#Requires -Version 7.0\n\u003c#\n.SYNOPSIS\n    Infrastructure MITM Audit - Forensic Evidence Collection for TLS Interception Detection\n\n.DESCRIPTION\n    Combines environment baselining, Root CA dumping, ASN-based integrity checking,\n    and DoH comparison to detect infrastructure-side Man-in-the-Middle attacks while\n    ruling out client-side exploits.\n\n    Produces a timestamped evidence package suitable for chain of custody.\n\n.PARAMETER ConfigFile\n    Path to mitm-audit.cfg configuration file.\n\n.PARAMETER OutputPath\n    Base directory for evidence collection (default: Desktop\\ForensicEvidence_timestamp)\n\n.PARAMETER Targets\n    Override target domains from config (comma-separated)\n\n.PARAMETER SkipTraceroute\n    Skip traceroute collection (faster but less complete)\n\n.PARAMETER SkipClientSideChecks\n    Skip client-side exploit detection (browser extensions, proxy settings)\n\n.PARAMETER HashOnly\n    Only generate hashes for existing evidence directory\n\n.EXAMPLE\n    .\\Invoke-MitmAudit-v7.ps1\n    .\\Invoke-MitmAudit-v7.ps1 -ConfigFile .\\mitm-audit.cfg\n    .\\Invoke-MitmAudit-v7.ps1 -Targets \"accounts.google.com,github.com\"\n    .\\Invoke-MitmAudit-v7.ps1 -SkipTraceroute -SkipClientSideChecks\n\n.NOTES\n    License: BSD-2-Clause\n    Requires: PowerShell 7+, Administrator privileges recommended\n    Signed-off-by: Network Diagnostics Toolkit\n\n    Run as Administrator for complete Root CA export and network diagnostics.\n\n    EVIDENCE PROCESSING:\n    1. Check _RedFlags.txt first - if empty, MITM may be passive/logging only\n    2. Certificate Serial Check - copy serial to crt.sh on clean device\n       - If \"No certificates found\": 100% MITM by private root CA\n       - If cert shown for different domain: collision/hash attack\n    3. Zip evidence folder, hash the zip for chain of custody\n#\u003e\n\n[CmdletBinding()]\nparam(\n    [Parameter()]\n    [string]$ConfigFile,\n\n    [Parameter()]\n    [string]$OutputPath,\n\n    [Parameter()]\n    [string]$Targets,\n\n    [Parameter()]\n    [switch]$SkipTraceroute,\n\n    [Parameter()]\n    [switch]$SkipClientSideChecks,\n\n    [Parameter()]\n    [switch]$HashOnly\n)\n\nSet-StrictMode -Version Latest\n$ErrorActionPreference = \u0027Continue\u0027\n\n#region Configuration\n\n# Default configuration\n$script:Config = @{\n    Targets = @(\"accounts.google.com\", \"login.microsoftonline.com\", \"appleid.apple.com\", \"aws.amazon.com\", \"github.com\")\n    PublicResolvers = @(\"1.1.1.1\", \"8.8.8.8\", \"9.9.9.9\")\n    DohEndpoint = \"https://dns.google/resolve\"\n    AsnLookupUrl = \"http://ip-api.com/json\"\n    AsnLookupTimeout = 3\n    ExternalIpUrl = \"https://ipinfo.io/json\"\n    ExternalIpTimeout = 5\n    ExpectedIspPatterns = @()\n    SuspiciousAsnPatterns = @(\"DigitalOcean\", \"Linode\", \"Vultr\", \"Choopa\", \"Datacamp\", \"OVH\", \"Hetzner\")\n    SuspiciousCertIssuers = @(\"Let\u0027s Encrypt\", \"ZeroSSL\", \"Self-Signed\", \"localhost\")\n    TracerouteMaxHops = 15\n    TracerouteTimeout = 2\n    TracerouteEnabled = $true\n    ExportRootCa = $true\n    HashRootCa = $true\n    CheckProxySettings = $true\n    CheckBrowserExtensions = $true\n    CheckHostsFile = $true\n    CheckRootCaAnomalies = $true\n    HashAlgorithm = \"SHA256\"\n}\n\nfunction Read-ConfigFile {\n    param([string]$Path)\n\n    if (-not (Test-Path $Path)) {\n        Write-Warning \"Config file not found: $Path (using defaults)\"\n        return\n    }\n\n    Get-Content $Path | ForEach-Object {\n        $line = $_.Trim()\n        if ($line -match \u0027^#\u0027 -or $line -eq \u0027\u0027) { return }\n        if ($line -match \u0027^([^=]+)=(.*)$\u0027) {\n            $key = $Matches[1].Trim()\n            $value = $Matches[2].Trim()\n\n            switch ($key) {\n                \u0027TARGETS\u0027 { $script:Config.Targets = $value -split \u0027,\u0027 | ForEach-Object { $_.Trim() } }\n                \u0027PUBLIC_RESOLVERS\u0027 { $script:Config.PublicResolvers = $value -split \u0027,\u0027 | ForEach-Object { $_.Trim() } }\n                \u0027DOH_ENDPOINT\u0027 { $script:Config.DohEndpoint = $value }\n                \u0027ASN_LOOKUP_URL\u0027 { $script:Config.AsnLookupUrl = $value }\n                \u0027ASN_LOOKUP_TIMEOUT_SEC\u0027 { $script:Config.AsnLookupTimeout = [int]$value }\n                \u0027EXTERNAL_IP_URL\u0027 { $script:Config.ExternalIpUrl = $value }\n                \u0027EXTERNAL_IP_TIMEOUT_SEC\u0027 { $script:Config.ExternalIpTimeout = [int]$value }\n                \u0027EXPECTED_ISP_PATTERNS\u0027 { if ($value) { $script:Config.ExpectedIspPatterns = $value -split \u0027,\u0027 | ForEach-Object { $_.Trim() } } }\n                \u0027SUSPICIOUS_ASN_PATTERNS\u0027 { $script:Config.SuspiciousAsnPatterns = $value -split \u0027,\u0027 | ForEach-Object { $_.Trim() } }\n                \u0027SUSPICIOUS_CERT_ISSUERS\u0027 { $script:Config.SuspiciousCertIssuers = $value -split \u0027,\u0027 | ForEach-Object { $_.Trim() } }\n                \u0027TRACEROUTE_MAX_HOPS\u0027 { $script:Config.TracerouteMaxHops = [int]$value }\n                \u0027TRACEROUTE_TIMEOUT_SEC\u0027 { $script:Config.TracerouteTimeout = [int]$value }\n                \u0027TRACEROUTE_ENABLED\u0027 { $script:Config.TracerouteEnabled = $value -eq \u0027true\u0027 }\n                \u0027EXPORT_ROOT_CA\u0027 { $script:Config.ExportRootCa = $value -eq \u0027true\u0027 }\n                \u0027HASH_ROOT_CA\u0027 { $script:Config.HashRootCa = $value -eq \u0027true\u0027 }\n                \u0027CHECK_PROXY_SETTINGS\u0027 { $script:Config.CheckProxySettings = $value -eq \u0027true\u0027 }\n                \u0027CHECK_BROWSER_EXTENSIONS\u0027 { $script:Config.CheckBrowserExtensions = $value -eq \u0027true\u0027 }\n                \u0027CHECK_HOSTS_FILE\u0027 { $script:Config.CheckHostsFile = $value -eq \u0027true\u0027 }\n                \u0027CHECK_ROOT_CA_ANOMALIES\u0027 { $script:Config.CheckRootCaAnomalies = $value -eq \u0027true\u0027 }\n                \u0027HASH_ALGORITHM\u0027 { $script:Config.HashAlgorithm = $value }\n            }\n        }\n    }\n}\n\n#endregion\n\n#region Logging and Output\n\n$script:LogFile = $null\n$script:AlertFile = $null\n\nfunction Initialize-OutputDirectory {\n    param([string]$BasePath)\n\n    $timestamp = Get-Date -Format \"yyyyMMdd_HHmmss\"\n\n    if ($BasePath) {\n        $script:BaseDir = $BasePath\n    } else {\n        $script:BaseDir = Join-Path $env:USERPROFILE \"Desktop\\ForensicEvidence_$timestamp\"\n    }\n\n    New-Item -Path $script:BaseDir -ItemType Directory -Force | Out-Null\n    $script:LogFile = Join-Path $script:BaseDir \"_AuditLog.txt\"\n    $script:AlertFile = Join-Path $script:BaseDir \"_RedFlags.txt\"\n\n    # Initialize files\n    \"\" | Set-Content $script:AlertFile -Encoding UTF8\n}\n\nfunction Write-Log {\n    param([string]$Message, [string]$Level = \"INFO\")\n\n    $timestamp = Get-Date -Format \"yyyy-MM-dd HH:mm:ss\"\n    $logEntry = \"[$timestamp] [$Level] $Message\"\n\n    switch ($Level) {\n        \"ERROR\" { Write-Host $logEntry -ForegroundColor Red }\n        \"WARN\"  { Write-Host $logEntry -ForegroundColor Yellow }\n        \"ALERT\" { Write-Host \"[!] $Message\" -ForegroundColor Red }\n        default { Write-Host $logEntry }\n    }\n\n    Add-Content -Path $script:LogFile -Value $logEntry -Encoding UTF8\n}\n\nfunction Write-Alert {\n    param([string]$Message)\n\n    Write-Log -Message $Message -Level \"ALERT\"\n    $timestamp = Get-Date -Format \"yyyy-MM-dd HH:mm:ss\"\n    Add-Content -Path $script:AlertFile -Value \"[$timestamp] $Message\" -Encoding UTF8\n}\n\nfunction Write-Section {\n    param([string]$Title)\n    Write-Host \"\"\n    Write-Host (\"=\" * 70) -ForegroundColor Cyan\n    Write-Host \" $Title\" -ForegroundColor Cyan\n    Write-Host (\"=\" * 70) -ForegroundColor Cyan\n    Write-Log \"=== $Title ===\" -Level \"INFO\"\n}\n\nfunction Write-SubSection {\n    param([string]$Title)\n    Write-Host \"\"\n    Write-Host \"[*] $Title\" -ForegroundColor Yellow\n    Write-Host (\"-\" * 50)\n    Write-Log \"--- $Title ---\" -Level \"INFO\"\n}\n\n#endregion\n\n#region ASN and DNS Functions\n\nfunction Get-ASN {\n    param([string]$IP)\n\n    try {\n        $uri = \"$($script:Config.AsnLookupUrl)/$IP`?fields=status,message,org,as\"\n        $response = Invoke-RestMethod -Uri $uri -TimeoutSec $script:Config.AsnLookupTimeout -ErrorAction Stop\n\n        if ($response.status -eq \"success\") {\n            return \"$($response.org) ($($response.as))\"\n        } else {\n            return \"Unknown\"\n        }\n    } catch {\n        return \"Lookup Failed (Blocked?)\"\n    }\n}\n\nfunction Get-DohResolution {\n    param([string]$Domain)\n\n    try {\n        $uri = \"$($script:Config.DohEndpoint)?name=$Domain\u0026type=A\"\n        $response = Invoke-RestMethod -Uri $uri -TimeoutSec 5 -ErrorAction Stop\n\n        if ($response.Answer -and $response.Answer.Count -gt 0) {\n            return $response.Answer[0].data\n        }\n        return $null\n    } catch {\n        return $null\n    }\n}\n\nfunction Test-AsnIntegrity {\n    param(\n        [string]$Domain,\n        [string]$Asn\n    )\n\n    if ($Asn -eq \"Lookup Failed (Blocked?)\") {\n        return $null  # Cannot determine\n    }\n\n    # Check against expected patterns\n    if ($Domain -match \"google\" -and $Asn -notmatch \"Google\") {\n        return \"MITM DETECTED: $Domain resolving to non-Google ASN ($Asn)\"\n    }\n    if ($Domain -match \"microsoft\" -and $Asn -notmatch \"Microsoft\") {\n        return \"MITM DETECTED: $Domain resolving to non-Microsoft ASN ($Asn)\"\n    }\n    if ($Domain -match \"apple\" -and $Asn -notmatch \"Apple\") {\n        return \"MITM DETECTED: $Domain resolving to non-Apple ASN ($Asn)\"\n    }\n    if ($Domain -match \"aws\\.amazon|amazonaws\" -and $Asn -notmatch \"Amazon|AMAZON\") {\n        return \"MITM DETECTED: $Domain resolving to non-Amazon ASN ($Asn)\"\n    }\n    if ($Domain -match \"github\" -and $Asn -notmatch \"GitHub|Microsoft\") {\n        return \"MITM DETECTED: $Domain resolving to non-GitHub/Microsoft ASN ($Asn)\"\n    }\n\n    # Check for suspicious VPS providers\n    foreach ($pattern in $script:Config.SuspiciousAsnPatterns) {\n        if ($Asn -match $pattern) {\n            return \"MITM DETECTED: High-value target routed to VPS provider ($pattern)\"\n        }\n    }\n\n    return $null\n}\n\n#endregion\n\n#region Certificate Functions\n\nfunction Get-TlsCertificate {\n    param([string]$Domain, [int]$Port = 443)\n\n    try {\n        $tcpClient = New-Object System.Net.Sockets.TcpClient\n        $tcpClient.Connect($Domain, $Port)\n        $sslStream = New-Object System.Net.Security.SslStream($tcpClient.GetStream(), $false, { $true })\n        $sslStream.AuthenticateAsClient($Domain)\n        $cert = $sslStream.RemoteCertificate\n\n        $certInfo = [PSCustomObject]@{\n            Subject = $cert.Subject\n            Issuer = $cert.Issuer\n            SerialNumber = $cert.GetSerialNumberString()\n            Thumbprint = $cert.GetCertHashString()\n            NotBefore = $cert.GetEffectiveDateString()\n            NotAfter = $cert.GetExpirationDateString()\n        }\n\n        $sslStream.Close()\n        $tcpClient.Close()\n\n        return $certInfo\n    } catch {\n        return [PSCustomObject]@{\n            Error = $_.Exception.Message\n            Domain = $Domain\n        }\n    }\n}\n\nfunction Test-CertificateAnomaly {\n    param(\n        [string]$Domain,\n        [PSCustomObject]$CertInfo\n    )\n\n    if ($CertInfo.Error) {\n        return \"TLS Handshake Failed for $Domain - Interception likely causing protocol error\"\n    }\n\n    # Check for suspicious issuers on major tech domains\n    foreach ($issuerPattern in $script:Config.SuspiciousCertIssuers) {\n        $isMajorTech = $Domain -match \"google|microsoft|apple|amazon|github\"\n        if ($isMajorTech -and $CertInfo.Issuer -match $issuerPattern) {\n            return \"CERTIFICATE ANOMALY: $Domain using $issuerPattern issuer - highly suspicious for major tech corp\"\n        }\n    }\n\n    return $null\n}\n\n#endregion\n\n#region Phase 1: Environment Snapshot\n\nfunction Get-EnvironmentSnapshot {\n    Write-Section \"PHASE 1: ENVIRONMENT SNAPSHOT\"\n\n    $envDir = Join-Path $script:BaseDir \"environment\"\n    New-Item -Path $envDir -ItemType Directory -Force | Out-Null\n\n    # Network configuration\n    Write-SubSection \"Network Configuration\"\n    $netConfig = Get-NetIPConfiguration | Select-Object InterfaceAlias, IPv4Address, IPv4DefaultGateway, DNSServer\n    $netConfig | ConvertTo-Json -Depth 5 | Set-Content (Join-Path $envDir \"NetworkConfig.json\") -Encoding UTF8\n    Get-NetIPConfiguration | Out-File (Join-Path $envDir \"NetworkConfig.txt\") -Encoding UTF8\n\n    # External IP\n    Write-SubSection \"External IP Identification\"\n    try {\n        $extIp = Invoke-RestMethod -Uri $script:Config.ExternalIpUrl -TimeoutSec $script:Config.ExternalIpTimeout\n        $extIp | ConvertTo-Json | Set-Content (Join-Path $envDir \"ExternalIP.json\") -Encoding UTF8\n\n        Write-Log \"External IP: $($extIp.ip)\"\n        Write-Log \"External Org: $($extIp.org)\"\n        Write-Log \"Location: $($extIp.city), $($extIp.region), $($extIp.country)\"\n\n        # Check expected ISP\n        if ($script:Config.ExpectedIspPatterns.Count -gt 0) {\n            $isExpectedIsp = $false\n            foreach ($pattern in $script:Config.ExpectedIspPatterns) {\n                if ($extIp.org -match $pattern) {\n                    $isExpectedIsp = $true\n                    break\n                }\n            }\n            if (-not $isExpectedIsp) {\n                Write-Alert \"External IP Org ($($extIp.org)) does not match expected ISP patterns - traffic may be tunneled/proxied\"\n            }\n        }\n    } catch {\n        Write-Alert \"Unable to determine External IP - connection may be blocked or filtered\"\n    }\n\n    # System info\n    Write-SubSection \"System Information\"\n    $sysInfo = [PSCustomObject]@{\n        ComputerName = $env:COMPUTERNAME\n        UserName = $env:USERNAME\n        UserDomain = $env:USERDOMAIN\n        OSVersion = [System.Environment]::OSVersion.VersionString\n        PowerShellVersion = $PSVersionTable.PSVersion.ToString()\n        Is64Bit = [System.Environment]::Is64BitOperatingSystem\n        IsAdmin = ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)\n        Timestamp = (Get-Date).ToString(\"o\")\n    }\n    $sysInfo | ConvertTo-Json | Set-Content (Join-Path $envDir \"SystemInfo.json\") -Encoding UTF8\n    Write-Log \"System: $($sysInfo.ComputerName) / User: $($sysInfo.UserName) / Admin: $($sysInfo.IsAdmin)\"\n}\n\n#endregion\n\n#region Phase 2: Trust Store Export\n\nfunction Export-TrustStore {\n    Write-Section \"PHASE 2: TRUST STORE EXPORT\"\n\n    $trustDir = Join-Path $script:BaseDir \"trust-store\"\n    New-Item -Path $trustDir -ItemType Directory -Force | Out-Null\n\n    if (-not $script:Config.ExportRootCa) {\n        Write-Log \"Root CA export disabled in configuration\"\n        return\n    }\n\n    Write-SubSection \"Exporting Root CA Store\"\n\n    # Export Root CAs\n    $rootCAs = Get-ChildItem Cert:\\LocalMachine\\Root\n    $rootCaData = $rootCAs | Select-Object Thumbprint, Subject, Issuer, NotBefore, NotAfter, @{N=\u0027SignatureAlgorithm\u0027;E={$_.SignatureAlgorithm.FriendlyName}}\n\n    # Export to CSV\n    $csvPath = Join-Path $trustDir \"RootStore_Dump.csv\"\n    $rootCaData | Export-Csv -Path $csvPath -NoTypeInformation -Encoding UTF8\n    Write-Log \"Root CA Store exported to $csvPath ($($rootCAs.Count) certificates)\"\n\n    # Export to JSON for programmatic access\n    $jsonPath = Join-Path $trustDir \"RootStore_Dump.json\"\n    $rootCaData | ConvertTo-Json -Depth 3 | Set-Content $jsonPath -Encoding UTF8\n\n    # Hash the export if configured\n    if ($script:Config.HashRootCa) {\n        $hash = Get-FileHash -Path $csvPath -Algorithm $script:Config.HashAlgorithm\n        $hash | ConvertTo-Json | Set-Content (Join-Path $trustDir \"RootStore_Hash.json\") -Encoding UTF8\n        Write-Log \"Root CA hash: $($hash.Hash)\"\n    }\n\n    # Check for anomalies\n    if ($script:Config.CheckRootCaAnomalies) {\n        Write-SubSection \"Root CA Anomaly Detection\"\n\n        $suspicious = @()\n\n        foreach ($ca in $rootCAs) {\n            # Check for self-signed certs with suspicious names\n            if ($ca.Subject -match \"Self|Test|Admin|Local|Proxy|Intercept|MITM\") {\n                $suspicious += [PSCustomObject]@{\n                    Thumbprint = $ca.Thumbprint\n                    Subject = $ca.Subject\n                    Reason = \"Suspicious name pattern in certificate subject\"\n                }\n            }\n\n            # Check for recently added certs (within last 30 days)\n            if ($ca.NotBefore -gt (Get-Date).AddDays(-30)) {\n                $suspicious += [PSCustomObject]@{\n                    Thumbprint = $ca.Thumbprint\n                    Subject = $ca.Subject\n                    NotBefore = $ca.NotBefore\n                    Reason = \"Recently added root CA (within last 30 days)\"\n                }\n            }\n\n            # Check for common enterprise MITM tools\n            if ($ca.Subject -match \"Zscaler|BlueCoat|Forcepoint|McAfee|Symantec Web Gateway|Websense|Palo Alto\") {\n                $suspicious += [PSCustomObject]@{\n                    Thumbprint = $ca.Thumbprint\n                    Subject = $ca.Subject\n                    Reason = \"Enterprise TLS inspection tool detected\"\n                }\n            }\n        }\n\n        if ($suspicious.Count -gt 0) {\n            $suspicious | ConvertTo-Json -Depth 3 | Set-Content (Join-Path $trustDir \"SuspiciousCAs.json\") -Encoding UTF8\n            foreach ($s in $suspicious) {\n                Write-Alert \"Suspicious Root CA: $($s.Subject) - $($s.Reason)\"\n            }\n        } else {\n            Write-Log \"No suspicious root CAs detected\"\n        }\n    }\n}\n\n#endregion\n\n#region Phase 3: Target Analysis\n\nfunction Invoke-TargetAnalysis {\n    Write-Section \"PHASE 3: TARGET ANALYSIS AND ASN INTEGRITY\"\n\n    $targetsDir = Join-Path $script:BaseDir \"targets\"\n    New-Item -Path $targetsDir -ItemType Directory -Force | Out-Null\n\n    foreach ($domain in $script:Config.Targets) {\n        Write-SubSection \"Analyzing: $domain\"\n\n        $safeDomain = $domain -replace \u0027\\.\u0027, \u0027_\u0027\n        $domainDir = Join-Path $targetsDir $safeDomain\n        New-Item -Path $domainDir -ItemType Directory -Force | Out-Null\n\n        $analysis = [PSCustomObject]@{\n            Domain = $domain\n            Timestamp = (Get-Date).ToString(\"o\")\n            LocalDns = $null\n            LocalAsn = $null\n            DohDns = $null\n            DohAsn = $null\n            Certificate = $null\n            Alerts = @()\n        }\n\n        # A. Local DNS Resolution\n        try {\n            $localIp = (Resolve-DnsName -Name $domain -Type A -ErrorAction SilentlyContinue).IPAddress | Select-Object -First 1\n            $analysis.LocalDns = $localIp\n\n            if ($localIp) {\n                $localAsn = Get-ASN -IP $localIp\n                $analysis.LocalAsn = $localAsn\n                Write-Log \"Local DNS: $localIp | ASN: $localAsn\"\n            } else {\n                Write-Log \"Local DNS resolution failed\" -Level \"WARN\"\n            }\n        } catch {\n            Write-Log \"DNS resolution error: $_\" -Level \"ERROR\"\n        }\n\n        # B. DoH Resolution (Control Group)\n        $dohIp = Get-DohResolution -Domain $domain\n        if ($dohIp) {\n            $analysis.DohDns = $dohIp\n            $dohAsn = Get-ASN -IP $dohIp\n            $analysis.DohAsn = $dohAsn\n            Write-Log \"DoH DNS:   $dohIp | ASN: $dohAsn\"\n\n            # Compare IPs\n            if ($analysis.LocalDns -and $analysis.LocalDns -ne $dohIp) {\n                Write-Log \"DNS MISMATCH: Local ($($analysis.LocalDns)) vs DoH ($dohIp)\" -Level \"WARN\"\n            }\n        } else {\n            Write-Log \"DoH resolution failed (network may be blocking)\" -Level \"WARN\"\n        }\n\n        # C. ASN Integrity Check\n        if ($analysis.LocalAsn) {\n            $asnAlert = Test-AsnIntegrity -Domain $domain -Asn $analysis.LocalAsn\n            if ($asnAlert) {\n                Write-Alert $asnAlert\n                $analysis.Alerts += $asnAlert\n            }\n        }\n\n        # D. Certificate Capture\n        Write-Log \"Capturing TLS certificate...\"\n        $certInfo = Get-TlsCertificate -Domain $domain\n        $analysis.Certificate = $certInfo\n\n        $certPath = Join-Path $domainDir \"Certificate.json\"\n        $certInfo | ConvertTo-Json -Depth 3 | Set-Content $certPath -Encoding UTF8\n\n        if ($certInfo.SerialNumber) {\n            Write-Log \"Certificate Serial: $($certInfo.SerialNumber)\"\n            Write-Log \"Certificate Issuer: $($certInfo.Issuer)\"\n\n            # Check for certificate anomalies\n            $certAlert = Test-CertificateAnomaly -Domain $domain -CertInfo $certInfo\n            if ($certAlert) {\n                Write-Alert $certAlert\n                $analysis.Alerts += $certAlert\n            }\n        } else {\n            Write-Alert \"TLS Handshake Failed for $domain - $($certInfo.Error)\"\n            $analysis.Alerts += \"TLS Handshake Failed: $($certInfo.Error)\"\n        }\n\n        # Save analysis\n        $analysis | ConvertTo-Json -Depth 5 | Set-Content (Join-Path $domainDir \"Analysis.json\") -Encoding UTF8\n    }\n}\n\n#endregion\n\n#region Phase 4: Traceroute Mapping\n\nfunction Invoke-TracerouteMapping {\n    Write-Section \"PHASE 4: TRACEROUTE MAPPING\"\n\n    if (-not $script:Config.TracerouteEnabled -or $SkipTraceroute) {\n        Write-Log \"Traceroute skipped (disabled or -SkipTraceroute specified)\"\n        return\n    }\n\n    $traceDir = Join-Path $script:BaseDir \"traceroute\"\n    New-Item -Path $traceDir -ItemType Directory -Force | Out-Null\n\n    foreach ($domain in $script:Config.Targets) {\n        Write-SubSection \"Tracing: $domain\"\n\n        $safeDomain = $domain -replace \u0027\\.\u0027, \u0027_\u0027\n        $tracePath = Join-Path $traceDir \"Trace_$safeDomain.txt\"\n        $traceJsonPath = Join-Path $traceDir \"Trace_$safeDomain.json\"\n\n        try {\n            $trace = Test-NetConnection -ComputerName $domain -TraceRoute -WarningAction SilentlyContinue\n            $hops = $trace.TraceRoute\n\n            # Save text output\n            $hops | Out-File $tracePath -Encoding UTF8\n\n            # Save JSON with ASN lookup for each hop\n            $hopDetails = @()\n            $hopNum = 1\n            foreach ($hop in $hops) {\n                if ($hop -and $hop -ne \"*\") {\n                    $asn = Get-ASN -IP $hop\n                    $hopDetails += [PSCustomObject]@{\n                        Hop = $hopNum\n                        IP = $hop\n                        ASN = $asn\n                    }\n\n                    # Check for suspicious hops\n                    foreach ($pattern in $script:Config.SuspiciousAsnPatterns) {\n                        if ($asn -match $pattern) {\n                            Write-Alert \"Suspicious hop in traceroute to $domain - Hop $hopNum ($hop) routes through $pattern\"\n                        }\n                    }\n                }\n                $hopNum++\n            }\n\n            $hopDetails | ConvertTo-Json -Depth 3 | Set-Content $traceJsonPath -Encoding UTF8\n            Write-Log \"Trace complete: $($hops.Count) hops\"\n        } catch {\n            Write-Log \"Traceroute failed: $_\" -Level \"ERROR\"\n        }\n    }\n}\n\n#endregion\n\n#region Phase 5: Client-Side Exploit Detection\n\nfunction Test-ClientSideExploits {\n    Write-Section \"PHASE 5: CLIENT-SIDE EXPLOIT DETECTION\"\n\n    if ($SkipClientSideChecks) {\n        Write-Log \"Client-side checks skipped (-SkipClientSideChecks specified)\"\n        return\n    }\n\n    $clientDir = Join-Path $script:BaseDir \"client-side\"\n    New-Item -Path $clientDir -ItemType Directory -Force | Out-Null\n\n    # A. Proxy Settings\n    if ($script:Config.CheckProxySettings) {\n        Write-SubSection \"Proxy Settings Check\"\n\n        $proxyInfo = [PSCustomObject]@{\n            SystemProxy = $null\n            EnvironmentProxy = $null\n            WinHttpProxy = $null\n            Alerts = @()\n        }\n\n        # System proxy (Internet Options)\n        try {\n            $regPath = \"HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\"\n            $proxyEnabled = Get-ItemProperty -Path $regPath -Name ProxyEnable -ErrorAction SilentlyContinue\n            $proxyServer = Get-ItemProperty -Path $regPath -Name ProxyServer -ErrorAction SilentlyContinue\n\n            $proxyInfo.SystemProxy = [PSCustomObject]@{\n                Enabled = [bool]$proxyEnabled.ProxyEnable\n                Server = $proxyServer.ProxyServer\n            }\n\n            if ($proxyEnabled.ProxyEnable) {\n                Write-Alert \"System proxy is ENABLED: $($proxyServer.ProxyServer)\"\n                $proxyInfo.Alerts += \"System proxy enabled\"\n            } else {\n                Write-Log \"System proxy: Disabled\"\n            }\n        } catch {\n            Write-Log \"Could not read system proxy settings\" -Level \"WARN\"\n        }\n\n        # Environment variables\n        $envProxy = @{\n            HTTP_PROXY = $env:HTTP_PROXY\n            HTTPS_PROXY = $env:HTTPS_PROXY\n            ALL_PROXY = $env:ALL_PROXY\n            NO_PROXY = $env:NO_PROXY\n        }\n        $proxyInfo.EnvironmentProxy = $envProxy\n\n        foreach ($key in $envProxy.Keys) {\n            if ($envProxy[$key]) {\n                Write-Alert \"Environment proxy variable set: $key = $($envProxy[$key])\"\n                $proxyInfo.Alerts += \"Env proxy: $key\"\n            }\n        }\n\n        # WinHTTP proxy\n        try {\n            $winhttp = netsh winhttp show proxy 2\u003e\u00261\n            $proxyInfo.WinHttpProxy = $winhttp -join \"`n\"\n            if ($winhttp -match \"Proxy Server\") {\n                Write-Alert \"WinHTTP proxy configured - check output for details\"\n            }\n        } catch {\n            Write-Log \"Could not check WinHTTP proxy\" -Level \"WARN\"\n        }\n\n        $proxyInfo | ConvertTo-Json -Depth 3 | Set-Content (Join-Path $clientDir \"ProxySettings.json\") -Encoding UTF8\n    }\n\n    # B. Hosts File Check\n    if ($script:Config.CheckHostsFile) {\n        Write-SubSection \"Hosts File Analysis\"\n\n        $hostsPath = \"$env:SystemRoot\\System32\\drivers\\etc\\hosts\"\n        $hostsContent = Get-Content $hostsPath -ErrorAction SilentlyContinue\n\n        $hostsInfo = [PSCustomObject]@{\n            Path = $hostsPath\n            Entries = @()\n            Suspicious = @()\n        }\n\n        $sensitivePatterns = @(\"google\", \"microsoft\", \"apple\", \"amazon\", \"github\", \"cursor\", \"openai\", \"anthropic\")\n\n        foreach ($line in $hostsContent) {\n            if ($line -match \u0027^\\s*#\u0027 -or $line -match \u0027^\\s*$\u0027) { continue }\n\n            $parts = $line -split \u0027\\s+\u0027, 2\n            if ($parts.Count -ge 2) {\n                $ip = $parts[0]\n                $hostnames = $parts[1] -split \u0027\\s+\u0027\n\n                $entry = [PSCustomObject]@{\n                    IP = $ip\n                    Hostnames = $hostnames\n                }\n                $hostsInfo.Entries += $entry\n\n                foreach ($hostname in $hostnames) {\n                    foreach ($pattern in $sensitivePatterns) {\n                        if ($hostname -match $pattern -and $ip -notmatch \u0027^(127\\.0\\.0\\.1|::1|0\\.0\\.0\\.0)$\u0027) {\n                            $suspicious = [PSCustomObject]@{\n                                Entry = $entry\n                                Reason = \"Redirect of $pattern domain to $ip\"\n                            }\n                            $hostsInfo.Suspicious += $suspicious\n                            Write-Alert \"Hosts file redirect: $hostname -\u003e $ip\"\n                        }\n                    }\n                }\n            }\n        }\n\n        $hostsInfo | ConvertTo-Json -Depth 3 | Set-Content (Join-Path $clientDir \"HostsFile.json\") -Encoding UTF8\n        Write-Log \"Hosts file entries: $($hostsInfo.Entries.Count), Suspicious: $($hostsInfo.Suspicious.Count)\"\n    }\n\n    # C. Browser Extensions (Chrome/Edge)\n    if ($script:Config.CheckBrowserExtensions) {\n        Write-SubSection \"Browser Extension Audit\"\n\n        $extInfo = [PSCustomObject]@{\n            Chrome = @()\n            Edge = @()\n            Suspicious = @()\n        }\n\n        # Suspicious extension patterns\n        $suspiciousPatterns = @(\"proxy\", \"vpn\", \"intercept\", \"modify\", \"inject\", \"ssl\", \"certificate\", \"mitm\")\n\n        # Chrome extensions\n        $chromePath = \"$env:LOCALAPPDATA\\Google\\Chrome\\User Data\\Default\\Extensions\"\n        if (Test-Path $chromePath) {\n            $chromeExts = Get-ChildItem $chromePath -Directory -ErrorAction SilentlyContinue\n            foreach ($ext in $chromeExts) {\n                $manifestPath = Get-ChildItem $ext.FullName -Filter \"manifest.json\" -Recurse -ErrorAction SilentlyContinue | Select-Object -First 1\n                if ($manifestPath) {\n                    try {\n                        $manifest = Get-Content $manifestPath.FullName -Raw | ConvertFrom-Json\n                        $extData = [PSCustomObject]@{\n                            Id = $ext.Name\n                            Name = $manifest.name\n                            Version = $manifest.version\n                            Permissions = $manifest.permissions\n                        }\n                        $extInfo.Chrome += $extData\n\n                        # Check for suspicious permissions\n                        $perms = $manifest.permissions -join \",\"\n                        foreach ($pattern in $suspiciousPatterns) {\n                            if ($manifest.name -match $pattern -or $perms -match $pattern) {\n                                $extInfo.Suspicious += [PSCustomObject]@{\n                                    Browser = \"Chrome\"\n                                    Extension = $extData\n                                    Reason = \"Suspicious pattern: $pattern\"\n                                }\n                                Write-Alert \"Suspicious Chrome extension: $($manifest.name)\"\n                            }\n                        }\n\n                        # Check for webRequest/webRequestBlocking (can intercept requests)\n                        if ($perms -match \"webRequest|webRequestBlocking\") {\n                            $extInfo.Suspicious += [PSCustomObject]@{\n                                Browser = \"Chrome\"\n                                Extension = $extData\n                                Reason = \"Has webRequest permission (can intercept/modify requests)\"\n                            }\n                            Write-Log \"Chrome extension with webRequest: $($manifest.name)\" -Level \"WARN\"\n                        }\n                    } catch {\n                        # Skip malformed manifests\n                    }\n                }\n            }\n        }\n\n        # Edge extensions (same structure as Chrome)\n        $edgePath = \"$env:LOCALAPPDATA\\Microsoft\\Edge\\User Data\\Default\\Extensions\"\n        if (Test-Path $edgePath) {\n            $edgeExts = Get-ChildItem $edgePath -Directory -ErrorAction SilentlyContinue\n            foreach ($ext in $edgeExts) {\n                $manifestPath = Get-ChildItem $ext.FullName -Filter \"manifest.json\" -Recurse -ErrorAction SilentlyContinue | Select-Object -First 1\n                if ($manifestPath) {\n                    try {\n                        $manifest = Get-Content $manifestPath.FullName -Raw | ConvertFrom-Json\n                        $extData = [PSCustomObject]@{\n                            Id = $ext.Name\n                            Name = $manifest.name\n                            Version = $manifest.version\n                            Permissions = $manifest.permissions\n                        }\n                        $extInfo.Edge += $extData\n\n                        $perms = $manifest.permissions -join \",\"\n                        foreach ($pattern in $suspiciousPatterns) {\n                            if ($manifest.name -match $pattern -or $perms -match $pattern) {\n                                $extInfo.Suspicious += [PSCustomObject]@{\n                                    Browser = \"Edge\"\n                                    Extension = $extData\n                                    Reason = \"Suspicious pattern: $pattern\"\n                                }\n                                Write-Alert \"Suspicious Edge extension: $($manifest.name)\"\n                            }\n                        }\n                    } catch {\n                        # Skip malformed manifests\n                    }\n                }\n            }\n        }\n\n        $extInfo | ConvertTo-Json -Depth 5 | Set-Content (Join-Path $clientDir \"BrowserExtensions.json\") -Encoding UTF8\n        Write-Log \"Chrome extensions: $($extInfo.Chrome.Count), Edge extensions: $($extInfo.Edge.Count)\"\n    }\n}\n\n#endregion\n\n#region Phase 6: Evidence Finalization\n\nfunction Complete-EvidencePackage {\n    Write-Section \"PHASE 6: EVIDENCE FINALIZATION\"\n\n    # Generate summary\n    Write-SubSection \"Generating Summary\"\n\n    $alertContent = Get-Content $script:AlertFile -ErrorAction SilentlyContinue\n    $alertCount = ($alertContent | Where-Object { $_ -ne \u0027\u0027 }).Count\n\n    $summary = [PSCustomObject]@{\n        AuditTimestamp = (Get-Date).ToString(\"o\")\n        EvidenceDirectory = $script:BaseDir\n        TotalAlerts = $alertCount\n        Targets = $script:Config.Targets\n        Configuration = @{\n            TracerouteEnabled = $script:Config.TracerouteEnabled -and -not $SkipTraceroute\n            ClientSideChecks = -not $SkipClientSideChecks\n            RootCaExport = $script:Config.ExportRootCa\n        }\n        Verdict = if ($alertCount -eq 0) { \"No obvious MITM indicators detected\" } else { \"REVIEW REQUIRED - $alertCount alerts found\" }\n    }\n\n    $summary | ConvertTo-Json -Depth 3 | Set-Content (Join-Path $script:BaseDir \"Summary.json\") -Encoding UTF8\n\n    # Generate file hashes for chain of custody\n    Write-SubSection \"Generating Evidence Hashes\"\n\n    $hashManifest = @()\n    Get-ChildItem $script:BaseDir -Recurse -File | ForEach-Object {\n        $hash = Get-FileHash -Path $_.FullName -Algorithm $script:Config.HashAlgorithm\n        $relativePath = $_.FullName.Substring($script:BaseDir.Length + 1)\n        $hashManifest += [PSCustomObject]@{\n            File = $relativePath\n            Algorithm = $script:Config.HashAlgorithm\n            Hash = $hash.Hash\n        }\n    }\n\n    $hashManifest | ConvertTo-Json -Depth 3 | Set-Content (Join-Path $script:BaseDir \"_FileHashes.json\") -Encoding UTF8\n    Write-Log \"Generated hashes for $($hashManifest.Count) files\"\n\n    # Final output\n    Write-Host \"\"\n    Write-Host (\"=\" * 70) -ForegroundColor Green\n    Write-Host \" AUDIT COMPLETE\" -ForegroundColor Green\n    Write-Host (\"=\" * 70) -ForegroundColor Green\n    Write-Host \"\"\n    Write-Host \"Evidence Directory: $script:BaseDir\" -ForegroundColor Cyan\n    Write-Host \"\"\n\n    if ($alertCount -gt 0) {\n        Write-Host \"ALERTS FOUND: $alertCount\" -ForegroundColor Red\n        Write-Host \"Review _RedFlags.txt immediately!\" -ForegroundColor Yellow\n        Write-Host \"\"\n        Write-Host \"--- ALERTS ---\" -ForegroundColor Red\n        Get-Content $script:AlertFile | ForEach-Object { Write-Host \"  $_\" -ForegroundColor Yellow }\n    } else {\n        Write-Host \"No obvious MITM indicators detected.\" -ForegroundColor Green\n        Write-Host \"Note: Passive interception (logging only) may not trigger alerts.\" -ForegroundColor Yellow\n    }\n\n    Write-Host \"\"\n    Write-Host \"NEXT STEPS:\" -ForegroundColor Cyan\n    Write-Host \"  1. Review _RedFlags.txt for immediate concerns\" -ForegroundColor White\n    Write-Host \"  2. Check certificate serials against crt.sh (on clean network)\" -ForegroundColor White\n    Write-Host \"  3. Zip the evidence folder and hash the zip for chain of custody\" -ForegroundColor White\n    Write-Host \"\"\n}\n\n#endregion\n\n#region Main Execution\n\n# Load configuration\nif ($ConfigFile) {\n    Read-ConfigFile -Path $ConfigFile\n} else {\n    $defaultConfig = Join-Path $PSScriptRoot \"mitm-audit.cfg\"\n    if (Test-Path $defaultConfig) {\n        Read-ConfigFile -Path $defaultConfig\n    }\n}\n\n# Override targets if specified\nif ($Targets) {\n    $script:Config.Targets = $Targets -split \u0027,\u0027 | ForEach-Object { $_.Trim() }\n}\n\n# Initialize output\nInitialize-OutputDirectory -BasePath $OutputPath\n\nWrite-Host \"\"\nWrite-Host (\"=\" * 70) -ForegroundColor Cyan\nWrite-Host \" INFRASTRUCTURE MITM AUDIT - FORENSIC EVIDENCE COLLECTION\" -ForegroundColor Cyan\nWrite-Host (\"=\" * 70) -ForegroundColor Cyan\nWrite-Host \"Timestamp: $(Get-Date -Format \u0027yyyy-MM-dd HH:mm:ss\u0027)\"\nWrite-Host \"Evidence Directory: $script:BaseDir\"\nWrite-Host \"Targets: $($script:Config.Targets -join \u0027, \u0027)\"\nWrite-Host \"\"\n\nWrite-Log \"Audit started\"\nWrite-Log \"Targets: $($script:Config.Targets -join \u0027, \u0027)\"\n\n# Execute phases\nGet-EnvironmentSnapshot\nExport-TrustStore\nInvoke-TargetAnalysis\nInvoke-TracerouteMapping\nTest-ClientSideExploits\nComplete-EvidencePackage\n\nWrite-Log \"Audit completed\"\n\n#endregion\n","languageId":"powershell"}],"capabilityType":15,"toolFormerData":{"tool":38,"toolCallId":"toolu_01Tj3q1Rr6rw6f4vRfBXbUaq","toolIndex":1,"modelCallId":"f0c84d54-6785-4327-8ccf-bcd44f694061","status":"completed","rawArgs":"{\"file_path\": \"templates/network/Invoke-MitmAudit-v7.ps1\", \"contents\": \"#Requires -Version 7.0\\n\u003c#\\n.SYNOPSIS\\n    Infrastructure MITM Audit - Forensic Evidence Collection for TLS Interception Detection\\n\\n.DESCRIPTION\\n    Combines environment baselining, Root CA dumping, ASN-based integrity checking,\\n    and DoH comparison to detect infrastructure-side Man-in-the-Middle attacks while\\n    ruling out client-side exploits.\\n\\n    Produces a timestamped evidence package suitable for chain of custody.\\n\\n.PARAMETER ConfigFile\\n    Path to mitm-audit.cfg configuration file.\\n\\n.PARAMETER OutputPath\\n    Base directory for evidence collection (default: Desktop\\\\ForensicEvidence_timestamp)\\n\\n.PARAMETER Targets\\n    Override target domains from config (comma-separated)\\n\\n.PARAMETER SkipTraceroute\\n    Skip traceroute collection (faster but less complete)\\n\\n.PARAMETER SkipClientSideChecks\\n    Skip client-side exploit detection (browser extensions, proxy settings)\\n\\n.PARAMETER HashOnly\\n    Only generate hashes for existing evidence directory\\n\\n.EXAMPLE\\n    .\\\\Invoke-MitmAudit-v7.ps1\\n    .\\\\Invoke-MitmAudit-v7.ps1 -ConfigFile .\\\\mitm-audit.cfg\\n    .\\\\Invoke-MitmAudit-v7.ps1 -Targets \\\"accounts.google.com,github.com\\\"\\n    .\\\\Invoke-MitmAudit-v7.ps1 -SkipTraceroute -SkipClientSideChecks\\n\\n.NOTES\\n    License: BSD-2-Clause\\n    Requires: PowerShell 7+, Administrator privileges recommended\\n    Signed-off-by: Network Diagnostics Toolkit\\n\\n    Run as Administrator for complete Root CA export and network diagnostics.\\n\\n    EVIDENCE PROCESSING:\\n    1. Check _RedFlags.txt first - if empty, MITM may be passive/logging only\\n    2. Certificate Serial Check - copy serial to crt.sh on clean device\\n       - If \\\"No certificates found\\\": 100% MITM by private root CA\\n       - If cert shown for different domain: collision/hash attack\\n    3. Zip evidence folder, hash the zip for chain of custody\\n#\u003e\\n\\n[CmdletBinding()]\\nparam(\\n    [Parameter()]\\n    [string]$ConfigFile,\\n\\n    [Parameter()]\\n    [string]$OutputPath,\\n\\n    [Parameter()]\\n    [string]$Targets,\\n\\n    [Parameter()]\\n    [switch]$SkipTraceroute,\\n\\n    [Parameter()]\\n    [switch]$SkipClientSideChecks,\\n\\n    [Parameter()]\\n    [switch]$HashOnly\\n)\\n\\nSet-StrictMode -Version Latest\\n$ErrorActionPreference = \u0027Continue\u0027\\n\\n#region Configuration\\n\\n# Default configuration\\n$script:Config = @{\\n    Targets = @(\\\"accounts.google.com\\\", \\\"login.microsoftonline.com\\\", \\\"appleid.apple.com\\\", \\\"aws.amazon.com\\\", \\\"github.com\\\")\\n    PublicResolvers = @(\\\"1.1.1.1\\\", \\\"8.8.8.8\\\", \\\"9.9.9.9\\\")\\n    DohEndpoint = \\\"https://dns.google/resolve\\\"\\n    AsnLookupUrl = \\\"http://ip-api.com/json\\\"\\n    AsnLookupTimeout = 3\\n    ExternalIpUrl = \\\"https://ipinfo.io/json\\\"\\n    ExternalIpTimeout = 5\\n    ExpectedIspPatterns = @()\\n    SuspiciousAsnPatterns = @(\\\"DigitalOcean\\\", \\\"Linode\\\", \\\"Vultr\\\", \\\"Choopa\\\", \\\"Datacamp\\\", \\\"OVH\\\", \\\"Hetzner\\\")\\n    SuspiciousCertIssuers = @(\\\"Let\u0027s Encrypt\\\", \\\"ZeroSSL\\\", \\\"Self-Signed\\\", \\\"localhost\\\")\\n    TracerouteMaxHops = 15\\n    TracerouteTimeout = 2\\n    TracerouteEnabled = $true\\n    ExportRootCa = $true\\n    HashRootCa = $true\\n    CheckProxySettings = $true\\n    CheckBrowserExtensions = $true\\n    CheckHostsFile = $true\\n    CheckRootCaAnomalies = $true\\n    HashAlgorithm = \\\"SHA256\\\"\\n}\\n\\nfunction Read-ConfigFile {\\n    param([string]$Path)\\n\\n    if (-not (Test-Path $Path)) {\\n        Write-Warning \\\"Config file not found: $Path (using defaults)\\\"\\n        return\\n    }\\n\\n    Get-Content $Path | ForEach-Object {\\n        $line = $_.Trim()\\n        if ($line -match \u0027^#\u0027 -or $line -eq \u0027\u0027) { return }\\n        if ($line -match \u0027^([^=]+)=(.*)$\u0027) {\\n            $key = $Matches[1].Trim()\\n            $value = $Matches[2].Trim()\\n\\n            switch ($key) {\\n                \u0027TARGETS\u0027 { $script:Config.Targets = $value -split \u0027,\u0027 | ForEach-Object { $_.Trim() } }\\n                \u0027PUBLIC_RESOLVERS\u0027 { $script:Config.PublicResolvers = $value -split \u0027,\u0027 | ForEach-Object { $_.Trim() } }\\n                \u0027DOH_ENDPOINT\u0027 { $script:Config.DohEndpoint = $value }\\n                \u0027ASN_LOOKUP_URL\u0027 { $script:Config.AsnLookupUrl = $value }\\n                \u0027ASN_LOOKUP_TIMEOUT_SEC\u0027 { $script:Config.AsnLookupTimeout = [int]$value }\\n                \u0027EXTERNAL_IP_URL\u0027 { $script:Config.ExternalIpUrl = $value }\\n                \u0027EXTERNAL_IP_TIMEOUT_SEC\u0027 { $script:Config.ExternalIpTimeout = [int]$value }\\n                \u0027EXPECTED_ISP_PATTERNS\u0027 { if ($value) { $script:Config.ExpectedIspPatterns = $value -split \u0027,\u0027 | ForEach-Object { $_.Trim() } } }\\n                \u0027SUSPICIOUS_ASN_PATTERNS\u0027 { $script:Config.SuspiciousAsnPatterns = $value -split \u0027,\u0027 | ForEach-Object { $_.Trim() } }\\n                \u0027SUSPICIOUS_CERT_ISSUERS\u0027 { $script:Config.SuspiciousCertIssuers = $value -split \u0027,\u0027 | ForEach-Object { $_.Trim() } }\\n                \u0027TRACEROUTE_MAX_HOPS\u0027 { $script:Config.TracerouteMaxHops = [int]$value }\\n                \u0027TRACEROUTE_TIMEOUT_SEC\u0027 { $script:Config.TracerouteTimeout = [int]$value }\\n                \u0027TRACEROUTE_ENABLED\u0027 { $script:Config.TracerouteEnabled = $value -eq \u0027true\u0027 }\\n                \u0027EXPORT_ROOT_CA\u0027 { $script:Config.ExportRootCa = $value -eq \u0027true\u0027 }\\n                \u0027HASH_ROOT_CA\u0027 { $script:Config.HashRootCa = $value -eq \u0027true\u0027 }\\n                \u0027CHECK_PROXY_SETTINGS\u0027 { $script:Config.CheckProxySettings = $value -eq \u0027true\u0027 }\\n                \u0027CHECK_BROWSER_EXTENSIONS\u0027 { $script:Config.CheckBrowserExtensions = $value -eq \u0027true\u0027 }\\n                \u0027CHECK_HOSTS_FILE\u0027 { $script:Config.CheckHostsFile = $value -eq \u0027true\u0027 }\\n                \u0027CHECK_ROOT_CA_ANOMALIES\u0027 { $script:Config.CheckRootCaAnomalies = $value -eq \u0027true\u0027 }\\n                \u0027HASH_ALGORITHM\u0027 { $script:Config.HashAlgorithm = $value }\\n            }\\n        }\\n    }\\n}\\n\\n#endregion\\n\\n#region Logging and Output\\n\\n$script:LogFile = $null\\n$script:AlertFile = $null\\n\\nfunction Initialize-OutputDirectory {\\n    param([string]$BasePath)\\n\\n    $timestamp = Get-Date -Format \\\"yyyyMMdd_HHmmss\\\"\\n\\n    if ($BasePath) {\\n        $script:BaseDir = $BasePath\\n    } else {\\n        $script:BaseDir = Join-Path $env:USERPROFILE \\\"Desktop\\\\ForensicEvidence_$timestamp\\\"\\n    }\\n\\n    New-Item -Path $script:BaseDir -ItemType Directory -Force | Out-Null\\n    $script:LogFile = Join-Path $script:BaseDir \\\"_AuditLog.txt\\\"\\n    $script:AlertFile = Join-Path $script:BaseDir \\\"_RedFlags.txt\\\"\\n\\n    # Initialize files\\n    \\\"\\\" | Set-Content $script:AlertFile -Encoding UTF8\\n}\\n\\nfunction Write-Log {\\n    param([string]$Message, [string]$Level = \\\"INFO\\\")\\n\\n    $timestamp = Get-Date -Format \\\"yyyy-MM-dd HH:mm:ss\\\"\\n    $logEntry = \\\"[$timestamp] [$Level] $Message\\\"\\n\\n    switch ($Level) {\\n        \\\"ERROR\\\" { Write-Host $logEntry -ForegroundColor Red }\\n        \\\"WARN\\\"  { Write-Host $logEntry -ForegroundColor Yellow }\\n        \\\"ALERT\\\" { Write-Host \\\"[!] $Message\\\" -ForegroundColor Red }\\n        default { Write-Host $logEntry }\\n    }\\n\\n    Add-Content -Path $script:LogFile -Value $logEntry -Encoding UTF8\\n}\\n\\nfunction Write-Alert {\\n    param([string]$Message)\\n\\n    Write-Log -Message $Message -Level \\\"ALERT\\\"\\n    $timestamp = Get-Date -Format \\\"yyyy-MM-dd HH:mm:ss\\\"\\n    Add-Content -Path $script:AlertFile -Value \\\"[$timestamp] $Message\\\" -Encoding UTF8\\n}\\n\\nfunction Write-Section {\\n    param([string]$Title)\\n    Write-Host \\\"\\\"\\n    Write-Host (\\\"=\\\" * 70) -ForegroundColor Cyan\\n    Write-Host \\\" $Title\\\" -ForegroundColor Cyan\\n    Write-Host (\\\"=\\\" * 70) -ForegroundColor Cyan\\n    Write-Log \\\"=== $Title ===\\\" -Level \\\"INFO\\\"\\n}\\n\\nfunction Write-SubSection {\\n    param([string]$Title)\\n    Write-Host \\\"\\\"\\n    Write-Host \\\"[*] $Title\\\" -ForegroundColor Yellow\\n    Write-Host (\\\"-\\\" * 50)\\n    Write-Log \\\"--- $Title ---\\\" -Level \\\"INFO\\\"\\n}\\n\\n#endregion\\n\\n#region ASN and DNS Functions\\n\\nfunction Get-ASN {\\n    param([string]$IP)\\n\\n    try {\\n        $uri = \\\"$($script:Config.AsnLookupUrl)/$IP`?fields=status,message,org,as\\\"\\n        $response = Invoke-RestMethod -Uri $uri -TimeoutSec $script:Config.AsnLookupTimeout -ErrorAction Stop\\n\\n        if ($response.status -eq \\\"success\\\") {\\n            return \\\"$($response.org) ($($response.as))\\\"\\n        } else {\\n            return \\\"Unknown\\\"\\n        }\\n    } catch {\\n        return \\\"Lookup Failed (Blocked?)\\\"\\n    }\\n}\\n\\nfunction Get-DohResolution {\\n    param([string]$Domain)\\n\\n    try {\\n        $uri = \\\"$($script:Config.DohEndpoint)?name=$Domain\u0026type=A\\\"\\n        $response = Invoke-RestMethod -Uri $uri -TimeoutSec 5 -ErrorAction Stop\\n\\n        if ($response.Answer -and $response.Answer.Count -gt 0) {\\n            return $response.Answer[0].data\\n        }\\n        return $null\\n    } catch {\\n        return $null\\n    }\\n}\\n\\nfunction Test-AsnIntegrity {\\n    param(\\n        [string]$Domain,\\n        [string]$Asn\\n    )\\n\\n    if ($Asn -eq \\\"Lookup Failed (Blocked?)\\\") {\\n        return $null  # Cannot determine\\n    }\\n\\n    # Check against expected patterns\\n    if ($Domain -match \\\"google\\\" -and $Asn -notmatch \\\"Google\\\") {\\n        return \\\"MITM DETECTED: $Domain resolving to non-Google ASN ($Asn)\\\"\\n    }\\n    if ($Domain -match \\\"microsoft\\\" -and $Asn -notmatch \\\"Microsoft\\\") {\\n        return \\\"MITM DETECTED: $Domain resolving to non-Microsoft ASN ($Asn)\\\"\\n    }\\n    if ($Domain -match \\\"apple\\\" -and $Asn -notmatch \\\"Apple\\\") {\\n        return \\\"MITM DETECTED: $Domain resolving to non-Apple ASN ($Asn)\\\"\\n    }\\n    if ($Domain -match \\\"aws\\\\.amazon|amazonaws\\\" -and $Asn -notmatch \\\"Amazon|AMAZON\\\") {\\n        return \\\"MITM DETECTED: $Domain resolving to non-Amazon ASN ($Asn)\\\"\\n    }\\n    if ($Domain -match \\\"github\\\" -and $Asn -notmatch \\\"GitHub|Microsoft\\\") {\\n        return \\\"MITM DETECTED: $Domain resolving to non-GitHub/Microsoft ASN ($Asn)\\\"\\n    }\\n\\n    # Check for suspicious VPS providers\\n    foreach ($pattern in $script:Config.SuspiciousAsnPatterns) {\\n        if ($Asn -match $pattern) {\\n            return \\\"MITM DETECTED: High-value target routed to VPS provider ($pattern)\\\"\\n        }\\n    }\\n\\n    return $null\\n}\\n\\n#endregion\\n\\n#region Certificate Functions\\n\\nfunction Get-TlsCertificate {\\n    param([string]$Domain, [int]$Port = 443)\\n\\n    try {\\n        $tcpClient = New-Object System.Net.Sockets.TcpClient\\n        $tcpClient.Connect($Domain, $Port)\\n        $sslStream = New-Object System.Net.Security.SslStream($tcpClient.GetStream(), $false, { $true })\\n        $sslStream.AuthenticateAsClient($Domain)\\n        $cert = $sslStream.RemoteCertificate\\n\\n        $certInfo = [PSCustomObject]@{\\n            Subject = $cert.Subject\\n            Issuer = $cert.Issuer\\n            SerialNumber = $cert.GetSerialNumberString()\\n            Thumbprint = $cert.GetCertHashString()\\n            NotBefore = $cert.GetEffectiveDateString()\\n            NotAfter = $cert.GetExpirationDateString()\\n        }\\n\\n        $sslStream.Close()\\n        $tcpClient.Close()\\n\\n        return $certInfo\\n    } catch {\\n        return [PSCustomObject]@{\\n            Error = $_.Exception.Message\\n            Domain = $Domain\\n        }\\n    }\\n}\\n\\nfunction Test-CertificateAnomaly {\\n    param(\\n        [string]$Domain,\\n        [PSCustomObject]$CertInfo\\n    )\\n\\n    if ($CertInfo.Error) {\\n        return \\\"TLS Handshake Failed for $Domain - Interception likely causing protocol error\\\"\\n    }\\n\\n    # Check for suspicious issuers on major tech domains\\n    foreach ($issuerPattern in $script:Config.SuspiciousCertIssuers) {\\n        $isMajorTech = $Domain -match \\\"google|microsoft|apple|amazon|github\\\"\\n        if ($isMajorTech -and $CertInfo.Issuer -match $issuerPattern) {\\n            return \\\"CERTIFICATE ANOMALY: $Domain using $issuerPattern issuer - highly suspicious for major tech corp\\\"\\n        }\\n    }\\n\\n    return $null\\n}\\n\\n#endregion\\n\\n#region Phase 1: Environment Snapshot\\n\\nfunction Get-EnvironmentSnapshot {\\n    Write-Section \\\"PHASE 1: ENVIRONMENT SNAPSHOT\\\"\\n\\n    $envDir = Join-Path $script:BaseDir \\\"environment\\\"\\n    New-Item -Path $envDir -ItemType Directory -Force | Out-Null\\n\\n    # Network configuration\\n    Write-SubSection \\\"Network Configuration\\\"\\n    $netConfig = Get-NetIPConfiguration | Select-Object InterfaceAlias, IPv4Address, IPv4DefaultGateway, DNSServer\\n    $netConfig | ConvertTo-Json -Depth 5 | Set-Content (Join-Path $envDir \\\"NetworkConfig.json\\\") -Encoding UTF8\\n    Get-NetIPConfiguration | Out-File (Join-Path $envDir \\\"NetworkConfig.txt\\\") -Encoding UTF8\\n\\n    # External IP\\n    Write-SubSection \\\"External IP Identification\\\"\\n    try {\\n        $extIp = Invoke-RestMethod -Uri $script:Config.ExternalIpUrl -TimeoutSec $script:Config.ExternalIpTimeout\\n        $extIp | ConvertTo-Json | Set-Content (Join-Path $envDir \\\"ExternalIP.json\\\") -Encoding UTF8\\n\\n        Write-Log \\\"External IP: $($extIp.ip)\\\"\\n        Write-Log \\\"External Org: $($extIp.org)\\\"\\n        Write-Log \\\"Location: $($extIp.city), $($extIp.region), $($extIp.country)\\\"\\n\\n        # Check expected ISP\\n        if ($script:Config.ExpectedIspPatterns.Count -gt 0) {\\n            $isExpectedIsp = $false\\n            foreach ($pattern in $script:Config.ExpectedIspPatterns) {\\n                if ($extIp.org -match $pattern) {\\n                    $isExpectedIsp = $true\\n                    break\\n                }\\n            }\\n            if (-not $isExpectedIsp) {\\n                Write-Alert \\\"External IP Org ($($extIp.org)) does not match expected ISP patterns - traffic may be tunneled/proxied\\\"\\n            }\\n        }\\n    } catch {\\n        Write-Alert \\\"Unable to determine External IP - connection may be blocked or filtered\\\"\\n    }\\n\\n    # System info\\n    Write-SubSection \\\"System Information\\\"\\n    $sysInfo = [PSCustomObject]@{\\n        ComputerName = $env:COMPUTERNAME\\n        UserName = $env:USERNAME\\n        UserDomain = $env:USERDOMAIN\\n        OSVersion = [System.Environment]::OSVersion.VersionString\\n        PowerShellVersion = $PSVersionTable.PSVersion.ToString()\\n        Is64Bit = [System.Environment]::Is64BitOperatingSystem\\n        IsAdmin = ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)\\n        Timestamp = (Get-Date).ToString(\\\"o\\\")\\n    }\\n    $sysInfo | ConvertTo-Json | Set-Content (Join-Path $envDir \\\"SystemInfo.json\\\") -Encoding UTF8\\n    Write-Log \\\"System: $($sysInfo.ComputerName) / User: $($sysInfo.UserName) / Admin: $($sysInfo.IsAdmin)\\\"\\n}\\n\\n#endregion\\n\\n#region Phase 2: Trust Store Export\\n\\nfunction Export-TrustStore {\\n    Write-Section \\\"PHASE 2: TRUST STORE EXPORT\\\"\\n\\n    $trustDir = Join-Path $script:BaseDir \\\"trust-store\\\"\\n    New-Item -Path $trustDir -ItemType Directory -Force | Out-Null\\n\\n    if (-not $script:Config.ExportRootCa) {\\n        Write-Log \\\"Root CA export disabled in configuration\\\"\\n        return\\n    }\\n\\n    Write-SubSection \\\"Exporting Root CA Store\\\"\\n\\n    # Export Root CAs\\n    $rootCAs = Get-ChildItem Cert:\\\\LocalMachine\\\\Root\\n    $rootCaData = $rootCAs | Select-Object Thumbprint, Subject, Issuer, NotBefore, NotAfter, @{N=\u0027SignatureAlgorithm\u0027;E={$_.SignatureAlgorithm.FriendlyName}}\\n\\n    # Export to CSV\\n    $csvPath = Join-Path $trustDir \\\"RootStore_Dump.csv\\\"\\n    $rootCaData | Export-Csv -Path $csvPath -NoTypeInformation -Encoding UTF8\\n    Write-Log \\\"Root CA Store exported to $csvPath ($($rootCAs.Count) certificates)\\\"\\n\\n    # Export to JSON for programmatic access\\n    $jsonPath = Join-Path $trustDir \\\"RootStore_Dump.json\\\"\\n    $rootCaData | ConvertTo-Json -Depth 3 | Set-Content $jsonPath -Encoding UTF8\\n\\n    # Hash the export if configured\\n    if ($script:Config.HashRootCa) {\\n        $hash = Get-FileHash -Path $csvPath -Algorithm $script:Config.HashAlgorithm\\n        $hash | ConvertTo-Json | Set-Content (Join-Path $trustDir \\\"RootStore_Hash.json\\\") -Encoding UTF8\\n        Write-Log \\\"Root CA hash: $($hash.Hash)\\\"\\n    }\\n\\n    # Check for anomalies\\n    if ($script:Config.CheckRootCaAnomalies) {\\n        Write-SubSection \\\"Root CA Anomaly Detection\\\"\\n\\n        $suspicious = @()\\n\\n        foreach ($ca in $rootCAs) {\\n            # Check for self-signed certs with suspicious names\\n            if ($ca.Subject -match \\\"Self|Test|Admin|Local|Proxy|Intercept|MITM\\\") {\\n                $suspicious += [PSCustomObject]@{\\n                    Thumbprint = $ca.Thumbprint\\n                    Subject = $ca.Subject\\n                    Reason = \\\"Suspicious name pattern in certificate subject\\\"\\n                }\\n            }\\n\\n            # Check for recently added certs (within last 30 days)\\n            if ($ca.NotBefore -gt (Get-Date).AddDays(-30)) {\\n                $suspicious += [PSCustomObject]@{\\n                    Thumbprint = $ca.Thumbprint\\n                    Subject = $ca.Subject\\n                    NotBefore = $ca.NotBefore\\n                    Reason = \\\"Recently added root CA (within last 30 days)\\\"\\n                }\\n            }\\n\\n            # Check for common enterprise MITM tools\\n            if ($ca.Subject -match \\\"Zscaler|BlueCoat|Forcepoint|McAfee|Symantec Web Gateway|Websense|Palo Alto\\\") {\\n                $suspicious += [PSCustomObject]@{\\n                    Thumbprint = $ca.Thumbprint\\n                    Subject = $ca.Subject\\n                    Reason = \\\"Enterprise TLS inspection tool detected\\\"\\n                }\\n            }\\n        }\\n\\n        if ($suspicious.Count -gt 0) {\\n            $suspicious | ConvertTo-Json -Depth 3 | Set-Content (Join-Path $trustDir \\\"SuspiciousCAs.json\\\") -Encoding UTF8\\n            foreach ($s in $suspicious) {\\n                Write-Alert \\\"Suspicious Root CA: $($s.Subject) - $($s.Reason)\\\"\\n            }\\n        } else {\\n            Write-Log \\\"No suspicious root CAs detected\\\"\\n        }\\n    }\\n}\\n\\n#endregion\\n\\n#region Phase 3: Target Analysis\\n\\nfunction Invoke-TargetAnalysis {\\n    Write-Section \\\"PHASE 3: TARGET ANALYSIS AND ASN INTEGRITY\\\"\\n\\n    $targetsDir = Join-Path $script:BaseDir \\\"targets\\\"\\n    New-Item -Path $targetsDir -ItemType Directory -Force | Out-Null\\n\\n    foreach ($domain in $script:Config.Targets) {\\n        Write-SubSection \\\"Analyzing: $domain\\\"\\n\\n        $safeDomain = $domain -replace \u0027\\\\.\u0027, \u0027_\u0027\\n        $domainDir = Join-Path $targetsDir $safeDomain\\n        New-Item -Path $domainDir -ItemType Directory -Force | Out-Null\\n\\n        $analysis = [PSCustomObject]@{\\n            Domain = $domain\\n            Timestamp = (Get-Date).ToString(\\\"o\\\")\\n            LocalDns = $null\\n            LocalAsn = $null\\n            DohDns = $null\\n            DohAsn = $null\\n            Certificate = $null\\n            Alerts = @()\\n        }\\n\\n        # A. Local DNS Resolution\\n        try {\\n            $localIp = (Resolve-DnsName -Name $domain -Type A -ErrorAction SilentlyContinue).IPAddress | Select-Object -First 1\\n            $analysis.LocalDns = $localIp\\n\\n            if ($localIp) {\\n                $localAsn = Get-ASN -IP $localIp\\n                $analysis.LocalAsn = $localAsn\\n                Write-Log \\\"Local DNS: $localIp | ASN: $localAsn\\\"\\n            } else {\\n                Write-Log \\\"Local DNS resolution failed\\\" -Level \\\"WARN\\\"\\n            }\\n        } catch {\\n            Write-Log \\\"DNS resolution error: $_\\\" -Level \\\"ERROR\\\"\\n        }\\n\\n        # B. DoH Resolution (Control Group)\\n        $dohIp = Get-DohResolution -Domain $domain\\n        if ($dohIp) {\\n            $analysis.DohDns = $dohIp\\n            $dohAsn = Get-ASN -IP $dohIp\\n            $analysis.DohAsn = $dohAsn\\n            Write-Log \\\"DoH DNS:   $dohIp | ASN: $dohAsn\\\"\\n\\n            # Compare IPs\\n            if ($analysis.LocalDns -and $analysis.LocalDns -ne $dohIp) {\\n                Write-Log \\\"DNS MISMATCH: Local ($($analysis.LocalDns)) vs DoH ($dohIp)\\\" -Level \\\"WARN\\\"\\n            }\\n        } else {\\n            Write-Log \\\"DoH resolution failed (network may be blocking)\\\" -Level \\\"WARN\\\"\\n        }\\n\\n        # C. ASN Integrity Check\\n        if ($analysis.LocalAsn) {\\n            $asnAlert = Test-AsnIntegrity -Domain $domain -Asn $analysis.LocalAsn\\n            if ($asnAlert) {\\n                Write-Alert $asnAlert\\n                $analysis.Alerts += $asnAlert\\n            }\\n        }\\n\\n        # D. Certificate Capture\\n        Write-Log \\\"Capturing TLS certificate...\\\"\\n        $certInfo = Get-TlsCertificate -Domain $domain\\n        $analysis.Certificate = $certInfo\\n\\n        $certPath = Join-Path $domainDir \\\"Certificate.json\\\"\\n        $certInfo | ConvertTo-Json -Depth 3 | Set-Content $certPath -Encoding UTF8\\n\\n        if ($certInfo.SerialNumber) {\\n            Write-Log \\\"Certificate Serial: $($certInfo.SerialNumber)\\\"\\n            Write-Log \\\"Certificate Issuer: $($certInfo.Issuer)\\\"\\n\\n            # Check for certificate anomalies\\n            $certAlert = Test-CertificateAnomaly -Domain $domain -CertInfo $certInfo\\n            if ($certAlert) {\\n                Write-Alert $certAlert\\n                $analysis.Alerts += $certAlert\\n            }\\n        } else {\\n            Write-Alert \\\"TLS Handshake Failed for $domain - $($certInfo.Error)\\\"\\n            $analysis.Alerts += \\\"TLS Handshake Failed: $($certInfo.Error)\\\"\\n        }\\n\\n        # Save analysis\\n        $analysis | ConvertTo-Json -Depth 5 | Set-Content (Join-Path $domainDir \\\"Analysis.json\\\") -Encoding UTF8\\n    }\\n}\\n\\n#endregion\\n\\n#region Phase 4: Traceroute Mapping\\n\\nfunction Invoke-TracerouteMapping {\\n    Write-Section \\\"PHASE 4: TRACEROUTE MAPPING\\\"\\n\\n    if (-not $script:Config.TracerouteEnabled -or $SkipTraceroute) {\\n        Write-Log \\\"Traceroute skipped (disabled or -SkipTraceroute specified)\\\"\\n        return\\n    }\\n\\n    $traceDir = Join-Path $script:BaseDir \\\"traceroute\\\"\\n    New-Item -Path $traceDir -ItemType Directory -Force | Out-Null\\n\\n    foreach ($domain in $script:Config.Targets) {\\n        Write-SubSection \\\"Tracing: $domain\\\"\\n\\n        $safeDomain = $domain -replace \u0027\\\\.\u0027, \u0027_\u0027\\n        $tracePath = Join-Path $traceDir \\\"Trace_$safeDomain.txt\\\"\\n        $traceJsonPath = Join-Path $traceDir \\\"Trace_$safeDomain.json\\\"\\n\\n        try {\\n            $trace = Test-NetConnection -ComputerName $domain -TraceRoute -WarningAction SilentlyContinue\\n            $hops = $trace.TraceRoute\\n\\n            # Save text output\\n            $hops | Out-File $tracePath -Encoding UTF8\\n\\n            # Save JSON with ASN lookup for each hop\\n            $hopDetails = @()\\n            $hopNum = 1\\n            foreach ($hop in $hops) {\\n                if ($hop -and $hop -ne \\\"*\\\") {\\n                    $asn = Get-ASN -IP $hop\\n                    $hopDetails += [PSCustomObject]@{\\n                        Hop = $hopNum\\n                        IP = $hop\\n                        ASN = $asn\\n                    }\\n\\n                    # Check for suspicious hops\\n                    foreach ($pattern in $script:Config.SuspiciousAsnPatterns) {\\n                        if ($asn -match $pattern) {\\n                            Write-Alert \\\"Suspicious hop in traceroute to $domain - Hop $hopNum ($hop) routes through $pattern\\\"\\n                        }\\n                    }\\n                }\\n                $hopNum++\\n            }\\n\\n            $hopDetails | ConvertTo-Json -Depth 3 | Set-Content $traceJsonPath -Encoding UTF8\\n            Write-Log \\\"Trace complete: $($hops.Count) hops\\\"\\n        } catch {\\n            Write-Log \\\"Traceroute failed: $_\\\" -Level \\\"ERROR\\\"\\n        }\\n    }\\n}\\n\\n#endregion\\n\\n#region Phase 5: Client-Side Exploit Detection\\n\\nfunction Test-ClientSideExploits {\\n    Write-Section \\\"PHASE 5: CLIENT-SIDE EXPLOIT DETECTION\\\"\\n\\n    if ($SkipClientSideChecks) {\\n        Write-Log \\\"Client-side checks skipped (-SkipClientSideChecks specified)\\\"\\n        return\\n    }\\n\\n    $clientDir = Join-Path $script:BaseDir \\\"client-side\\\"\\n    New-Item -Path $clientDir -ItemType Directory -Force | Out-Null\\n\\n    # A. Proxy Settings\\n    if ($script:Config.CheckProxySettings) {\\n        Write-SubSection \\\"Proxy Settings Check\\\"\\n\\n        $proxyInfo = [PSCustomObject]@{\\n            SystemProxy = $null\\n            EnvironmentProxy = $null\\n            WinHttpProxy = $null\\n            Alerts = @()\\n        }\\n\\n        # System proxy (Internet Options)\\n        try {\\n            $regPath = \\\"HKCU:\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Internet Settings\\\"\\n            $proxyEnabled = Get-ItemProperty -Path $regPath -Name ProxyEnable -ErrorAction SilentlyContinue\\n            $proxyServer = Get-ItemProperty -Path $regPath -Name ProxyServer -ErrorAction SilentlyContinue\\n\\n            $proxyInfo.SystemProxy = [PSCustomObject]@{\\n                Enabled = [bool]$proxyEnabled.ProxyEnable\\n                Server = $proxyServer.ProxyServer\\n            }\\n\\n            if ($proxyEnabled.ProxyEnable) {\\n                Write-Alert \\\"System proxy is ENABLED: $($proxyServer.ProxyServer)\\\"\\n                $proxyInfo.Alerts += \\\"System proxy enabled\\\"\\n            } else {\\n                Write-Log \\\"System proxy: Disabled\\\"\\n            }\\n        } catch {\\n            Write-Log \\\"Could not read system proxy settings\\\" -Level \\\"WARN\\\"\\n        }\\n\\n        # Environment variables\\n        $envProxy = @{\\n            HTTP_PROXY = $env:HTTP_PROXY\\n            HTTPS_PROXY = $env:HTTPS_PROXY\\n            ALL_PROXY = $env:ALL_PROXY\\n            NO_PROXY = $env:NO_PROXY\\n        }\\n        $proxyInfo.EnvironmentProxy = $envProxy\\n\\n        foreach ($key in $envProxy.Keys) {\\n            if ($envProxy[$key]) {\\n                Write-Alert \\\"Environment proxy variable set: $key = $($envProxy[$key])\\\"\\n                $proxyInfo.Alerts += \\\"Env proxy: $key\\\"\\n            }\\n        }\\n\\n        # WinHTTP proxy\\n        try {\\n            $winhttp = netsh winhttp show proxy 2\u003e\u00261\\n            $proxyInfo.WinHttpProxy = $winhttp -join \\\"`n\\\"\\n            if ($winhttp -match \\\"Proxy Server\\\") {\\n                Write-Alert \\\"WinHTTP proxy configured - check output for details\\\"\\n            }\\n        } catch {\\n            Write-Log \\\"Could not check WinHTTP proxy\\\" -Level \\\"WARN\\\"\\n        }\\n\\n        $proxyInfo | ConvertTo-Json -Depth 3 | Set-Content (Join-Path $clientDir \\\"ProxySettings.json\\\") -Encoding UTF8\\n    }\\n\\n    # B. Hosts File Check\\n    if ($script:Config.CheckHostsFile) {\\n        Write-SubSection \\\"Hosts File Analysis\\\"\\n\\n        $hostsPath = \\\"$env:SystemRoot\\\\System32\\\\drivers\\\\etc\\\\hosts\\\"\\n        $hostsContent = Get-Content $hostsPath -ErrorAction SilentlyContinue\\n\\n        $hostsInfo = [PSCustomObject]@{\\n            Path = $hostsPath\\n            Entries = @()\\n            Suspicious = @()\\n        }\\n\\n        $sensitivePatterns = @(\\\"google\\\", \\\"microsoft\\\", \\\"apple\\\", \\\"amazon\\\", \\\"github\\\", \\\"cursor\\\", \\\"openai\\\", \\\"anthropic\\\")\\n\\n        foreach ($line in $hostsContent) {\\n            if ($line -match \u0027^\\\\s*#\u0027 -or $line -match \u0027^\\\\s*$\u0027) { continue }\\n\\n            $parts = $line -split \u0027\\\\s+\u0027, 2\\n            if ($parts.Count -ge 2) {\\n                $ip = $parts[0]\\n                $hostnames = $parts[1] -split \u0027\\\\s+\u0027\\n\\n                $entry = [PSCustomObject]@{\\n                    IP = $ip\\n                    Hostnames = $hostnames\\n                }\\n                $hostsInfo.Entries += $entry\\n\\n                foreach ($hostname in $hostnames) {\\n                    foreach ($pattern in $sensitivePatterns) {\\n                        if ($hostname -match $pattern -and $ip -notmatch \u0027^(127\\\\.0\\\\.0\\\\.1|::1|0\\\\.0\\\\.0\\\\.0)$\u0027) {\\n                            $suspicious = [PSCustomObject]@{\\n                                Entry = $entry\\n                                Reason = \\\"Redirect of $pattern domain to $ip\\\"\\n                            }\\n                            $hostsInfo.Suspicious += $suspicious\\n                            Write-Alert \\\"Hosts file redirect: $hostname -\u003e $ip\\\"\\n                        }\\n                    }\\n                }\\n            }\\n        }\\n\\n        $hostsInfo | ConvertTo-Json -Depth 3 | Set-Content (Join-Path $clientDir \\\"HostsFile.json\\\") -Encoding UTF8\\n        Write-Log \\\"Hosts file entries: $($hostsInfo.Entries.Count), Suspicious: $($hostsInfo.Suspicious.Count)\\\"\\n    }\\n\\n    # C. Browser Extensions (Chrome/Edge)\\n    if ($script:Config.CheckBrowserExtensions) {\\n        Write-SubSection \\\"Browser Extension Audit\\\"\\n\\n        $extInfo = [PSCustomObject]@{\\n            Chrome = @()\\n            Edge = @()\\n            Suspicious = @()\\n        }\\n\\n        # Suspicious extension patterns\\n        $suspiciousPatterns = @(\\\"proxy\\\", \\\"vpn\\\", \\\"intercept\\\", \\\"modify\\\", \\\"inject\\\", \\\"ssl\\\", \\\"certificate\\\", \\\"mitm\\\")\\n\\n        # Chrome extensions\\n        $chromePath = \\\"$env:LOCALAPPDATA\\\\Google\\\\Chrome\\\\User Data\\\\Default\\\\Extensions\\\"\\n        if (Test-Path $chromePath) {\\n            $chromeExts = Get-ChildItem $chromePath -Directory -ErrorAction SilentlyContinue\\n            foreach ($ext in $chromeExts) {\\n                $manifestPath = Get-ChildItem $ext.FullName -Filter \\\"manifest.json\\\" -Recurse -ErrorAction SilentlyContinue | Select-Object -First 1\\n                if ($manifestPath) {\\n                    try {\\n                        $manifest = Get-Content $manifestPath.FullName -Raw | ConvertFrom-Json\\n                        $extData = [PSCustomObject]@{\\n                            Id = $ext.Name\\n                            Name = $manifest.name\\n                            Version = $manifest.version\\n                            Permissions = $manifest.permissions\\n                        }\\n                        $extInfo.Chrome += $extData\\n\\n                        # Check for suspicious permissions\\n                        $perms = $manifest.permissions -join \\\",\\\"\\n                        foreach ($pattern in $suspiciousPatterns) {\\n                            if ($manifest.name -match $pattern -or $perms -match $pattern) {\\n                                $extInfo.Suspicious += [PSCustomObject]@{\\n                                    Browser = \\\"Chrome\\\"\\n                                    Extension = $extData\\n                                    Reason = \\\"Suspicious pattern: $pattern\\\"\\n                                }\\n                                Write-Alert \\\"Suspicious Chrome extension: $($manifest.name)\\\"\\n                            }\\n                        }\\n\\n                        # Check for webRequest/webRequestBlocking (can intercept requests)\\n                        if ($perms -match \\\"webRequest|webRequestBlocking\\\") {\\n                            $extInfo.Suspicious += [PSCustomObject]@{\\n                                Browser = \\\"Chrome\\\"\\n                                Extension = $extData\\n                                Reason = \\\"Has webRequest permission (can intercept/modify requests)\\\"\\n                            }\\n                            Write-Log \\\"Chrome extension with webRequest: $($manifest.name)\\\" -Level \\\"WARN\\\"\\n                        }\\n                    } catch {\\n                        # Skip malformed manifests\\n                    }\\n                }\\n            }\\n        }\\n\\n        # Edge extensions (same structure as Chrome)\\n        $edgePath = \\\"$env:LOCALAPPDATA\\\\Microsoft\\\\Edge\\\\User Data\\\\Default\\\\Extensions\\\"\\n        if (Test-Path $edgePath) {\\n            $edgeExts = Get-ChildItem $edgePath -Directory -ErrorAction SilentlyContinue\\n            foreach ($ext in $edgeExts) {\\n                $manifestPath = Get-ChildItem $ext.FullName -Filter \\\"manifest.json\\\" -Recurse -ErrorAction SilentlyContinue | Select-Object -First 1\\n                if ($manifestPath) {\\n                    try {\\n                        $manifest = Get-Content $manifestPath.FullName -Raw | ConvertFrom-Json\\n                        $extData = [PSCustomObject]@{\\n                            Id = $ext.Name\\n                            Name = $manifest.name\\n                            Version = $manifest.version\\n                            Permissions = $manifest.permissions\\n                        }\\n                        $extInfo.Edge += $extData\\n\\n                        $perms = $manifest.permissions -join \\\",\\\"\\n                        foreach ($pattern in $suspiciousPatterns) {\\n                            if ($manifest.name -match $pattern -or $perms -match $pattern) {\\n                                $extInfo.Suspicious += [PSCustomObject]@{\\n                                    Browser = \\\"Edge\\\"\\n                                    Extension = $extData\\n                                    Reason = \\\"Suspicious pattern: $pattern\\\"\\n                                }\\n                                Write-Alert \\\"Suspicious Edge extension: $($manifest.name)\\\"\\n                            }\\n                        }\\n                    } catch {\\n                        # Skip malformed manifests\\n                    }\\n                }\\n            }\\n        }\\n\\n        $extInfo | ConvertTo-Json -Depth 5 | Set-Content (Join-Path $clientDir \\\"BrowserExtensions.json\\\") -Encoding UTF8\\n        Write-Log \\\"Chrome extensions: $($extInfo.Chrome.Count), Edge extensions: $($extInfo.Edge.Count)\\\"\\n    }\\n}\\n\\n#endregion\\n\\n#region Phase 6: Evidence Finalization\\n\\nfunction Complete-EvidencePackage {\\n    Write-Section \\\"PHASE 6: EVIDENCE FINALIZATION\\\"\\n\\n    # Generate summary\\n    Write-SubSection \\\"Generating Summary\\\"\\n\\n    $alertContent = Get-Content $script:AlertFile -ErrorAction SilentlyContinue\\n    $alertCount = ($alertContent | Where-Object { $_ -ne \u0027\u0027 }).Count\\n\\n    $summary = [PSCustomObject]@{\\n        AuditTimestamp = (Get-Date).ToString(\\\"o\\\")\\n        EvidenceDirectory = $script:BaseDir\\n        TotalAlerts = $alertCount\\n        Targets = $script:Config.Targets\\n        Configuration = @{\\n            TracerouteEnabled = $script:Config.TracerouteEnabled -and -not $SkipTraceroute\\n            ClientSideChecks = -not $SkipClientSideChecks\\n            RootCaExport = $script:Config.ExportRootCa\\n        }\\n        Verdict = if ($alertCount -eq 0) { \\\"No obvious MITM indicators detected\\\" } else { \\\"REVIEW REQUIRED - $alertCount alerts found\\\" }\\n    }\\n\\n    $summary | ConvertTo-Json -Depth 3 | Set-Content (Join-Path $script:BaseDir \\\"Summary.json\\\") -Encoding UTF8\\n\\n    # Generate file hashes for chain of custody\\n    Write-SubSection \\\"Generating Evidence Hashes\\\"\\n\\n    $hashManifest = @()\\n    Get-ChildItem $script:BaseDir -Recurse -File | ForEach-Object {\\n        $hash = Get-FileHash -Path $_.FullName -Algorithm $script:Config.HashAlgorithm\\n        $relativePath = $_.FullName.Substring($script:BaseDir.Length + 1)\\n        $hashManifest += [PSCustomObject]@{\\n            File = $relativePath\\n            Algorithm = $script:Config.HashAlgorithm\\n            Hash = $hash.Hash\\n        }\\n    }\\n\\n    $hashManifest | ConvertTo-Json -Depth 3 | Set-Content (Join-Path $script:BaseDir \\\"_FileHashes.json\\\") -Encoding UTF8\\n    Write-Log \\\"Generated hashes for $($hashManifest.Count) files\\\"\\n\\n    # Final output\\n    Write-Host \\\"\\\"\\n    Write-Host (\\\"=\\\" * 70) -ForegroundColor Green\\n    Write-Host \\\" AUDIT COMPLETE\\\" -ForegroundColor Green\\n    Write-Host (\\\"=\\\" * 70) -ForegroundColor Green\\n    Write-Host \\\"\\\"\\n    Write-Host \\\"Evidence Directory: $script:BaseDir\\\" -ForegroundColor Cyan\\n    Write-Host \\\"\\\"\\n\\n    if ($alertCount -gt 0) {\\n        Write-Host \\\"ALERTS FOUND: $alertCount\\\" -ForegroundColor Red\\n        Write-Host \\\"Review _RedFlags.txt immediately!\\\" -ForegroundColor Yellow\\n        Write-Host \\\"\\\"\\n        Write-Host \\\"--- ALERTS ---\\\" -ForegroundColor Red\\n        Get-Content $script:AlertFile | ForEach-Object { Write-Host \\\"  $_\\\" -ForegroundColor Yellow }\\n    } else {\\n        Write-Host \\\"No obvious MITM indicators detected.\\\" -ForegroundColor Green\\n        Write-Host \\\"Note: Passive interception (logging only) may not trigger alerts.\\\" -ForegroundColor Yellow\\n    }\\n\\n    Write-Host \\\"\\\"\\n    Write-Host \\\"NEXT STEPS:\\\" -ForegroundColor Cyan\\n    Write-Host \\\"  1. Review _RedFlags.txt for immediate concerns\\\" -ForegroundColor White\\n    Write-Host \\\"  2. Check certificate serials against crt.sh (on clean network)\\\" -ForegroundColor White\\n    Write-Host \\\"  3. Zip the evidence folder and hash the zip for chain of custody\\\" -ForegroundColor White\\n    Write-Host \\\"\\\"\\n}\\n\\n#endregion\\n\\n#region Main Execution\\n\\n# Load configuration\\nif ($ConfigFile) {\\n    Read-ConfigFile -Path $ConfigFile\\n} else {\\n    $defaultConfig = Join-Path $PSScriptRoot \\\"mitm-audit.cfg\\\"\\n    if (Test-Path $defaultConfig) {\\n        Read-ConfigFile -Path $defaultConfig\\n    }\\n}\\n\\n# Override targets if specified\\nif ($Targets) {\\n    $script:Config.Targets = $Targets -split \u0027,\u0027 | ForEach-Object { $_.Trim() }\\n}\\n\\n# Initialize output\\nInitialize-OutputDirectory -BasePath $OutputPath\\n\\nWrite-Host \\\"\\\"\\nWrite-Host (\\\"=\\\" * 70) -ForegroundColor Cyan\\nWrite-Host \\\" INFRASTRUCTURE MITM AUDIT - FORENSIC EVIDENCE COLLECTION\\\" -ForegroundColor Cyan\\nWrite-Host (\\\"=\\\" * 70) -ForegroundColor Cyan\\nWrite-Host \\\"Timestamp: $(Get-Date -Format \u0027yyyy-MM-dd HH:mm:ss\u0027)\\\"\\nWrite-Host \\\"Evidence Directory: $script:BaseDir\\\"\\nWrite-Host \\\"Targets: $($script:Config.Targets -join \u0027, \u0027)\\\"\\nWrite-Host \\\"\\\"\\n\\nWrite-Log \\\"Audit started\\\"\\nWrite-Log \\\"Targets: $($script:Config.Targets -join \u0027, \u0027)\\\"\\n\\n# Execute phases\\nGet-EnvironmentSnapshot\\nExport-TrustStore\\nInvoke-TargetAnalysis\\nInvoke-TracerouteMapping\\nTest-ClientSideExploits\\nComplete-EvidencePackage\\n\\nWrite-Log \\\"Audit completed\\\"\\n\\n#endregion\\n\"}","name":"write","params":"{\"relativeWorkspacePath\":\"templates/network/Invoke-MitmAudit-v7.ps1\",\"code\":{\"code\":\"#\"}}","additionalData":{"codeblockId":"d3b129e2-7ca6-4d73-bc41-462b5f2d1e0c","reviewData":{"status":"None","selectedOption":"accept","isShowingInput":false,"firstTimeReviewMode":false}},"userDecision":"accepted","result":"{\"diff\":{\"chunks\":[{\"diffString\":\"- \\n+ #Requires -Version 7.0\\n+ \u003c#\\n+ .SYNOPSIS\\n+     Infrastructure MITM Audit - Forensic Evidence Collection for TLS Interception Detection\\n+ \\n+ .DESCRIPTION\\n+     Combines environment baselining, Root CA dumping, ASN-based integrity checking,\\n+     and DoH comparison to detect infrastructure-side Man-in-the-Middle attacks while\\n+     ruling out client-side exploits.\\n+ \\n+     Produces a timestamped evidence package suitable for chain of custody.\\n+ \\n+ .PARAMETER ConfigFile\\n+     Path to mitm-audit.cfg configuration file.\\n+ \\n+ .PARAMETER OutputPath\\n+     Base directory for evidence collection (default: Desktop\\\\ForensicEvidence_timestamp)\\n+ \\n+ .PARAMETER Targets\\n+     Override target domains from config (comma-separated)\\n+ \\n+ .PARAMETER SkipTraceroute\\n+     Skip traceroute collection (faster but less complete)\\n+ \\n+ .PARAMETER SkipClientSideChecks\\n+     Skip client-side exploit detection (browser extensions, proxy settings)\\n+ \\n+ .PARAMETER HashOnly\\n+     Only generate hashes for existing evidence directory\\n+ \\n+ .EXAMPLE\\n+     .\\\\Invoke-MitmAudit-v7.ps1\\n+     .\\\\Invoke-MitmAudit-v7.ps1 -ConfigFile .\\\\mitm-audit.cfg\\n+     .\\\\Invoke-MitmAudit-v7.ps1 -Targets \\\"accounts.google.com,github.com\\\"\\n+     .\\\\Invoke-MitmAudit-v7.ps1 -SkipTraceroute -SkipClientSideChecks\\n+ \\n+ .NOTES\\n+     License: BSD-2-Clause\\n+     Requires: PowerShell 7+, Administrator privileges recommended\\n+     Signed-off-by: Network Diagnostics Toolkit\\n+ \\n+     Run as Administrator for complete Root CA export and network diagnostics.\\n+ \\n+     EVIDENCE PROCESSING:\\n+     1. Check _RedFlags.txt first - if empty, MITM may be passive/logging only\\n+     2. Certificate Serial Check - copy serial to crt.sh on clean device\\n+        - If \\\"No certificates found\\\": 100% MITM by private root CA\\n+        - If cert shown for different domain: collision/hash attack\\n+     3. Zip evidence folder, hash the zip for chain of custody\\n+ #\u003e\\n+ \\n+ [CmdletBinding()]\\n+ param(\\n+     [Parameter()]\\n+     [string]$ConfigFile,\\n+ \\n+     [Parameter()]\\n+     [string]$OutputPath,\\n+ \\n+     [Parameter()]\\n+     [string]$Targets,\\n+ \\n+     [Parameter()]\\n+     [switch]$SkipTraceroute,\\n+ \\n+     [Parameter()]\\n+     [switch]$SkipClientSideChecks,\\n+ \\n+     [Parameter()]\\n+     [switch]$HashOnly\\n+ )\\n+ \\n+ Set-StrictMode -Version Latest\\n+ $ErrorActionPreference = \u0027Continue\u0027\\n+ \\n+ #region Configuration\\n+ \\n+ # Default configuration\\n+ $script:Config = @{\\n+     Targets = @(\\\"accounts.google.com\\\", \\\"login.microsoftonline.com\\\", \\\"appleid.apple.com\\\", \\\"aws.amazon.com\\\", \\\"github.com\\\")\\n+     PublicResolvers = @(\\\"1.1.1.1\\\", \\\"8.8.8.8\\\", \\\"9.9.9.9\\\")\\n+     DohEndpoint = \\\"https://dns.google/resolve\\\"\\n+     AsnLookupUrl = \\\"http://ip-api.com/json\\\"\\n+     AsnLookupTimeout = 3\\n+     ExternalIpUrl = \\\"https://ipinfo.io/json\\\"\\n+     ExternalIpTimeout = 5\\n+     ExpectedIspPatterns = @()\\n+     SuspiciousAsnPatterns = @(\\\"DigitalOcean\\\", \\\"Linode\\\", \\\"Vultr\\\", \\\"Choopa\\\", \\\"Datacamp\\\", \\\"OVH\\\", \\\"Hetzner\\\")\\n+     SuspiciousCertIssuers = @(\\\"Let\u0027s Encrypt\\\", \\\"ZeroSSL\\\", \\\"Self-Signed\\\", \\\"localhost\\\")\\n+     TracerouteMaxHops = 15\\n+     TracerouteTimeout = 2\\n+     TracerouteEnabled = $true\\n+     ExportRootCa = $true\\n+     HashRootCa = $true\\n+     CheckProxySettings = $true\\n+     CheckBrowserExtensions = $true\\n+     CheckHostsFile = $true\\n+     CheckRootCaAnomalies = $true\\n+     HashAlgorithm = \\\"SHA256\\\"\\n+ }\\n+ \\n+ function Read-ConfigFile {\\n+     param([string]$Path)\\n+ \\n+     if (-not (Test-Path $Path)) {\\n+         Write-Warning \\\"Config file not found: $Path (using defaults)\\\"\\n+         return\\n+     }\\n+ \\n+     Get-Content $Path | ForEach-Object {\\n+         $line = $_.Trim()\\n+         if ($line -match \u0027^#\u0027 -or $line -eq \u0027\u0027) { return }\\n+         if ($line -match \u0027^([^=]+)=(.*)$\u0027) {\\n+             $key = $Matches[1].Trim()\\n+             $value = $Matches[2].Trim()\\n+ \\n+             switch ($key) {\\n+                 \u0027TARGETS\u0027 { $script:Config.Targets = $value -split \u0027,\u0027 | ForEach-Object { $_.Trim() } }\\n+                 \u0027PUBLIC_RESOLVERS\u0027 { $script:Config.PublicResolvers = $value -split \u0027,\u0027 | ForEach-Object { $_.Trim() } }\\n+                 \u0027DOH_ENDPOINT\u0027 { $script:Config.DohEndpoint = $value }\\n+                 \u0027ASN_LOOKUP_URL\u0027 { $script:Config.AsnLookupUrl = $value }\\n+                 \u0027ASN_LOOKUP_TIMEOUT_SEC\u0027 { $script:Config.AsnLookupTimeout = [int]$value }\\n+                 \u0027EXTERNAL_IP_URL\u0027 { $script:Config.ExternalIpUrl = $value }\\n+                 \u0027EXTERNAL_IP_TIMEOUT_SEC\u0027 { $script:Config.ExternalIpTimeout = [int]$value }\\n+                 \u0027EXPECTED_ISP_PATTERNS\u0027 { if ($value) { $script:Config.ExpectedIspPatterns = $value -split \u0027,\u0027 | ForEach-Object { $_.Trim() } } }\\n+                 \u0027SUSPICIOUS_ASN_PATTERNS\u0027 { $script:Config.SuspiciousAsnPatterns = $value -split \u0027,\u0027 | ForEach-Object { $_.Trim() } }\\n+                 \u0027SUSPICIOUS_CERT_ISSUERS\u0027 { $script:Config.SuspiciousCertIssuers = $value -split \u0027,\u0027 | ForEach-Object { $_.Trim() } }\\n+                 \u0027TRACEROUTE_MAX_HOPS\u0027 { $script:Config.TracerouteMaxHops = [int]$value }\\n+                 \u0027TRACEROUTE_TIMEOUT_SEC\u0027 { $script:Config.TracerouteTimeout = [int]$value }\\n+                 \u0027TRACEROUTE_ENABLED\u0027 { $script:Config.TracerouteEnabled = $value -eq \u0027true\u0027 }\\n+                 \u0027EXPORT_ROOT_CA\u0027 { $script:Config.ExportRootCa = $value -eq \u0027true\u0027 }\\n+                 \u0027HASH_ROOT_CA\u0027 { $script:Config.HashRootCa = $value -eq \u0027true\u0027 }\\n+                 \u0027CHECK_PROXY_SETTINGS\u0027 { $script:Config.CheckProxySettings = $value -eq \u0027true\u0027 }\\n+                 \u0027CHECK_BROWSER_EXTENSIONS\u0027 { $script:Config.CheckBrowserExtensions = $value -eq \u0027true\u0027 }\\n+                 \u0027CHECK_HOSTS_FILE\u0027 { $script:Config.CheckHostsFile = $value -eq \u0027true\u0027 }\\n+                 \u0027CHECK_ROOT_CA_ANOMALIES\u0027 { $script:Config.CheckRootCaAnomalies = $value -eq \u0027true\u0027 }\\n+                 \u0027HASH_ALGORITHM\u0027 { $script:Config.HashAlgorithm = $value }\\n+             }\\n+         }\\n+     }\\n+ }\\n+ \\n+ #endregion\\n+ \\n+ #region Logging and Output\\n+ \\n+ $script:LogFile = $null\\n+ $script:AlertFile = $null\\n+ \\n+ function Initialize-OutputDirectory {\\n+     param([string]$BasePath)\\n+ \\n+     $timestamp = Get-Date -Format \\\"yyyyMMdd_HHmmss\\\"\\n+ \\n+     if ($BasePath) {\\n+         $script:BaseDir = $BasePath\\n+     } else {\\n+         $script:BaseDir = Join-Path $env:USERPROFILE \\\"Desktop\\\\ForensicEvidence_$timestamp\\\"\\n+     }\\n+ \\n+     New-Item -Path $script:BaseDir -ItemType Directory -Force | Out-Null\\n+     $script:LogFile = Join-Path $script:BaseDir \\\"_AuditLog.txt\\\"\\n+     $script:AlertFile = Join-Path $script:BaseDir \\\"_RedFlags.txt\\\"\\n+ \\n+     # Initialize files\\n+     \\\"\\\" | Set-Content $script:AlertFile -Encoding UTF8\\n+ }\\n+ \\n+ function Write-Log {\\n+     param([string]$Message, [string]$Level = \\\"INFO\\\")\\n+ \\n+     $timestamp = Get-Date -Format \\\"yyyy-MM-dd HH:mm:ss\\\"\\n+     $logEntry = \\\"[$timestamp] [$Level] $Message\\\"\\n+ \\n+     switch ($Level) {\\n+         \\\"ERROR\\\" { Write-Host $logEntry -ForegroundColor Red }\\n+         \\\"WARN\\\"  { Write-Host $logEntry -ForegroundColor Yellow }\\n+         \\\"ALERT\\\" { Write-Host \\\"[!] $Message\\\" -ForegroundColor Red }\\n+         default { Write-Host $logEntry }\\n+     }\\n+ \\n+     Add-Content -Path $script:LogFile -Value $logEntry -Encoding UTF8\\n+ }\\n+ \\n+ function Write-Alert {\\n+     param([string]$Message)\\n+ \\n+     Write-Log -Message $Message -Level \\\"ALERT\\\"\\n+     $timestamp = Get-Date -Format \\\"yyyy-MM-dd HH:mm:ss\\\"\\n+     Add-Content -Path $script:AlertFile -Value \\\"[$timestamp] $Message\\\" -Encoding UTF8\\n+ }\\n+ \\n+ function Write-Section {\\n+     param([string]$Title)\\n+     Write-Host \\\"\\\"\\n+     Write-Host (\\\"=\\\" * 70) -ForegroundColor Cyan\\n+     Write-Host \\\" $Title\\\" -ForegroundColor Cyan\\n+     Write-Host (\\\"=\\\" * 70) -ForegroundColor Cyan\\n+     Write-Log \\\"=== $Title ===\\\" -Level \\\"INFO\\\"\\n+ }\\n+ \\n+ function Write-SubSection {\\n+     param([string]$Title)\\n+     Write-Host \\\"\\\"\\n+     Write-Host \\\"[*] $Title\\\" -ForegroundColor Yellow\\n+     Write-Host (\\\"-\\\" * 50)\\n+     Write-Log \\\"--- $Title ---\\\" -Level \\\"INFO\\\"\\n+ }\\n+ \\n+ #endregion\\n+ \\n+ #region ASN and DNS Functions\\n+ \\n+ function Get-ASN {\\n+     param([string]$IP)\\n+ \\n+     try {\\n+         $uri = \\\"$($script:Config.AsnLookupUrl)/$IP`?fields=status,message,org,as\\\"\\n+         $response = Invoke-RestMethod -Uri $uri -TimeoutSec $script:Config.AsnLookupTimeout -ErrorAction Stop\\n+ \\n+         if ($response.status -eq \\\"success\\\") {\\n+             return \\\"$($response.org) ($($response.as))\\\"\\n+         } else {\\n+             return \\\"Unknown\\\"\\n+         }\\n+     } catch {\\n+         return \\\"Lookup Failed (Blocked?)\\\"\\n+     }\\n+ }\\n+ \\n+ function Get-DohResolution {\\n+     param([string]$Domain)\\n+ \\n+     try {\\n+         $uri = \\\"$($script:Config.DohEndpoint)?name=$Domain\u0026type=A\\\"\\n+         $response = Invoke-RestMethod -Uri $uri -TimeoutSec 5 -ErrorAction Stop\\n+ \\n+         if ($response.Answer -and $response.Answer.Count -gt 0) {\\n+             return $response.Answer[0].data\\n+         }\\n+         return $null\\n+     } catch {\\n+         return $null\\n+     }\\n+ }\\n+ \\n+ function Test-AsnIntegrity {\\n+     param(\\n+         [string]$Domain,\\n+         [string]$Asn\\n+     )\\n+ \\n+     if ($Asn -eq \\\"Lookup Failed (Blocked?)\\\") {\\n+         return $null  # Cannot determine\\n+     }\\n+ \\n+     # Check against expected patterns\\n+     if ($Domain -match \\\"google\\\" -and $Asn -notmatch \\\"Google\\\") {\\n+         return \\\"MITM DETECTED: $Domain resolving to non-Google ASN ($Asn)\\\"\\n+     }\\n+     if ($Domain -match \\\"microsoft\\\" -and $Asn -notmatch \\\"Microsoft\\\") {\\n+         return \\\"MITM DETECTED: $Domain resolving to non-Microsoft ASN ($Asn)\\\"\\n+     }\\n+     if ($Domain -match \\\"apple\\\" -and $Asn -notmatch \\\"Apple\\\") {\\n+         return \\\"MITM DETECTED: $Domain resolving to non-Apple ASN ($Asn)\\\"\\n+     }\\n+     if ($Domain -match \\\"aws\\\\.amazon|amazonaws\\\" -and $Asn -notmatch \\\"Amazon|AMAZON\\\") {\\n+         return \\\"MITM DETECTED: $Domain resolving to non-Amazon ASN ($Asn)\\\"\\n+     }\\n+     if ($Domain -match \\\"github\\\" -and $Asn -notmatch \\\"GitHub|Microsoft\\\") {\\n+         return \\\"MITM DETECTED: $Domain resolving to non-GitHub/Microsoft ASN ($Asn)\\\"\\n+     }\\n+ \\n+     # Check for suspicious VPS providers\\n+     foreach ($pattern in $script:Config.SuspiciousAsnPatterns) {\\n+         if ($Asn -match $pattern) {\\n+             return \\\"MITM DETECTED: High-value target routed to VPS provider ($pattern)\\\"\\n+         }\\n+     }\\n+ \\n+     return $null\\n+ }\\n+ \\n+ #endregion\\n+ \\n+ #region Certificate Functions\\n+ \\n+ function Get-TlsCertificate {\\n+     param([string]$Domain, [int]$Port = 443)\\n+ \\n+     try {\\n+         $tcpClient = New-Object System.Net.Sockets.TcpClient\\n+         $tcpClient.Connect($Domain, $Port)\\n+         $sslStream = New-Object System.Net.Security.SslStream($tcpClient.GetStream(), $false, { $true })\\n+         $sslStream.AuthenticateAsClient($Domain)\\n+         $cert = $sslStream.RemoteCertificate\\n+ \\n+         $certInfo = [PSCustomObject]@{\\n+             Subject = $cert.Subject\\n+             Issuer = $cert.Issuer\\n+             SerialNumber = $cert.GetSerialNumberString()\\n+             Thumbprint = $cert.GetCertHashString()\\n+             NotBefore = $cert.GetEffectiveDateString()\\n+             NotAfter = $cert.GetExpirationDateString()\\n+         }\\n+ \\n+         $sslStream.Close()\\n+         $tcpClient.Close()\\n+ \\n+         return $certInfo\\n+     } catch {\\n+         return [PSCustomObject]@{\\n+             Error = $_.Exception.Message\\n+             Domain = $Domain\\n+         }\\n+     }\\n+ }\\n+ \\n+ function Test-CertificateAnomaly {\\n+     param(\\n+         [string]$Domain,\\n+         [PSCustomObject]$CertInfo\\n+     )\\n+ \\n+     if ($CertInfo.Error) {\\n+         return \\\"TLS Handshake Failed for $Domain - Interception likely causing protocol error\\\"\\n+     }\\n+ \\n+     # Check for suspicious issuers on major tech domains\\n+     foreach ($issuerPattern in $script:Config.SuspiciousCertIssuers) {\\n+         $isMajorTech = $Domain -match \\\"google|microsoft|apple|amazon|github\\\"\\n+         if ($isMajorTech -and $CertInfo.Issuer -match $issuerPattern) {\\n+             return \\\"CERTIFICATE ANOMALY: $Domain using $issuerPattern issuer - highly suspicious for major tech corp\\\"\\n+         }\\n+     }\\n+ \\n+     return $null\\n+ }\\n+ \\n+ #endregion\\n+ \\n+ #region Phase 1: Environment Snapshot\\n+ \\n+ function Get-EnvironmentSnapshot {\\n+     Write-Section \\\"PHASE 1: ENVIRONMENT SNAPSHOT\\\"\\n+ \\n+     $envDir = Join-Path $script:BaseDir \\\"environment\\\"\\n+     New-Item -Path $envDir -ItemType Directory -Force | Out-Null\\n+ \\n+     # Network configuration\\n+     Write-SubSection \\\"Network Configuration\\\"\\n+     $netConfig = Get-NetIPConfiguration | Select-Object InterfaceAlias, IPv4Address, IPv4DefaultGateway, DNSServer\\n+     $netConfig | ConvertTo-Json -Depth 5 | Set-Content (Join-Path $envDir \\\"NetworkConfig.json\\\") -Encoding UTF8\\n+     Get-NetIPConfiguration | Out-File (Join-Path $envDir \\\"NetworkConfig.txt\\\") -Encoding UTF8\\n+ \\n+     # External IP\\n+     Write-SubSection \\\"External IP Identification\\\"\\n+     try {\\n+         $extIp = Invoke-RestMethod -Uri $script:Config.ExternalIpUrl -TimeoutSec $script:Config.ExternalIpTimeout\\n+         $extIp | ConvertTo-Json | Set-Content (Join-Path $envDir \\\"ExternalIP.json\\\") -Encoding UTF8\\n+ \\n+         Write-Log \\\"External IP: $($extIp.ip)\\\"\\n+         Write-Log \\\"External Org: $($extIp.org)\\\"\\n+         Write-Log \\\"Location: $($extIp.city), $($extIp.region), $($extIp.country)\\\"\\n+ \\n+         # Check expected ISP\\n+         if ($script:Config.ExpectedIspPatterns.Count -gt 0) {\\n+             $isExpectedIsp = $false\\n+             foreach ($pattern in $script:Config.ExpectedIspPatterns) {\\n+                 if ($extIp.org -match $pattern) {\\n+                     $isExpectedIsp = $true\\n+                     break\\n+                 }\\n+             }\\n+             if (-not $isExpectedIsp) {\\n+                 Write-Alert \\\"External IP Org ($($extIp.org)) does not match expected ISP patterns - traffic may be tunneled/proxied\\\"\\n+             }\\n+         }\\n+     } catch {\\n+         Write-Alert \\\"Unable to determine External IP - connection may be blocked or filtered\\\"\\n+     }\\n+ \\n+     # System info\\n+     Write-SubSection \\\"System Information\\\"\\n+     $sysInfo = [PSCustomObject]@{\\n+         ComputerName = $env:COMPUTERNAME\\n+         UserName = $env:USERNAME\\n+         UserDomain = $env:USERDOMAIN\\n+         OSVersion = [System.Environment]::OSVersion.VersionString\\n+         PowerShellVersion = $PSVersionTable.PSVersion.ToString()\\n+         Is64Bit = [System.Environment]::Is64BitOperatingSystem\\n+         IsAdmin = ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)\\n+         Timestamp = (Get-Date).ToString(\\\"o\\\")\\n+     }\\n+     $sysInfo | ConvertTo-Json | Set-Content (Join-Path $envDir \\\"SystemInfo.json\\\") -Encoding UTF8\\n+     Write-Log \\\"System: $($sysInfo.ComputerName) / User: $($sysInfo.UserName) / Admin: $($sysInfo.IsAdmin)\\\"\\n+ }\\n+ \\n+ #endregion\\n+ \\n+ #region Phase 2: Trust Store Export\\n+ \\n+ function Export-TrustStore {\\n+     Write-Section \\\"PHASE 2: TRUST STORE EXPORT\\\"\\n+ \\n+     $trustDir = Join-Path $script:BaseDir \\\"trust-store\\\"\\n+     New-Item -Path $trustDir -ItemType Directory -Force | Out-Null\\n+ \\n+     if (-not $script:Config.ExportRootCa) {\\n+         Write-Log \\\"Root CA export disabled in configuration\\\"\\n+         return\\n+     }\\n+ \\n+     Write-SubSection \\\"Exporting Root CA Store\\\"\\n+ \\n+     # Export Root CAs\\n+     $rootCAs = Get-ChildItem Cert:\\\\LocalMachine\\\\Root\\n+     $rootCaData = $rootCAs | Select-Object Thumbprint, Subject, Issuer, NotBefore, NotAfter, @{N=\u0027SignatureAlgorithm\u0027;E={$_.SignatureAlgorithm.FriendlyName}}\\n+ \\n+     # Export to CSV\\n+     $csvPath = Join-Path $trustDir \\\"RootStore_Dump.csv\\\"\\n+     $rootCaData | Export-Csv -Path $csvPath -NoTypeInformation -Encoding UTF8\\n+     Write-Log \\\"Root CA Store exported to $csvPath ($($rootCAs.Count) certificates)\\\"\\n+ \\n+     # Export to JSON for programmatic access\\n+     $jsonPath = Join-Path $trustDir \\\"RootStore_Dump.json\\\"\\n+     $rootCaData | ConvertTo-Json -Depth 3 | Set-Content $jsonPath -Encoding UTF8\\n+ \\n+     # Hash the export if configured\\n+     if ($script:Config.HashRootCa) {\\n+         $hash = Get-FileHash -Path $csvPath -Algorithm $script:Config.HashAlgorithm\\n+         $hash | ConvertTo-Json | Set-Content (Join-Path $trustDir \\\"RootStore_Hash.json\\\") -Encoding UTF8\\n+         Write-Log \\\"Root CA hash: $($hash.Hash)\\\"\\n+     }\\n+ \\n+     # Check for anomalies\\n+     if ($script:Config.CheckRootCaAnomalies) {\\n+         Write-SubSection \\\"Root CA Anomaly Detection\\\"\\n+ \\n+         $suspicious = @()\\n+ \\n+         foreach ($ca in $rootCAs) {\\n+             # Check for self-signed certs with suspicious names\\n+             if ($ca.Subject -match \\\"Self|Test|Admin|Local|Proxy|Intercept|MITM\\\") {\\n+                 $suspicious += [PSCustomObject]@{\\n+                     Thumbprint = $ca.Thumbprint\\n+                     Subject = $ca.Subject\\n+                     Reason = \\\"Suspicious name pattern in certificate subject\\\"\\n+                 }\\n+             }\\n+ \\n+             # Check for recently added certs (within last 30 days)\\n+             if ($ca.NotBefore -gt (Get-Date).AddDays(-30)) {\\n+                 $suspicious += [PSCustomObject]@{\\n+                     Thumbprint = $ca.Thumbprint\\n+                     Subject = $ca.Subject\\n+                     NotBefore = $ca.NotBefore\\n+                     Reason = \\\"Recently added root CA (within last 30 days)\\\"\\n+                 }\\n+             }\\n+ \\n+             # Check for common enterprise MITM tools\\n+             if ($ca.Subject -match \\\"Zscaler|BlueCoat|Forcepoint|McAfee|Symantec Web Gateway|Websense|Palo Alto\\\") {\\n+                 $suspicious += [PSCustomObject]@{\\n+                     Thumbprint = $ca.Thumbprint\\n+                     Subject = $ca.Subject\\n+                     Reason = \\\"Enterprise TLS inspection tool detected\\\"\\n+                 }\\n+             }\\n+         }\\n+ \\n+         if ($suspicious.Count -gt 0) {\\n+             $suspicious | ConvertTo-Json -Depth 3 | Set-Content (Join-Path $trustDir \\\"SuspiciousCAs.json\\\") -Encoding UTF8\\n+             foreach ($s in $suspicious) {\\n+                 Write-Alert \\\"Suspicious Root CA: $($s.Subject) - $($s.Reason)\\\"\\n+             }\\n+         } else {\\n+             Write-Log \\\"No suspicious root CAs detected\\\"\\n+         }\\n+     }\\n+ }\\n+ \\n+ #endregion\\n+ \\n+ #region Phase 3: Target Analysis\\n+ \\n+ function Invoke-TargetAnalysis {\\n+     Write-Section \\\"PHASE 3: TARGET ANALYSIS AND ASN INTEGRITY\\\"\\n+ \\n+     $targetsDir = Join-Path $script:BaseDir \\\"targets\\\"\\n+     New-Item -Path $targetsDir -ItemType Directory -Force | Out-Null\\n+ \\n+     foreach ($domain in $script:Config.Targets) {\\n+         Write-SubSection \\\"Analyzing: $domain\\\"\\n+ \\n+         $safeDomain = $domain -replace \u0027\\\\.\u0027, \u0027_\u0027\\n+         $domainDir = Join-Path $targetsDir $safeDomain\\n+         New-Item -Path $domainDir -ItemType Directory -Force | Out-Null\\n+ \\n+         $analysis = [PSCustomObject]@{\\n+             Domain = $domain\\n+             Timestamp = (Get-Date).ToString(\\\"o\\\")\\n+             LocalDns = $null\\n+             LocalAsn = $null\\n+             DohDns = $null\\n+             DohAsn = $null\\n+             Certificate = $null\\n+             Alerts = @()\\n+         }\\n+ \\n+         # A. Local DNS Resolution\\n+         try {\\n+             $localIp = (Resolve-DnsName -Name $domain -Type A -ErrorAction SilentlyContinue).IPAddress | Select-Object -First 1\\n+             $analysis.LocalDns = $localIp\\n+ \\n+             if ($localIp) {\\n+                 $localAsn = Get-ASN -IP $localIp\\n+                 $analysis.LocalAsn = $localAsn\\n+                 Write-Log \\\"Local DNS: $localIp | ASN: $localAsn\\\"\\n+             } else {\\n+                 Write-Log \\\"Local DNS resolution failed\\\" -Level \\\"WARN\\\"\\n+             }\\n+         } catch {\\n+             Write-Log \\\"DNS resolution error: $_\\\" -Level \\\"ERROR\\\"\\n+         }\\n+ \\n+         # B. DoH Resolution (Control Group)\\n+         $dohIp = Get-DohResolution -Domain $domain\\n+         if ($dohIp) {\\n+             $analysis.DohDns = $dohIp\\n+             $dohAsn = Get-ASN -IP $dohIp\\n+             $analysis.DohAsn = $dohAsn\\n+             Write-Log \\\"DoH DNS:   $dohIp | ASN: $dohAsn\\\"\\n+ \\n+             # Compare IPs\\n+             if ($analysis.LocalDns -and $analysis.LocalDns -ne $dohIp) {\\n+                 Write-Log \\\"DNS MISMATCH: Local ($($analysis.LocalDns)) vs DoH ($dohIp)\\\" -Level \\\"WARN\\\"\\n+             }\\n+         } else {\\n+             Write-Log \\\"DoH resolution failed (network may be blocking)\\\" -Level \\\"WARN\\\"\\n+         }\\n+ \\n+         # C. ASN Integrity Check\\n+         if ($analysis.LocalAsn) {\\n+             $asnAlert = Test-AsnIntegrity -Domain $domain -Asn $analysis.LocalAsn\\n+             if ($asnAlert) {\\n+                 Write-Alert $asnAlert\\n+                 $analysis.Alerts += $asnAlert\\n+             }\\n+         }\\n+ \\n+         # D. Certificate Capture\\n+         Write-Log \\\"Capturing TLS certificate...\\\"\\n+         $certInfo = Get-TlsCertificate -Domain $domain\\n+         $analysis.Certificate = $certInfo\\n+ \\n+         $certPath = Join-Path $domainDir \\\"Certificate.json\\\"\\n+         $certInfo | ConvertTo-Json -Depth 3 | Set-Content $certPath -Encoding UTF8\\n+ \\n+         if ($certInfo.SerialNumber) {\\n+             Write-Log \\\"Certificate Serial: $($certInfo.SerialNumber)\\\"\\n+             Write-Log \\\"Certificate Issuer: $($certInfo.Issuer)\\\"\\n+ \\n+             # Check for certificate anomalies\\n+             $certAlert = Test-CertificateAnomaly -Domain $domain -CertInfo $certInfo\\n+             if ($certAlert) {\\n+                 Write-Alert $certAlert\\n+                 $analysis.Alerts += $certAlert\\n+             }\\n+         } else {\\n+             Write-Alert \\\"TLS Handshake Failed for $domain - $($certInfo.Error)\\\"\\n+             $analysis.Alerts += \\\"TLS Handshake Failed: $($certInfo.Error)\\\"\\n+         }\\n+ \\n+         # Save analysis\\n+         $analysis | ConvertTo-Json -Depth 5 | Set-Content (Join-Path $domainDir \\\"Analysis.json\\\") -Encoding UTF8\\n+     }\\n+ }\\n+ \\n+ #endregion\\n+ \\n+ #region Phase 4: Traceroute Mapping\\n+ \\n+ function Invoke-TracerouteMapping {\\n+     Write-Section \\\"PHASE 4: TRACEROUTE MAPPING\\\"\\n+ \\n+     if (-not $script:Config.TracerouteEnabled -or $SkipTraceroute) {\\n+         Write-Log \\\"Traceroute skipped (disabled or -SkipTraceroute specified)\\\"\\n+         return\\n+     }\\n+ \\n+     $traceDir = Join-Path $script:BaseDir \\\"traceroute\\\"\\n+     New-Item -Path $traceDir -ItemType Directory -Force | Out-Null\\n+ \\n+     foreach ($domain in $script:Config.Targets) {\\n+         Write-SubSection \\\"Tracing: $domain\\\"\\n+ \\n+         $safeDomain = $domain -replace \u0027\\\\.\u0027, \u0027_\u0027\\n+         $tracePath = Join-Path $traceDir \\\"Trace_$safeDomain.txt\\\"\\n+         $traceJsonPath = Join-Path $traceDir \\\"Trace_$safeDomain.json\\\"\\n+ \\n+         try {\\n+             $trace = Test-NetConnection -ComputerName $domain -TraceRoute -WarningAction SilentlyContinue\\n+             $hops = $trace.TraceRoute\\n+ \\n+             # Save text output\\n+             $hops | Out-File $tracePath -Encoding UTF8\\n+ \\n+             # Save JSON with ASN lookup for each hop\\n+             $hopDetails = @()\\n+             $hopNum = 1\\n+             foreach ($hop in $hops) {\\n+                 if ($hop -and $hop -ne \\\"*\\\") {\\n+                     $asn = Get-ASN -IP $hop\\n+                     $hopDetails += [PSCustomObject]@{\\n+                         Hop = $hopNum\\n+                         IP = $hop\\n+                         ASN = $asn\\n+                     }\\n+ \\n+                     # Check for suspicious hops\\n+                     foreach ($pattern in $script:Config.SuspiciousAsnPatterns) {\\n+                         if ($asn -match $pattern) {\\n+                             Write-Alert \\\"Suspicious hop in traceroute to $domain - Hop $hopNum ($hop) routes through $pattern\\\"\\n+                         }\\n+                     }\\n+                 }\\n+                 $hopNum++\\n+             }\\n+ \\n+             $hopDetails | ConvertTo-Json -Depth 3 | Set-Content $traceJsonPath -Encoding UTF8\\n+             Write-Log \\\"Trace complete: $($hops.Count) hops\\\"\\n+         } catch {\\n+             Write-Log \\\"Traceroute failed: $_\\\" -Level \\\"ERROR\\\"\\n+         }\\n+     }\\n+ }\\n+ \\n+ #endregion\\n+ \\n+ #region Phase 5: Client-Side Exploit Detection\\n+ \\n+ function Test-ClientSideExploits {\\n+     Write-Section \\\"PHASE 5: CLIENT-SIDE EXPLOIT DETECTION\\\"\\n+ \\n+     if ($SkipClientSideChecks) {\\n+         Write-Log \\\"Client-side checks skipped (-SkipClientSideChecks specified)\\\"\\n+         return\\n+     }\\n+ \\n+     $clientDir = Join-Path $script:BaseDir \\\"client-side\\\"\\n+     New-Item -Path $clientDir -ItemType Directory -Force | Out-Null\\n+ \\n+     # A. Proxy Settings\\n+     if ($script:Config.CheckProxySettings) {\\n+         Write-SubSection \\\"Proxy Settings Check\\\"\\n+ \\n+         $proxyInfo = [PSCustomObject]@{\\n+             SystemProxy = $null\\n+             EnvironmentProxy = $null\\n+             WinHttpProxy = $null\\n+             Alerts = @()\\n+         }\\n+ \\n+         # System proxy (Internet Options)\\n+         try {\\n+             $regPath = \\\"HKCU:\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Internet Settings\\\"\\n+             $proxyEnabled = Get-ItemProperty -Path $regPath -Name ProxyEnable -ErrorAction SilentlyContinue\\n+             $proxyServer = Get-ItemProperty -Path $regPath -Name ProxyServer -ErrorAction SilentlyContinue\\n+ \\n+             $proxyInfo.SystemProxy = [PSCustomObject]@{\\n+                 Enabled = [bool]$proxyEnabled.ProxyEnable\\n+                 Server = $proxyServer.ProxyServer\\n+             }\\n+ \\n+             if ($proxyEnabled.ProxyEnable) {\\n+                 Write-Alert \\\"System proxy is ENABLED: $($proxyServer.ProxyServer)\\\"\\n+                 $proxyInfo.Alerts += \\\"System proxy enabled\\\"\\n+             } else {\\n+                 Write-Log \\\"System proxy: Disabled\\\"\\n+             }\\n+         } catch {\\n+             Write-Log \\\"Could not read system proxy settings\\\" -Level \\\"WARN\\\"\\n+         }\\n+ \\n+         # Environment variables\\n+         $envProxy = @{\\n+             HTTP_PROXY = $env:HTTP_PROXY\\n+             HTTPS_PROXY = $env:HTTPS_PROXY\\n+             ALL_PROXY = $env:ALL_PROXY\\n+             NO_PROXY = $env:NO_PROXY\\n+         }\\n+         $proxyInfo.EnvironmentProxy = $envProxy\\n+ \\n+         foreach ($key in $envProxy.Keys) {\\n+             if ($envProxy[$key]) {\\n+                 Write-Alert \\\"Environment proxy variable set: $key = $($envProxy[$key])\\\"\\n+                 $proxyInfo.Alerts += \\\"Env proxy: $key\\\"\\n+             }\\n+         }\\n+ \\n+         # WinHTTP proxy\\n+         try {\\n+             $winhttp = netsh winhttp show proxy 2\u003e\u00261\\n+             $proxyInfo.WinHttpProxy = $winhttp -join \\\"`n\\\"\\n+             if ($winhttp -match \\\"Proxy Server\\\") {\\n+                 Write-Alert \\\"WinHTTP proxy configured - check output for details\\\"\\n+             }\\n+         } catch {\\n+             Write-Log \\\"Could not check WinHTTP proxy\\\" -Level \\\"WARN\\\"\\n+         }\\n+ \\n+         $proxyInfo | ConvertTo-Json -Depth 3 | Set-Content (Join-Path $clientDir \\\"ProxySettings.json\\\") -Encoding UTF8\\n+     }\\n+ \\n+     # B. Hosts File Check\\n+     if ($script:Config.CheckHostsFile) {\\n+         Write-SubSection \\\"Hosts File Analysis\\\"\\n+ \\n+         $hostsPath = \\\"$env:SystemRoot\\\\System32\\\\drivers\\\\etc\\\\hosts\\\"\\n+         $hostsContent = Get-Content $hostsPath -ErrorAction SilentlyContinue\\n+ \\n+         $hostsInfo = [PSCustomObject]@{\\n+             Path = $hostsPath\\n+             Entries = @()\\n+             Suspicious = @()\\n+         }\\n+ \\n+         $sensitivePatterns = @(\\\"google\\\", \\\"microsoft\\\", \\\"apple\\\", \\\"amazon\\\", \\\"github\\\", \\\"cursor\\\", \\\"openai\\\", \\\"anthropic\\\")\\n+ \\n+         foreach ($line in $hostsContent) {\\n+             if ($line -match \u0027^\\\\s*#\u0027 -or $line -match \u0027^\\\\s*$\u0027) { continue }\\n+ \\n+             $parts = $line -split \u0027\\\\s+\u0027, 2\\n+             if ($parts.Count -ge 2) {\\n+                 $ip = $parts[0]\\n+                 $hostnames = $parts[1] -split \u0027\\\\s+\u0027\\n+ \\n+                 $entry = [PSCustomObject]@{\\n+                     IP = $ip\\n+                     Hostnames = $hostnames\\n+                 }\\n+                 $hostsInfo.Entries += $entry\\n+ \\n+                 foreach ($hostname in $hostnames) {\\n+                     foreach ($pattern in $sensitivePatterns) {\\n+                         if ($hostname -match $pattern -and $ip -notmatch \u0027^(127\\\\.0\\\\.0\\\\.1|::1|0\\\\.0\\\\.0\\\\.0)$\u0027) {\\n+                             $suspicious = [PSCustomObject]@{\\n+                                 Entry = $entry\\n+                                 Reason = \\\"Redirect of $pattern domain to $ip\\\"\\n+                             }\\n+                             $hostsInfo.Suspicious += $suspicious\\n+                             Write-Alert \\\"Hosts file redirect: $hostname -\u003e $ip\\\"\\n+                         }\\n+                     }\\n+                 }\\n+             }\\n+         }\\n+ \\n+         $hostsInfo | ConvertTo-Json -Depth 3 | Set-Content (Join-Path $clientDir \\\"HostsFile.json\\\") -Encoding UTF8\\n+         Write-Log \\\"Hosts file entries: $($hostsInfo.Entries.Count), Suspicious: $($hostsInfo.Suspicious.Count)\\\"\\n+     }\\n+ \\n+     # C. Browser Extensions (Chrome/Edge)\\n+     if ($script:Config.CheckBrowserExtensions) {\\n+         Write-SubSection \\\"Browser Extension Audit\\\"\\n+ \\n+         $extInfo = [PSCustomObject]@{\\n+             Chrome = @()\\n+             Edge = @()\\n+             Suspicious = @()\\n+         }\\n+ \\n+         # Suspicious extension patterns\\n+         $suspiciousPatterns = @(\\\"proxy\\\", \\\"vpn\\\", \\\"intercept\\\", \\\"modify\\\", \\\"inject\\\", \\\"ssl\\\", \\\"certificate\\\", \\\"mitm\\\")\\n+ \\n+         # Chrome extensions\\n+         $chromePath = \\\"$env:LOCALAPPDATA\\\\Google\\\\Chrome\\\\User Data\\\\Default\\\\Extensions\\\"\\n+         if (Test-Path $chromePath) {\\n+             $chromeExts = Get-ChildItem $chromePath -Directory -ErrorAction SilentlyContinue\\n+             foreach ($ext in $chromeExts) {\\n+                 $manifestPath = Get-ChildItem $ext.FullName -Filter \\\"manifest.json\\\" -Recurse -ErrorAction SilentlyContinue | Select-Object -First 1\\n+                 if ($manifestPath) {\\n+                     try {\\n+                         $manifest = Get-Content $manifestPath.FullName -Raw | ConvertFrom-Json\\n+                         $extData = [PSCustomObject]@{\\n+                             Id = $ext.Name\\n+                             Name = $manifest.name\\n+                             Version = $manifest.version\\n+                             Permissions = $manifest.permissions\\n+                         }\\n+                         $extInfo.Chrome += $extData\\n+ \\n+                         # Check for suspicious permissions\\n+                         $perms = $manifest.permissions -join \\\",\\\"\\n+                         foreach ($pattern in $suspiciousPatterns) {\\n+                             if ($manifest.name -match $pattern -or $perms -match $pattern) {\\n+                                 $extInfo.Suspicious += [PSCustomObject]@{\\n+                                     Browser = \\\"Chrome\\\"\\n+                                     Extension = $extData\\n+                                     Reason = \\\"Suspicious pattern: $pattern\\\"\\n+                                 }\\n+                                 Write-Alert \\\"Suspicious Chrome extension: $($manifest.name)\\\"\\n+                             }\\n+                         }\\n+ \\n+                         # Check for webRequest/webRequestBlocking (can intercept requests)\\n+                         if ($perms -match \\\"webRequest|webRequestBlocking\\\") {\\n+                             $extInfo.Suspicious += [PSCustomObject]@{\\n+                                 Browser = \\\"Chrome\\\"\\n+                                 Extension = $extData\\n+                                 Reason = \\\"Has webRequest permission (can intercept/modify requests)\\\"\\n+                             }\\n+                             Write-Log \\\"Chrome extension with webRequest: $($manifest.name)\\\" -Level \\\"WARN\\\"\\n+                         }\\n+                     } catch {\\n+                         # Skip malformed manifests\\n+                     }\\n+                 }\\n+             }\\n+         }\\n+ \\n+         # Edge extensions (same structure as Chrome)\\n+         $edgePath = \\\"$env:LOCALAPPDATA\\\\Microsoft\\\\Edge\\\\User Data\\\\Default\\\\Extensions\\\"\\n+         if (Test-Path $edgePath) {\\n+             $edgeExts = Get-ChildItem $edgePath -Directory -ErrorAction SilentlyContinue\\n+             foreach ($ext in $edgeExts) {\\n+                 $manifestPath = Get-ChildItem $ext.FullName -Filter \\\"manifest.json\\\" -Recurse -ErrorAction SilentlyContinue | Select-Object -First 1\\n+                 if ($manifestPath) {\\n+                     try {\\n+                         $manifest = Get-Content $manifestPath.FullName -Raw | ConvertFrom-Json\\n+                         $extData = [PSCustomObject]@{\\n+                             Id = $ext.Name\\n+                             Name = $manifest.name\\n+                             Version = $manifest.version\\n+                             Permissions = $manifest.permissions\\n+                         }\\n+                         $extInfo.Edge += $extData\\n+ \\n+                         $perms = $manifest.permissions -join \\\",\\\"\\n+                         foreach ($pattern in $suspiciousPatterns) {\\n+                             if ($manifest.name -match $pattern -or $perms -match $pattern) {\\n+                                 $extInfo.Suspicious += [PSCustomObject]@{\\n+                                     Browser = \\\"Edge\\\"\\n+                                     Extension = $extData\\n+                                     Reason = \\\"Suspicious pattern: $pattern\\\"\\n+                                 }\\n+                                 Write-Alert \\\"Suspicious Edge extension: $($manifest.name)\\\"\\n+                             }\\n+                         }\\n+                     } catch {\\n+                         # Skip malformed manifests\\n+                     }\\n+                 }\\n+             }\\n+         }\\n+ \\n+         $extInfo | ConvertTo-Json -Depth 5 | Set-Content (Join-Path $clientDir \\\"BrowserExtensions.json\\\") -Encoding UTF8\\n+         Write-Log \\\"Chrome extensions: $($extInfo.Chrome.Count), Edge extensions: $($extInfo.Edge.Count)\\\"\\n+     }\\n+ }\\n+ \\n+ #endregion\\n+ \\n+ #region Phase 6: Evidence Finalization\\n+ \\n+ function Complete-EvidencePackage {\\n+     Write-Section \\\"PHASE 6: EVIDENCE FINALIZATION\\\"\\n+ \\n+     # Generate summary\\n+     Write-SubSection \\\"Generating Summary\\\"\\n+ \\n+     $alertContent = Get-Content $script:AlertFile -ErrorAction SilentlyContinue\\n+     $alertCount = ($alertContent | Where-Object { $_ -ne \u0027\u0027 }).Count\\n+ \\n+     $summary = [PSCustomObject]@{\\n+         AuditTimestamp = (Get-Date).ToString(\\\"o\\\")\\n+         EvidenceDirectory = $script:BaseDir\\n+         TotalAlerts = $alertCount\\n+         Targets = $script:Config.Targets\\n+         Configuration = @{\\n+             TracerouteEnabled = $script:Config.TracerouteEnabled -and -not $SkipTraceroute\\n+             ClientSideChecks = -not $SkipClientSideChecks\\n+             RootCaExport = $script:Config.ExportRootCa\\n+         }\\n+         Verdict = if ($alertCount -eq 0) { \\\"No obvious MITM indicators detected\\\" } else { \\\"REVIEW REQUIRED - $alertCount alerts found\\\" }\\n+     }\\n+ \\n+     $summary | ConvertTo-Json -Depth 3 | Set-Content (Join-Path $script:BaseDir \\\"Summary.json\\\") -Encoding UTF8\\n+ \\n+     # Generate file hashes for chain of custody\\n+     Write-SubSection \\\"Generating Evidence Hashes\\\"\\n+ \\n+     $hashManifest = @()\\n+     Get-ChildItem $script:BaseDir -Recurse -File | ForEach-Object {\\n+         $hash = Get-FileHash -Path $_.FullName -Algorithm $script:Config.HashAlgorithm\\n+         $relativePath = $_.FullName.Substring($script:BaseDir.Length + 1)\\n+         $hashManifest += [PSCustomObject]@{\\n+             File = $relativePath\\n+             Algorithm = $script:Config.HashAlgorithm\\n+             Hash = $hash.Hash\\n+         }\\n+     }\\n+ \\n+     $hashManifest | ConvertTo-Json -Depth 3 | Set-Content (Join-Path $script:BaseDir \\\"_FileHashes.json\\\") -Encoding UTF8\\n+     Write-Log \\\"Generated hashes for $($hashManifest.Count) files\\\"\\n+ \\n+     # Final output\\n+     Write-Host \\\"\\\"\\n+     Write-Host (\\\"=\\\" * 70) -ForegroundColor Green\\n+     Write-Host \\\" AUDIT COMPLETE\\\" -ForegroundColor Green\\n+     Write-Host (\\\"=\\\" * 70) -ForegroundColor Green\\n+     Write-Host \\\"\\\"\\n+     Write-Host \\\"Evidence Directory: $script:BaseDir\\\" -ForegroundColor Cyan\\n+     Write-Host \\\"\\\"\\n+ \\n+     if ($alertCount -gt 0) {\\n+         Write-Host \\\"ALERTS FOUND: $alertCount\\\" -ForegroundColor Red\\n+         Write-Host \\\"Review _RedFlags.txt immediately!\\\" -ForegroundColor Yellow\\n+         Write-Host \\\"\\\"\\n+         Write-Host \\\"--- ALERTS ---\\\" -ForegroundColor Red\\n+         Get-Content $script:AlertFile | ForEach-Object { Write-Host \\\"  $_\\\" -ForegroundColor Yellow }\\n+     } else {\\n+         Write-Host \\\"No obvious MITM indicators detected.\\\" -ForegroundColor Green\\n+         Write-Host \\\"Note: Passive interception (logging only) may not trigger alerts.\\\" -ForegroundColor Yellow\\n+     }\\n+ \\n+     Write-Host \\\"\\\"\\n+     Write-Host \\\"NEXT STEPS:\\\" -ForegroundColor Cyan\\n+     Write-Host \\\"  1. Review _RedFlags.txt for immediate concerns\\\" -ForegroundColor White\\n+     Write-Host \\\"  2. Check certificate serials against crt.sh (on clean network)\\\" -ForegroundColor White\\n+     Write-Host \\\"  3. Zip the evidence folder and hash the zip for chain of custody\\\" -ForegroundColor White\\n+     Write-Host \\\"\\\"\\n+ }\\n+ \\n+ #endregion\\n+ \\n+ #region Main Execution\\n+ \\n+ # Load configuration\\n+ if ($ConfigFile) {\\n+     Read-ConfigFile -Path $ConfigFile\\n+ } else {\\n+     $defaultConfig = Join-Path $PSScriptRoot \\\"mitm-audit.cfg\\\"\\n+     if (Test-Path $defaultConfig) {\\n+         Read-ConfigFile -Path $defaultConfig\\n+     }\\n+ }\\n+ \\n+ # Override targets if specified\\n+ if ($Targets) {\\n+     $script:Config.Targets = $Targets -split \u0027,\u0027 | ForEach-Object { $_.Trim() }\\n+ }\\n+ \\n+ # Initialize output\\n+ Initialize-OutputDirectory -BasePath $OutputPath\\n+ \\n+ Write-Host \\\"\\\"\\n+ Write-Host (\\\"=\\\" * 70) -ForegroundColor Cyan\\n+ Write-Host \\\" INFRASTRUCTURE MITM AUDIT - FORENSIC EVIDENCE COLLECTION\\\" -ForegroundColor Cyan\\n+ Write-Host (\\\"=\\\" * 70) -ForegroundColor Cyan\\n+ Write-Host \\\"Timestamp: $(Get-Date -Format \u0027yyyy-MM-dd HH:mm:ss\u0027)\\\"\\n+ Write-Host \\\"Evidence Directory: $script:BaseDir\\\"\\n+ Write-Host \\\"Targets: $($script:Config.Targets -join \u0027, \u0027)\\\"\\n+ Write-Host \\\"\\\"\\n+ \\n+ Write-Log \\\"Audit started\\\"\\n+ Write-Log \\\"Targets: $($script:Config.Targets -join \u0027, \u0027)\\\"\\n+ \\n+ # Execute phases\\n+ Get-EnvironmentSnapshot\\n+ Export-TrustStore\\n+ Invoke-TargetAnalysis\\n+ Invoke-TracerouteMapping\\n+ Test-ClientSideExploits\\n+ Complete-EvidencePackage\\n+ \\n+ Write-Log \\\"Audit completed\\\"\\n+ \\n+ #endregion\\n+ \",\"oldStart\":1,\"newStart\":1,\"oldLines\":1,\"newLines\":981,\"linesRemoved\":1,\"linesAdded\":981}],\"editor\":\"EDITOR_AI\"},\"shouldAutoFixLints\":true,\"resultForModel\":\"Wrote contents to templates/network/Invoke-MitmAudit-v7.ps1.\",\"contentsAfterEdit\":\"#Requires -Version 7.0\\n\u003c#\\n.SYNOPSIS\\n    Infrastructure MITM Audit - Forensic Evidence Collection for TLS Interception Detection\\n\\n.DESCRIPTION\\n    Combines environment baselining, Root CA dumping, ASN-based integrity checking,\\n    and DoH comparison to detect infrastructure-side Man-in-the-Middle attacks while\\n    ruling out client-side exploits.\\n\\n    Produces a timestamped evidence package suitable for chain of custody.\\n\\n.PARAMETER ConfigFile\\n    Path to mitm-audit.cfg configuration file.\\n\\n.PARAMETER OutputPath\\n    Base directory for evidence collection (default: Desktop\\\\ForensicEvidence_timestamp)\\n\\n.PARAMETER Targets\\n    Override target domains from config (comma-separated)\\n\\n.PARAMETER SkipTraceroute\\n    Skip traceroute collection (faster but less complete)\\n\\n.PARAMETER SkipClientSideChecks\\n    Skip client-side exploit detection (browser extensions, proxy settings)\\n\\n.PARAMETER HashOnly\\n    Only generate hashes for existing evidence directory\\n\\n.EXAMPLE\\n    .\\\\Invoke-MitmAudit-v7.ps1\\n    .\\\\Invoke-MitmAudit-v7.ps1 -ConfigFile .\\\\mitm-audit.cfg\\n    .\\\\Invoke-MitmAudit-v7.ps1 -Targets \\\"accounts.google.com,github.com\\\"\\n    .\\\\Invoke-MitmAudit-v7.ps1 -SkipTraceroute -SkipClientSideChecks\\n\\n.NOTES\\n    License: BSD-2-Clause\\n    Requires: PowerShell 7+, Administrator privileges recommended\\n    Signed-off-by: Network Diagnostics Toolkit\\n\\n    Run as Administrator for complete Root CA export and network diagnostics.\\n\\n    EVIDENCE PROCESSING:\\n    1. Check _RedFlags.txt first - if empty, MITM may be passive/logging only\\n    2. Certificate Serial Check - copy serial to crt.sh on clean device\\n       - If \\\"No certificates found\\\": 100% MITM by private root CA\\n       - If cert shown for different domain: collision/hash attack\\n    3. Zip evidence folder, hash the zip for chain of custody\\n#\u003e\\n\\n[CmdletBinding()]\\nparam(\\n    [Parameter()]\\n    [string]$ConfigFile,\\n\\n    [Parameter()]\\n    [string]$OutputPath,\\n\\n    [Parameter()]\\n    [string]$Targets,\\n\\n    [Parameter()]\\n    [switch]$SkipTraceroute,\\n\\n    [Parameter()]\\n    [switch]$SkipClientSideChecks,\\n\\n    [Parameter()]\\n    [switch]$HashOnly\\n)\\n\\nSet-StrictMode -Version Latest\\n$ErrorActionPreference = \u0027Continue\u0027\\n\\n#region Configuration\\n\\n# Default configuration\\n$script:Config = @{\\n    Targets = @(\\\"accounts.google.com\\\", \\\"login.microsoftonline.com\\\", \\\"appleid.apple.com\\\", \\\"aws.amazon.com\\\", \\\"github.com\\\")\\n    PublicResolvers = @(\\\"1.1.1.1\\\", \\\"8.8.8.8\\\", \\\"9.9.9.9\\\")\\n    DohEndpoint = \\\"https://dns.google/resolve\\\"\\n    AsnLookupUrl = \\\"http://ip-api.com/json\\\"\\n    AsnLookupTimeout = 3\\n    ExternalIpUrl = \\\"https://ipinfo.io/json\\\"\\n    ExternalIpTimeout = 5\\n    ExpectedIspPatterns = @()\\n    SuspiciousAsnPatterns = @(\\\"DigitalOcean\\\", \\\"Linode\\\", \\\"Vultr\\\", \\\"Choopa\\\", \\\"Datacamp\\\", \\\"OVH\\\", \\\"Hetzner\\\")\\n    SuspiciousCertIssuers = @(\\\"Let\u0027s Encrypt\\\", \\\"ZeroSSL\\\", \\\"Self-Signed\\\", \\\"localhost\\\")\\n    TracerouteMaxHops = 15\\n    TracerouteTimeout = 2\\n    TracerouteEnabled = $true\\n    ExportRootCa = $true\\n    HashRootCa = $true\\n    CheckProxySettings = $true\\n    CheckBrowserExtensions = $true\\n    CheckHostsFile = $true\\n    CheckRootCaAnomalies = $true\\n    HashAlgorithm = \\\"SHA256\\\"\\n}\\n\\nfunction Read-ConfigFile {\\n    param([string]$Path)\\n\\n    if (-not (Test-Path $Path)) {\\n        Write-Warning \\\"Config file not found: $Path (using defaults)\\\"\\n        return\\n    }\\n\\n    Get-Content $Path | ForEach-Object {\\n        $line = $_.Trim()\\n        if ($line -match \u0027^#\u0027 -or $line -eq \u0027\u0027) { return }\\n        if ($line -match \u0027^([^=]+)=(.*)$\u0027) {\\n            $key = $Matches[1].Trim()\\n            $value = $Matches[2].Trim()\\n\\n            switch ($key) {\\n                \u0027TARGETS\u0027 { $script:Config.Targets = $value -split \u0027,\u0027 | ForEach-Object { $_.Trim() } }\\n                \u0027PUBLIC_RESOLVERS\u0027 { $script:Config.PublicResolvers = $value -split \u0027,\u0027 | ForEach-Object { $_.Trim() } }\\n                \u0027DOH_ENDPOINT\u0027 { $script:Config.DohEndpoint = $value }\\n                \u0027ASN_LOOKUP_URL\u0027 { $script:Config.AsnLookupUrl = $value }\\n                \u0027ASN_LOOKUP_TIMEOUT_SEC\u0027 { $script:Config.AsnLookupTimeout = [int]$value }\\n                \u0027EXTERNAL_IP_URL\u0027 { $script:Config.ExternalIpUrl = $value }\\n                \u0027EXTERNAL_IP_TIMEOUT_SEC\u0027 { $script:Config.ExternalIpTimeout = [int]$value }\\n                \u0027EXPECTED_ISP_PATTERNS\u0027 { if ($value) { $script:Config.ExpectedIspPatterns = $value -split \u0027,\u0027 | ForEach-Object { $_.Trim() } } }\\n                \u0027SUSPICIOUS_ASN_PATTERNS\u0027 { $script:Config.SuspiciousAsnPatterns = $value -split \u0027,\u0027 | ForEach-Object { $_.Trim() } }\\n                \u0027SUSPICIOUS_CERT_ISSUERS\u0027 { $script:Config.SuspiciousCertIssuers = $value -split \u0027,\u0027 | ForEach-Object { $_.Trim() } }\\n                \u0027TRACEROUTE_MAX_HOPS\u0027 { $script:Config.TracerouteMaxHops = [int]$value }\\n                \u0027TRACEROUTE_TIMEOUT_SEC\u0027 { $script:Config.TracerouteTimeout = [int]$value }\\n                \u0027TRACEROUTE_ENABLED\u0027 { $script:Config.TracerouteEnabled = $value -eq \u0027true\u0027 }\\n                \u0027EXPORT_ROOT_CA\u0027 { $script:Config.ExportRootCa = $value -eq \u0027true\u0027 }\\n                \u0027HASH_ROOT_CA\u0027 { $script:Config.HashRootCa = $value -eq \u0027true\u0027 }\\n                \u0027CHECK_PROXY_SETTINGS\u0027 { $script:Config.CheckProxySettings = $value -eq \u0027true\u0027 }\\n                \u0027CHECK_BROWSER_EXTENSIONS\u0027 { $script:Config.CheckBrowserExtensions = $value -eq \u0027true\u0027 }\\n                \u0027CHECK_HOSTS_FILE\u0027 { $script:Config.CheckHostsFile = $value -eq \u0027true\u0027 }\\n                \u0027CHECK_ROOT_CA_ANOMALIES\u0027 { $script:Config.CheckRootCaAnomalies = $value -eq \u0027true\u0027 }\\n                \u0027HASH_ALGORITHM\u0027 { $script:Config.HashAlgorithm = $value }\\n            }\\n        }\\n    }\\n}\\n\\n#endregion\\n\\n#region Logging and Output\\n\\n$script:LogFile = $null\\n$script:AlertFile = $null\\n\\nfunction Initialize-OutputDirectory {\\n    param([string]$BasePath)\\n\\n    $timestamp = Get-Date -Format \\\"yyyyMMdd_HHmmss\\\"\\n\\n    if ($BasePath) {\\n        $script:BaseDir = $BasePath\\n    } else {\\n        $script:BaseDir = Join-Path $env:USERPROFILE \\\"Desktop\\\\ForensicEvidence_$timestamp\\\"\\n    }\\n\\n    New-Item -Path $script:BaseDir -ItemType Directory -Force | Out-Null\\n    $script:LogFile = Join-Path $script:BaseDir \\\"_AuditLog.txt\\\"\\n    $script:AlertFile = Join-Path $script:BaseDir \\\"_RedFlags.txt\\\"\\n\\n    # Initialize files\\n    \\\"\\\" | Set-Content $script:AlertFile -Encoding UTF8\\n}\\n\\nfunction Write-Log {\\n    param([string]$Message, [string]$Level = \\\"INFO\\\")\\n\\n    $timestamp = Get-Date -Format \\\"yyyy-MM-dd HH:mm:ss\\\"\\n    $logEntry = \\\"[$timestamp] [$Level] $Message\\\"\\n\\n    switch ($Level) {\\n        \\\"ERROR\\\" { Write-Host $logEntry -ForegroundColor Red }\\n        \\\"WARN\\\"  { Write-Host $logEntry -ForegroundColor Yellow }\\n        \\\"ALERT\\\" { Write-Host \\\"[!] $Message\\\" -ForegroundColor Red }\\n        default { Write-Host $logEntry }\\n    }\\n\\n    Add-Content -Path $script:LogFile -Value $logEntry -Encoding UTF8\\n}\\n\\nfunction Write-Alert {\\n    param([string]$Message)\\n\\n    Write-Log -Message $Message -Level \\\"ALERT\\\"\\n    $timestamp = Get-Date -Format \\\"yyyy-MM-dd HH:mm:ss\\\"\\n    Add-Content -Path $script:AlertFile -Value \\\"[$timestamp] $Message\\\" -Encoding UTF8\\n}\\n\\nfunction Write-Section {\\n    param([string]$Title)\\n    Write-Host \\\"\\\"\\n    Write-Host (\\\"=\\\" * 70) -ForegroundColor Cyan\\n    Write-Host \\\" $Title\\\" -ForegroundColor Cyan\\n    Write-Host (\\\"=\\\" * 70) -ForegroundColor Cyan\\n    Write-Log \\\"=== $Title ===\\\" -Level \\\"INFO\\\"\\n}\\n\\nfunction Write-SubSection {\\n    param([string]$Title)\\n    Write-Host \\\"\\\"\\n    Write-Host \\\"[*] $Title\\\" -ForegroundColor Yellow\\n    Write-Host (\\\"-\\\" * 50)\\n    Write-Log \\\"--- $Title ---\\\" -Level \\\"INFO\\\"\\n}\\n\\n#endregion\\n\\n#region ASN and DNS Functions\\n\\nfunction Get-ASN {\\n    param([string]$IP)\\n\\n    try {\\n        $uri = \\\"$($script:Config.AsnLookupUrl)/$IP`?fields=status,message,org,as\\\"\\n        $response = Invoke-RestMethod -Uri $uri -TimeoutSec $script:Config.AsnLookupTimeout -ErrorAction Stop\\n\\n        if ($response.status -eq \\\"success\\\") {\\n            return \\\"$($response.org) ($($response.as))\\\"\\n        } else {\\n            return \\\"Unknown\\\"\\n        }\\n    } catch {\\n        return \\\"Lookup Failed (Blocked?)\\\"\\n    }\\n}\\n\\nfunction Get-DohResolution {\\n    param([string]$Domain)\\n\\n    try {\\n        $uri = \\\"$($script:Config.DohEndpoint)?name=$Domain\u0026type=A\\\"\\n        $response = Invoke-RestMethod -Uri $uri -TimeoutSec 5 -ErrorAction Stop\\n\\n        if ($response.Answer -and $response.Answer.Count -gt 0) {\\n            return $response.Answer[0].data\\n        }\\n        return $null\\n    } catch {\\n        return $null\\n    }\\n}\\n\\nfunction Test-AsnIntegrity {\\n    param(\\n        [string]$Domain,\\n        [string]$Asn\\n    )\\n\\n    if ($Asn -eq \\\"Lookup Failed (Blocked?)\\\") {\\n        return $null  # Cannot determine\\n    }\\n\\n    # Check against expected patterns\\n    if ($Domain -match \\\"google\\\" -and $Asn -notmatch \\\"Google\\\") {\\n        return \\\"MITM DETECTED: $Domain resolving to non-Google ASN ($Asn)\\\"\\n    }\\n    if ($Domain -match \\\"microsoft\\\" -and $Asn -notmatch \\\"Microsoft\\\") {\\n        return \\\"MITM DETECTED: $Domain resolving to non-Microsoft ASN ($Asn)\\\"\\n    }\\n    if ($Domain -match \\\"apple\\\" -and $Asn -notmatch \\\"Apple\\\") {\\n        return \\\"MITM DETECTED: $Domain resolving to non-Apple ASN ($Asn)\\\"\\n    }\\n    if ($Domain -match \\\"aws\\\\.amazon|amazonaws\\\" -and $Asn -notmatch \\\"Amazon|AMAZON\\\") {\\n        return \\\"MITM DETECTED: $Domain resolving to non-Amazon ASN ($Asn)\\\"\\n    }\\n    if ($Domain -match \\\"github\\\" -and $Asn -notmatch \\\"GitHub|Microsoft\\\") {\\n        return \\\"MITM DETECTED: $Domain resolving to non-GitHub/Microsoft ASN ($Asn)\\\"\\n    }\\n\\n    # Check for suspicious VPS providers\\n    foreach ($pattern in $script:Config.SuspiciousAsnPatterns) {\\n        if ($Asn -match $pattern) {\\n            return \\\"MITM DETECTED: High-value target routed to VPS provider ($pattern)\\\"\\n        }\\n    }\\n\\n    return $null\\n}\\n\\n#endregion\\n\\n#region Certificate Functions\\n\\nfunction Get-TlsCertificate {\\n    param([string]$Domain, [int]$Port = 443)\\n\\n    try {\\n        $tcpClient = New-Object System.Net.Sockets.TcpClient\\n        $tcpClient.Connect($Domain, $Port)\\n        $sslStream = New-Object System.Net.Security.SslStream($tcpClient.GetStream(), $false, { $true })\\n        $sslStream.AuthenticateAsClient($Domain)\\n        $cert = $sslStream.RemoteCertificate\\n\\n        $certInfo = [PSCustomObject]@{\\n            Subject = $cert.Subject\\n            Issuer = $cert.Issuer\\n            SerialNumber = $cert.GetSerialNumberString()\\n            Thumbprint = $cert.GetCertHashString()\\n            NotBefore = $cert.GetEffectiveDateString()\\n            NotAfter = $cert.GetExpirationDateString()\\n        }\\n\\n        $sslStream.Close()\\n        $tcpClient.Close()\\n\\n        return $certInfo\\n    } catch {\\n        return [PSCustomObject]@{\\n            Error = $_.Exception.Message\\n            Domain = $Domain\\n        }\\n    }\\n}\\n\\nfunction Test-CertificateAnomaly {\\n    param(\\n        [string]$Domain,\\n        [PSCustomObject]$CertInfo\\n    )\\n\\n    if ($CertInfo.Error) {\\n        return \\\"TLS Handshake Failed for $Domain - Interception likely causing protocol error\\\"\\n    }\\n\\n    # Check for suspicious issuers on major tech domains\\n    foreach ($issuerPattern in $script:Config.SuspiciousCertIssuers) {\\n        $isMajorTech = $Domain -match \\\"google|microsoft|apple|amazon|github\\\"\\n        if ($isMajorTech -and $CertInfo.Issuer -match $issuerPattern) {\\n            return \\\"CERTIFICATE ANOMALY: $Domain using $issuerPattern issuer - highly suspicious for major tech corp\\\"\\n        }\\n    }\\n\\n    return $null\\n}\\n\\n#endregion\\n\\n#region Phase 1: Environment Snapshot\\n\\nfunction Get-EnvironmentSnapshot {\\n    Write-Section \\\"PHASE 1: ENVIRONMENT SNAPSHOT\\\"\\n\\n    $envDir = Join-Path $script:BaseDir \\\"environment\\\"\\n    New-Item -Path $envDir -ItemType Directory -Force | Out-Null\\n\\n    # Network configuration\\n    Write-SubSection \\\"Network Configuration\\\"\\n    $netConfig = Get-NetIPConfiguration | Select-Object InterfaceAlias, IPv4Address, IPv4DefaultGateway, DNSServer\\n    $netConfig | ConvertTo-Json -Depth 5 | Set-Content (Join-Path $envDir \\\"NetworkConfig.json\\\") -Encoding UTF8\\n    Get-NetIPConfiguration | Out-File (Join-Path $envDir \\\"NetworkConfig.txt\\\") -Encoding UTF8\\n\\n    # External IP\\n    Write-SubSection \\\"External IP Identification\\\"\\n    try {\\n        $extIp = Invoke-RestMethod -Uri $script:Config.ExternalIpUrl -TimeoutSec $script:Config.ExternalIpTimeout\\n        $extIp | ConvertTo-Json | Set-Content (Join-Path $envDir \\\"ExternalIP.json\\\") -Encoding UTF8\\n\\n        Write-Log \\\"External IP: $($extIp.ip)\\\"\\n        Write-Log \\\"External Org: $($extIp.org)\\\"\\n        Write-Log \\\"Location: $($extIp.city), $($extIp.region), $($extIp.country)\\\"\\n\\n        # Check expected ISP\\n        if ($script:Config.ExpectedIspPatterns.Count -gt 0) {\\n            $isExpectedIsp = $false\\n            foreach ($pattern in $script:Config.ExpectedIspPatterns) {\\n                if ($extIp.org -match $pattern) {\\n                    $isExpectedIsp = $true\\n                    break\\n                }\\n            }\\n            if (-not $isExpectedIsp) {\\n                Write-Alert \\\"External IP Org ($($extIp.org)) does not match expected ISP patterns - traffic may be tunneled/proxied\\\"\\n            }\\n        }\\n    } catch {\\n        Write-Alert \\\"Unable to determine External IP - connection may be blocked or filtered\\\"\\n    }\\n\\n    # System info\\n    Write-SubSection \\\"System Information\\\"\\n    $sysInfo = [PSCustomObject]@{\\n        ComputerName = $env:COMPUTERNAME\\n        UserName = $env:USERNAME\\n        UserDomain = $env:USERDOMAIN\\n        OSVersion = [System.Environment]::OSVersion.VersionString\\n        PowerShellVersion = $PSVersionTable.PSVersion.ToString()\\n        Is64Bit = [System.Environment]::Is64BitOperatingSystem\\n        IsAdmin = ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)\\n        Timestamp = (Get-Date).ToString(\\\"o\\\")\\n    }\\n    $sysInfo | ConvertTo-Json | Set-Content (Join-Path $envDir \\\"SystemInfo.json\\\") -Encoding UTF8\\n    Write-Log \\\"System: $($sysInfo.ComputerName) / User: $($sysInfo.UserName) / Admin: $($sysInfo.IsAdmin)\\\"\\n}\\n\\n#endregion\\n\\n#region Phase 2: Trust Store Export\\n\\nfunction Export-TrustStore {\\n    Write-Section \\\"PHASE 2: TRUST STORE EXPORT\\\"\\n\\n    $trustDir = Join-Path $script:BaseDir \\\"trust-store\\\"\\n    New-Item -Path $trustDir -ItemType Directory -Force | Out-Null\\n\\n    if (-not $script:Config.ExportRootCa) {\\n        Write-Log \\\"Root CA export disabled in configuration\\\"\\n        return\\n    }\\n\\n    Write-SubSection \\\"Exporting Root CA Store\\\"\\n\\n    # Export Root CAs\\n    $rootCAs = Get-ChildItem Cert:\\\\LocalMachine\\\\Root\\n    $rootCaData = $rootCAs | Select-Object Thumbprint, Subject, Issuer, NotBefore, NotAfter, @{N=\u0027SignatureAlgorithm\u0027;E={$_.SignatureAlgorithm.FriendlyName}}\\n\\n    # Export to CSV\\n    $csvPath = Join-Path $trustDir \\\"RootStore_Dump.csv\\\"\\n    $rootCaData | Export-Csv -Path $csvPath -NoTypeInformation -Encoding UTF8\\n    Write-Log \\\"Root CA Store exported to $csvPath ($($rootCAs.Count) certificates)\\\"\\n\\n    # Export to JSON for programmatic access\\n    $jsonPath = Join-Path $trustDir \\\"RootStore_Dump.json\\\"\\n    $rootCaData | ConvertTo-Json -Depth 3 | Set-Content $jsonPath -Encoding UTF8\\n\\n    # Hash the export if configured\\n    if ($script:Config.HashRootCa) {\\n        $hash = Get-FileHash -Path $csvPath -Algorithm $script:Config.HashAlgorithm\\n        $hash | ConvertTo-Json | Set-Content (Join-Path $trustDir \\\"RootStore_Hash.json\\\") -Encoding UTF8\\n        Write-Log \\\"Root CA hash: $($hash.Hash)\\\"\\n    }\\n\\n    # Check for anomalies\\n    if ($script:Config.CheckRootCaAnomalies) {\\n        Write-SubSection \\\"Root CA Anomaly Detection\\\"\\n\\n        $suspicious = @()\\n\\n        foreach ($ca in $rootCAs) {\\n            # Check for self-signed certs with suspicious names\\n            if ($ca.Subject -match \\\"Self|Test|Admin|Local|Proxy|Intercept|MITM\\\") {\\n                $suspicious += [PSCustomObject]@{\\n                    Thumbprint = $ca.Thumbprint\\n                    Subject = $ca.Subject\\n                    Reason = \\\"Suspicious name pattern in certificate subject\\\"\\n                }\\n            }\\n\\n            # Check for recently added certs (within last 30 days)\\n            if ($ca.NotBefore -gt (Get-Date).AddDays(-30)) {\\n                $suspicious += [PSCustomObject]@{\\n                    Thumbprint = $ca.Thumbprint\\n                    Subject = $ca.Subject\\n                    NotBefore = $ca.NotBefore\\n                    Reason = \\\"Recently added root CA (within last 30 days)\\\"\\n                }\\n            }\\n\\n            # Check for common enterprise MITM tools\\n            if ($ca.Subject -match \\\"Zscaler|BlueCoat|Forcepoint|McAfee|Symantec Web Gateway|Websense|Palo Alto\\\") {\\n                $suspicious += [PSCustomObject]@{\\n                    Thumbprint = $ca.Thumbprint\\n                    Subject = $ca.Subject\\n                    Reason = \\\"Enterprise TLS inspection tool detected\\\"\\n                }\\n            }\\n        }\\n\\n        if ($suspicious.Count -gt 0) {\\n            $suspicious | ConvertTo-Json -Depth 3 | Set-Content (Join-Path $trustDir \\\"SuspiciousCAs.json\\\") -Encoding UTF8\\n            foreach ($s in $suspicious) {\\n                Write-Alert \\\"Suspicious Root CA: $($s.Subject) - $($s.Reason)\\\"\\n            }\\n        } else {\\n            Write-Log \\\"No suspicious root CAs detected\\\"\\n        }\\n    }\\n}\\n\\n#endregion\\n\\n#region Phase 3: Target Analysis\\n\\nfunction Invoke-TargetAnalysis {\\n    Write-Section \\\"PHASE 3: TARGET ANALYSIS AND ASN INTEGRITY\\\"\\n\\n    $targetsDir = Join-Path $script:BaseDir \\\"targets\\\"\\n    New-Item -Path $targetsDir -ItemType Directory -Force | Out-Null\\n\\n    foreach ($domain in $script:Config.Targets) {\\n        Write-SubSection \\\"Analyzing: $domain\\\"\\n\\n        $safeDomain = $domain -replace \u0027\\\\.\u0027, \u0027_\u0027\\n        $domainDir = Join-Path $targetsDir $safeDomain\\n        New-Item -Path $domainDir -ItemType Directory -Force | Out-Null\\n\\n        $analysis = [PSCustomObject]@{\\n            Domain = $domain\\n            Timestamp = (Get-Date).ToString(\\\"o\\\")\\n            LocalDns = $null\\n            LocalAsn = $null\\n            DohDns = $null\\n            DohAsn = $null\\n            Certificate = $null\\n            Alerts = @()\\n        }\\n\\n        # A. Local DNS Resolution\\n        try {\\n            $localIp = (Resolve-DnsName -Name $domain -Type A -ErrorAction SilentlyContinue).IPAddress | Select-Object -First 1\\n            $analysis.LocalDns = $localIp\\n\\n            if ($localIp) {\\n                $localAsn = Get-ASN -IP $localIp\\n                $analysis.LocalAsn = $localAsn\\n                Write-Log \\\"Local DNS: $localIp | ASN: $localAsn\\\"\\n            } else {\\n                Write-Log \\\"Local DNS resolution failed\\\" -Level \\\"WARN\\\"\\n            }\\n        } catch {\\n            Write-Log \\\"DNS resolution error: $_\\\" -Level \\\"ERROR\\\"\\n        }\\n\\n        # B. DoH Resolution (Control Group)\\n        $dohIp = Get-DohResolution -Domain $domain\\n        if ($dohIp) {\\n            $analysis.DohDns = $dohIp\\n            $dohAsn = Get-ASN -IP $dohIp\\n            $analysis.DohAsn = $dohAsn\\n            Write-Log \\\"DoH DNS:   $dohIp | ASN: $dohAsn\\\"\\n\\n            # Compare IPs\\n            if ($analysis.LocalDns -and $analysis.LocalDns -ne $dohIp) {\\n                Write-Log \\\"DNS MISMATCH: Local ($($analysis.LocalDns)) vs DoH ($dohIp)\\\" -Level \\\"WARN\\\"\\n            }\\n        } else {\\n            Write-Log \\\"DoH resolution failed (network may be blocking)\\\" -Level \\\"WARN\\\"\\n        }\\n\\n        # C. ASN Integrity Check\\n        if ($analysis.LocalAsn) {\\n            $asnAlert = Test-AsnIntegrity -Domain $domain -Asn $analysis.LocalAsn\\n            if ($asnAlert) {\\n                Write-Alert $asnAlert\\n                $analysis.Alerts += $asnAlert\\n            }\\n        }\\n\\n        # D. Certificate Capture\\n        Write-Log \\\"Capturing TLS certificate...\\\"\\n        $certInfo = Get-TlsCertificate -Domain $domain\\n        $analysis.Certificate = $certInfo\\n\\n        $certPath = Join-Path $domainDir \\\"Certificate.json\\\"\\n        $certInfo | ConvertTo-Json -Depth 3 | Set-Content $certPath -Encoding UTF8\\n\\n        if ($certInfo.SerialNumber) {\\n            Write-Log \\\"Certificate Serial: $($certInfo.SerialNumber)\\\"\\n            Write-Log \\\"Certificate Issuer: $($certInfo.Issuer)\\\"\\n\\n            # Check for certificate anomalies\\n            $certAlert = Test-CertificateAnomaly -Domain $domain -CertInfo $certInfo\\n            if ($certAlert) {\\n                Write-Alert $certAlert\\n                $analysis.Alerts += $certAlert\\n            }\\n        } else {\\n            Write-Alert \\\"TLS Handshake Failed for $domain - $($certInfo.Error)\\\"\\n            $analysis.Alerts += \\\"TLS Handshake Failed: $($certInfo.Error)\\\"\\n        }\\n\\n        # Save analysis\\n        $analysis | ConvertTo-Json -Depth 5 | Set-Content (Join-Path $domainDir \\\"Analysis.json\\\") -Encoding UTF8\\n    }\\n}\\n\\n#endregion\\n\\n#region Phase 4: Traceroute Mapping\\n\\nfunction Invoke-TracerouteMapping {\\n    Write-Section \\\"PHASE 4: TRACEROUTE MAPPING\\\"\\n\\n    if (-not $script:Config.TracerouteEnabled -or $SkipTraceroute) {\\n        Write-Log \\\"Traceroute skipped (disabled or -SkipTraceroute specified)\\\"\\n        return\\n    }\\n\\n    $traceDir = Join-Path $script:BaseDir \\\"traceroute\\\"\\n    New-Item -Path $traceDir -ItemType Directory -Force | Out-Null\\n\\n    foreach ($domain in $script:Config.Targets) {\\n        Write-SubSection \\\"Tracing: $domain\\\"\\n\\n        $safeDomain = $domain -replace \u0027\\\\.\u0027, \u0027_\u0027\\n        $tracePath = Join-Path $traceDir \\\"Trace_$safeDomain.txt\\\"\\n        $traceJsonPath = Join-Path $traceDir \\\"Trace_$safeDomain.json\\\"\\n\\n        try {\\n            $trace = Test-NetConnection -ComputerName $domain -TraceRoute -WarningAction SilentlyContinue\\n            $hops = $trace.TraceRoute\\n\\n            # Save text output\\n            $hops | Out-File $tracePath -Encoding UTF8\\n\\n            # Save JSON with ASN lookup for each hop\\n            $hopDetails = @()\\n            $hopNum = 1\\n            foreach ($hop in $hops) {\\n                if ($hop -and $hop -ne \\\"*\\\") {\\n                    $asn = Get-ASN -IP $hop\\n                    $hopDetails += [PSCustomObject]@{\\n                        Hop = $hopNum\\n                        IP = $hop\\n                        ASN = $asn\\n                    }\\n\\n                    # Check for suspicious hops\\n                    foreach ($pattern in $script:Config.SuspiciousAsnPatterns) {\\n                        if ($asn -match $pattern) {\\n                            Write-Alert \\\"Suspicious hop in traceroute to $domain - Hop $hopNum ($hop) routes through $pattern\\\"\\n                        }\\n                    }\\n                }\\n                $hopNum++\\n            }\\n\\n            $hopDetails | ConvertTo-Json -Depth 3 | Set-Content $traceJsonPath -Encoding UTF8\\n            Write-Log \\\"Trace complete: $($hops.Count) hops\\\"\\n        } catch {\\n            Write-Log \\\"Traceroute failed: $_\\\" -Level \\\"ERROR\\\"\\n        }\\n    }\\n}\\n\\n#endregion\\n\\n#region Phase 5: Client-Side Exploit Detection\\n\\nfunction Test-ClientSideExploits {\\n    Write-Section \\\"PHASE 5: CLIENT-SIDE EXPLOIT DETECTION\\\"\\n\\n    if ($SkipClientSideChecks) {\\n        Write-Log \\\"Client-side checks skipped (-SkipClientSideChecks specified)\\\"\\n        return\\n    }\\n\\n    $clientDir = Join-Path $script:BaseDir \\\"client-side\\\"\\n    New-Item -Path $clientDir -ItemType Directory -Force | Out-Null\\n\\n    # A. Proxy Settings\\n    if ($script:Config.CheckProxySettings) {\\n        Write-SubSection \\\"Proxy Settings Check\\\"\\n\\n        $proxyInfo = [PSCustomObject]@{\\n            SystemProxy = $null\\n            EnvironmentProxy = $null\\n            WinHttpProxy = $null\\n            Alerts = @()\\n        }\\n\\n        # System proxy (Internet Options)\\n        try {\\n            $regPath = \\\"HKCU:\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Internet Settings\\\"\\n            $proxyEnabled = Get-ItemProperty -Path $regPath -Name ProxyEnable -ErrorAction SilentlyContinue\\n            $proxyServer = Get-ItemProperty -Path $regPath -Name ProxyServer -ErrorAction SilentlyContinue\\n\\n            $proxyInfo.SystemProxy = [PSCustomObject]@{\\n                Enabled = [bool]$proxyEnabled.ProxyEnable\\n                Server = $proxyServer.ProxyServer\\n            }\\n\\n            if ($proxyEnabled.ProxyEnable) {\\n                Write-Alert \\\"System proxy is ENABLED: $($proxyServer.ProxyServer)\\\"\\n                $proxyInfo.Alerts += \\\"System proxy enabled\\\"\\n            } else {\\n                Write-Log \\\"System proxy: Disabled\\\"\\n            }\\n        } catch {\\n            Write-Log \\\"Could not read system proxy settings\\\" -Level \\\"WARN\\\"\\n        }\\n\\n        # Environment variables\\n        $envProxy = @{\\n            HTTP_PROXY = $env:HTTP_PROXY\\n            HTTPS_PROXY = $env:HTTPS_PROXY\\n            ALL_PROXY = $env:ALL_PROXY\\n            NO_PROXY = $env:NO_PROXY\\n        }\\n        $proxyInfo.EnvironmentProxy = $envProxy\\n\\n        foreach ($key in $envProxy.Keys) {\\n            if ($envProxy[$key]) {\\n                Write-Alert \\\"Environment proxy variable set: $key = $($envProxy[$key])\\\"\\n                $proxyInfo.Alerts += \\\"Env proxy: $key\\\"\\n            }\\n        }\\n\\n        # WinHTTP proxy\\n        try {\\n            $winhttp = netsh winhttp show proxy 2\u003e\u00261\\n            $proxyInfo.WinHttpProxy = $winhttp -join \\\"`n\\\"\\n            if ($winhttp -match \\\"Proxy Server\\\") {\\n                Write-Alert \\\"WinHTTP proxy configured - check output for details\\\"\\n            }\\n        } catch {\\n            Write-Log \\\"Could not check WinHTTP proxy\\\" -Level \\\"WARN\\\"\\n        }\\n\\n        $proxyInfo | ConvertTo-Json -Depth 3 | Set-Content (Join-Path $clientDir \\\"ProxySettings.json\\\") -Encoding UTF8\\n    }\\n\\n    # B. Hosts File Check\\n    if ($script:Config.CheckHostsFile) {\\n        Write-SubSection \\\"Hosts File Analysis\\\"\\n\\n        $hostsPath = \\\"$env:SystemRoot\\\\System32\\\\drivers\\\\etc\\\\hosts\\\"\\n        $hostsContent = Get-Content $hostsPath -ErrorAction SilentlyContinue\\n\\n        $hostsInfo = [PSCustomObject]@{\\n            Path = $hostsPath\\n            Entries = @()\\n            Suspicious = @()\\n        }\\n\\n        $sensitivePatterns = @(\\\"google\\\", \\\"microsoft\\\", \\\"apple\\\", \\\"amazon\\\", \\\"github\\\", \\\"cursor\\\", \\\"openai\\\", \\\"anthropic\\\")\\n\\n        foreach ($line in $hostsContent) {\\n            if ($line -match \u0027^\\\\s*#\u0027 -or $line -match \u0027^\\\\s*$\u0027) { continue }\\n\\n            $parts = $line -split \u0027\\\\s+\u0027, 2\\n            if ($parts.Count -ge 2) {\\n                $ip = $parts[0]\\n                $hostnames = $parts[1] -split \u0027\\\\s+\u0027\\n\\n                $entry = [PSCustomObject]@{\\n                    IP = $ip\\n                    Hostnames = $hostnames\\n                }\\n                $hostsInfo.Entries += $entry\\n\\n                foreach ($hostname in $hostnames) {\\n                    foreach ($pattern in $sensitivePatterns) {\\n                        if ($hostname -match $pattern -and $ip -notmatch \u0027^(127\\\\.0\\\\.0\\\\.1|::1|0\\\\.0\\\\.0\\\\.0)$\u0027) {\\n                            $suspicious = [PSCustomObject]@{\\n                                Entry = $entry\\n                                Reason = \\\"Redirect of $pattern domain to $ip\\\"\\n                            }\\n                            $hostsInfo.Suspicious += $suspicious\\n                            Write-Alert \\\"Hosts file redirect: $hostname -\u003e $ip\\\"\\n                        }\\n                    }\\n                }\\n            }\\n        }\\n\\n        $hostsInfo | ConvertTo-Json -Depth 3 | Set-Content (Join-Path $clientDir \\\"HostsFile.json\\\") -Encoding UTF8\\n        Write-Log \\\"Hosts file entries: $($hostsInfo.Entries.Count), Suspicious: $($hostsInfo.Suspicious.Count)\\\"\\n    }\\n\\n    # C. Browser Extensions (Chrome/Edge)\\n    if ($script:Config.CheckBrowserExtensions) {\\n        Write-SubSection \\\"Browser Extension Audit\\\"\\n\\n        $extInfo = [PSCustomObject]@{\\n            Chrome = @()\\n            Edge = @()\\n            Suspicious = @()\\n        }\\n\\n        # Suspicious extension patterns\\n        $suspiciousPatterns = @(\\\"proxy\\\", \\\"vpn\\\", \\\"intercept\\\", \\\"modify\\\", \\\"inject\\\", \\\"ssl\\\", \\\"certificate\\\", \\\"mitm\\\")\\n\\n        # Chrome extensions\\n        $chromePath = \\\"$env:LOCALAPPDATA\\\\Google\\\\Chrome\\\\User Data\\\\Default\\\\Extensions\\\"\\n        if (Test-Path $chromePath) {\\n            $chromeExts = Get-ChildItem $chromePath -Directory -ErrorAction SilentlyContinue\\n            foreach ($ext in $chromeExts) {\\n                $manifestPath = Get-ChildItem $ext.FullName -Filter \\\"manifest.json\\\" -Recurse -ErrorAction SilentlyContinue | Select-Object -First 1\\n                if ($manifestPath) {\\n                    try {\\n                        $manifest = Get-Content $manifestPath.FullName -Raw | ConvertFrom-Json\\n                        $extData = [PSCustomObject]@{\\n                            Id = $ext.Name\\n                            Name = $manifest.name\\n                            Version = $manifest.version\\n                            Permissions = $manifest.permissions\\n                        }\\n                        $extInfo.Chrome += $extData\\n\\n                        # Check for suspicious permissions\\n                        $perms = $manifest.permissions -join \\\",\\\"\\n                        foreach ($pattern in $suspiciousPatterns) {\\n                            if ($manifest.name -match $pattern -or $perms -match $pattern) {\\n                                $extInfo.Suspicious += [PSCustomObject]@{\\n                                    Browser = \\\"Chrome\\\"\\n                                    Extension = $extData\\n                                    Reason = \\\"Suspicious pattern: $pattern\\\"\\n                                }\\n                                Write-Alert \\\"Suspicious Chrome extension: $($manifest.name)\\\"\\n                            }\\n                        }\\n\\n                        # Check for webRequest/webRequestBlocking (can intercept requests)\\n                        if ($perms -match \\\"webRequest|webRequestBlocking\\\") {\\n                            $extInfo.Suspicious += [PSCustomObject]@{\\n                                Browser = \\\"Chrome\\\"\\n                                Extension = $extData\\n                                Reason = \\\"Has webRequest permission (can intercept/modify requests)\\\"\\n                            }\\n                            Write-Log \\\"Chrome extension with webRequest: $($manifest.name)\\\" -Level \\\"WARN\\\"\\n                        }\\n                    } catch {\\n                        # Skip malformed manifests\\n                    }\\n                }\\n            }\\n        }\\n\\n        # Edge extensions (same structure as Chrome)\\n        $edgePath = \\\"$env:LOCALAPPDATA\\\\Microsoft\\\\Edge\\\\User Data\\\\Default\\\\Extensions\\\"\\n        if (Test-Path $edgePath) {\\n            $edgeExts = Get-ChildItem $edgePath -Directory -ErrorAction SilentlyContinue\\n            foreach ($ext in $edgeExts) {\\n                $manifestPath = Get-ChildItem $ext.FullName -Filter \\\"manifest.json\\\" -Recurse -ErrorAction SilentlyContinue | Select-Object -First 1\\n                if ($manifestPath) {\\n                    try {\\n                        $manifest = Get-Content $manifestPath.FullName -Raw | ConvertFrom-Json\\n                        $extData = [PSCustomObject]@{\\n                            Id = $ext.Name\\n                            Name = $manifest.name\\n                            Version = $manifest.version\\n                            Permissions = $manifest.permissions\\n                        }\\n                        $extInfo.Edge += $extData\\n\\n                        $perms = $manifest.permissions -join \\\",\\\"\\n                        foreach ($pattern in $suspiciousPatterns) {\\n                            if ($manifest.name -match $pattern -or $perms -match $pattern) {\\n                                $extInfo.Suspicious += [PSCustomObject]@{\\n                                    Browser = \\\"Edge\\\"\\n                                    Extension = $extData\\n                                    Reason = \\\"Suspicious pattern: $pattern\\\"\\n                                }\\n                                Write-Alert \\\"Suspicious Edge extension: $($manifest.name)\\\"\\n                            }\\n                        }\\n                    } catch {\\n                        # Skip malformed manifests\\n                    }\\n                }\\n            }\\n        }\\n\\n        $extInfo | ConvertTo-Json -Depth 5 | Set-Content (Join-Path $clientDir \\\"BrowserExtensions.json\\\") -Encoding UTF8\\n        Write-Log \\\"Chrome extensions: $($extInfo.Chrome.Count), Edge extensions: $($extInfo.Edge.Count)\\\"\\n    }\\n}\\n\\n#endregion\\n\\n#region Phase 6: Evidence Finalization\\n\\nfunction Complete-EvidencePackage {\\n    Write-Section \\\"PHASE 6: EVIDENCE FINALIZATION\\\"\\n\\n    # Generate summary\\n    Write-SubSection \\\"Generating Summary\\\"\\n\\n    $alertContent = Get-Content $script:AlertFile -ErrorAction SilentlyContinue\\n    $alertCount = ($alertContent | Where-Object { $_ -ne \u0027\u0027 }).Count\\n\\n    $summary = [PSCustomObject]@{\\n        AuditTimestamp = (Get-Date).ToString(\\\"o\\\")\\n        EvidenceDirectory = $script:BaseDir\\n        TotalAlerts = $alertCount\\n        Targets = $script:Config.Targets\\n        Configuration = @{\\n            TracerouteEnabled = $script:Config.TracerouteEnabled -and -not $SkipTraceroute\\n            ClientSideChecks = -not $SkipClientSideChecks\\n            RootCaExport = $script:Config.ExportRootCa\\n        }\\n        Verdict = if ($alertCount -eq 0) { \\\"No obvious MITM indicators detected\\\" } else { \\\"REVIEW REQUIRED - $alertCount alerts found\\\" }\\n    }\\n\\n    $summary | ConvertTo-Json -Depth 3 | Set-Content (Join-Path $script:BaseDir \\\"Summary.json\\\") -Encoding UTF8\\n\\n    # Generate file hashes for chain of custody\\n    Write-SubSection \\\"Generating Evidence Hashes\\\"\\n\\n    $hashManifest = @()\\n    Get-ChildItem $script:BaseDir -Recurse -File | ForEach-Object {\\n        $hash = Get-FileHash -Path $_.FullName -Algorithm $script:Config.HashAlgorithm\\n        $relativePath = $_.FullName.Substring($script:BaseDir.Length + 1)\\n        $hashManifest += [PSCustomObject]@{\\n            File = $relativePath\\n            Algorithm = $script:Config.HashAlgorithm\\n            Hash = $hash.Hash\\n        }\\n    }\\n\\n    $hashManifest | ConvertTo-Json -Depth 3 | Set-Content (Join-Path $script:BaseDir \\\"_FileHashes.json\\\") -Encoding UTF8\\n    Write-Log \\\"Generated hashes for $($hashManifest.Count) files\\\"\\n\\n    # Final output\\n    Write-Host \\\"\\\"\\n    Write-Host (\\\"=\\\" * 70) -ForegroundColor Green\\n    Write-Host \\\" AUDIT COMPLETE\\\" -ForegroundColor Green\\n    Write-Host (\\\"=\\\" * 70) -ForegroundColor Green\\n    Write-Host \\\"\\\"\\n    Write-Host \\\"Evidence Directory: $script:BaseDir\\\" -ForegroundColor Cyan\\n    Write-Host \\\"\\\"\\n\\n    if ($alertCount -gt 0) {\\n        Write-Host \\\"ALERTS FOUND: $alertCount\\\" -ForegroundColor Red\\n        Write-Host \\\"Review _RedFlags.txt immediately!\\\" -ForegroundColor Yellow\\n        Write-Host \\\"\\\"\\n        Write-Host \\\"--- ALERTS ---\\\" -ForegroundColor Red\\n        Get-Content $script:AlertFile | ForEach-Object { Write-Host \\\"  $_\\\" -ForegroundColor Yellow }\\n    } else {\\n        Write-Host \\\"No obvious MITM indicators detected.\\\" -ForegroundColor Green\\n        Write-Host \\\"Note: Passive interception (logging only) may not trigger alerts.\\\" -ForegroundColor Yellow\\n    }\\n\\n    Write-Host \\\"\\\"\\n    Write-Host \\\"NEXT STEPS:\\\" -ForegroundColor Cyan\\n    Write-Host \\\"  1. Review _RedFlags.txt for immediate concerns\\\" -ForegroundColor White\\n    Write-Host \\\"  2. Check certificate serials against crt.sh (on clean network)\\\" -ForegroundColor White\\n    Write-Host \\\"  3. Zip the evidence folder and hash the zip for chain of custody\\\" -ForegroundColor White\\n    Write-Host \\\"\\\"\\n}\\n\\n#endregion\\n\\n#region Main Execution\\n\\n# Load configuration\\nif ($ConfigFile) {\\n    Read-ConfigFile -Path $ConfigFile\\n} else {\\n    $defaultConfig = Join-Path $PSScriptRoot \\\"mitm-audit.cfg\\\"\\n    if (Test-Path $defaultConfig) {\\n        Read-ConfigFile -Path $defaultConfig\\n    }\\n}\\n\\n# Override targets if specified\\nif ($Targets) {\\n    $script:Config.Targets = $Targets -split \u0027,\u0027 | ForEach-Object { $_.Trim() }\\n}\\n\\n# Initialize output\\nInitialize-OutputDirectory -BasePath $OutputPath\\n\\nWrite-Host \\\"\\\"\\nWrite-Host (\\\"=\\\" * 70) -ForegroundColor Cyan\\nWrite-Host \\\" INFRASTRUCTURE MITM AUDIT - FORENSIC EVIDENCE COLLECTION\\\" -ForegroundColor Cyan\\nWrite-Host (\\\"=\\\" * 70) -ForegroundColor Cyan\\nWrite-Host \\\"Timestamp: $(Get-Date -Format \u0027yyyy-MM-dd HH:mm:ss\u0027)\\\"\\nWrite-Host \\\"Evidence Directory: $script:BaseDir\\\"\\nWrite-Host \\\"Targets: $($script:Config.Targets -join \u0027, \u0027)\\\"\\nWrite-Host \\\"\\\"\\n\\nWrite-Log \\\"Audit started\\\"\\nWrite-Log \\\"Targets: $($script:Config.Targets -join \u0027, \u0027)\\\"\\n\\n# Execute phases\\nGet-EnvironmentSnapshot\\nExport-TrustStore\\nInvoke-TargetAnalysis\\nInvoke-TracerouteMapping\\nTest-ClientSideExploits\\nComplete-EvidencePackage\\n\\nWrite-Log \\\"Audit completed\\\"\\n\\n#endregion\\n\\n\"}"},"checkpointId":"75a74f52-dfec-4347-a522-090e917eccbb"},"bubbleId":"d78eb378-1d32-4ff3-812f-93a34d555a21"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"d805447e-a987-4c60-8bdf-a1909575127d","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:40:25.057Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"text":"","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878","codeBlocks":[{"uri":{"scheme":"file","authority":"","path":"/c:/Users/user/Downloads/Cursor_working_directory_misc/templates/network/README.md","query":"","fragment":"","_formatted":"file:///c%3A/Users/user/Downloads/Cursor_working_directory_misc/templates/network/README.md","_fsPath":null},"codeblockId":"615388a3-3023-4d02-8b40-07de53847f8c","codeBlockIdx":0,"content":"# Network Diagnostics Toolkit\n\nNetwork scanning, DNS diagnostics, forensics collection, and Infrastructure MITM detection tools.\n\n## Scripts\n\n| Script | Platform | Purpose |\n|--------|----------|---------|\n| `Invoke-NetworkScan-v7.ps1` | Windows (PS7) | TCP port scanner with service detection |\n| `Invoke-DnsDiagnostics-v7.ps1` | Windows (PS7) | DNS anomaly detection and consistency checks |\n| `Invoke-NetworkForensics-v7.ps1` | Windows (PS7) | Forensic data collection and analysis |\n| `Invoke-MitmAudit-v7.ps1` | Windows (PS7) | Infrastructure MITM detection with ASN/DoH/Cert analysis |\n| `Invoke-BackgroundDiagnostics-v7.ps1` | Windows (PS7) | Background wrapper for all diagnostics |\n| `network-scan.sh` | POSIX | TCP port scanner |\n| `dns-diagnostics.sh` | POSIX | DNS testing and anomaly detection |\n| `network-forensics.sh` | POSIX | Forensic data collection |\n| `mitm-audit.sh` | POSIX | Infrastructure MITM detection with ASN/DoH/Cert analysis |\n| `Invoke-PacketCapture-v7.ps1` | Windows (PS7) | Packet capture with pktmon (full detail, timestamps) |\n| `packet-capture.sh` | POSIX | Packet capture with tcpdump (full detail, timestamps) |\n\n## Configuration\n\nAll scripts use `network.cfg` with KEY=VALUE format:\n\n```\nTARGET_HOST=192.168.1.1\nTARGET_NETWORK=192.168.1.0/24\nSCAN_PORTS=21,22,23,25,53,80,443,445,3389,8080,8443\nDNS_SERVERS=1.1.1.1,8.8.8.8,9.9.9.9\nDNS_TEST_DOMAINS=api2.cursor.sh,github.com,google.com\nSCAN_TIMEOUT_MS=500\nOUTPUT_DIR=./network-diagnostics\n\n# Packet capture settings\nCAPTURE_SNAPLEN=0\nCAPTURE_MAX_SIZE_MB=512\nCAPTURE_ROTATE_COUNT=10\nCAPTURE_TIMESTAMP_PRECISION=nano\nCAPTURE_CONVERT_PCAPNG=true\n```\n\n## Usage Examples\n\n### Network Scanning\n\n```powershell\n# Windows - Scan single host\n.\\Invoke-NetworkScan-v7.ps1 -Target 192.168.1.1 -Ports \"22,80,443\"\n\n# Windows - Use config file\n.\\Invoke-NetworkScan-v7.ps1 -ConfigFile .\\network.cfg\n\n# Unix\n./network-scan.sh -t 192.168.1.1 -p \"22,80,443\"\n```\n\n### DNS Diagnostics\n\n```powershell\n# Windows - Test specific domain\n.\\Invoke-DnsDiagnostics-v7.ps1 -Domain api2.cursor.sh\n\n# Windows - Full diagnostics with config\n.\\Invoke-DnsDiagnostics-v7.ps1 -ConfigFile .\\network.cfg -OutputPath .\\results\n\n# Unix\n./dns-diagnostics.sh -d api2.cursor.sh -s \"1.1.1.1,8.8.8.8\"\n```\n\n### Network Forensics\n\n```powershell\n# Windows - Full collection\n.\\Invoke-NetworkForensics-v7.ps1 -OutputPath .\\forensics\n\n# Unix\n./network-forensics.sh -o ./forensics\n```\n\n### Background Execution (for Agent/Automation)\n\nFor scripts that may run indefinitely or timeout in agent sessions:\n\n```powershell\n# Windows - Run any diagnostic in background\n.\\Invoke-BackgroundDiagnostics-v7.ps1 -Script NetworkForensics -OutputPath .\\results\n.\\Invoke-BackgroundDiagnostics-v7.ps1 -Script DnsDiagnostics -WaitSeconds 30\n.\\Invoke-BackgroundDiagnostics-v7.ps1 -Script PacketCapture -ScriptArgs @{Duration=60}\n\n# Check status\nGet-Content .\\results\\*-status.json\n\n# Read output when complete\nGet-Content .\\results\\*-stdout.txt\n```\n\n```sh\n# Unix - Use nohup for background\nnohup ./network-forensics.sh -o ./results \u003e forensics.log 2\u003e\u00261 \u0026\n\n# Check later\ncat forensics.log\n```\n\n### Infrastructure MITM Audit\n\nDetects infrastructure-side Man-in-the-Middle attacks while ruling out client-side exploits. Uses `mitm-audit.cfg`.\n\n```powershell\n# Windows - Full MITM audit\n.\\Invoke-MitmAudit-v7.ps1\n\n# Windows - With custom config\n.\\Invoke-MitmAudit-v7.ps1 -ConfigFile .\\mitm-audit.cfg\n\n# Windows - Custom targets, skip traceroute\n.\\Invoke-MitmAudit-v7.ps1 -Targets \"accounts.google.com,github.com\" -SkipTraceroute\n\n# Unix\n./mitm-audit.sh\n\n# Unix - With options\n./mitm-audit.sh -c ./mitm-audit.cfg -t \"accounts.google.com,github.com\" --skip-traceroute\n```\n\n#### MITM Detection Capabilities\n\n- **ASN Integrity**: Verifies Google/Microsoft/Apple/Amazon/GitHub resolve to their ASNs\n- **DoH Comparison**: Compares local DNS to DNS-over-HTTPS (dns.google) as control group\n- **Certificate Analysis**: Captures TLS certs, detects anomalous issuers for major tech\n- **Root CA Audit**: Exports trust store, detects enterprise MITM tools and suspicious CAs\n- **Traceroute Mapping**: Identifies suspicious hops through VPS providers\n- **Client-Side Checks**: Proxy settings, browser extensions, hosts file tampering\n\n#### Evidence Processing\n\n1. Check `_RedFlags.txt` first - if empty, MITM may be passive/logging only\n2. Certificate Serial Check - copy serial to [crt.sh](https://crt.sh) on clean device:\n   - \"No certificates found\" = 100% MITM by private root CA\n   - Cert shown for different domain = collision/hash attack or mis-issuance\n3. Zip evidence folder, hash the zip for chain of custody\n\n#### Output Structure\n\n```\nForensicEvidence_YYYYMMDD_HHMMSS/\n  _AuditLog.txt          # Full audit log\n  _RedFlags.txt          # Immediate alerts (check this first)\n  _FileHashes.json       # SHA256 hashes for chain of custody\n  Summary.json           # Audit verdict and configuration\n  environment/\n    NetworkConfig.json   # IP/DNS configuration\n    ExternalIP.json      # External IP and ISP info\n    SystemInfo.json      # System identification\n  trust-store/\n    RootStore_Dump.csv   # All root CAs (Windows)\n    RootCA_Snapshot.crt  # CA bundle (Linux/macOS)\n    RootCA_Hash.json     # Hash of CA store\n    SuspiciousCAs.json   # Flagged certificates\n  targets/\n    accounts_google_com/\n      Analysis.json      # Full analysis results\n      Certificate.json   # TLS certificate details\n      dns.txt            # DNS resolution data\n    (... other targets ...)\n  traceroute/\n    Trace_*.txt          # Raw traceroute output\n    Trace_*.json         # Hops with ASN lookup\n  client-side/\n    ProxySettings.json   # System/environment proxy\n    HostsFile.json       # /etc/hosts analysis\n    BrowserExtensions.json # Installed extensions\n```\n\n### Packet Capture\n\n```powershell\n# Windows - Capture with pktmon (requires Admin)\n.\\Invoke-PacketCapture-v7.ps1 -Duration 60 -OutputPath .\\captures\n.\\Invoke-PacketCapture-v7.ps1 -Filter \"port 443\" -Duration 30 -ConvertToPcap\n\n# Unix - Capture with tcpdump (requires root/sudo)\n./packet-capture.sh -i eth0 -d 60 -o ./captures\n./packet-capture.sh -f \"port 443 or port 80\" -d 30\n./packet-capture.sh -i any -f \"host 192.168.1.1\" -d 120\n```\n\n#### Capture Options\n\n**Windows (pktmon):**\n- Full packet capture (no truncation)\n- All network components\n- ETL format with optional PCAPNG conversion\n- Timestamp precision to nanoseconds\n\n**Unix (tcpdump):**\n- `-XX` Hex and ASCII dump\n- `-vvv` Maximum verbosity\n- `-tttt` Human-readable timestamps with date\n- `-S` Absolute sequence numbers\n- `--time-stamp-precision=nano` Nanosecond precision (if supported)\n- File rotation support\n\n## Detection Capabilities\n\n### DNS Diagnostics\n\n- DNS hijacking (fake IPs like 0.0.0.x)\n- LLMNR/NetBIOS poisoning (.lan/.local suffixes)\n- DNS response inconsistencies across servers\n- Temporary resolution failures (EAI_AGAIN)\n\n### Network Forensics\n\n- ARP spoofing (duplicate MAC addresses)\n- Suspicious listening ports\n- Malware C2 ports (4444, 5555, 31337, etc.)\n- Hosts file tampering\n- Firewall state analysis\n- Promiscuous mode detection\n\n### Infrastructure MITM Audit\n\n- **ASN Mismatch Detection**: Google domains not resolving to Google ASN, etc.\n- **VPS Provider Alert**: Auth traffic routed through DigitalOcean/Linode/Vultr/etc.\n- **DoH vs Local DNS Comparison**: Detects DNS manipulation at ISP/network level\n- **Certificate Anomalies**: Major tech domains with Let\u0027s Encrypt/ZeroSSL certs\n- **Enterprise MITM Tools**: Zscaler, BlueCoat, Forcepoint in root CA store\n- **Recently Added Root CAs**: Certs added within last 30 days flagged\n- **Suspicious Traceroute Hops**: Traffic routed through unexpected providers\n- **Client-Side Exploit Ruling Out**: Proxy, browser extensions, hosts file checks\n\n## Output Format\n\nAll tools output JSON files for programmatic analysis:\n\n```\n./network-diagnostics/\n  scan-2025-12-01_15-00-00.json\n  dns-diagnostics-2025-12-01_15-00-00.json\n\n./network-forensics/\n  summary.json\n  network/\n    connections.json\n    interfaces.json\n    arp-cache.json\n    routes.json\n    listeners.json\n  dns/\n    cache.json\n    hosts-file.json\n  security/\n    firewall.json\n  processes/\n    network-processes.json\n```\n\n## Requirements\n\n### Windows\n\n- PowerShell 7+\n- Administrator privileges recommended for full data collection\n\n### Unix/Linux/macOS\n\n- POSIX-compliant shell\n- One of: dig, nslookup, or host (for DNS)\n- One of: nc (netcat), or bash with /dev/tcp support (for scanning)\n- tcpdump for packet capture\n- root/sudo for packet capture and full forensics collection\n\n## License\n\nBSD-2-Clause\n\n## Signed-off-by\n\nNetwork Diagnostics Toolkit\n\n","languageId":"markdown"}],"capabilityType":15,"toolFormerData":{"tool":38,"toolCallId":"toolu_01Hqgn7LHMU6VTQ7fxJePxzW","toolIndex":1,"modelCallId":"cc026af3-dd49-44c8-8f5b-5bf26f2f3c50","status":"completed","rawArgs":"{\"file_path\": \"templates/network/README.md\", \"old_string\": \"## Detection Capabilities\\n\\n### DNS Diagnostics\\n\\n- DNS hijacking (fake IPs like 0.0.0.x)\\n- LLMNR/NetBIOS poisoning (.lan/.local suffixes)\\n- DNS response inconsistencies across servers\\n- Temporary resolution failures (EAI_AGAIN)\\n\\n### Network Forensics\\n\\n- ARP spoofing (duplicate MAC addresses)\\n- Suspicious listening ports\\n- Malware C2 ports (4444, 5555, 31337, etc.)\\n- Hosts file tampering\\n- Firewall state analysis\\n- Promiscuous mode detection\", \"new_string\": \"## Detection Capabilities\\n\\n### DNS Diagnostics\\n\\n- DNS hijacking (fake IPs like 0.0.0.x)\\n- LLMNR/NetBIOS poisoning (.lan/.local suffixes)\\n- DNS response inconsistencies across servers\\n- Temporary resolution failures (EAI_AGAIN)\\n\\n### Network Forensics\\n\\n- ARP spoofing (duplicate MAC addresses)\\n- Suspicious listening ports\\n- Malware C2 ports (4444, 5555, 31337, etc.)\\n- Hosts file tampering\\n- Firewall state analysis\\n- Promiscuous mode detection\\n\\n### Infrastructure MITM Audit\\n\\n- **ASN Mismatch Detection**: Google domains not resolving to Google ASN, etc.\\n- **VPS Provider Alert**: Auth traffic routed through DigitalOcean/Linode/Vultr/etc.\\n- **DoH vs Local DNS Comparison**: Detects DNS manipulation at ISP/network level\\n- **Certificate Anomalies**: Major tech domains with Let\u0027s Encrypt/ZeroSSL certs\\n- **Enterprise MITM Tools**: Zscaler, BlueCoat, Forcepoint in root CA store\\n- **Recently Added Root CAs**: Certs added within last 30 days flagged\\n- **Suspicious Traceroute Hops**: Traffic routed through unexpected providers\\n- **Client-Side Exploit Ruling Out**: Proxy, browser extensions, hosts file checks\"}","name":"search_replace","params":"{\"relativeWorkspacePath\":\"templates/network/README.md\"}","additionalData":{"codeblockId":"615388a3-3023-4d02-8b40-07de53847f8c","reviewData":{"status":"None","selectedOption":"accept","isShowingInput":false,"firstTimeReviewMode":false}},"userDecision":"accepted","result":"{\"diff\":{\"chunks\":[{\"diffString\":\"  - Firewall state analysis\\n  - Promiscuous mode detection\\n+ \\n+ ### Infrastructure MITM Audit\\n+ \\n+ - **ASN Mismatch Detection**: Google domains not resolving to Google ASN, etc.\\n+ - **VPS Provider Alert**: Auth traffic routed through DigitalOcean/Linode/Vultr/etc.\\n+ - **DoH vs Local DNS Comparison**: Detects DNS manipulation at ISP/network level\\n+ - **Certificate Anomalies**: Major tech domains with Let\u0027s Encrypt/ZeroSSL certs\\n+ - **Enterprise MITM Tools**: Zscaler, BlueCoat, Forcepoint in root CA store\\n+ - **Recently Added Root CAs**: Certs added within last 30 days flagged\\n+ - **Suspicious Traceroute Hops**: Traffic routed through unexpected providers\\n+ - **Client-Side Exploit Ruling Out**: Proxy, browser extensions, hosts file checks\\n  \\n  ## Output Format\",\"oldStart\":219,\"newStart\":219,\"oldLines\":4,\"newLines\":15,\"linesAdded\":11}],\"editor\":\"EDITOR_AI\"},\"shouldAutoFixLints\":true,\"resultForModel\":\"The file templates/network/README.md has been updated.\",\"contentsAfterEdit\":\"# Network Diagnostics Toolkit\\n\\nNetwork scanning, DNS diagnostics, forensics collection, and Infrastructure MITM detection tools.\\n\\n## Scripts\\n\\n| Script | Platform | Purpose |\\n|--------|----------|---------|\\n| `Invoke-NetworkScan-v7.ps1` | Windows (PS7) | TCP port scanner with service detection |\\n| `Invoke-DnsDiagnostics-v7.ps1` | Windows (PS7) | DNS anomaly detection and consistency checks |\\n| `Invoke-NetworkForensics-v7.ps1` | Windows (PS7) | Forensic data collection and analysis |\\n| `Invoke-MitmAudit-v7.ps1` | Windows (PS7) | Infrastructure MITM detection with ASN/DoH/Cert analysis |\\n| `Invoke-BackgroundDiagnostics-v7.ps1` | Windows (PS7) | Background wrapper for all diagnostics |\\n| `network-scan.sh` | POSIX | TCP port scanner |\\n| `dns-diagnostics.sh` | POSIX | DNS testing and anomaly detection |\\n| `network-forensics.sh` | POSIX | Forensic data collection |\\n| `mitm-audit.sh` | POSIX | Infrastructure MITM detection with ASN/DoH/Cert analysis |\\n| `Invoke-PacketCapture-v7.ps1` | Windows (PS7) | Packet capture with pktmon (full detail, timestamps) |\\n| `packet-capture.sh` | POSIX | Packet capture with tcpdump (full detail, timestamps) |\\n\\n## Configuration\\n\\nAll scripts use `network.cfg` with KEY=VALUE format:\\n\\n```\\nTARGET_HOST=192.168.1.1\\nTARGET_NETWORK=192.168.1.0/24\\nSCAN_PORTS=21,22,23,25,53,80,443,445,3389,8080,8443\\nDNS_SERVERS=1.1.1.1,8.8.8.8,9.9.9.9\\nDNS_TEST_DOMAINS=api2.cursor.sh,github.com,google.com\\nSCAN_TIMEOUT_MS=500\\nOUTPUT_DIR=./network-diagnostics\\n\\n# Packet capture settings\\nCAPTURE_SNAPLEN=0\\nCAPTURE_MAX_SIZE_MB=512\\nCAPTURE_ROTATE_COUNT=10\\nCAPTURE_TIMESTAMP_PRECISION=nano\\nCAPTURE_CONVERT_PCAPNG=true\\n```\\n\\n## Usage Examples\\n\\n### Network Scanning\\n\\n```powershell\\n# Windows - Scan single host\\n.\\\\Invoke-NetworkScan-v7.ps1 -Target 192.168.1.1 -Ports \\\"22,80,443\\\"\\n\\n# Windows - Use config file\\n.\\\\Invoke-NetworkScan-v7.ps1 -ConfigFile .\\\\network.cfg\\n\\n# Unix\\n./network-scan.sh -t 192.168.1.1 -p \\\"22,80,443\\\"\\n```\\n\\n### DNS Diagnostics\\n\\n```powershell\\n# Windows - Test specific domain\\n.\\\\Invoke-DnsDiagnostics-v7.ps1 -Domain api2.cursor.sh\\n\\n# Windows - Full diagnostics with config\\n.\\\\Invoke-DnsDiagnostics-v7.ps1 -ConfigFile .\\\\network.cfg -OutputPath .\\\\results\\n\\n# Unix\\n./dns-diagnostics.sh -d api2.cursor.sh -s \\\"1.1.1.1,8.8.8.8\\\"\\n```\\n\\n### Network Forensics\\n\\n```powershell\\n# Windows - Full collection\\n.\\\\Invoke-NetworkForensics-v7.ps1 -OutputPath .\\\\forensics\\n\\n# Unix\\n./network-forensics.sh -o ./forensics\\n```\\n\\n### Background Execution (for Agent/Automation)\\n\\nFor scripts that may run indefinitely or timeout in agent sessions:\\n\\n```powershell\\n# Windows - Run any diagnostic in background\\n.\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script NetworkForensics -OutputPath .\\\\results\\n.\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script DnsDiagnostics -WaitSeconds 30\\n.\\\\Invoke-BackgroundDiagnostics-v7.ps1 -Script PacketCapture -ScriptArgs @{Duration=60}\\n\\n# Check status\\nGet-Content .\\\\results\\\\*-status.json\\n\\n# Read output when complete\\nGet-Content .\\\\results\\\\*-stdout.txt\\n```\\n\\n```sh\\n# Unix - Use nohup for background\\nnohup ./network-forensics.sh -o ./results \u003e forensics.log 2\u003e\u00261 \u0026\\n\\n# Check later\\ncat forensics.log\\n```\\n\\n### Infrastructure MITM Audit\\n\\nDetects infrastructure-side Man-in-the-Middle attacks while ruling out client-side exploits. Uses `mitm-audit.cfg`.\\n\\n```powershell\\n# Windows - Full MITM audit\\n.\\\\Invoke-MitmAudit-v7.ps1\\n\\n# Windows - With custom config\\n.\\\\Invoke-MitmAudit-v7.ps1 -ConfigFile .\\\\mitm-audit.cfg\\n\\n# Windows - Custom targets, skip traceroute\\n.\\\\Invoke-MitmAudit-v7.ps1 -Targets \\\"accounts.google.com,github.com\\\" -SkipTraceroute\\n\\n# Unix\\n./mitm-audit.sh\\n\\n# Unix - With options\\n./mitm-audit.sh -c ./mitm-audit.cfg -t \\\"accounts.google.com,github.com\\\" --skip-traceroute\\n```\\n\\n#### MITM Detection Capabilities\\n\\n- **ASN Integrity**: Verifies Google/Microsoft/Apple/Amazon/GitHub resolve to their ASNs\\n- **DoH Comparison**: Compares local DNS to DNS-over-HTTPS (dns.google) as control group\\n- **Certificate Analysis**: Captures TLS certs, detects anomalous issuers for major tech\\n- **Root CA Audit**: Exports trust store, detects enterprise MITM tools and suspicious CAs\\n- **Traceroute Mapping**: Identifies suspicious hops through VPS providers\\n- **Client-Side Checks**: Proxy settings, browser extensions, hosts file tampering\\n\\n#### Evidence Processing\\n\\n1. Check `_RedFlags.txt` first - if empty, MITM may be passive/logging only\\n2. Certificate Serial Check - copy serial to [crt.sh](https://crt.sh) on clean device:\\n   - \\\"No certificates found\\\" = 100% MITM by private root CA\\n   - Cert shown for different domain = collision/hash attack or mis-issuance\\n3. Zip evidence folder, hash the zip for chain of custody\\n\\n#### Output Structure\\n\\n```\\nForensicEvidence_YYYYMMDD_HHMMSS/\\n  _AuditLog.txt          # Full audit log\\n  _RedFlags.txt          # Immediate alerts (check this first)\\n  _FileHashes.json       # SHA256 hashes for chain of custody\\n  Summary.json           # Audit verdict and configuration\\n  environment/\\n    NetworkConfig.json   # IP/DNS configuration\\n    ExternalIP.json      # External IP and ISP info\\n    SystemInfo.json      # System identification\\n  trust-store/\\n    RootStore_Dump.csv   # All root CAs (Windows)\\n    RootCA_Snapshot.crt  # CA bundle (Linux/macOS)\\n    RootCA_Hash.json     # Hash of CA store\\n    SuspiciousCAs.json   # Flagged certificates\\n  targets/\\n    accounts_google_com/\\n      Analysis.json      # Full analysis results\\n      Certificate.json   # TLS certificate details\\n      dns.txt            # DNS resolution data\\n    (... other targets ...)\\n  traceroute/\\n    Trace_*.txt          # Raw traceroute output\\n    Trace_*.json         # Hops with ASN lookup\\n  client-side/\\n    ProxySettings.json   # System/environment proxy\\n    HostsFile.json       # /etc/hosts analysis\\n    BrowserExtensions.json # Installed extensions\\n```\\n\\n### Packet Capture\\n\\n```powershell\\n# Windows - Capture with pktmon (requires Admin)\\n.\\\\Invoke-PacketCapture-v7.ps1 -Duration 60 -OutputPath .\\\\captures\\n.\\\\Invoke-PacketCapture-v7.ps1 -Filter \\\"port 443\\\" -Duration 30 -ConvertToPcap\\n\\n# Unix - Capture with tcpdump (requires root/sudo)\\n./packet-capture.sh -i eth0 -d 60 -o ./captures\\n./packet-capture.sh -f \\\"port 443 or port 80\\\" -d 30\\n./packet-capture.sh -i any -f \\\"host 192.168.1.1\\\" -d 120\\n```\\n\\n#### Capture Options\\n\\n**Windows (pktmon):**\\n- Full packet capture (no truncation)\\n- All network components\\n- ETL format with optional PCAPNG conversion\\n- Timestamp precision to nanoseconds\\n\\n**Unix (tcpdump):**\\n- `-XX` Hex and ASCII dump\\n- `-vvv` Maximum verbosity\\n- `-tttt` Human-readable timestamps with date\\n- `-S` Absolute sequence numbers\\n- `--time-stamp-precision=nano` Nanosecond precision (if supported)\\n- File rotation support\\n\\n## Detection Capabilities\\n\\n### DNS Diagnostics\\n\\n- DNS hijacking (fake IPs like 0.0.0.x)\\n- LLMNR/NetBIOS poisoning (.lan/.local suffixes)\\n- DNS response inconsistencies across servers\\n- Temporary resolution failures (EAI_AGAIN)\\n\\n### Network Forensics\\n\\n- ARP spoofing (duplicate MAC addresses)\\n- Suspicious listening ports\\n- Malware C2 ports (4444, 5555, 31337, etc.)\\n- Hosts file tampering\\n- Firewall state analysis\\n- Promiscuous mode detection\\n\\n### Infrastructure MITM Audit\\n\\n- **ASN Mismatch Detection**: Google domains not resolving to Google ASN, etc.\\n- **VPS Provider Alert**: Auth traffic routed through DigitalOcean/Linode/Vultr/etc.\\n- **DoH vs Local DNS Comparison**: Detects DNS manipulation at ISP/network level\\n- **Certificate Anomalies**: Major tech domains with Let\u0027s Encrypt/ZeroSSL certs\\n- **Enterprise MITM Tools**: Zscaler, BlueCoat, Forcepoint in root CA store\\n- **Recently Added Root CAs**: Certs added within last 30 days flagged\\n- **Suspicious Traceroute Hops**: Traffic routed through unexpected providers\\n- **Client-Side Exploit Ruling Out**: Proxy, browser extensions, hosts file checks\\n\\n## Output Format\\n\\nAll tools output JSON files for programmatic analysis:\\n\\n```\\n./network-diagnostics/\\n  scan-2025-12-01_15-00-00.json\\n  dns-diagnostics-2025-12-01_15-00-00.json\\n\\n./network-forensics/\\n  summary.json\\n  network/\\n    connections.json\\n    interfaces.json\\n    arp-cache.json\\n    routes.json\\n    listeners.json\\n  dns/\\n    cache.json\\n    hosts-file.json\\n  security/\\n    firewall.json\\n  processes/\\n    network-processes.json\\n```\\n\\n## Requirements\\n\\n### Windows\\n\\n- PowerShell 7+\\n- Administrator privileges recommended for full data collection\\n\\n### Unix/Linux/macOS\\n\\n- POSIX-compliant shell\\n- One of: dig, nslookup, or host (for DNS)\\n- One of: nc (netcat), or bash with /dev/tcp support (for scanning)\\n- tcpdump for packet capture\\n- root/sudo for packet capture and full forensics collection\\n\\n## License\\n\\nBSD-2-Clause\\n\\n## Signed-off-by\\n\\nNetwork Diagnostics Toolkit\\n\\n\"}"},"checkpointId":"26375bd3-c518-4d41-9651-d10f4f7362b9"},"bubbleId":"d805447e-a987-4c60-8bdf-a1909575127d"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"eaaf4988-4290-43b7-82ec-ce3929896a42","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:39:46.675Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"text":"Now let me update the README in the network templates directory and add integration to the background diagnostics wrapper:","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878"},"bubbleId":"eaaf4988-4290-43b7-82ec-ce3929896a42"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"eb3835f0-78d0-4c0e-a8da-86fc1b56582d","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:40:50.104Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"text":"Now let me update the background diagnostics wrapper to support the MITM audit script:","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878"},"bubbleId":"eb3835f0-78d0-4c0e-a8da-86fc1b56582d"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"ed58e18a-72d7-4a43-83bb-dc5d46ee537c","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:35:13.067Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"text":"Now I have a complete picture. I\u0027ll create reconciled Infrastructure MITM audit scripts that:\n\n1. **Follow workspace conventions** (`.cfg` file, BSD-2-Clause, no emojis)\n2. **Have feature parity** between PowerShell and POSIX shell\n3. **Include all \"Gold Standard\" MITM detection** (ASN checks, DoH comparison, cert serial capture)\n4. **Add client-side exploit ruling out** (proxy settings, browser extensions, root CA anomalies)\n5. **Produce identical evidence package structure** with integrity hashing\n\nLet me create the unified solution:","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878"},"bubbleId":"ed58e18a-72d7-4a43-83bb-dc5d46ee537c"}
{"data":{"_v":3,"type":2,"approximateLintErrors":[],"lints":[],"codebaseContextChunks":[],"commits":[],"pullRequests":[],"attachedCodeChunks":[],"assistantSuggestedDiffs":[],"gitDiffs":[],"interpreterResults":[],"images":[],"attachedFolders":[],"attachedFoldersNew":[],"bubbleId":"f7f2af16-07ba-4096-bf75-6295e097ffd0","userResponsesToSuggestedCodeBlocks":[],"suggestedCodeBlocks":[],"diffsForCompressingFiles":[],"relevantFiles":[],"toolResults":[],"notepads":[],"capabilities":[],"capabilityStatuses":{"mutate-request":[],"start-submit-chat":[],"before-submit-chat":[],"chat-stream-finished":[],"before-apply":[],"after-apply":[],"accept-all-edits":[],"composer-done":[],"process-stream":[],"add-pending-action":[]},"multiFileLinterErrors":[],"diffHistories":[],"recentLocationsHistory":[],"recentlyViewedFiles":[],"isAgentic":false,"fileDiffTrajectories":[],"existedSubsequentTerminalCommand":false,"existedPreviousTerminalCommand":false,"docsReferences":[],"webReferences":[],"aiWebSearchResults":[],"requestId":"","attachedFoldersListDirResults":[],"humanChanges":[],"attachedHumanChanges":false,"summarizedComposers":[],"cursorRules":[],"contextPieces":[],"editTrailContexts":[],"allThinkingBlocks":[],"diffsSinceLastApply":[],"deletedFiles":[],"supportedTools":[],"tokenCount":{"inputTokens":0,"outputTokens":0},"attachedFileCodeChunksMetadataOnly":[],"consoleLogs":[],"uiElementPicked":[],"isRefunded":false,"knowledgeItems":[],"documentationSelections":[],"externalLinks":[],"useWeb":false,"projectLayouts":[],"unifiedMode":2,"capabilityContexts":[],"todos":[],"createdAt":"2025-12-16T03:37:40.663Z","isQuickSearchQuery":false,"mcpDescriptors":[],"workspaceUris":[],"text":"Now let me create the POSIX shell version with feature parity:","usageUuid":"9e1c53bb-86a3-41a3-ad2a-43628bbff878"},"bubbleId":"f7f2af16-07ba-4096-bf75-6295e097ffd0"}
