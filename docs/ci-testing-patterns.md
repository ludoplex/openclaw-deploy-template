# CI/CD & Testing Patterns Reference

*Generated by seeker agent â€” 2026-02-04*

## FastAPI CI Best Practices

### Caching with setup-python (Simple)
```yaml
- uses: actions/setup-python@v5
  with:
    python-version: '3.12'
    cache: 'pip'
```

### Caching with UV (Faster)
```yaml
- uses: astral-sh/setup-uv@v7
  with:
    enable-cache: true
    cache-dependency-glob: |
      pyproject.toml
      uv.lock
```

### Ruff Linting (Official Action)
```yaml
- uses: astral-sh/ruff-action@v3
- run: ruff check --fix
- run: ruff format
```

---

## HTMX Testing Patterns

### Testing Partial Responses
```python
def test_htmx_partial():
    response = client.get("/users", headers={"HX-Request": "true"})
    assert response.status_code == 200
    assert "<ul>" in response.text  # HTML fragment
    assert "<!DOCTYPE html>" not in response.text  # Not full page
```

### Testing Full Page (non-HTMX)
```python
def test_full_page():
    response = client.get("/users")  # No HX-Request header
    assert "<!DOCTYPE html>" in response.text
```

### Testing with Auth Dependencies
```python
from app.dependencies import get_current_user

def mock_current_user():
    return {"id": 1, "username": "testuser"}

app.dependency_overrides[get_current_user] = mock_current_user
```

---

## Matrix Testing Pattern

```yaml
strategy:
  fail-fast: false
  matrix:
    python-version: ["3.10", "3.11", "3.12"]
    os: [ubuntu-latest, windows-latest]
```

---

## Key Resources

- FastAPI Testing Docs: https://fastapi.tiangolo.com/tutorial/testing/
- Dependency Override Testing: https://fastapi.tiangolo.com/advanced/testing-dependencies/
- Starlette TestClient: https://www.starlette.dev/testclient/
- FastHX (HTMX decorators): https://github.com/volfpeter/fasthx
- FastAPI-HTMX: https://github.com/maces/fastapi-htmx
